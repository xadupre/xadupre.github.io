
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>MVP Spec &#8212; Custom Extensions to ML.net 0.8.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/font-awesome@4.5.0/css/font-awesome.min.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ML.net releases details" href="changes.html" />
    <link rel="prev" title="VBuffer Care and Feeding" href="vbuffercarefeeding.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="mvp-spec">
<span id="mvp-spec"></span><h1>MVP Spec<a class="headerlink" href="#mvp-spec" title="Permalink to this headline">¶</a></h1>
<p>This document is meant to capture the key requirements and rough drafts of the
API surface we need to get ready by Build, which is the conference we’re going
to release an initial preview of our API shape.</p>
<p>That means the marker <strong>Currently out of scope</strong> really applies to deliverables
for Build. Post Build, we’ll update this document to reflect upcoming release
timelines.</p>
<div class="section" id="prediction">
<span id="prediction"></span><h2>Prediction<a class="headerlink" href="#prediction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-experience">
<span id="user-experience"></span><h3>User Experience<a class="headerlink" href="#user-experience" title="Permalink to this headline">¶</a></h3>
<p>Mikayla works for a real estate company. They have a database of houses that
might go up for sale. They’d like to use machine learning to predict the house
prices. Since Mikayla is new to machine learning, she decides to use the ML.NET
UI to create a model for this. After she create the model, the UI offers to
generate some C# code that she can incorporate into her ASP.NET Core web site.</p>
</div>
<div class="section" id="code">
<span id="code"></span><h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<p>The generated code is meant to be easily copy &amp; pasted into a developer’s
application or library. The <code class="docutils literal notranslate"><span class="pre">Main</span></code> method is likely being adapted to match the
developer’s application but the intention is to give them something to get
started with. It also illustrates how the APIs are meant to be used without
having to consult the documentation.</p>
<p><strong>Currently out of scope</strong>. Later on, we might decide to integrate the UI and
code generation directly into Visual Studio, in which case we’ll likely have to
separate code we expect the developer to use as-is from sample code.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Here is how you&#39;d use these types from your application:</span>

<span class="cm">/*</span>
<span class="cm">class Program</span>
<span class="cm">{</span>
<span class="cm">    static async Task Main(string[] args)</span>
<span class="cm">    {</span>
<span class="cm">        var path = @&quot;C:\users\mikayla\documents\houseprices.zip&quot;;</span>
<span class="cm">        var model = await PredictionModel.ReadAsync&lt;HousePriceData, HousePricePrediction&gt;(path);</span>
<span class="cm">        var house = new HousePriceData</span>
<span class="cm">        {</span>
<span class="cm">            // TODO: initialize your data type you&#39;d like to get predictions for</span>
<span class="cm">        };</span>
<span class="cm">        HousePricePrediction prediction = model.Predict(house);</span>
<span class="cm">    }</span>
<span class="cm">}</span>
<span class="cm">*/</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// This class represents your input data.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">HousePriceData</span>
<span class="p">{</span>
<span class="na">    [Column(ordinal: &quot;0&quot;)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Id</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;1&quot;)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Date</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;2&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Bedrooms</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;3&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Bathrooms</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;4&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">SqftLiving</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;5&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">SqftLot</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;6&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Floors</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;7&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Waterfront</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;8&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">View</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;9&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Condition</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;10&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Grade</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;11&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">SqftAbove</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;12&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">SqftBasement</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;13&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">YearBuilt</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;14&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">YearRenovated</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;15&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">ZipCode</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;16&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Lat</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;17&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Long</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;18&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">SqftLiving15</span><span class="p">;</span>
<span class="na">    [Column(ordinal: &quot;19&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">SqftLot15</span><span class="p">;</span>
<span class="na">    [Column(name: &quot;Label&quot;, ordinal: &quot;19&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Price</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// This class represents the result of a prediction for your input. The</span>
<span class="c1">/// predicted value is marked with &lt;c&gt;[ColumnName(&quot;Score&quot;)]&lt;/c&gt;.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">HousePricePrediction</span>
<span class="p">{</span>
<span class="na">    [Column(&quot;Score&quot;)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">Price</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="design">
<span id="design"></span><h3>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>We like the term <em>Model</em> to represent the persisted graph with the trained
state. However, <em>Model</em> is too generic of a name, so we need a prefix. We
penciled in <code class="docutils literal notranslate"><span class="pre">PredictionModel</span></code> as that’s the only useful API on this type right
now. Once we looked at training and extended the API surface we can revisit
that decision.</li>
<li>The model should be immutable. We’ll offer a conversion API to go from the
model to the building block for training, for example, <code class="docutils literal notranslate"><span class="pre">ToPipeline()</span></code>.</li>
<li>The persisted <code class="docutils literal notranslate"><span class="pre">model.zip</span></code> has no notion of .NET types. It only has schema
information. Strong typing requires the developer to specify the types when
loading the model but it makes serialization/deserialization simpler and more
sustainable: the schema is matched by duck typing.</li>
<li>TLC supports the packing of multiple fields into an array instead of accessing
the values as individual fields. They did this for performance optimization.<ul>
<li>We believe this can be a more advanced scenario for the developer who is
willing to massage the data type more to get better performance.</li>
<li><strong>Currently out of scope</strong></li>
</ul>
</li>
<li>We made the sample code a comment rather than code. It’s very likely that
developers will need to adapt it to their code while there are still iterating
on the model with the GUI. If we always generate it, they would have to delete
the code every single time they regenerated the source code.</li>
</ul>
</div>
<div class="section" id="api-shape">
<span id="api-shape"></span><h3>API Shape<a class="headerlink" href="#api-shape" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nn">Microsoft.MachineLearning</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PredictionModel</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">PredictionModel</span> <span class="nf">ReadAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">PredictionModel</span> <span class="nf">ReadAsync</span><span class="p">(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">PredictionModel</span><span class="p">&lt;</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TOutput</span><span class="p">&gt;</span> <span class="n">ReadAsync</span><span class="p">&lt;</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TOutput</span><span class="p">&gt;(</span><span class="kt">string</span> <span class="n">path</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">PredictionModel</span><span class="p">&lt;</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TOutput</span><span class="p">&gt;</span> <span class="n">ReadAsync</span><span class="p">&lt;</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TOutput</span><span class="p">&gt;(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">);</span>

        <span class="k">public</span> <span class="n">IDataView</span> <span class="nf">Predict</span><span class="p">(</span><span class="n">IDataView</span> <span class="n">data</span><span class="p">);</span>
        <span class="k">public</span> <span class="n">Task</span> <span class="nf">WriteAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">);</span>
        <span class="k">public</span> <span class="n">Task</span> <span class="nf">WriteAsync</span><span class="p">(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PredictionModel</span><span class="p">&lt;</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TOutput</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">PredictionModel</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TOuput</span><span class="p">&gt;</span> <span class="n">Predict</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TInput</span><span class="p">&gt;</span> <span class="n">data</span><span class="p">);</span>
        <span class="k">public</span> <span class="n">TOuput</span> <span class="nf">Predict</span><span class="p">(</span><span class="n">TInput</span> <span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="open-questions">
<span id="open-questions"></span><h3>Open questions<a class="headerlink" href="#open-questions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>We currently use properties while the core components (<code class="docutils literal notranslate"><span class="pre">PredictionEngine&lt;&gt;</span></code>
and <code class="docutils literal notranslate"><span class="pre">BatchPredictionEngine&lt;&gt;</span></code>) only supports fields. Can it support properties
or should we change the spec?<ul>
<li>Properties are preferred because it’s what .NET developers are used to.</li>
<li>It also gives them a way to encapsulate logic that the TLC engine doesn’t
need to understand (like lazily loading data or syncing derived values).</li>
</ul>
</li>
<li>Should we support binding to immutable data types?<ul>
<li>The engine would either have to bind to fields or understand typical
conventions of immutable types (using withers).</li>
<li><strong>Currently out of scope</strong></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="training">
<span id="training"></span><h2>Training<a class="headerlink" href="#training" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-experience">
<span id="id1"></span><h3>User Experience<a class="headerlink" href="#user-experience" title="Permalink to this headline">¶</a></h3>
<p>Mikayla is using the ML.NET UI for a while. It helped her to get familiar with
the concepts. She would now like to train using code, as this would enable her
to automate this task. As Mikayla is writing the code, she notices that it can
be challenging to understand what columns are available at a given point in the
training pipeline. She’s glad that she can simply set a breakpoint, step over
the items and explore the schema as well as the actual data.</p>
<p>Using edit-and-continue she’s able to get the pipeline up and running. This
approach is similar to what she has seen in a Python-focused Pluralsight course
on machine learning, but more familiar to her as she’s an experienced C#
developer.</p>
</div>
<div class="section" id="code">
<span id="id2"></span><h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<p>Similar to prediction, the ML.NET UI might be able to allow for the training
code to be generated as well. However, we’ve optimized the API shape to be
written by hand, which includes the ability to easily debug the training
pipeline:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">path</span> <span class="p">=</span> <span class="s">@&quot;C:\users\mikayla\documents\houses.csv&quot;</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">CsvOptions</span><span class="p">.</span><span class="n">CreateFrom</span><span class="p">&lt;</span><span class="n">HousePriceData</span><span class="p">&gt;(</span><span class="n">separator</span><span class="p">:</span> <span class="sc">&#39;\t&#39;</span><span class="p">,</span> <span class="n">header</span><span class="p">:</span> <span class="k">true</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="n">LearningPipeline</span><span class="p">&lt;</span><span class="n">HousePriceData</span><span class="p">,</span> <span class="n">HousePricePrediction</span><span class="p">&gt;();</span>

<span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">TextLoader</span><span class="p">&lt;</span><span class="n">HousePriceData</span><span class="p">&gt;(</span><span class="n">path</span><span class="p">,</span> <span class="n">options</span><span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ConcatColumns</span><span class="p">(</span>
    <span class="s">&quot;NumericalFeatures&quot;</span><span class="p">,</span>
    <span class="s">&quot;SqftLiving&quot;</span><span class="p">,</span> <span class="s">&quot;SqftLot&quot;</span><span class="p">,</span> <span class="s">&quot;SqftAbove&quot;</span><span class="p">,</span> <span class="s">&quot;SqftBasement&quot;</span><span class="p">,</span> <span class="s">&quot;Lat&quot;</span><span class="p">,</span> <span class="s">&quot;Long&quot;</span><span class="p">,</span>
    <span class="s">&quot;SqftLiving15&quot;</span><span class="p">,</span> <span class="s">&quot;SqftLot15&quot;</span>
<span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ConcatColumns</span><span class="p">(</span>
    <span class="s">&quot;CategoryFeatures&quot;</span><span class="p">,</span>
    <span class="s">&quot;Bedrooms&quot;</span><span class="p">,</span> <span class="s">&quot;Bathrooms&quot;</span><span class="p">,</span> <span class="s">&quot;Floors&quot;</span><span class="p">,</span> <span class="s">&quot;Waterfront&quot;</span><span class="p">,</span> <span class="s">&quot;View&quot;</span><span class="p">,</span> <span class="s">&quot;Condition&quot;</span><span class="p">,</span>
    <span class="s">&quot;Grade&quot;</span><span class="p">,</span> <span class="s">&quot;YearBuilt&quot;</span><span class="p">,</span> <span class="s">&quot;YearRenovated&quot;</span><span class="p">,</span> <span class="s">&quot;Zipcode&quot;</span>
<span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">CatTransformDict</span><span class="p">(</span>
    <span class="s">&quot;CategoryFeatures&quot;</span>
<span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ConcatColumns</span><span class="p">(</span>
    <span class="s">&quot;Features&quot;</span><span class="p">,</span>
    <span class="s">&quot;NumericalFeatures&quot;</span><span class="p">,</span> <span class="s">&quot;CategoryFeatures&quot;</span>
<span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">TrainRegression</span><span class="p">());</span>

<span class="n">PredictionModel</span><span class="p">&lt;</span><span class="n">HousePriceData</span><span class="p">,</span> <span class="n">HousePricePrediction</span><span class="p">&gt;</span> <span class="n">model</span> <span class="p">=</span> <span class="k">await</span> <span class="n">p</span><span class="p">.</span><span class="n">TrainAsync</span><span class="p">();</span>

<span class="k">await</span> <span class="n">model</span><span class="p">.</span><span class="n">WriteAsync</span><span class="p">(</span><span class="s">@&quot;C:\users\mikayla\documents\houseModel.zip&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging">
<span id="debugging"></span><h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>The expectation is that the debugging will be made possible by inspecting the
pipeline object. Consider these lines of code:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">p</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="p">();</span>
<span class="cm">/* 1 */</span> <span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">CsvLoader</span><span class="p">(</span><span class="n">trainFilePath</span><span class="p">,</span> <span class="n">options</span><span class="p">));</span>
<span class="cm">/* 2 */</span> <span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Categorical</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;CategoricalFeatures&quot;</span><span class="p">));</span>
<span class="cm">/* 3 */</span> <span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ColumnConcatenator</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="s">&quot;Features&quot;</span><span class="p">,</span>
              <span class="s">&quot;NumericalFeatures&quot;</span><span class="p">,</span> <span class="s">&quot;CategoricalFeatures&quot;</span><span class="p">));</span>
<span class="cm">/* 4 */</span> <span class="n">p</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">SdcaRegressor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
              <span class="n">learningRate</span><span class="p">:</span> <span class="m">10</span><span class="p">,</span>
              <span class="n">label</span><span class="p">:</span> <span class="s">&quot;price&quot;</span><span class="p">,</span> <span class="s">&quot;zipcode&quot;</span><span class="p">,</span> <span class="s">&quot;waterfront&quot;</span><span class="p">,</span> <span class="s">&quot;bedrooms&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>When the developer sets a breakpoint on statement (1), the pipeline is empty.
Thus no data or schema information will be present.</p>
<p>Subsequent breakpoints will allow the developer to inspect the pipeline with the
elements that were added so far. For instance at point (2) the CSV schema
information and data will be present. At point (3) and (4) the categorical and
column concatenation will be available.</p>
<p>It’s important to point out that outside the debugger no execution of the
pipeline happens until <code class="docutils literal notranslate"><span class="pre">PredictionModel.CreateAsync(p)</span></code> is called. The execution
during debugging will be achieved by <a class="reference external" href="https://docs.microsoft.com/en-us/visualstudio/debugger/using-debuggertypeproxy-attribute">debugger type proxies</a>.</p>
</div>
<div class="section" id="design">
<span id="id3"></span><h3>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Our graph execution model is declarative, i.e. the developer isn’t
mechanically pulling or pushing data throught the system. Instead, the
developer creates a graph and passes it to a graph runner, which is currently
represented by <code class="docutils literal notranslate"><span class="pre">PredictionModel.CreateAsync</span></code>. The construction of the graph
itself is imperative, which creates locals for individuals nodes which means
we have a chance to make it debuggable.</li>
<li>We need to be able to debug the flow, which means the developer needs to
be able to view the schema as well as the top N rows of the actual data.<ul>
<li>Add a `take(100)`` transform after loader or add a parameter to the loader</li>
<li>Train a model</li>
<li>Predict with a model using some dataset, such as the train dataset</li>
</ul>
</li>
<li>We need to avoid eager computation/full loading of data, i.e. streaming of
large amounts must be possible without extra work for the developer.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">LearningPipeline</span></code> is mutable as immutability doesn’t buy us much:<ul>
<li>No thread safety issues as <code class="docutils literal notranslate"><span class="pre">TrainAsync()</span></code> effectively snapshots the graph.</li>
<li>The fluent syntax is mostly useful to avoid saying `p.`` which C# collection
initializer syntax solves as well</li>
<li>Immutability is heavy handed as we’d have to make sure that all nodes are
too</li>
<li>C# developers primarily think in terms mutable APIs</li>
</ul>
</li>
<li>We believe we want a three-line automatic API where customers only need to
declare the schema, specify the column they want to predict (AKA the label)
and then they will get a generated pipeline they can make predictions with
without knowing anything about machine learning.<ul>
<li><strong>Currently out of scope</strong></li>
</ul>
</li>
<li>We believe we also want a <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>-style API that allows us to add items
and have the type do the wiring so that code can be moved more freely without
having to perform error prone rewiring.<ul>
<li><strong>Currently out of scope</strong></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="api-shape">
<span id="id4"></span><h3>API Shape<a class="headerlink" href="#api-shape" title="Permalink to this headline">¶</a></h3>
<p>This captures the abstract base type we expect all nodes, such as <code class="docutils literal notranslate"><span class="pre">CsvLoader</span></code>,
<code class="docutils literal notranslate"><span class="pre">Categorical</span></code>, <code class="docutils literal notranslate"><span class="pre">ColumnConcatenator</span></code>, and <code class="docutils literal notranslate"><span class="pre">SdcaRegressor</span></code> to derive from:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nn">Microsoft.MachineLearning</span>
<span class="p">{</span>  
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">PipelineItem</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">PipelineItem</span> <span class="n">Previous</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="c1">// We need to expose a debugger viewer, which might be an attribute</span>
        <span class="c1">// public IDataView Output { get; }</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The pipeline items will be spread across multiple namespaces:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Microsoft.MachineLearning</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Microsoft.MachineLearning.Pipeline</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Microsoft.MachineLearning.Pipeline.Loaders</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Microsoft.MachineLearning.Pipeline.Transforms</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Microsoft.MachineLearning.Pipeline.Learners</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Microsoft.MachineLearning.Pipeline.Evaluators</span></code></li>
</ul>
<p>All nodes will have coverloads for the constructor that accept a previous
as well as ones that do not so that they can be wired later:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nn">Microsoft.MachineLearning.Transforms</span>
<span class="p">{</span>  
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Categorical</span> <span class="p">:</span> <span class="n">PipelineItem</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">Categorical</span><span class="p">(</span><span class="n">PipelineItem</span> <span class="n">previous</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">columns</span><span class="p">);</span>
        <span class="k">public</span> <span class="nf">Categorical</span><span class="p">(</span><span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">columns</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ColumnConcatenator</span> <span class="p">:</span> <span class="n">PipelineItem</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">ColumnConcatenator</span><span class="p">(</span><span class="n">PipelineItem</span> <span class="n">previous</span><span class="p">,</span> <span class="kt">string</span> <span class="n">outputColumn</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">columns</span><span class="p">);</span>
        <span class="k">public</span> <span class="nf">ColumnConcatenator</span><span class="p">(</span><span class="kt">string</span> <span class="n">outputColumn</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">columns</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This captures the CSV reader APIs:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nn">Microsoft.MachineLearning</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">DataType</span>
    <span class="p">{</span>
        <span class="n">Boolean</span><span class="p">,</span>
        <span class="n">Int32</span><span class="p">,</span>
        <span class="n">Single</span><span class="p">,</span>
        <span class="n">Double</span><span class="p">,</span>
        <span class="n">String</span>        
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CsvColumn</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">CsvColumn</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">DataType</span> <span class="n">dataType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ordinal</span><span class="p">);</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DataType</span> <span class="n">DataType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Ordinal</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CsvOptions</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">CsvOptions</span> <span class="nf">CreateFrom</span><span class="p">(</span><span class="kt">char</span> <span class="n">separator</span> <span class="p">=</span> <span class="sc">&#39;,&#39;</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">hasHeader</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">Type</span> <span class="n">rowType</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">CsvOptions</span> <span class="n">CreateFrom</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kt">char</span> <span class="n">separator</span> <span class="p">=</span> <span class="sc">&#39;,&#39;</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">hasHeader</span> <span class="p">=</span> <span class="k">true</span><span class="p">);</span>

        <span class="k">public</span> <span class="nf">CsvOptions</span><span class="p">();</span>
        <span class="k">public</span> <span class="kt">char</span> <span class="n">Separator</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">HasHeader</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">CsvColumnCollection</span> <span class="n">Columns</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CsvColumnCollection</span> <span class="p">:</span> <span class="n">Collection</span><span class="p">&lt;</span><span class="n">CsvColumn</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">CsvColumn</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">DataType</span> <span class="n">dataType</span><span class="p">);</span>
        <span class="k">public</span> <span class="n">CsvColumn</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">DataType</span> <span class="n">dataType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ordinal</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="evaluation">
<span id="evaluation"></span><h2>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-experience">
<span id="id5"></span><h3>User Experience<a class="headerlink" href="#user-experience" title="Permalink to this headline">¶</a></h3>
<p>Mikayla has trained her model and would like to see how well her model is able
to predict prices based on known sample data. Using the evaluation APIs she’s
able to create a .NET Core console application that allows her to automate
assessing the quality of the current model by printing relevant statistical
measures, such as RMS, R-square, and others.</p>
</div>
<div class="section" id="code">
<span id="id6"></span><h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">model</span> <span class="p">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="n">Train</span><span class="p">&lt;</span><span class="n">HousePriceData</span><span class="p">,</span> <span class="n">HousePricePrediction</span><span class="p">&gt;();</span>
<span class="kt">var</span> <span class="n">testData</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TextLoader</span><span class="p">&lt;</span><span class="n">HousePriceData</span><span class="p">&gt;(</span><span class="n">TestDataPath</span><span class="p">,</span> <span class="n">useHeader</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="s">&quot;,&quot;</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">evaluator</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RegressionEvaluator</span><span class="p">();</span>
<span class="n">RegressionMetrics</span> <span class="n">metrics</span> <span class="p">=</span> <span class="n">evaluator</span><span class="p">.</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">testData</span><span class="p">);</span>

<span class="c1">// RMS is the main metric for judging how good the regression prediction</span>
<span class="c1">// worked. It stands for &quot;root mean square loss&quot;.</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Rms=&quot;</span> <span class="p">+</span> <span class="n">metrics</span><span class="p">.</span><span class="n">Rms</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/project_ico.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">Custom Extensions to ML.net</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataframe.html">DataFrames in C#</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commandline.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">ML.net Components</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../machinelearning_docs.html">ML.net details</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">ML.net details</a></li>
<li class="toctree-l2"><a class="reference internal" href="changes.html">ML.net releases details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Scikit.ML details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apicsharpdoc.html">CSharp API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aonnx.html">ML.net and ONNX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../incompatibilities.html">ML.net customization</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../machinelearning_docs.html">ML.net details</a><ul>
  <li><a href="index.html">ML.net details</a><ul>
      <li>Previous: <a href="vbuffercarefeeding.html" title="previous chapter"><code class="docutils literal notranslate"><span class="pre">VBuffer</span></code> Care and Feeding</a></li>
      <li>Next: <a href="changes.html" title="next chapter">ML.net releases details</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/mlnetdocs/mvp.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>