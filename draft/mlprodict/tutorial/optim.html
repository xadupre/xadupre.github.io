
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Converters with options &#8212; Python Runtime for ONNX</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my-styles.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="shortcut icon" href="../_static/project_ico.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Benchmarks" href="benchmark.html" />
    <link rel="prev" title="Execute ONNX graphs" href="onnx_runtime.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Tutorial
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../onnx.html">
  ONNX, Runtime, Backends
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../onnx_bench.html">
  scikit-learn Converters and Benchmarks
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../i_cmd.html">
  Command lines
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../i_ex.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../i_index.html">
  FAQ, code, …
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../gyexamples/index.html">
  Gallery of examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../all_notebooks.html">
  Notebook Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../HISTORY.html">
  History
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_runtime.html">
   Execute ONNX graphs
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Converters with options
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="benchmark.html">
   Benchmarks
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="skl.html">
   From scikit-learn to ONNX
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_numpy.html">
   Create custom ONNX graphs with AST
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_api_onnx.html">
   Numpy to ONNX: Create ONNX graphs with an API similar to numpy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="xop_api.html">
   Xop API
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ex_python.html">
   Export ONNX into Python
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-cdist-for-gaussianprocessregressor">
   Option cdist for GaussianProcessRegressor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-model-supported-cdist">
   Other model supported cdist
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-zipmap-for-classifiers">
   Option
   <em>
    zipmap
   </em>
   for classifiers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-raw-scores-for-classifiers">
   Option
   <em>
    raw_scores
   </em>
   for classifiers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pickability-and-pipeline">
   Pickability and Pipeline
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="converters-with-options">
<span id="l-onnx-tutorial-optim"></span><h1>Converters with options<a class="headerlink" href="#converters-with-options" title="Permalink to this headline">#</a></h1>
<p>Some converters have options to change the way
a specific operator is converted. The whole list
is described at <a class="reference external" href="http://www.xavierdupre.fr/app/sklearn-onnx/helpsphinx/parameterized.html">Converters with options</a>.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#option-cdist-for-gaussianprocessregressor" id="id1">Option cdist for GaussianProcessRegressor</a></p></li>
<li><p><a class="reference internal" href="#other-model-supported-cdist" id="id2">Other model supported cdist</a></p></li>
<li><p><a class="reference internal" href="#option-zipmap-for-classifiers" id="id3">Option <em>zipmap</em> for classifiers</a></p></li>
<li><p><a class="reference internal" href="#option-raw-scores-for-classifiers" id="id4">Option <em>raw_scores</em> for classifiers</a></p></li>
<li><p><a class="reference internal" href="#pickability-and-pipeline" id="id5">Pickability and Pipeline</a></p></li>
</ul>
</div>
<section id="option-cdist-for-gaussianprocessregressor">
<h2><a class="toc-backref" href="#id1">Option cdist for GaussianProcessRegressor</a><a class="headerlink" href="#option-cdist-for-gaussianprocessregressor" title="Permalink to this headline">#</a></h2>
<p>Notebooks <a class="reference internal" href="../notebooks/onnx_pdist.html#onnxpdistrst"><span class="std std-ref">Pairwise distances with ONNX (pdist)</span></a> shows how much slower
an <a class="reference external" href="https://onnx.ai/">ONNX</a> implementation of function
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cdist.html">cdist</a>, from 3 to 10 times slower.
One way to optimize the converted model is to
create dedicated operators such as the one for function
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cdist.html">cdist</a>. The first example shows how to
convert a <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.gaussian_process.GaussianProcessRegressor.html">GaussianProcessRegressor</a> into
standard <a class="reference external" href="https://onnx.ai/">ONNX</a> (see also <a class="reference internal" href="../mlprodict/onnxrt/ops_cpu/op_cdist.html#mlprodict.onnxrt.ops_cpu.op_cdist.CDist" title="mlprodict.onnxrt.ops_cpu.op_cdist.CDist"><code class="xref py py-class docutils literal notranslate"><span class="pre">CDist</span></code></a>).</p>

    <div id="gdot-139922694304240-cont"><div id="gdot-139922694304240" style="width:100%;height:100%;"></div>
    <script>

    require(['../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  ranksep=0.25;\n  nodesep=0.05;\n  orientation=portrait;\n  size=7;\n\n  X [shape=box color=red label=\"X\\ndouble((0, 4))\" fontsize=10];\n\n  GPmean [shape=box color=green label=\"GPmean\\ndouble((0, 1))\" fontsize=10];\n\n  Sc_Scancst [shape=box label=\"Sc_Scancst\\nfloat64((112, 4))\\n[[5.5 3.5 1.3 0.2]\\n [6.  2.7 5.1 1.6]\\n [5.  2.  3....\" fontsize=10];\n  kgpd_Divcst [shape=box label=\"kgpd_Divcst\\nfloat64((1,))\\n[0.295]\" fontsize=10];\n  kgpd_Mulcst [shape=box label=\"kgpd_Mulcst\\nfloat64((1,))\\n[3.142]\" fontsize=10];\n  kgpd_Divcst1 [shape=box label=\"kgpd_Divcst1\\nfloat64((1,))\\n[1634.535]\" fontsize=10];\n  kgpd_Powcst [shape=box label=\"kgpd_Powcst\\nfloat64((1,))\\n[2.]\" fontsize=10];\n  kgpd_Mulcst1 [shape=box label=\"kgpd_Mulcst1\\nfloat64((1,))\\n[-2.]\" fontsize=10];\n  gpr_MatMulcst [shape=box label=\"gpr_MatMulcst\\nfloat64((112,))\\n[-0.041  0.009  0.009  0.059 -0.041  0.009  0.059 ...\" fontsize=10];\n  gpr_Addcst [shape=box label=\"gpr_Addcst\\nfloat64((1, 1))\\n[[0.]]\" fontsize=10];\n  Re_Reshapecst [shape=box label=\"Re_Reshapecst\\nint64((2,))\\n[-1  1]\" fontsize=10];\n\n  UU040UU [shape=box label=\"UU040UU\" fontsize=10];\n  UU041UU [shape=box label=\"UU041UU\" fontsize=10];\n  Sc_Scan [shape=box style=\"filled,rounded\" color=orange label=\"Scan\\n(Sc_Scan)\\nbody=node {\\n  input: 'next_in'...\\nnum_scan_inputs=1\" fontsize=10];\n  X -> Sc_Scan;\n  Sc_Scancst -> Sc_Scan;\n  Sc_Scan -> UU040UU;\n  Sc_Scan -> UU041UU;\n\n  kgpd_transposed0 [shape=box label=\"kgpd_transposed0\" fontsize=10];\n  kgpd_Transpose [shape=box style=\"filled,rounded\" color=orange label=\"Transpose\\n(kgpd_Transpose)\\nperm=[1 0]\" fontsize=10];\n  UU041UU -> kgpd_Transpose;\n  kgpd_Transpose -> kgpd_transposed0;\n\n  kgpd_Y0 [shape=box label=\"kgpd_Y0\" fontsize=10];\n  kgpd_Sqrt [shape=box style=\"filled,rounded\" color=orange label=\"Sqrt\\n(kgpd_Sqrt)\" fontsize=10];\n  kgpd_transposed0 -> kgpd_Sqrt;\n  kgpd_Sqrt -> kgpd_Y0;\n\n  kgpd_C03 [shape=box label=\"kgpd_C03\" fontsize=10];\n  kgpd_Div [shape=box style=\"filled,rounded\" color=orange label=\"Div\\n(kgpd_Div)\" fontsize=10];\n  kgpd_Y0 -> kgpd_Div;\n  kgpd_Divcst -> kgpd_Div;\n  kgpd_Div -> kgpd_C03;\n\n  kgpd_C02 [shape=box label=\"kgpd_C02\" fontsize=10];\n  kgpd_Mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(kgpd_Mul)\" fontsize=10];\n  kgpd_C03 -> kgpd_Mul;\n  kgpd_Mulcst -> kgpd_Mul;\n  kgpd_Mul -> kgpd_C02;\n\n  kgpd_output02 [shape=box label=\"kgpd_output02\" fontsize=10];\n  kgpd_Sin [shape=box style=\"filled,rounded\" color=orange label=\"Sin\\n(kgpd_Sin)\" fontsize=10];\n  kgpd_C02 -> kgpd_Sin;\n  kgpd_Sin -> kgpd_output02;\n\n  kgpd_C01 [shape=box label=\"kgpd_C01\" fontsize=10];\n  kgpd_Div1 [shape=box style=\"filled,rounded\" color=orange label=\"Div\\n(kgpd_Div1)\" fontsize=10];\n  kgpd_output02 -> kgpd_Div1;\n  kgpd_Divcst1 -> kgpd_Div1;\n  kgpd_Div1 -> kgpd_C01;\n\n  kgpd_Z0 [shape=box label=\"kgpd_Z0\" fontsize=10];\n  kgpd_Pow [shape=box style=\"filled,rounded\" color=orange label=\"Pow\\n(kgpd_Pow)\" fontsize=10];\n  kgpd_C01 -> kgpd_Pow;\n  kgpd_Powcst -> kgpd_Pow;\n  kgpd_Pow -> kgpd_Z0;\n\n  kgpd_C0 [shape=box label=\"kgpd_C0\" fontsize=10];\n  kgpd_Mul1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(kgpd_Mul1)\" fontsize=10];\n  kgpd_Z0 -> kgpd_Mul1;\n  kgpd_Mulcst1 -> kgpd_Mul1;\n  kgpd_Mul1 -> kgpd_C0;\n\n  kgpd_output01 [shape=box label=\"kgpd_output01\" fontsize=10];\n  kgpd_Exp [shape=box style=\"filled,rounded\" color=orange label=\"Exp\\n(kgpd_Exp)\" fontsize=10];\n  kgpd_C0 -> kgpd_Exp;\n  kgpd_Exp -> kgpd_output01;\n\n  gpr_Y0 [shape=box label=\"gpr_Y0\" fontsize=10];\n  gpr_MatMul [shape=box style=\"filled,rounded\" color=orange label=\"MatMul\\n(gpr_MatMul)\" fontsize=10];\n  kgpd_output01 -> gpr_MatMul;\n  gpr_MatMulcst -> gpr_MatMul;\n  gpr_MatMul -> gpr_Y0;\n\n  gpr_C0 [shape=box label=\"gpr_C0\" fontsize=10];\n  gpr_Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(gpr_Add)\" fontsize=10];\n  gpr_Y0 -> gpr_Add;\n  gpr_Addcst -> gpr_Add;\n  gpr_Add -> gpr_C0;\n\n  Re_Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Re_Reshape)\\nallowzero=0\" fontsize=10];\n  gpr_C0 -> Re_Reshape;\n  Re_Reshapecst -> Re_Reshape;\n  Re_Reshape -> GPmean;\n}\n");
    document.getElementById('gdot-139922694304240').innerHTML = svgGraph; });
    
</script>
</div><p>Now the new model with the operator <cite>CDist</cite>.</p>

    <div id="gdot-139922694306640-cont"><div id="gdot-139922694306640" style="width:100%;height:100%;"></div>
    <script>

    require(['../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  ranksep=0.25;\n  nodesep=0.05;\n  orientation=portrait;\n  size=7;\n\n  X [shape=box color=red label=\"X\\ndouble((0, 4))\" fontsize=10];\n\n  GPmean [shape=box color=green label=\"GPmean\\ndouble((0, 1))\" fontsize=10];\n\n  kgpd_CDistcst [shape=box label=\"kgpd_CDistcst\\nfloat64((112, 4))\\n[[5.5 3.5 1.3 0.2]\\n [6.  2.7 5.1 1.6]\\n [5.  2.  3....\" fontsize=10];\n  kgpd_Divcst [shape=box label=\"kgpd_Divcst\\nfloat64((1,))\\n[0.295]\" fontsize=10];\n  kgpd_Mulcst [shape=box label=\"kgpd_Mulcst\\nfloat64((1,))\\n[3.142]\" fontsize=10];\n  kgpd_Divcst1 [shape=box label=\"kgpd_Divcst1\\nfloat64((1,))\\n[1634.535]\" fontsize=10];\n  kgpd_Powcst [shape=box label=\"kgpd_Powcst\\nfloat64((1,))\\n[2.]\" fontsize=10];\n  kgpd_Mulcst1 [shape=box label=\"kgpd_Mulcst1\\nfloat64((1,))\\n[-2.]\" fontsize=10];\n  gpr_MatMulcst [shape=box label=\"gpr_MatMulcst\\nfloat64((112,))\\n[-0.041  0.009  0.009  0.059 -0.041  0.009  0.059 ...\" fontsize=10];\n  gpr_Addcst [shape=box label=\"gpr_Addcst\\nfloat64((1, 1))\\n[[0.]]\" fontsize=10];\n  Re_Reshapecst [shape=box label=\"Re_Reshapecst\\nint64((2,))\\n[-1  1]\" fontsize=10];\n\n  kgpd_dist [shape=box label=\"kgpd_dist\" fontsize=10];\n  kgpd_CDist [shape=box style=\"filled,rounded\" color=orange label=\"CDist\\n(kgpd_CDist)\\nmetric=b'euclidean'\" fontsize=10];\n  X -> kgpd_CDist;\n  kgpd_CDistcst -> kgpd_CDist;\n  kgpd_CDist -> kgpd_dist;\n\n  kgpd_C03 [shape=box label=\"kgpd_C03\" fontsize=10];\n  kgpd_Div [shape=box style=\"filled,rounded\" color=orange label=\"Div\\n(kgpd_Div)\" fontsize=10];\n  kgpd_dist -> kgpd_Div;\n  kgpd_Divcst -> kgpd_Div;\n  kgpd_Div -> kgpd_C03;\n\n  kgpd_C02 [shape=box label=\"kgpd_C02\" fontsize=10];\n  kgpd_Mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(kgpd_Mul)\" fontsize=10];\n  kgpd_C03 -> kgpd_Mul;\n  kgpd_Mulcst -> kgpd_Mul;\n  kgpd_Mul -> kgpd_C02;\n\n  kgpd_output02 [shape=box label=\"kgpd_output02\" fontsize=10];\n  kgpd_Sin [shape=box style=\"filled,rounded\" color=orange label=\"Sin\\n(kgpd_Sin)\" fontsize=10];\n  kgpd_C02 -> kgpd_Sin;\n  kgpd_Sin -> kgpd_output02;\n\n  kgpd_C01 [shape=box label=\"kgpd_C01\" fontsize=10];\n  kgpd_Div1 [shape=box style=\"filled,rounded\" color=orange label=\"Div\\n(kgpd_Div1)\" fontsize=10];\n  kgpd_output02 -> kgpd_Div1;\n  kgpd_Divcst1 -> kgpd_Div1;\n  kgpd_Div1 -> kgpd_C01;\n\n  kgpd_Z0 [shape=box label=\"kgpd_Z0\" fontsize=10];\n  kgpd_Pow [shape=box style=\"filled,rounded\" color=orange label=\"Pow\\n(kgpd_Pow)\" fontsize=10];\n  kgpd_C01 -> kgpd_Pow;\n  kgpd_Powcst -> kgpd_Pow;\n  kgpd_Pow -> kgpd_Z0;\n\n  kgpd_C0 [shape=box label=\"kgpd_C0\" fontsize=10];\n  kgpd_Mul1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(kgpd_Mul1)\" fontsize=10];\n  kgpd_Z0 -> kgpd_Mul1;\n  kgpd_Mulcst1 -> kgpd_Mul1;\n  kgpd_Mul1 -> kgpd_C0;\n\n  kgpd_output01 [shape=box label=\"kgpd_output01\" fontsize=10];\n  kgpd_Exp [shape=box style=\"filled,rounded\" color=orange label=\"Exp\\n(kgpd_Exp)\" fontsize=10];\n  kgpd_C0 -> kgpd_Exp;\n  kgpd_Exp -> kgpd_output01;\n\n  gpr_Y0 [shape=box label=\"gpr_Y0\" fontsize=10];\n  gpr_MatMul [shape=box style=\"filled,rounded\" color=orange label=\"MatMul\\n(gpr_MatMul)\" fontsize=10];\n  kgpd_output01 -> gpr_MatMul;\n  gpr_MatMulcst -> gpr_MatMul;\n  gpr_MatMul -> gpr_Y0;\n\n  gpr_C0 [shape=box label=\"gpr_C0\" fontsize=10];\n  gpr_Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(gpr_Add)\" fontsize=10];\n  gpr_Y0 -> gpr_Add;\n  gpr_Addcst -> gpr_Add;\n  gpr_Add -> gpr_C0;\n\n  Re_Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Re_Reshape)\\nallowzero=0\" fontsize=10];\n  gpr_C0 -> Re_Reshape;\n  Re_Reshapecst -> Re_Reshape;\n  Re_Reshape -> GPmean;\n}\n");
    document.getElementById('gdot-139922694306640').innerHTML = svgGraph; });
    
</script>
</div><p>The only change is parameter <em>options</em>
set to <code class="docutils literal notranslate"><span class="pre">options={GaussianProcessRegressor:</span> <span class="pre">{'optim':</span> <span class="pre">'cdist'}}</span></code>.
It tells the conversion fonction that every every model
<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/gaussian_process.GaussianProcessRegressor.html">sklearn.gaussian_process.GaussianProcessRegressor</a>
must be converted with the option <code class="docutils literal notranslate"><span class="pre">optim='cdist'</span></code>. The converter
of this model checks that that options and uses custom operator <cite>CDist</cite>
instead of its standard implementation based on operator
<a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md#Scan">Scan</a>.
Section <a class="reference internal" href="../skl_converters/bench_python.html#lpy-gaussianprocess"><span class="std std-ref">GaussianProcess</span></a> shows how much the gain
is depending on the number of observations for this example.</p>
</section>
<section id="other-model-supported-cdist">
<h2><a class="toc-backref" href="#id2">Other model supported cdist</a><a class="headerlink" href="#other-model-supported-cdist" title="Permalink to this headline">#</a></h2>
<p>Pairwise distances are also is all nearest neighbours models.
That same <em>cdist</em> option is also supported for these models.</p>
</section>
<section id="option-zipmap-for-classifiers">
<h2><a class="toc-backref" href="#id3">Option <em>zipmap</em> for classifiers</a><a class="headerlink" href="#option-zipmap-for-classifiers" title="Permalink to this headline">#</a></h2>
<p>By default, the library <em>sklearn-onnx</em> produces a list
of dictionaries <code class="docutils literal notranslate"><span class="pre">{label:</span> <span class="pre">prediction}</span></code> but this data structure
takes a significant time to be build. The converted
model can stick to matrices by removing operator <em>ZipMap</em>.
This is done by using option <code class="docutils literal notranslate"><span class="pre">{'zipmap':</span> <span class="pre">False}</span></code>.</p>

    <div id="gdot-139922701890176-cont"><div id="gdot-139922701890176" style="width:100%;height:100%;"></div>
    <script>

    require(['../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  ranksep=0.25;\n  nodesep=0.05;\n  orientation=portrait;\n  size=7;\n\n  X [shape=box color=red label=\"X\\ndouble((0, 4))\" fontsize=10];\n\n  label [shape=box color=green label=\"label\\nint64((0,))\" fontsize=10];\n  probabilities [shape=box color=green label=\"probabilities\\ndouble((0, 3))\" fontsize=10];\n\n  coef [shape=box label=\"coef\\nfloat64((4, 3))\\n[[-0.376  0.465 -0.089]\\n [ 0.883 -0.699 -0.184]\\n [...\" fontsize=10];\n  intercept [shape=box label=\"intercept\\nfloat64((1, 3))\\n[[  8.587   2.949 -11.536]]\" fontsize=10];\n  classes [shape=box label=\"classes\\nint32((3,))\\n[0 1 2]\" fontsize=10];\n  shape_tensor [shape=box label=\"shape_tensor\\nint64((1,))\\n[-1]\" fontsize=10];\n\n  multiplied [shape=box label=\"multiplied\" fontsize=10];\n  MatMul [shape=box style=\"filled,rounded\" color=orange label=\"MatMul\\n(MatMul)\" fontsize=10];\n  X -> MatMul;\n  coef -> MatMul;\n  MatMul -> multiplied;\n\n  raw_scores [shape=box label=\"raw_scores\" fontsize=10];\n  Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add)\" fontsize=10];\n  multiplied -> Add;\n  intercept -> Add;\n  Add -> raw_scores;\n\n  Softmax [shape=box style=\"filled,rounded\" color=orange label=\"Softmax\\n(Softmax)\\naxis=-1\" fontsize=10];\n  raw_scores -> Softmax;\n  Softmax -> probabilities;\n\n  label1 [shape=box label=\"label1\" fontsize=10];\n  ArgMax [shape=box style=\"filled,rounded\" color=orange label=\"ArgMax\\n(ArgMax)\\naxis=1\" fontsize=10];\n  raw_scores -> ArgMax;\n  ArgMax -> label1;\n\n  array_feature_extractor_result [shape=box label=\"array_feature_extractor_result\" fontsize=10];\n  ArrayFeatureExtractor [shape=box style=\"filled,rounded\" color=orange label=\"ArrayFeatureExtractor\\n(ArrayFeatureExtractor)\" fontsize=10];\n  classes -> ArrayFeatureExtractor;\n  label1 -> ArrayFeatureExtractor;\n  ArrayFeatureExtractor -> array_feature_extractor_result;\n\n  cast2_result [shape=box label=\"cast2_result\" fontsize=10];\n  Cast [shape=box style=\"filled,rounded\" color=orange label=\"Cast\\n(Cast)\\nto=11\" fontsize=10];\n  array_feature_extractor_result -> Cast;\n  Cast -> cast2_result;\n\n  reshaped_result [shape=box label=\"reshaped_result\" fontsize=10];\n  Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape)\" fontsize=10];\n  cast2_result -> Reshape;\n  shape_tensor -> Reshape;\n  Reshape -> reshaped_result;\n\n  Cast1 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\\n(Cast1)\\nto=7\" fontsize=10];\n  reshaped_result -> Cast1;\n  Cast1 -> label;\n}\n");
    document.getElementById('gdot-139922701890176').innerHTML = svgGraph; });
    
</script>
</div></section>
<section id="option-raw-scores-for-classifiers">
<h2><a class="toc-backref" href="#id4">Option <em>raw_scores</em> for classifiers</a><a class="headerlink" href="#option-raw-scores-for-classifiers" title="Permalink to this headline">#</a></h2>
<p>By default, the library <em>sklearn-onnx</em> produces probabilities
whenever it is possible for a classifier. Raw scores can usually
be still obtained by using option <code class="docutils literal notranslate"><span class="pre">{'raw_scores':</span> <span class="pre">True}</span></code>.</p>

    <div id="gdot-139922701893392-cont"><div id="gdot-139922701893392" style="width:100%;height:100%;"></div>
    <script>

    require(['../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  ranksep=0.25;\n  nodesep=0.05;\n  orientation=portrait;\n  size=7;\n\n  X [shape=box color=red label=\"X\\ndouble((0, 4))\" fontsize=10];\n\n  label [shape=box color=green label=\"label\\nint64((0,))\" fontsize=10];\n  probabilities [shape=box color=green label=\"probabilities\\ndouble((0, 3))\" fontsize=10];\n\n  coef [shape=box label=\"coef\\nfloat64((4, 3))\\n[[-0.376  0.465 -0.089]\\n [ 0.883 -0.699 -0.184]\\n [...\" fontsize=10];\n  intercept [shape=box label=\"intercept\\nfloat64((1, 3))\\n[[  8.587   2.949 -11.536]]\" fontsize=10];\n  classes [shape=box label=\"classes\\nint32((3,))\\n[0 1 2]\" fontsize=10];\n  shape_tensor [shape=box label=\"shape_tensor\\nint64((1,))\\n[-1]\" fontsize=10];\n\n  multiplied [shape=box label=\"multiplied\" fontsize=10];\n  MatMul [shape=box style=\"filled,rounded\" color=orange label=\"MatMul\\n(MatMul)\" fontsize=10];\n  X -> MatMul;\n  coef -> MatMul;\n  MatMul -> multiplied;\n\n  Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add)\" fontsize=10];\n  multiplied -> Add;\n  intercept -> Add;\n  Add -> probabilities;\n\n  label1 [shape=box label=\"label1\" fontsize=10];\n  ArgMax [shape=box style=\"filled,rounded\" color=orange label=\"ArgMax\\n(ArgMax)\\naxis=1\" fontsize=10];\n  probabilities -> ArgMax;\n  ArgMax -> label1;\n\n  array_feature_extractor_result [shape=box label=\"array_feature_extractor_result\" fontsize=10];\n  ArrayFeatureExtractor [shape=box style=\"filled,rounded\" color=orange label=\"ArrayFeatureExtractor\\n(ArrayFeatureExtractor)\" fontsize=10];\n  classes -> ArrayFeatureExtractor;\n  label1 -> ArrayFeatureExtractor;\n  ArrayFeatureExtractor -> array_feature_extractor_result;\n\n  cast2_result [shape=box label=\"cast2_result\" fontsize=10];\n  Cast [shape=box style=\"filled,rounded\" color=orange label=\"Cast\\n(Cast)\\nto=11\" fontsize=10];\n  array_feature_extractor_result -> Cast;\n  Cast -> cast2_result;\n\n  reshaped_result [shape=box label=\"reshaped_result\" fontsize=10];\n  Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape)\" fontsize=10];\n  cast2_result -> Reshape;\n  shape_tensor -> Reshape;\n  Reshape -> reshaped_result;\n\n  Cast1 [shape=box style=\"filled,rounded\" color=orange label=\"Cast\\n(Cast1)\\nto=7\" fontsize=10];\n  reshaped_result -> Cast1;\n  Cast1 -> label;\n}\n");
    document.getElementById('gdot-139922701893392').innerHTML = svgGraph; });
    
</script>
</div></section>
<section id="pickability-and-pipeline">
<h2><a class="toc-backref" href="#id5">Pickability and Pipeline</a><a class="headerlink" href="#pickability-and-pipeline" title="Permalink to this headline">#</a></h2>
<p>The proposed way to specify options is not always pickable.
Function <code class="docutils literal notranslate"><span class="pre">id(model)</span></code> depends on the execution and map an option
to one class may be not enough to customize the conversion.
However, it is possible to specify an option the same way
parameters are referenced in a <em>scikit-learn</em> pipeline
with method <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline.get_params">get_params</a>.
Following syntax are supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">PCA</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())])</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
</pre></div>
</div>
<p>Or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier__zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
<p>Options applied to one model, not a pipeline as the converter
replaces the pipeline structure by a single onnx graph.
Following that rule, option <em>zipmap</em> would not have any impact
if applied to a pipeline and to the last step of the pipeline.
However, because there is no ambiguity about what the conversion
should be, for options <em>zipmap</em> and <em>nocl</em>, the following
options would have the same effect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">PCA</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())])</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}}</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;classifier__zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="onnx_runtime.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Execute ONNX graphs</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="benchmark.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Benchmarks</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>