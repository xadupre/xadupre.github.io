
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Infer operator computation cost &#8212; Python Runtime for ONNX</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/require.js"></script>
    <script src="../_static/embed-amd.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="shortcut icon" href="../_static/project_ico.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction to a numpy API for ONNX: CustomClassifier" href="numpy_api_onnx_ccl.html" />
    <link rel="prev" title="Fast TopK elements" href="topk_cpp.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../tutorial/index.html">
  Tutorial
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/index.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../onnx.html">
  ONNX, Runtime, Backends
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../onnx_bench.html">
  scikit-learn Converters and Benchmarks
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../i_cmd.html">
  Command lines
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../i_ex.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../i_index.html">
  FAQ, code, …
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../gyexamples/index.html">
  Gallery of examples
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../all_notebooks.html">
  Notebook Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../HISTORY.html">
  History
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="sklearn_grammar_lr.html">
   Converts a logistic regression into C
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_discrepencies.html">
   Discrepencies with ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="einsum_decomposition.html">
   Einsum decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="topk_cpp.html">
   Fast TopK elements
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Infer operator computation cost
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_api_onnx_ccl.html">
   Introduction to a numpy API for ONNX: CustomClassifier
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_api_onnx_ftr.html">
   Introduction to a numpy API for ONNX: FunctionTransformer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lightgbm_double.html">
   Lightgbm, double, discrepencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="loss_functions.html">
   Loss function in ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_profile.html">
   Memory usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_fft.html">
   ONNX and FFT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_float32_and_64.html">
   ONNX graph, single or double floats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_sbs.html">
   ONNX side by side
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_visualization.html">
   ONNX visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_pdist.html">
   Pairwise distances with ONNX (pdist)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_shaker.html">
   Precision loss due to float32 conversion with ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_profile_ort.html">
   Profiling with onnxruntime
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_node_time.html">
   Time processing for every ONNX nodes in a graph
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transfer_learning.html">
   Transfer Learning with ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnx_float_double_skl_decision_trees.html">
   Tricky detail when converting a random forest from scikit-learn into ONNX
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../all_notebooks_coverage.html">
   Notebooks Coverage
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#onnx-graph-and-measures">
   ONNX graph and measures
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulation-to-build-a-database">
   Simulation to build a database
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#many-dimensions-many-permutations">
     Many dimensions, many permutations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-cases">
     Random cases
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   features
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-the-features">
     Computing the features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-the-features-for-all-simulations">
     Computing the features for all simulations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlations">
     correlations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression">
   Linear regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataset">
     Dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-model">
     Simple model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quantile-regression">
     Quantile Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lasso">
     Lasso
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-regression-with-positive-weights">
     Linear regression with positive weights
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quantile-regression-with-positive-weights">
     Quantile regression with positive weights
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#investigation">
   Investigation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation-between-predictors">
     Correlation between predictors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#standalone-predictions">
   Standalone predictions
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="infer-operator-computation-cost">
<span id="onnxoperatorcostrst"></span><h1>Infer operator computation cost<a class="headerlink" href="#infer-operator-computation-cost" title="Permalink to this headline">¶</a></h1>
<p><strong>Links:</strong> <a class="reference download internal" download="" href="../_downloads/996ecdcbd0c6510be7bce3cf9535ce7b/onnx_operator_cost.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">notebook</span></code></a>, <a class="reference internal" href="onnx_operator_cost2html.html">html</a>, <a class="reference download internal" download="" href="../_downloads/85b4a7588449340a77c81fc7a344e579/onnx_operator_cost.pdf"><code class="xref download docutils literal notranslate"><span class="pre">PDF</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d28e019dea7a5c96529a07e61524267b/onnx_operator_cost.py"><code class="xref download docutils literal notranslate"><span class="pre">python</span></code></a>, <a class="reference internal" href="onnx_operator_cost.slides.html">slides</a>, <a class="reference external" href="https://github.com/sdpython/mlprodict/blob/master/_doc/notebooks/onnx_operator_cost.ipynb">GitHub</a></p>
<p>This notebooks explores a way to predict the cost of operator Transpose
based on some features.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jyquickhelper</span> <span class="kn">import</span> <span class="n">add_notebook_menu</span>
<span class="n">add_notebook_menu</span><span class="p">()</span>
</pre></div>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#onnx-graph-and-measures" id="id1">ONNX graph and measures</a></p></li>
<li><p><a class="reference internal" href="#simulation-to-build-a-database" id="id2">Simulation to build a database</a></p>
<ul>
<li><p><a class="reference internal" href="#many-dimensions-many-permutations" id="id3">Many dimensions, many permutations</a></p></li>
<li><p><a class="reference internal" href="#random-cases" id="id4">Random cases</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#features" id="id5">features</a></p>
<ul>
<li><p><a class="reference internal" href="#computing-the-features" id="id6">Computing the features</a></p></li>
<li><p><a class="reference internal" href="#computing-the-features-for-all-simulations" id="id7">Computing the features for all simulations</a></p></li>
<li><p><a class="reference internal" href="#correlations" id="id8">correlations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#linear-regression" id="id9">Linear regression</a></p>
<ul>
<li><p><a class="reference internal" href="#dataset" id="id10">Dataset</a></p></li>
<li><p><a class="reference internal" href="#simple-model" id="id11">Simple model</a></p></li>
<li><p><a class="reference internal" href="#quantile-regression" id="id12">Quantile Regression</a></p></li>
<li><p><a class="reference internal" href="#lasso" id="id13">Lasso</a></p></li>
<li><p><a class="reference internal" href="#linear-regression-with-positive-weights" id="id14">Linear regression with positive weights</a></p></li>
<li><p><a class="reference internal" href="#quantile-regression-with-positive-weights" id="id15">Quantile regression with positive weights</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id16">Summary</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#investigation" id="id17">Investigation</a></p>
<ul>
<li><p><a class="reference internal" href="#correlation-between-predictors" id="id18">Correlation between predictors</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#standalone-predictions" id="id19">Standalone predictions</a></p></li>
</ul>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> mlprodict
</pre></div>
</div>
<section id="onnx-graph-and-measures">
<h2><a class="toc-backref" href="#id1">ONNX graph and measures</a><a class="headerlink" href="#onnx-graph-and-measures" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">skl2onnx.common.data_types</span> <span class="kn">import</span> <span class="n">FloatTensorType</span>
<span class="kn">from</span> <span class="nn">skl2onnx.algebra.onnx_ops</span> <span class="kn">import</span> <span class="n">OnnxTranspose</span>


<span class="k">def</span> <span class="nf">create_onnx_graph</span><span class="p">(</span><span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">target_opset</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">OnnxTranspose</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="n">perm</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">op_version</span><span class="o">=</span><span class="n">target_opset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tr</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">FloatTensorType</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">perm</span><span class="p">))})</span>


<span class="n">onx</span> <span class="o">=</span> <span class="n">create_onnx_graph</span><span class="p">()</span>

<span class="o">%</span><span class="k">onnxview</span> onx
</pre></div>
</div>
<div id="M3ef12c0ffd6a42aaaecd7ebd615d1b50-cont"><div id="M3ef12c0ffd6a42aaaecd7ebd615d1b50" style="width:100%;height:100%;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  nodesep=0.05;\n  ranksep=0.25;\n  size=None;\n  orientation=portrait;\n\n  X [shape=box color=red label=\"X\nfloat((0, 0, 0, 0))\" fontsize=10];\n\n  Y [shape=box color=green label=\"Y\nfloat((0, 0, 0, 0))\" fontsize=10];\n\n\n  Tr_Transpose [shape=box style=\"filled,rounded\" color=orange label=\"Transpose\n(Tr_Transpose)\nperm=[0 1 2 3]\" fontsize=10];\n  X -> Tr_Transpose;\n  Tr_Transpose -> Y;\n}");
document.getElementById('M3ef12c0ffd6a42aaaecd7ebd615d1b50').innerHTML = svgGraph; });

</script><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlprodict.onnxrt</span> <span class="kn">import</span> <span class="n">OnnxInference</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">create_onnx_graph</span><span class="p">(</span><span class="n">perm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">onx</span><span class="p">)</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)}</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
<span class="n">res</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">InferenceSession</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">res</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cpyquickhelper.numbers.speed_measure</span> <span class="kn">import</span> <span class="n">measure_time</span>

<span class="k">def</span> <span class="nf">measure_time_onnx</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">measure_time</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputs</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sess</span><span class="o">=</span><span class="n">sess</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">),</span>
                        <span class="n">div_by_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">measure_time_onnx</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;average&#39;</span><span class="p">:</span> <span class="mf">0.0024677738666666646</span><span class="p">,</span>
 <span class="s1">&#39;deviation&#39;</span><span class="p">:</span> <span class="mf">0.00022911153911864325</span><span class="p">,</span>
 <span class="s1">&#39;min_exec&#39;</span><span class="p">:</span> <span class="mf">0.0022292380000000023</span><span class="p">,</span>
 <span class="s1">&#39;max_exec&#39;</span><span class="p">:</span> <span class="mf">0.003265080000000005</span><span class="p">,</span>
 <span class="s1">&#39;repeat&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
 <span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
 <span class="s1">&#39;context_size&#39;</span><span class="p">:</span> <span class="mi">232</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="simulation-to-build-a-database">
<h2><a class="toc-backref" href="#id2">Simulation to build a database</a><a class="headerlink" href="#simulation-to-build-a-database" title="Permalink to this headline">¶</a></h2>
<section id="many-dimensions-many-permutations">
<h3><a class="toc-backref" href="#id3">Many dimensions, many permutations</a><a class="headerlink" href="#many-dimensions-many-permutations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>


<span class="k">def</span> <span class="nf">process_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">perms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">permutations</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)))))</span>
    <span class="n">baseline</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">itergen</span> <span class="o">=</span> <span class="n">perms</span> <span class="k">if</span> <span class="p">(</span><span class="n">rnd</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">bar</span><span class="p">)</span> <span class="k">else</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">itergen</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rnd</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="n">onx</span> <span class="o">=</span> <span class="n">create_onnx_graph</span><span class="p">(</span><span class="n">perm</span><span class="o">=</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">measure_time_onnx</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">)</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;perm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">perm</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="n">res</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;average&#39;</span><span class="p">)</span>

<span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:04&lt;00:00,  5.73it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>0.000044</td>
      <td>0.000006</td>
      <td>0.000039</td>
      <td>0.000057</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 3, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.750316</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000048</td>
      <td>0.000003</td>
      <td>0.000045</td>
      <td>0.000058</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 3, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.820821</td>
      <td>4</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.000049</td>
      <td>0.000003</td>
      <td>0.000045</td>
      <td>0.000062</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 0, 1, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.823070</td>
      <td>4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.000049</td>
      <td>0.000001</td>
      <td>0.000048</td>
      <td>0.000053</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 3, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.830604</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.000051</td>
      <td>0.000004</td>
      <td>0.000039</td>
      <td>0.000062</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 1, 3)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.861994</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000052</td>
      <td>0.000005</td>
      <td>0.000047</td>
      <td>0.000073</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 3, 1, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.889753</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000054</td>
      <td>0.000006</td>
      <td>0.000044</td>
      <td>0.000067</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 0, 3)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.909477</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000054</td>
      <td>0.000007</td>
      <td>0.000049</td>
      <td>0.000081</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 1, 3)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.922354</td>
      <td>4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.000057</td>
      <td>0.000006</td>
      <td>0.000046</td>
      <td>0.000064</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 0, 3)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.972198</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.000059</td>
      <td>0.000019</td>
      <td>0.000034</td>
      <td>0.000093</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 2, 3)</td>
      <td>(12, 13, 15, 18)</td>
      <td>1.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000092</td>
      <td>0.000019</td>
      <td>0.000053</td>
      <td>0.000139</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 2, 3)</td>
      <td>(12, 13, 15, 18)</td>
      <td>1.557903</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.000136</td>
      <td>0.000020</td>
      <td>0.000119</td>
      <td>0.000186</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 3, 2, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.301556</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.000138</td>
      <td>0.000023</td>
      <td>0.000121</td>
      <td>0.000181</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 3, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.336826</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.000138</td>
      <td>0.000018</td>
      <td>0.000118</td>
      <td>0.000176</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 3, 0, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.346118</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.000140</td>
      <td>0.000015</td>
      <td>0.000124</td>
      <td>0.000193</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 3, 0, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.379168</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.000144</td>
      <td>0.000019</td>
      <td>0.000119</td>
      <td>0.000196</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 3, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.443392</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.000145</td>
      <td>0.000022</td>
      <td>0.000123</td>
      <td>0.000199</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 3, 1, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.455098</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.000145</td>
      <td>0.000017</td>
      <td>0.000125</td>
      <td>0.000196</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 2, 1, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.456431</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.000146</td>
      <td>0.000015</td>
      <td>0.000128</td>
      <td>0.000184</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 1, 0, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.473250</td>
      <td>4</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.000150</td>
      <td>0.000017</td>
      <td>0.000127</td>
      <td>0.000170</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 2, 0, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.539817</td>
      <td>4</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.000158</td>
      <td>0.000021</td>
      <td>0.000127</td>
      <td>0.000192</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 0, 2, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.684876</td>
      <td>4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.000164</td>
      <td>0.000045</td>
      <td>0.000124</td>
      <td>0.000231</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 1, 2, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.778193</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000214</td>
      <td>0.000060</td>
      <td>0.000136</td>
      <td>0.000295</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 3, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>3.627240</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000215</td>
      <td>0.000071</td>
      <td>0.000143</td>
      <td>0.000340</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 3, 2, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>3.640132</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">43</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">))</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 6/6 [00:01&lt;00:00,  4.70it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>0.000073</td>
      <td>0.000009</td>
      <td>0.000062</td>
      <td>0.000094</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 0)</td>
      <td>(43, 44, 45)</td>
      <td>0.985513</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.000074</td>
      <td>0.000009</td>
      <td>0.000065</td>
      <td>0.000109</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 2)</td>
      <td>(43, 44, 45)</td>
      <td>1.000000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000077</td>
      <td>0.000008</td>
      <td>0.000069</td>
      <td>0.000101</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 1)</td>
      <td>(43, 44, 45)</td>
      <td>1.032759</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000097</td>
      <td>0.000004</td>
      <td>0.000083</td>
      <td>0.000110</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 1)</td>
      <td>(43, 44, 45)</td>
      <td>1.300915</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000113</td>
      <td>0.000029</td>
      <td>0.000061</td>
      <td>0.000141</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 2)</td>
      <td>(43, 44, 45)</td>
      <td>1.515711</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000375</td>
      <td>0.000121</td>
      <td>0.000292</td>
      <td>0.000750</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 0)</td>
      <td>(43, 44, 45)</td>
      <td>5.054301</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">))</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 6/6 [00:01&lt;00:00,  3.05it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.000100</td>
      <td>0.000009</td>
      <td>0.000090</td>
      <td>0.000125</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 2)</td>
      <td>(3, 244, 244)</td>
      <td>0.955203</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.000105</td>
      <td>0.000016</td>
      <td>0.000078</td>
      <td>0.000138</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 2)</td>
      <td>(3, 244, 244)</td>
      <td>1.000000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000123</td>
      <td>0.000013</td>
      <td>0.000108</td>
      <td>0.000161</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 1)</td>
      <td>(3, 244, 244)</td>
      <td>1.178827</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000124</td>
      <td>0.000017</td>
      <td>0.000108</td>
      <td>0.000171</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 1)</td>
      <td>(3, 244, 244)</td>
      <td>1.185666</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000151</td>
      <td>0.000016</td>
      <td>0.000136</td>
      <td>0.000197</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 0)</td>
      <td>(3, 244, 244)</td>
      <td>1.438446</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000672</td>
      <td>0.000083</td>
      <td>0.000626</td>
      <td>0.001030</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 0)</td>
      <td>(3, 244, 244)</td>
      <td>6.418195</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:19&lt;00:00,  1.26it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>0.000092</td>
      <td>0.000008</td>
      <td>0.000078</td>
      <td>0.000107</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 3, 1, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>0.859903</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.000107</td>
      <td>0.000018</td>
      <td>0.000084</td>
      <td>0.000157</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 2, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000124</td>
      <td>0.000068</td>
      <td>0.000088</td>
      <td>0.000323</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 2, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.162456</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.000126</td>
      <td>0.000017</td>
      <td>0.000107</td>
      <td>0.000185</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 1, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.180996</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000130</td>
      <td>0.000009</td>
      <td>0.000120</td>
      <td>0.000163</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 3, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.210077</td>
      <td>4</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.000137</td>
      <td>0.000047</td>
      <td>0.000090</td>
      <td>0.000250</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 0, 1, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.276642</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000147</td>
      <td>0.000017</td>
      <td>0.000106</td>
      <td>0.000175</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 3, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.369978</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000185</td>
      <td>0.000017</td>
      <td>0.000164</td>
      <td>0.000246</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 0, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.725391</td>
      <td>4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.000189</td>
      <td>0.000044</td>
      <td>0.000142</td>
      <td>0.000265</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 3, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.766905</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000201</td>
      <td>0.000054</td>
      <td>0.000121</td>
      <td>0.000289</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 1, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.878802</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000522</td>
      <td>0.000061</td>
      <td>0.000457</td>
      <td>0.000733</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 3, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>4.874009</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.000533</td>
      <td>0.000157</td>
      <td>0.000456</td>
      <td>0.001128</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 3, 0, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>4.973916</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.000640</td>
      <td>0.000189</td>
      <td>0.000477</td>
      <td>0.001289</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 3, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>5.980796</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.000660</td>
      <td>0.000106</td>
      <td>0.000503</td>
      <td>0.000860</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 3, 0, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>6.167703</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000692</td>
      <td>0.000136</td>
      <td>0.000529</td>
      <td>0.001021</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 3, 2, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>6.460759</td>
      <td>4</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.000749</td>
      <td>0.000206</td>
      <td>0.000508</td>
      <td>0.001324</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 0, 2, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>6.996362</td>
      <td>4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.000754</td>
      <td>0.000105</td>
      <td>0.000633</td>
      <td>0.000994</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 0, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>7.041007</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.000791</td>
      <td>0.000264</td>
      <td>0.000561</td>
      <td>0.001386</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 3, 2, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>7.389431</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.000818</td>
      <td>0.000278</td>
      <td>0.000625</td>
      <td>0.001522</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 3, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>7.634646</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.000893</td>
      <td>0.000212</td>
      <td>0.000646</td>
      <td>0.001477</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>8.339926</td>
      <td>4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.000944</td>
      <td>0.000293</td>
      <td>0.000581</td>
      <td>0.001626</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 1, 2, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>8.814785</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.000976</td>
      <td>0.000347</td>
      <td>0.000584</td>
      <td>0.001742</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 1, 0, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>9.112243</td>
      <td>4</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.001011</td>
      <td>0.000337</td>
      <td>0.000544</td>
      <td>0.001810</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 2, 0, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>9.437403</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.001128</td>
      <td>0.000322</td>
      <td>0.000629</td>
      <td>0.001737</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 2, 1, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>10.530182</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:22&lt;00:00,  1.07it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>0.000092</td>
      <td>0.000014</td>
      <td>0.000078</td>
      <td>0.000132</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 0, 3)</td>
      <td>(1, 244, 244, 3)</td>
      <td>0.753009</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000098</td>
      <td>0.000013</td>
      <td>0.000083</td>
      <td>0.000142</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 2, 3)</td>
      <td>(1, 244, 244, 3)</td>
      <td>0.802808</td>
      <td>4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.000107</td>
      <td>0.000018</td>
      <td>0.000075</td>
      <td>0.000137</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 2, 3, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>0.873932</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000115</td>
      <td>0.000015</td>
      <td>0.000092</td>
      <td>0.000147</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 3, 1)</td>
      <td>(1, 244, 244, 3)</td>
      <td>0.940606</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.000122</td>
      <td>0.000028</td>
      <td>0.000094</td>
      <td>0.000201</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 2, 3)</td>
      <td>(1, 244, 244, 3)</td>
      <td>1.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000194</td>
      <td>0.000036</td>
      <td>0.000160</td>
      <td>0.000311</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 1, 3, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>1.585479</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000195</td>
      <td>0.000019</td>
      <td>0.000163</td>
      <td>0.000258</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 3, 1, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>1.598770</td>
      <td>4</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.000235</td>
      <td>0.000058</td>
      <td>0.000172</td>
      <td>0.000345</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 0, 1, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>1.923654</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000408</td>
      <td>0.000156</td>
      <td>0.000229</td>
      <td>0.000718</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 2, 1, 3)</td>
      <td>(1, 244, 244, 3)</td>
      <td>3.345406</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.000513</td>
      <td>0.000215</td>
      <td>0.000300</td>
      <td>0.001430</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 1, 3)</td>
      <td>(1, 244, 244, 3)</td>
      <td>4.205477</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.000558</td>
      <td>0.000131</td>
      <td>0.000458</td>
      <td>0.001023</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 3, 0, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>4.572658</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000604</td>
      <td>0.000188</td>
      <td>0.000471</td>
      <td>0.001065</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 0, 3, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>4.947937</td>
      <td>4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.000620</td>
      <td>0.000142</td>
      <td>0.000410</td>
      <td>0.001121</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 0, 3)</td>
      <td>(1, 244, 244, 3)</td>
      <td>5.078387</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.000679</td>
      <td>0.000097</td>
      <td>0.000590</td>
      <td>0.000928</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 2, 1, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>5.561888</td>
      <td>4</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.000710</td>
      <td>0.000161</td>
      <td>0.000620</td>
      <td>0.001390</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 2, 0, 1)</td>
      <td>(1, 244, 244, 3)</td>
      <td>5.818089</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.000737</td>
      <td>0.000240</td>
      <td>0.000493</td>
      <td>0.001174</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 3, 1, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>6.040189</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.000824</td>
      <td>0.000288</td>
      <td>0.000515</td>
      <td>0.001879</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(1, 3, 2, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>6.752663</td>
      <td>4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.000913</td>
      <td>0.000216</td>
      <td>0.000613</td>
      <td>0.001410</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 1, 2, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>7.476378</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.000918</td>
      <td>0.000328</td>
      <td>0.000572</td>
      <td>0.002079</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 1, 0, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>7.521481</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.001057</td>
      <td>0.000609</td>
      <td>0.000502</td>
      <td>0.002702</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 3, 0, 1)</td>
      <td>(1, 244, 244, 3)</td>
      <td>8.657076</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.001061</td>
      <td>0.000612</td>
      <td>0.000539</td>
      <td>0.003790</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(0, 3, 2, 1)</td>
      <td>(1, 244, 244, 3)</td>
      <td>8.693870</td>
      <td>4</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.001212</td>
      <td>0.000417</td>
      <td>0.000719</td>
      <td>0.002561</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(3, 0, 2, 1)</td>
      <td>(1, 244, 244, 3)</td>
      <td>9.929308</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.001311</td>
      <td>0.000505</td>
      <td>0.000856</td>
      <td>0.003377</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 1, 3, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>10.739398</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.001433</td>
      <td>0.000505</td>
      <td>0.000721</td>
      <td>0.002335</td>
      <td>30</td>
      <td>50</td>
      <td>232</td>
      <td>(2, 0, 3, 1)</td>
      <td>(1, 244, 244, 3)</td>
      <td>11.740772</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:14&lt;00:00,  1.62it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.001088</td>
      <td>0.000085</td>
      <td>0.000986</td>
      <td>0.001291</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 1, 2, 3)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.001227</td>
      <td>0.000088</td>
      <td>0.001152</td>
      <td>0.001474</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 3, 1, 2)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.128126</td>
      <td>4</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.001277</td>
      <td>0.000118</td>
      <td>0.001079</td>
      <td>0.001490</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 0, 1, 2)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.173721</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.001311</td>
      <td>0.000320</td>
      <td>0.001007</td>
      <td>0.001925</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 0, 2, 3)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.205182</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.001415</td>
      <td>0.000307</td>
      <td>0.001200</td>
      <td>0.002498</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 1, 3, 2)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.300901</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001426</td>
      <td>0.000221</td>
      <td>0.001191</td>
      <td>0.001863</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 2, 3, 1)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.311361</td>
      <td>4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.001510</td>
      <td>0.000432</td>
      <td>0.001132</td>
      <td>0.002417</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 2, 3, 0)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.388068</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.001552</td>
      <td>0.000030</td>
      <td>0.001500</td>
      <td>0.001602</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 2, 0, 3)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.427105</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.001724</td>
      <td>0.000193</td>
      <td>0.001470</td>
      <td>0.002142</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 0, 1, 3)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.585155</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001790</td>
      <td>0.000191</td>
      <td>0.001566</td>
      <td>0.002238</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 2, 1, 3)</td>
      <td>(3, 244, 244, 3)</td>
      <td>1.645717</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.002528</td>
      <td>0.000154</td>
      <td>0.002327</td>
      <td>0.002983</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 0, 3, 2)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.324384</td>
      <td>4</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.002571</td>
      <td>0.000186</td>
      <td>0.002383</td>
      <td>0.002922</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 0, 2, 1)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.363443</td>
      <td>4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.002591</td>
      <td>0.000253</td>
      <td>0.002431</td>
      <td>0.003403</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 1, 2, 0)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.381860</td>
      <td>4</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.002698</td>
      <td>0.000412</td>
      <td>0.002346</td>
      <td>0.003689</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 2, 0, 1)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.480308</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.002806</td>
      <td>0.000783</td>
      <td>0.002147</td>
      <td>0.004296</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 1, 0, 2)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.579517</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.003212</td>
      <td>0.000304</td>
      <td>0.002773</td>
      <td>0.003851</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 3, 0, 1)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.953032</td>
      <td>4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.003228</td>
      <td>0.000796</td>
      <td>0.002071</td>
      <td>0.004791</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 1, 0, 3)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.967523</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.003257</td>
      <td>0.000287</td>
      <td>0.002912</td>
      <td>0.003739</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 3, 2, 0)</td>
      <td>(3, 244, 244, 3)</td>
      <td>2.994043</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.003574</td>
      <td>0.000479</td>
      <td>0.003028</td>
      <td>0.005042</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 3)</td>
      <td>3.285842</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.003942</td>
      <td>0.001860</td>
      <td>0.002446</td>
      <td>0.008241</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 3, 0, 2)</td>
      <td>(3, 244, 244, 3)</td>
      <td>3.624145</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.004249</td>
      <td>0.001217</td>
      <td>0.003175</td>
      <td>0.008041</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 1, 3, 0)</td>
      <td>(3, 244, 244, 3)</td>
      <td>3.906361</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.004685</td>
      <td>0.001343</td>
      <td>0.002827</td>
      <td>0.006868</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 3, 2, 1)</td>
      <td>(3, 244, 244, 3)</td>
      <td>4.307072</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.005539</td>
      <td>0.002180</td>
      <td>0.002991</td>
      <td>0.009602</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 0, 3, 1)</td>
      <td>(3, 244, 244, 3)</td>
      <td>5.092422</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.005575</td>
      <td>0.001930</td>
      <td>0.002876</td>
      <td>0.008157</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 2, 1, 0)</td>
      <td>(3, 244, 244, 3)</td>
      <td>5.125597</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:34&lt;00:00,  1.43s/it]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.002249</td>
      <td>0.000144</td>
      <td>0.002067</td>
      <td>0.002627</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 1, 3, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.606961</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.002711</td>
      <td>0.000171</td>
      <td>0.002458</td>
      <td>0.002995</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 2, 3, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.731795</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.002773</td>
      <td>0.000683</td>
      <td>0.002260</td>
      <td>0.004103</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 0, 1, 3)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.748578</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.002953</td>
      <td>0.000677</td>
      <td>0.002187</td>
      <td>0.004132</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 3, 1, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.797062</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.003232</td>
      <td>0.000963</td>
      <td>0.002303</td>
      <td>0.005088</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 2, 1, 3)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.872427</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.003363</td>
      <td>0.000372</td>
      <td>0.002883</td>
      <td>0.004025</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 0, 2, 3)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.907834</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.003397</td>
      <td>0.000237</td>
      <td>0.002886</td>
      <td>0.003846</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 2, 0, 3)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.917011</td>
      <td>4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.003653</td>
      <td>0.000874</td>
      <td>0.002567</td>
      <td>0.005244</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 2, 3, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.986071</td>
      <td>4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.003697</td>
      <td>0.000186</td>
      <td>0.003495</td>
      <td>0.004150</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 1, 0, 3)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.997901</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.003705</td>
      <td>0.000797</td>
      <td>0.002111</td>
      <td>0.005164</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 1, 2, 3)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.003780</td>
      <td>0.000882</td>
      <td>0.002701</td>
      <td>0.005402</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 0, 1, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.020432</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004938</td>
      <td>0.000367</td>
      <td>0.004532</td>
      <td>0.005844</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 3, 0, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.333061</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.005918</td>
      <td>0.001085</td>
      <td>0.004598</td>
      <td>0.008312</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 0, 3, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.597357</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.006106</td>
      <td>0.000556</td>
      <td>0.005619</td>
      <td>0.007305</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 0, 3, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.648325</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.006722</td>
      <td>0.001807</td>
      <td>0.005067</td>
      <td>0.011245</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(1, 3, 2, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.814552</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.007071</td>
      <td>0.000982</td>
      <td>0.005454</td>
      <td>0.008559</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 1, 0, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.908667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.007441</td>
      <td>0.001732</td>
      <td>0.006199</td>
      <td>0.012169</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 1, 2, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.008635</td>
      <td>4</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.007815</td>
      <td>0.001757</td>
      <td>0.005932</td>
      <td>0.010779</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 1, 3, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.109489</td>
      <td>4</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.008546</td>
      <td>0.001384</td>
      <td>0.005878</td>
      <td>0.010614</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 3, 0, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.306951</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.010339</td>
      <td>0.002789</td>
      <td>0.005878</td>
      <td>0.018301</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 3, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.790823</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.010677</td>
      <td>0.001457</td>
      <td>0.008504</td>
      <td>0.014070</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.882191</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.012421</td>
      <td>0.003052</td>
      <td>0.007818</td>
      <td>0.018106</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 2, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.352770</td>
      <td>4</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.013432</td>
      <td>0.004496</td>
      <td>0.006536</td>
      <td>0.021250</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 2, 0, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.625680</td>
      <td>4</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.014579</td>
      <td>0.004026</td>
      <td>0.007144</td>
      <td>0.020739</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 0, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.935483</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></section>
<section id="random-cases">
<h3><a class="toc-backref" href="#id4">Random cases</a><a class="headerlink" href="#random-cases" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">if</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># comment out for more training data</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)):</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mf">1e8</span>
        <span class="k">while</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mf">1e6</span> <span class="ow">or</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]</span> <span class="o">+</span>
                    <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">+</span>
                    <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]</span> <span class="o">+</span>
                    <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="o">+</span>
                    <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
            <span class="n">ashape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">ashape</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">:</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">800000</span><span class="p">:</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">500000</span><span class="p">:</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">200000</span><span class="p">:</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)):</span>
            <span class="n">shape2</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">shape2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">process_shape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">7</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>context_size</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>127</th>
      <td>0.010339</td>
      <td>0.002789</td>
      <td>0.005878</td>
      <td>0.018301</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(0, 3, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.790823</td>
      <td>4</td>
    </tr>
    <tr>
      <th>128</th>
      <td>0.010677</td>
      <td>0.001457</td>
      <td>0.008504</td>
      <td>0.014070</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.882191</td>
      <td>4</td>
    </tr>
    <tr>
      <th>129</th>
      <td>0.012421</td>
      <td>0.003052</td>
      <td>0.007818</td>
      <td>0.018106</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 2, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.352770</td>
      <td>4</td>
    </tr>
    <tr>
      <th>130</th>
      <td>0.013432</td>
      <td>0.004496</td>
      <td>0.006536</td>
      <td>0.021250</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 2, 0, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.625680</td>
      <td>4</td>
    </tr>
    <tr>
      <th>131</th>
      <td>0.014579</td>
      <td>0.004026</td>
      <td>0.007144</td>
      <td>0.020739</td>
      <td>15</td>
      <td>15</td>
      <td>232</td>
      <td>(3, 0, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.935483</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;ratio&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">]})</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="4" halign="left">ratio</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>median</th>
    </tr>
    <tr>
      <th>dim</th>
      <th>shape</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>(3, 244, 244)</th>
      <td>0.955203</td>
      <td>6.418195</td>
      <td>2.029389</td>
      <td>1.182247</td>
    </tr>
    <tr>
      <th>(43, 44, 45)</th>
      <td>0.985513</td>
      <td>5.054301</td>
      <td>1.814867</td>
      <td>1.166837</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">4</th>
      <th>(1, 244, 244, 3)</th>
      <td>0.753009</td>
      <td>11.740772</td>
      <td>5.023301</td>
      <td>5.013162</td>
    </tr>
    <tr>
      <th>(3, 244, 244, 1)</th>
      <td>0.859903</td>
      <td>10.530182</td>
      <td>4.882680</td>
      <td>5.477356</td>
    </tr>
    <tr>
      <th>(3, 244, 244, 3)</th>
      <td>1.000000</td>
      <td>5.125597</td>
      <td>2.481287</td>
      <td>2.372651</td>
    </tr>
    <tr>
      <th>(3, 244, 244, 6)</th>
      <td>0.606961</td>
      <td>3.935483</td>
      <td>1.704169</td>
      <td>1.465209</td>
    </tr>
    <tr>
      <th>(12, 13, 15, 18)</th>
      <td>0.750316</td>
      <td>3.640132</td>
      <td>1.866691</td>
      <td>2.319191</td>
    </tr>
  </tbody>
</table>
</div></section>
</section>
<section id="features">
<h2><a class="toc-backref" href="#id5">features</a><a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<section id="computing-the-features">
<h3><a class="toc-backref" href="#id6">Computing the features</a><a class="headerlink" href="#computing-the-features" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_edit_distance</span><span class="p">(</span><span class="n">mot1</span><span class="p">,</span> <span class="n">mot2</span><span class="p">):</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="kc">None</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mot1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mot2</span><span class="p">):</span>
            <span class="n">dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">pred</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dist</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">pred</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mot1</span><span class="p">):</span>
        <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">pred</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mot2</span><span class="p">):</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">opt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">opt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">d</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">opt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="n">mi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
            <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">dist</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">mot1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mot2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">_edit_distance</span><span class="p">(</span><span class="s2">&quot;abdc&quot;</span><span class="p">,</span> <span class="s2">&quot;cbda&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_edit_distance</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>


<span class="k">def</span> <span class="nf">_is_rotation</span><span class="p">(</span><span class="n">perm</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">perm</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
            <span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">origin</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">origin</span> <span class="k">else</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">compute_features</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">perm</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>

    <span class="n">begin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">dbegin</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">perm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">dbegin</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">begin</span> <span class="o">*=</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">end</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">dend</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">dend</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">end</span> <span class="o">*=</span> <span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">dis_cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dis_cont</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">middle</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="n">end</span> <span class="o">*</span> <span class="n">begin</span><span class="p">)))</span>
    <span class="n">feat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">total</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">middle</span><span class="o">=</span><span class="n">middle</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">discont</span><span class="o">=</span><span class="n">dis_cont</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">]:</span>
        <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;end</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">_relu</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">}:</span>
            <span class="k">continue</span>
        <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;r</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]:</span>
        <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;iend</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">end</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;ibegin</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">begin</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span>

    <span class="c1"># feat[&#39;CST&#39;] = 1</span>
    <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;CST_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;dbegin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dbegin</span>
    <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;dend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dend</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;begin&#39;</span><span class="p">):</span>
            <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rend&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rbegin&#39;</span><span class="p">):</span>
            <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;iend&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ibegin&#39;</span><span class="p">):</span>
            <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;rdiscont&quot;</span><span class="p">:</span>
            <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">feat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">idp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">perm</span><span class="p">)))</span>
    <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">_is_rotation</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;rev&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">perm</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">idp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;edit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_edit_distance</span><span class="p">(</span><span class="n">idp</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
    <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;redit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span><span class="p">[</span><span class="s2">&quot;edit&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">idp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">feat</span>


<span class="n">compute_features</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;middle&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;discont&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;end16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;end32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;rbegin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;rend&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;rmiddle&#39;</span><span class="p">:</span> <span class="mf">0.009523809523809525</span><span class="p">,</span>
 <span class="s1">&#39;rdiscont&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;rend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;iend2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;iend4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;iend8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;iend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;iend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;iend64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;CST_&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;dbegin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;rev&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;edit&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;redit&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_features</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;middle&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;discont&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;end16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>
 <span class="s1">&#39;end32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span>
 <span class="s1">&#39;rbegin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
 <span class="s1">&#39;rend&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
 <span class="s1">&#39;rmiddle&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;rdiscont&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.01904761904761905</span><span class="p">,</span>
 <span class="s1">&#39;rend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1523809523809524</span><span class="p">,</span>
 <span class="s1">&#39;rend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3047619047619048</span><span class="p">,</span>
 <span class="s1">&#39;iend2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;CST_&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;dbegin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;rev&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;edit&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;redit&#39;</span><span class="p">:</span> <span class="mf">0.6666666666666666</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_features</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;middle&#39;</span><span class="p">:</span> <span class="mi">105</span><span class="p">,</span>
 <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;discont&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;end16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>
 <span class="s1">&#39;end32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span>
 <span class="s1">&#39;rbegin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
 <span class="s1">&#39;rend&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
 <span class="s1">&#39;rmiddle&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;rdiscont&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.009523809523809525</span><span class="p">,</span>
 <span class="s1">&#39;rend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1523809523809524</span><span class="p">,</span>
 <span class="s1">&#39;rend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.3047619047619048</span><span class="p">,</span>
 <span class="s1">&#39;iend2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin4&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin8&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin16&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin32&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin64&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;CST_&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;dbegin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;rev&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;edit&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;redit&#39;</span><span class="p">:</span> <span class="mf">0.6666666666666666</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="computing-the-features-for-all-simulations">
<h3><a class="toc-backref" href="#id7">Computing the features for all simulations</a><a class="headerlink" href="#computing-the-features-for-all-simulations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_features_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">compute_features</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;perm&#39;</span><span class="p">])</span>
        <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;yt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">]</span>
        <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;yr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">feat</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">],</span> <span class="n">perm</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;perm&quot;</span><span class="p">],</span>
                         <span class="n">average</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">],</span> <span class="n">ratio</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;ratio&quot;</span><span class="p">]))</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

<span class="n">fdata</span> <span class="o">=</span> <span class="n">compute_features_dataframe</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">col_sort</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">fdata</span> <span class="o">=</span> <span class="n">fdata</span><span class="p">[</span><span class="n">col_sort</span><span class="p">]</span>
<span class="n">fdata</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 132/132 [00:00&lt;00:00, 9459.22it/s]
100%|██████████| 132/132 [00:00&lt;00:00, 3601.95it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CST_</th>
      <th>begin</th>
      <th>dbegin</th>
      <th>dend</th>
      <th>dim</th>
      <th>discont</th>
      <th>edit</th>
      <th>end</th>
      <th>end16</th>
      <th>end32</th>
      <th>...</th>
      <th>redit</th>
      <th>rend</th>
      <th>rend16</th>
      <th>rend32</th>
      <th>rev</th>
      <th>rmiddle</th>
      <th>rot</th>
      <th>size</th>
      <th>yr</th>
      <th>yt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>127</th>
      <td>-1</td>
      <td>-3</td>
      <td>-1</td>
      <td>0</td>
      <td>4</td>
      <td>3</td>
      <td>2</td>
      <td>-1</td>
      <td>-16</td>
      <td>-32</td>
      <td>...</td>
      <td>0.50</td>
      <td>-9.331422e-07</td>
      <td>-0.000015</td>
      <td>-0.00003</td>
      <td>0</td>
      <td>0.333333</td>
      <td>0</td>
      <td>1071648</td>
      <td>2.790823</td>
      <td>0.010339</td>
    </tr>
    <tr>
      <th>128</th>
      <td>-1</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
      <td>-1</td>
      <td>-16</td>
      <td>-32</td>
      <td>...</td>
      <td>1.00</td>
      <td>-9.331422e-07</td>
      <td>-0.000015</td>
      <td>-0.00003</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1071648</td>
      <td>2.882191</td>
      <td>0.010677</td>
    </tr>
    <tr>
      <th>129</th>
      <td>-1</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>3</td>
      <td>4</td>
      <td>-1</td>
      <td>-16</td>
      <td>-32</td>
      <td>...</td>
      <td>1.00</td>
      <td>-9.331422e-07</td>
      <td>-0.000015</td>
      <td>-0.00003</td>
      <td>1</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1071648</td>
      <td>3.352770</td>
      <td>0.012421</td>
    </tr>
    <tr>
      <th>130</th>
      <td>-1</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>4</td>
      <td>-1</td>
      <td>-16</td>
      <td>-32</td>
      <td>...</td>
      <td>1.00</td>
      <td>-9.331422e-07</td>
      <td>-0.000015</td>
      <td>-0.00003</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1071648</td>
      <td>3.625680</td>
      <td>0.013432</td>
    </tr>
    <tr>
      <th>131</th>
      <td>-1</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>-1</td>
      <td>-16</td>
      <td>-32</td>
      <td>...</td>
      <td>0.75</td>
      <td>-9.331422e-07</td>
      <td>-0.000015</td>
      <td>-0.00003</td>
      <td>0</td>
      <td>1.000000</td>
      <td>0</td>
      <td>1071648</td>
      <td>3.935483</td>
      <td>0.014579</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 35 columns</p>
</div></section>
<section id="correlations">
<h3><a class="toc-backref" href="#id8">correlations</a><a class="headerlink" href="#correlations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fdata</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CST_</th>
      <th>begin</th>
      <th>dbegin</th>
      <th>dend</th>
      <th>dim</th>
      <th>discont</th>
      <th>edit</th>
      <th>end</th>
      <th>end16</th>
      <th>end32</th>
      <th>...</th>
      <th>redit</th>
      <th>rend</th>
      <th>rend16</th>
      <th>rend32</th>
      <th>rev</th>
      <th>rmiddle</th>
      <th>rot</th>
      <th>size</th>
      <th>yr</th>
      <th>yt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CST_</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>begin</th>
      <td>NaN</td>
      <td>1.000000</td>
      <td>0.596816</td>
      <td>0.596414</td>
      <td>0.014118</td>
      <td>0.404952</td>
      <td>0.405175</td>
      <td>0.999998</td>
      <td>0.999998</td>
      <td>0.999998</td>
      <td>...</td>
      <td>0.418022</td>
      <td>0.681573</td>
      <td>0.681573</td>
      <td>0.681573</td>
      <td>0.038216</td>
      <td>0.256349</td>
      <td>0.325594</td>
      <td>-0.133581</td>
      <td>0.127658</td>
      <td>-0.008816</td>
    </tr>
    <tr>
      <th>dbegin</th>
      <td>NaN</td>
      <td>0.596816</td>
      <td>1.000000</td>
      <td>0.676899</td>
      <td>0.077162</td>
      <td>0.486887</td>
      <td>0.669598</td>
      <td>0.596384</td>
      <td>0.596374</td>
      <td>0.596363</td>
      <td>...</td>
      <td>0.690333</td>
      <td>0.831887</td>
      <td>0.831895</td>
      <td>0.831903</td>
      <td>0.111636</td>
      <td>0.605990</td>
      <td>0.298090</td>
      <td>0.016411</td>
      <td>0.291318</td>
      <td>0.139951</td>
    </tr>
    <tr>
      <th>dend</th>
      <td>NaN</td>
      <td>0.596414</td>
      <td>0.676899</td>
      <td>1.000000</td>
      <td>0.077162</td>
      <td>0.486887</td>
      <td>0.669598</td>
      <td>0.596936</td>
      <td>0.596907</td>
      <td>0.596881</td>
      <td>...</td>
      <td>0.690333</td>
      <td>0.833059</td>
      <td>0.832975</td>
      <td>0.832924</td>
      <td>0.111636</td>
      <td>0.623582</td>
      <td>0.298090</td>
      <td>0.016411</td>
      <td>0.305489</td>
      <td>0.155098</td>
    </tr>
    <tr>
      <th>dim</th>
      <td>NaN</td>
      <td>0.014118</td>
      <td>0.077162</td>
      <td>0.077162</td>
      <td>1.000000</td>
      <td>0.305320</td>
      <td>0.272614</td>
      <td>0.014153</td>
      <td>0.014145</td>
      <td>0.014135</td>
      <td>...</td>
      <td>0.115902</td>
      <td>0.160407</td>
      <td>0.160417</td>
      <td>0.160414</td>
      <td>-0.160357</td>
      <td>0.106693</td>
      <td>0.240946</td>
      <td>0.212685</td>
      <td>0.138961</td>
      <td>0.192305</td>
    </tr>
    <tr>
      <th>discont</th>
      <td>NaN</td>
      <td>0.404952</td>
      <td>0.486887</td>
      <td>0.486887</td>
      <td>0.305320</td>
      <td>1.000000</td>
      <td>0.531254</td>
      <td>0.404971</td>
      <td>0.404961</td>
      <td>0.404948</td>
      <td>...</td>
      <td>0.504206</td>
      <td>0.594219</td>
      <td>0.594226</td>
      <td>0.594223</td>
      <td>0.150144</td>
      <td>0.225854</td>
      <td>0.823937</td>
      <td>0.064937</td>
      <td>0.388140</td>
      <td>0.203342</td>
    </tr>
    <tr>
      <th>edit</th>
      <td>NaN</td>
      <td>0.405175</td>
      <td>0.669598</td>
      <td>0.669598</td>
      <td>0.272614</td>
      <td>0.531254</td>
      <td>1.000000</td>
      <td>0.405223</td>
      <td>0.405204</td>
      <td>0.405189</td>
      <td>...</td>
      <td>0.984655</td>
      <td>0.594688</td>
      <td>0.594639</td>
      <td>0.594619</td>
      <td>0.208568</td>
      <td>0.652532</td>
      <td>0.338994</td>
      <td>0.057981</td>
      <td>0.464225</td>
      <td>0.283262</td>
    </tr>
    <tr>
      <th>end</th>
      <td>NaN</td>
      <td>0.999998</td>
      <td>0.596384</td>
      <td>0.596936</td>
      <td>0.014153</td>
      <td>0.404971</td>
      <td>0.405223</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.418062</td>
      <td>0.681565</td>
      <td>0.681565</td>
      <td>0.681565</td>
      <td>0.038236</td>
      <td>0.256479</td>
      <td>0.325559</td>
      <td>-0.133665</td>
      <td>0.127730</td>
      <td>-0.008844</td>
    </tr>
    <tr>
      <th>end16</th>
      <td>NaN</td>
      <td>0.999998</td>
      <td>0.596374</td>
      <td>0.596907</td>
      <td>0.014145</td>
      <td>0.404961</td>
      <td>0.405204</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.418044</td>
      <td>0.681550</td>
      <td>0.681550</td>
      <td>0.681550</td>
      <td>0.038231</td>
      <td>0.256451</td>
      <td>0.325557</td>
      <td>-0.133671</td>
      <td>0.127716</td>
      <td>-0.008852</td>
    </tr>
    <tr>
      <th>end32</th>
      <td>NaN</td>
      <td>0.999998</td>
      <td>0.596363</td>
      <td>0.596881</td>
      <td>0.014135</td>
      <td>0.404948</td>
      <td>0.405189</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.418029</td>
      <td>0.681533</td>
      <td>0.681533</td>
      <td>0.681533</td>
      <td>0.038228</td>
      <td>0.256430</td>
      <td>0.325552</td>
      <td>-0.133677</td>
      <td>0.127707</td>
      <td>-0.008859</td>
    </tr>
    <tr>
      <th>ibegin16</th>
      <td>NaN</td>
      <td>0.488586</td>
      <td>0.854056</td>
      <td>0.553792</td>
      <td>0.160800</td>
      <td>0.476225</td>
      <td>0.528132</td>
      <td>0.487938</td>
      <td>0.487930</td>
      <td>0.487919</td>
      <td>...</td>
      <td>0.533981</td>
      <td>0.715870</td>
      <td>0.715889</td>
      <td>0.715901</td>
      <td>0.078215</td>
      <td>0.522399</td>
      <td>0.283800</td>
      <td>0.037462</td>
      <td>0.254352</td>
      <td>0.136416</td>
    </tr>
    <tr>
      <th>ibegin2</th>
      <td>NaN</td>
      <td>0.297779</td>
      <td>0.792225</td>
      <td>0.326418</td>
      <td>0.080033</td>
      <td>0.230393</td>
      <td>0.539082</td>
      <td>0.297285</td>
      <td>0.297281</td>
      <td>0.297277</td>
      <td>...</td>
      <td>0.548605</td>
      <td>0.436111</td>
      <td>0.436126</td>
      <td>0.436148</td>
      <td>0.128338</td>
      <td>0.685605</td>
      <td>0.049586</td>
      <td>-0.027198</td>
      <td>0.324851</td>
      <td>0.109929</td>
    </tr>
    <tr>
      <th>ibegin32</th>
      <td>NaN</td>
      <td>0.488586</td>
      <td>0.854056</td>
      <td>0.553792</td>
      <td>0.160800</td>
      <td>0.476225</td>
      <td>0.528132</td>
      <td>0.487938</td>
      <td>0.487930</td>
      <td>0.487919</td>
      <td>...</td>
      <td>0.533981</td>
      <td>0.715870</td>
      <td>0.715889</td>
      <td>0.715901</td>
      <td>0.078215</td>
      <td>0.522399</td>
      <td>0.283800</td>
      <td>0.037462</td>
      <td>0.254352</td>
      <td>0.136416</td>
    </tr>
    <tr>
      <th>ibegin4</th>
      <td>NaN</td>
      <td>0.420023</td>
      <td>0.814178</td>
      <td>0.474232</td>
      <td>0.114432</td>
      <td>0.388689</td>
      <td>0.517951</td>
      <td>0.419433</td>
      <td>0.419424</td>
      <td>0.419415</td>
      <td>...</td>
      <td>0.528284</td>
      <td>0.615385</td>
      <td>0.615471</td>
      <td>0.615584</td>
      <td>0.090985</td>
      <td>0.594774</td>
      <td>0.207651</td>
      <td>0.116460</td>
      <td>0.278810</td>
      <td>0.179014</td>
    </tr>
    <tr>
      <th>ibegin64</th>
      <td>NaN</td>
      <td>0.510659</td>
      <td>0.869357</td>
      <td>0.586430</td>
      <td>0.083333</td>
      <td>0.488512</td>
      <td>0.533376</td>
      <td>0.509999</td>
      <td>0.509990</td>
      <td>0.509979</td>
      <td>...</td>
      <td>0.555529</td>
      <td>0.748243</td>
      <td>0.748253</td>
      <td>0.748257</td>
      <td>0.074833</td>
      <td>0.501069</td>
      <td>0.307207</td>
      <td>0.017724</td>
      <td>0.243128</td>
      <td>0.124459</td>
    </tr>
    <tr>
      <th>ibegin8</th>
      <td>NaN</td>
      <td>0.420023</td>
      <td>0.814178</td>
      <td>0.474232</td>
      <td>0.114432</td>
      <td>0.388689</td>
      <td>0.517951</td>
      <td>0.419433</td>
      <td>0.419424</td>
      <td>0.419415</td>
      <td>...</td>
      <td>0.528284</td>
      <td>0.615385</td>
      <td>0.615471</td>
      <td>0.615584</td>
      <td>0.090985</td>
      <td>0.594774</td>
      <td>0.207651</td>
      <td>0.116460</td>
      <td>0.278810</td>
      <td>0.179014</td>
    </tr>
    <tr>
      <th>iend16</th>
      <td>NaN</td>
      <td>0.405858</td>
      <td>0.452474</td>
      <td>0.807989</td>
      <td>0.181503</td>
      <td>0.383654</td>
      <td>0.517311</td>
      <td>0.406614</td>
      <td>0.406575</td>
      <td>0.406542</td>
      <td>...</td>
      <td>0.513917</td>
      <td>0.597165</td>
      <td>0.597061</td>
      <td>0.597069</td>
      <td>0.094032</td>
      <td>0.619928</td>
      <td>0.191751</td>
      <td>0.125689</td>
      <td>0.307633</td>
      <td>0.182267</td>
    </tr>
    <tr>
      <th>iend2</th>
      <td>NaN</td>
      <td>0.297323</td>
      <td>0.326418</td>
      <td>0.792225</td>
      <td>0.080033</td>
      <td>0.230393</td>
      <td>0.539082</td>
      <td>0.297930</td>
      <td>0.297895</td>
      <td>0.297872</td>
      <td>...</td>
      <td>0.548605</td>
      <td>0.437541</td>
      <td>0.437398</td>
      <td>0.437338</td>
      <td>0.128338</td>
      <td>0.724562</td>
      <td>0.049586</td>
      <td>-0.027198</td>
      <td>0.337071</td>
      <td>0.146321</td>
    </tr>
    <tr>
      <th>iend32</th>
      <td>NaN</td>
      <td>0.468224</td>
      <td>0.524298</td>
      <td>0.841277</td>
      <td>0.233408</td>
      <td>0.465593</td>
      <td>0.524167</td>
      <td>0.469061</td>
      <td>0.469029</td>
      <td>0.468993</td>
      <td>...</td>
      <td>0.514805</td>
      <td>0.688714</td>
      <td>0.688640</td>
      <td>0.688553</td>
      <td>0.081511</td>
      <td>0.544599</td>
      <td>0.262448</td>
      <td>0.049643</td>
      <td>0.261930</td>
      <td>0.139099</td>
    </tr>
    <tr>
      <th>iend4</th>
      <td>NaN</td>
      <td>0.360597</td>
      <td>0.400119</td>
      <td>0.792963</td>
      <td>0.141421</td>
      <td>0.321878</td>
      <td>0.519634</td>
      <td>0.361290</td>
      <td>0.361251</td>
      <td>0.361222</td>
      <td>...</td>
      <td>0.521120</td>
      <td>0.530594</td>
      <td>0.530467</td>
      <td>0.530439</td>
      <td>0.105830</td>
      <td>0.673384</td>
      <td>0.136300</td>
      <td>-0.039355</td>
      <td>0.351151</td>
      <td>0.127468</td>
    </tr>
    <tr>
      <th>iend64</th>
      <td>NaN</td>
      <td>0.487959</td>
      <td>0.553792</td>
      <td>0.854056</td>
      <td>0.160800</td>
      <td>0.476225</td>
      <td>0.528132</td>
      <td>0.488816</td>
      <td>0.488786</td>
      <td>0.488752</td>
      <td>...</td>
      <td>0.533981</td>
      <td>0.717677</td>
      <td>0.717612</td>
      <td>0.717534</td>
      <td>0.078215</td>
      <td>0.523746</td>
      <td>0.283800</td>
      <td>0.030938</td>
      <td>0.255567</td>
      <td>0.127728</td>
    </tr>
    <tr>
      <th>iend8</th>
      <td>NaN</td>
      <td>0.405858</td>
      <td>0.452474</td>
      <td>0.807989</td>
      <td>0.181503</td>
      <td>0.383654</td>
      <td>0.517311</td>
      <td>0.406614</td>
      <td>0.406575</td>
      <td>0.406542</td>
      <td>...</td>
      <td>0.513917</td>
      <td>0.597165</td>
      <td>0.597061</td>
      <td>0.597069</td>
      <td>0.094032</td>
      <td>0.619928</td>
      <td>0.191751</td>
      <td>0.125689</td>
      <td>0.307633</td>
      <td>0.182267</td>
    </tr>
    <tr>
      <th>middle</th>
      <td>NaN</td>
      <td>0.126896</td>
      <td>0.303868</td>
      <td>0.319057</td>
      <td>0.178317</td>
      <td>0.152095</td>
      <td>0.377874</td>
      <td>0.126960</td>
      <td>0.126947</td>
      <td>0.126937</td>
      <td>...</td>
      <td>0.355980</td>
      <td>0.186472</td>
      <td>0.186669</td>
      <td>0.186918</td>
      <td>0.052991</td>
      <td>0.467981</td>
      <td>0.000903</td>
      <td>0.728990</td>
      <td>-0.008120</td>
      <td>0.821357</td>
    </tr>
    <tr>
      <th>rbegin</th>
      <td>NaN</td>
      <td>0.681576</td>
      <td>0.832794</td>
      <td>0.831933</td>
      <td>0.160296</td>
      <td>0.594171</td>
      <td>0.594568</td>
      <td>0.681564</td>
      <td>0.681549</td>
      <td>0.681532</td>
      <td>...</td>
      <td>0.613417</td>
      <td>0.999992</td>
      <td>0.999993</td>
      <td>0.999993</td>
      <td>0.056108</td>
      <td>0.376357</td>
      <td>0.477649</td>
      <td>0.034328</td>
      <td>0.187411</td>
      <td>0.095471</td>
    </tr>
    <tr>
      <th>rdiscont</th>
      <td>NaN</td>
      <td>-0.132163</td>
      <td>-0.158903</td>
      <td>-0.158903</td>
      <td>-0.077379</td>
      <td>-0.320270</td>
      <td>-0.168278</td>
      <td>-0.132191</td>
      <td>-0.132195</td>
      <td>-0.132192</td>
      <td>...</td>
      <td>-0.163660</td>
      <td>-0.193464</td>
      <td>-0.193106</td>
      <td>-0.192632</td>
      <td>-0.054527</td>
      <td>-0.001602</td>
      <td>-0.265672</td>
      <td>0.551880</td>
      <td>0.004517</td>
      <td>0.386893</td>
    </tr>
    <tr>
      <th>redit</th>
      <td>NaN</td>
      <td>0.418022</td>
      <td>0.690333</td>
      <td>0.690333</td>
      <td>0.115902</td>
      <td>0.504206</td>
      <td>0.984655</td>
      <td>0.418062</td>
      <td>0.418044</td>
      <td>0.418029</td>
      <td>...</td>
      <td>1.000000</td>
      <td>0.613517</td>
      <td>0.613466</td>
      <td>0.613446</td>
      <td>0.244134</td>
      <td>0.655658</td>
      <td>0.317106</td>
      <td>0.024651</td>
      <td>0.450928</td>
      <td>0.256097</td>
    </tr>
    <tr>
      <th>rend</th>
      <td>NaN</td>
      <td>0.681573</td>
      <td>0.831887</td>
      <td>0.833059</td>
      <td>0.160407</td>
      <td>0.594219</td>
      <td>0.594688</td>
      <td>0.681565</td>
      <td>0.681550</td>
      <td>0.681533</td>
      <td>...</td>
      <td>0.613517</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.999999</td>
      <td>0.056153</td>
      <td>0.376658</td>
      <td>0.477579</td>
      <td>0.034412</td>
      <td>0.187551</td>
      <td>0.095557</td>
    </tr>
    <tr>
      <th>rend16</th>
      <td>NaN</td>
      <td>0.681573</td>
      <td>0.831895</td>
      <td>0.832975</td>
      <td>0.160417</td>
      <td>0.594226</td>
      <td>0.594639</td>
      <td>0.681565</td>
      <td>0.681550</td>
      <td>0.681533</td>
      <td>...</td>
      <td>0.613466</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.056129</td>
      <td>0.376574</td>
      <td>0.477613</td>
      <td>0.034679</td>
      <td>0.187559</td>
      <td>0.095755</td>
    </tr>
    <tr>
      <th>rend32</th>
      <td>NaN</td>
      <td>0.681573</td>
      <td>0.831903</td>
      <td>0.832924</td>
      <td>0.160414</td>
      <td>0.594223</td>
      <td>0.594619</td>
      <td>0.681565</td>
      <td>0.681550</td>
      <td>0.681533</td>
      <td>...</td>
      <td>0.613446</td>
      <td>0.999999</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.056116</td>
      <td>0.376557</td>
      <td>0.477630</td>
      <td>0.035005</td>
      <td>0.187607</td>
      <td>0.095996</td>
    </tr>
    <tr>
      <th>rev</th>
      <td>NaN</td>
      <td>0.038216</td>
      <td>0.111636</td>
      <td>0.111636</td>
      <td>-0.160357</td>
      <td>0.150144</td>
      <td>0.208568</td>
      <td>0.038236</td>
      <td>0.038231</td>
      <td>0.038228</td>
      <td>...</td>
      <td>0.244134</td>
      <td>0.056153</td>
      <td>0.056129</td>
      <td>0.056116</td>
      <td>1.000000</td>
      <td>0.180470</td>
      <td>0.117200</td>
      <td>-0.034106</td>
      <td>0.218387</td>
      <td>0.094260</td>
    </tr>
    <tr>
      <th>rmiddle</th>
      <td>NaN</td>
      <td>0.256349</td>
      <td>0.605990</td>
      <td>0.623582</td>
      <td>0.106693</td>
      <td>0.225854</td>
      <td>0.652532</td>
      <td>0.256479</td>
      <td>0.256451</td>
      <td>0.256430</td>
      <td>...</td>
      <td>0.655658</td>
      <td>0.376658</td>
      <td>0.376574</td>
      <td>0.376557</td>
      <td>0.180470</td>
      <td>1.000000</td>
      <td>-0.064351</td>
      <td>-0.013771</td>
      <td>0.468925</td>
      <td>0.195497</td>
    </tr>
    <tr>
      <th>rot</th>
      <td>NaN</td>
      <td>0.325594</td>
      <td>0.298090</td>
      <td>0.298090</td>
      <td>0.240946</td>
      <td>0.823937</td>
      <td>0.338994</td>
      <td>0.325559</td>
      <td>0.325557</td>
      <td>0.325552</td>
      <td>...</td>
      <td>0.317106</td>
      <td>0.477579</td>
      <td>0.477613</td>
      <td>0.477630</td>
      <td>0.117200</td>
      <td>-0.064351</td>
      <td>1.000000</td>
      <td>0.051246</td>
      <td>0.243294</td>
      <td>0.126195</td>
    </tr>
    <tr>
      <th>size</th>
      <td>NaN</td>
      <td>-0.133581</td>
      <td>0.016411</td>
      <td>0.016411</td>
      <td>0.212685</td>
      <td>0.064937</td>
      <td>0.057981</td>
      <td>-0.133665</td>
      <td>-0.133671</td>
      <td>-0.133677</td>
      <td>...</td>
      <td>0.024651</td>
      <td>0.034412</td>
      <td>0.034679</td>
      <td>0.035005</td>
      <td>-0.034106</td>
      <td>-0.013771</td>
      <td>0.051246</td>
      <td>1.000000</td>
      <td>-0.236289</td>
      <td>0.805926</td>
    </tr>
    <tr>
      <th>yr</th>
      <td>NaN</td>
      <td>0.127658</td>
      <td>0.291318</td>
      <td>0.305489</td>
      <td>0.138961</td>
      <td>0.388140</td>
      <td>0.464225</td>
      <td>0.127730</td>
      <td>0.127716</td>
      <td>0.127707</td>
      <td>...</td>
      <td>0.450928</td>
      <td>0.187551</td>
      <td>0.187559</td>
      <td>0.187607</td>
      <td>0.218387</td>
      <td>0.468925</td>
      <td>0.243294</td>
      <td>-0.236289</td>
      <td>1.000000</td>
      <td>-0.013907</td>
    </tr>
    <tr>
      <th>yt</th>
      <td>NaN</td>
      <td>-0.008816</td>
      <td>0.139951</td>
      <td>0.155098</td>
      <td>0.192305</td>
      <td>0.203342</td>
      <td>0.283262</td>
      <td>-0.008844</td>
      <td>-0.008852</td>
      <td>-0.008859</td>
      <td>...</td>
      <td>0.256097</td>
      <td>0.095557</td>
      <td>0.095755</td>
      <td>0.095996</td>
      <td>0.094260</td>
      <td>0.195497</td>
      <td>0.126195</td>
      <td>0.805926</td>
      <td>-0.013907</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>35 rows × 35 columns</p>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fdata</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s1">&#39;yt&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CST_</span>             <span class="n">NaN</span>
<span class="n">begin</span>      <span class="o">-</span><span class="mf">0.008816</span>
<span class="n">dbegin</span>      <span class="mf">0.139951</span>
<span class="n">dend</span>        <span class="mf">0.155098</span>
<span class="n">dim</span>         <span class="mf">0.192305</span>
<span class="n">discont</span>     <span class="mf">0.203342</span>
<span class="n">edit</span>        <span class="mf">0.283262</span>
<span class="n">end</span>        <span class="o">-</span><span class="mf">0.008844</span>
<span class="n">end16</span>      <span class="o">-</span><span class="mf">0.008852</span>
<span class="n">end32</span>      <span class="o">-</span><span class="mf">0.008859</span>
<span class="n">ibegin16</span>    <span class="mf">0.136416</span>
<span class="n">ibegin2</span>     <span class="mf">0.109929</span>
<span class="n">ibegin32</span>    <span class="mf">0.136416</span>
<span class="n">ibegin4</span>     <span class="mf">0.179014</span>
<span class="n">ibegin64</span>    <span class="mf">0.124459</span>
<span class="n">ibegin8</span>     <span class="mf">0.179014</span>
<span class="n">iend16</span>      <span class="mf">0.182267</span>
<span class="n">iend2</span>       <span class="mf">0.146321</span>
<span class="n">iend32</span>      <span class="mf">0.139099</span>
<span class="n">iend4</span>       <span class="mf">0.127468</span>
<span class="n">iend64</span>      <span class="mf">0.127728</span>
<span class="n">iend8</span>       <span class="mf">0.182267</span>
<span class="n">middle</span>      <span class="mf">0.821357</span>
<span class="n">rbegin</span>      <span class="mf">0.095471</span>
<span class="n">rdiscont</span>    <span class="mf">0.386893</span>
<span class="n">redit</span>       <span class="mf">0.256097</span>
<span class="n">rend</span>        <span class="mf">0.095557</span>
<span class="n">rend16</span>      <span class="mf">0.095755</span>
<span class="n">rend32</span>      <span class="mf">0.095996</span>
<span class="n">rev</span>         <span class="mf">0.094260</span>
<span class="n">rmiddle</span>     <span class="mf">0.195497</span>
<span class="n">rot</span>         <span class="mf">0.126195</span>
<span class="n">size</span>        <span class="mf">0.805926</span>
<span class="n">yr</span>         <span class="o">-</span><span class="mf">0.013907</span>
<span class="n">yt</span>          <span class="mf">1.000000</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">yt</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>We check the sign of the correlations of all features with <em>yt</em>. If it
is positive, increasing the feature increases the processing time. We
try to get only positive correlations. <em>end</em> is the flattened last
dimensions left unchanged by the permutation. The bigger it is, the
faster the transposition is. That’s why the function computing all
features multiplies this number by <code class="docutils literal notranslate"><span class="pre">-1</span></code> to get a feature positively
correlated to the processing time. <em>end16</em> is equal to <em>end</em> when
<code class="docutils literal notranslate"><span class="pre">end&lt;-16</span></code> and <code class="docutils literal notranslate"><span class="pre">-16</span></code> when <code class="docutils literal notranslate"><span class="pre">end&gt;=-16</span></code>. This is a simplification of
the cost of moving data from memory to cache L1. This cost is linear
when the data to move is big enough, but almost constant for small
chunks.</p>
</section>
</section>
<section id="linear-regression">
<h2><a class="toc-backref" href="#id9">Linear regression</a><a class="headerlink" href="#linear-regression" title="Permalink to this headline">¶</a></h2>
<p>We choose a linear regression because the prediction are not limited.
The training set does not include all configuration and surely does not
include all possible high value the model may have to predict.</p>
<p>The goal is not necessarily to predict the fastest permutation but to
predict the processing time as the goal is to find the best combination
of transpositions in a ONNX graph (einsum). The final goal is to predict
which graphs optimizes a series of transpositions.</p>
<p>The target could be the processing time or the logarithm of this time.
However, making mistakes on small times is not an issue but errors on
high processing time is not a good thing.</p>
<p>We could also try to predict a ratio <em>transposition time /copy time</em> but
it still gives more important to small matrix size.</p>
<p>Many variables are correlated. Variables should be selected.</p>
<section id="dataset">
<h3><a class="toc-backref" href="#id10">Dataset</a><a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">fdata</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;yt&quot;</span><span class="p">,</span> <span class="s2">&quot;yr&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">yt</span> <span class="o">=</span> <span class="n">fdata</span><span class="p">[</span><span class="s1">&#39;yt&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.8809171132996723</span>
</pre></div>
</div>
</section>
<section id="simple-model">
<h3><a class="toc-backref" href="#id11">Simple model</a><a class="headerlink" href="#simple-model" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_absolute_error</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;reg&#39;</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;intercept_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">coef</span><span class="p">]</span>
<span class="n">coef</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">],</span> <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.8157414076410756</span><span class="p">,</span> <span class="mf">0.6368865305095469</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coef</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">}],</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_42_0.png" src="../_images/onnx_operator_cost_42_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
    </tr>
    <tr>
      <th>feature</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CST_</th>
      <td>-3.076618e+08</td>
    </tr>
    <tr>
      <th>begin</th>
      <td>-2.941725e+01</td>
    </tr>
    <tr>
      <th>dbegin</th>
      <td>-1.854147e-01</td>
    </tr>
    <tr>
      <th>dend</th>
      <td>-9.638954e-02</td>
    </tr>
    <tr>
      <th>dim</th>
      <td>-1.037599e-01</td>
    </tr>
    <tr>
      <th>discont</th>
      <td>5.204404e-01</td>
    </tr>
    <tr>
      <th>edit</th>
      <td>3.582481e-01</td>
    </tr>
    <tr>
      <th>end</th>
      <td>-1.046584e+12</td>
    </tr>
    <tr>
      <th>end16</th>
      <td>-2.278042e+10</td>
    </tr>
    <tr>
      <th>end32</th>
      <td>1.069321e+12</td>
    </tr>
    <tr>
      <th>ibegin16</th>
      <td>-3.713466e+00</td>
    </tr>
    <tr>
      <th>ibegin2</th>
      <td>1.439716e-02</td>
    </tr>
    <tr>
      <th>ibegin32</th>
      <td>3.784367e+00</td>
    </tr>
    <tr>
      <th>ibegin4</th>
      <td>-6.813416e+00</td>
    </tr>
    <tr>
      <th>ibegin64</th>
      <td>-7.576102e-02</td>
    </tr>
    <tr>
      <th>ibegin8</th>
      <td>6.927856e+00</td>
    </tr>
    <tr>
      <th>iend16</th>
      <td>2.028144e+07</td>
    </tr>
    <tr>
      <th>iend2</th>
      <td>8.225773e+06</td>
    </tr>
    <tr>
      <th>iend32</th>
      <td>4.322857e+07</td>
    </tr>
    <tr>
      <th>iend4</th>
      <td>1.097274e+07</td>
    </tr>
    <tr>
      <th>iend64</th>
      <td>1.996315e-01</td>
    </tr>
    <tr>
      <th>iend8</th>
      <td>2.028143e+07</td>
    </tr>
    <tr>
      <th>middle</th>
      <td>1.541218e+00</td>
    </tr>
    <tr>
      <th>rbegin</th>
      <td>4.940619e+01</td>
    </tr>
    <tr>
      <th>rdiscont</th>
      <td>7.614642e-01</td>
    </tr>
    <tr>
      <th>redit</th>
      <td>8.622710e-02</td>
    </tr>
    <tr>
      <th>rend</th>
      <td>6.615750e+02</td>
    </tr>
    <tr>
      <th>rend16</th>
      <td>3.459172e+02</td>
    </tr>
    <tr>
      <th>rend32</th>
      <td>-1.057057e+03</td>
    </tr>
    <tr>
      <th>rev</th>
      <td>1.537206e-01</td>
    </tr>
    <tr>
      <th>rmiddle</th>
      <td>-4.563712e-01</td>
    </tr>
    <tr>
      <th>rot</th>
      <td>7.771901e-02</td>
    </tr>
    <tr>
      <th>size</th>
      <td>1.295707e+00</td>
    </tr>
    <tr>
      <th>intercept_</th>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>r2</th>
      <td>8.157414e-01</td>
    </tr>
    <tr>
      <th>mae</th>
      <td>6.368865e-01</td>
    </tr>
  </tbody>
</table>
</div><p>Coefficients associated to features <em>end</em>, <em>end16</em> are almost opposed
and it would better to get a model which keeps only one.</p>
</section>
<section id="quantile-regression">
<h3><a class="toc-backref" href="#id12">Quantile Regression</a><a class="headerlink" href="#quantile-regression" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlinsights.mlmodel</span> <span class="kn">import</span> <span class="n">QuantileLinearRegression</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">QuantileLinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;med&#39;</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;intercept_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe</span>
<span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">],</span> <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.7924498414927943</span><span class="p">,</span> <span class="mf">0.5679387557069854</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
    </tr>
    <tr>
      <th>feature</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CST_</th>
      <td>1433409.249051</td>
    </tr>
    <tr>
      <th>begin</th>
      <td>27.13405</td>
    </tr>
    <tr>
      <th>dbegin</th>
      <td>0.07931</td>
    </tr>
    <tr>
      <th>dend</th>
      <td>0.087576</td>
    </tr>
    <tr>
      <th>dim</th>
      <td>0.006919</td>
    </tr>
    <tr>
      <th>discont</th>
      <td>0.413378</td>
    </tr>
    <tr>
      <th>edit</th>
      <td>0.186032</td>
    </tr>
    <tr>
      <th>end</th>
      <td>4876069525.422424</td>
    </tr>
    <tr>
      <th>end16</th>
      <td>106134745.367844</td>
    </tr>
    <tr>
      <th>end32</th>
      <td>-4982003112.711292</td>
    </tr>
    <tr>
      <th>ibegin16</th>
      <td>0.129918</td>
    </tr>
    <tr>
      <th>ibegin2</th>
      <td>-0.069604</td>
    </tr>
    <tr>
      <th>ibegin32</th>
      <td>-0.221099</td>
    </tr>
    <tr>
      <th>ibegin4</th>
      <td>-0.045585</td>
    </tr>
    <tr>
      <th>ibegin64</th>
      <td>-0.1085</td>
    </tr>
    <tr>
      <th>ibegin8</th>
      <td>0.073031</td>
    </tr>
    <tr>
      <th>iend16</th>
      <td>-94492.918693</td>
    </tr>
    <tr>
      <th>iend2</th>
      <td>-38324.37475</td>
    </tr>
    <tr>
      <th>iend32</th>
      <td>-201401.795017</td>
    </tr>
    <tr>
      <th>iend4</th>
      <td>-51122.392443</td>
    </tr>
    <tr>
      <th>iend64</th>
      <td>0.15928</td>
    </tr>
    <tr>
      <th>iend8</th>
      <td>-94492.881923</td>
    </tr>
    <tr>
      <th>middle</th>
      <td>1.588707</td>
    </tr>
    <tr>
      <th>rbegin</th>
      <td>36.958438</td>
    </tr>
    <tr>
      <th>rdiscont</th>
      <td>0.375421</td>
    </tr>
    <tr>
      <th>redit</th>
      <td>0.071189</td>
    </tr>
    <tr>
      <th>rend</th>
      <td>4424.263222</td>
    </tr>
    <tr>
      <th>rend16</th>
      <td>-7664.018684</td>
    </tr>
    <tr>
      <th>rend32</th>
      <td>3202.681647</td>
    </tr>
    <tr>
      <th>rev</th>
      <td>0.08288</td>
    </tr>
    <tr>
      <th>rmiddle</th>
      <td>-0.207068</td>
    </tr>
    <tr>
      <th>rot</th>
      <td>-0.095643</td>
    </tr>
    <tr>
      <th>size</th>
      <td>0.938597</td>
    </tr>
    <tr>
      <th>name</th>
      <td>med</td>
    </tr>
    <tr>
      <th>intercept_</th>
      <td>0</td>
    </tr>
    <tr>
      <th>r2</th>
      <td>0.79245</td>
    </tr>
    <tr>
      <th>mae</th>
      <td>0.567939</td>
    </tr>
    <tr>
      <th>model</th>
      <td>(StandardScaler(with_mean=False), QuantileLine...</td>
    </tr>
  </tbody>
</table>
</div></section>
<section id="lasso">
<h3><a class="toc-backref" href="#id13">Lasso</a><a class="headerlink" href="#lasso" title="Permalink to this headline">¶</a></h3>
<p>To select features.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>

<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">1.</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
        <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">5000</span><span class="p">))</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">r2</span><span class="o">=</span><span class="n">r2_score</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">),</span> <span class="n">mae</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">),</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                       <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)))</span>
    <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mf">0.2</span><span class="p">:</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
        <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lasso-</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">alpha</span>
        <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe</span>
        <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
        <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
        <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>

<span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>100%|██████████| 13/13 [00:00&lt;00:00, 69.97it/s]
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>r2</th>
      <th>mae</th>
      <th>alpha</th>
      <th>null</th>
      <th>n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.809704</td>
      <td>0.629480</td>
      <td>0.001</td>
      <td>4</td>
      <td>33</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.807546</td>
      <td>0.629886</td>
      <td>0.010</td>
      <td>10</td>
      <td>33</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.782541</td>
      <td>0.676499</td>
      <td>0.100</td>
      <td>23</td>
      <td>33</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.766911</td>
      <td>0.680344</td>
      <td>0.200</td>
      <td>28</td>
      <td>33</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.751546</td>
      <td>0.703684</td>
      <td>0.300</td>
      <td>29</td>
      <td>33</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.738223</td>
      <td>0.742962</td>
      <td>0.400</td>
      <td>30</td>
      <td>33</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.730937</td>
      <td>0.735958</td>
      <td>0.500</td>
      <td>31</td>
      <td>33</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.718437</td>
      <td>0.758143</td>
      <td>0.600</td>
      <td>30</td>
      <td>33</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.701329</td>
      <td>0.800503</td>
      <td>0.700</td>
      <td>30</td>
      <td>33</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.681590</td>
      <td>0.848549</td>
      <td>0.800</td>
      <td>30</td>
      <td>33</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.659218</td>
      <td>0.898770</td>
      <td>0.900</td>
      <td>30</td>
      <td>33</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.634218</td>
      <td>0.949493</td>
      <td>1.000</td>
      <td>30</td>
      <td>33</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.239413</td>
      <td>1.600542</td>
      <td>2.000</td>
      <td>30</td>
      <td>33</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">models</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;alpha=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">scores</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]);</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_50_0.png" src="../_images/onnx_operator_cost_50_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">models</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;alpha=</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">scores</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]);</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_51_0.png" src="../_images/onnx_operator_cost_51_0.png" />
</section>
<section id="linear-regression-with-positive-weights">
<h3><a class="toc-backref" href="#id14">Linear regression with positive weights</a><a class="headerlink" href="#linear-regression-with-positive-weights" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pos&#39;</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;intercept_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe</span>
<span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">],</span> <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.7905447080626958</span><span class="p">,</span> <span class="mf">0.6768663007518693</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;positive&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_54_0.png" src="../_images/onnx_operator_cost_54_0.png" />
</section>
<section id="quantile-regression-with-positive-weights">
<h3><a class="toc-backref" href="#id15">Quantile regression with positive weights</a><a class="headerlink" href="#quantile-regression-with-positive-weights" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">QuantileLinearRegression</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">yt</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;medpos&#39;</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;intercept_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">yt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipe</span>
<span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span>
<span class="n">coef</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">],</span> <span class="n">coef</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.752689515971656</span><span class="p">,</span> <span class="mf">0.6468340444504788</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;positive&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_57_0.png" src="../_images/onnx_operator_cost_57_0.png" />
</section>
<section id="summary">
<h3><a class="toc-backref" href="#id16">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfcoef</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
<span class="n">dfcoef</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>6</th>
      <th>5</th>
      <th>4</th>
      <th>3</th>
      <th>2</th>
      <th>1</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CST_</th>
      <td>0.829482</td>
      <td>0.821048</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1433409.249051</td>
      <td>-307661768.128088</td>
    </tr>
    <tr>
      <th>begin</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.03443</td>
      <td>27.13405</td>
      <td>-29.417247</td>
    </tr>
    <tr>
      <th>dbegin</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.044705</td>
      <td>0.07931</td>
      <td>-0.185415</td>
    </tr>
    <tr>
      <th>dend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.087576</td>
      <td>-0.09639</td>
    </tr>
    <tr>
      <th>dim</th>
      <td>0.023846</td>
      <td>0.0</td>
      <td>-0.014763</td>
      <td>-0.030446</td>
      <td>-0.120949</td>
      <td>0.006919</td>
      <td>-0.10376</td>
    </tr>
    <tr>
      <th>discont</th>
      <td>0.060636</td>
      <td>0.056297</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.210421</td>
      <td>0.413378</td>
      <td>0.52044</td>
    </tr>
    <tr>
      <th>edit</th>
      <td>0.03823</td>
      <td>0.094856</td>
      <td>0.0</td>
      <td>0.0418</td>
      <td>0.396052</td>
      <td>0.186032</td>
      <td>0.358248</td>
    </tr>
    <tr>
      <th>end</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.007053</td>
      <td>4876069525.422424</td>
      <td>-1046583604803.358887</td>
    </tr>
    <tr>
      <th>end16</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.000036</td>
      <td>106134745.367844</td>
      <td>-22780416305.902706</td>
    </tr>
    <tr>
      <th>end32</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.00004</td>
      <td>-4982003112.711292</td>
      <td>1069320839370.567505</td>
    </tr>
    <tr>
      <th>ibegin16</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.066669</td>
      <td>0.129918</td>
      <td>-3.713466</td>
    </tr>
    <tr>
      <th>ibegin2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.02181</td>
      <td>-0.069604</td>
      <td>0.014397</td>
    </tr>
    <tr>
      <th>ibegin32</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
      <td>-0.221099</td>
      <td>3.784367</td>
    </tr>
    <tr>
      <th>ibegin4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
      <td>-0.045585</td>
      <td>-6.813416</td>
    </tr>
    <tr>
      <th>ibegin64</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
      <td>-0.1085</td>
      <td>-0.075761</td>
    </tr>
    <tr>
      <th>ibegin8</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
      <td>0.073031</td>
      <td>6.927856</td>
    </tr>
    <tr>
      <th>iend16</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.022416</td>
      <td>-94492.918693</td>
      <td>20281439.108194</td>
    </tr>
    <tr>
      <th>iend2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>0.0</td>
      <td>-38324.37475</td>
      <td>8225773.255917</td>
    </tr>
    <tr>
      <th>iend32</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-201401.795017</td>
      <td>43228573.054944</td>
    </tr>
    <tr>
      <th>iend4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.151081</td>
      <td>-51122.392443</td>
      <td>10972737.091606</td>
    </tr>
    <tr>
      <th>iend64</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>0.15928</td>
      <td>0.199631</td>
    </tr>
    <tr>
      <th>iend8</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.08907</td>
      <td>-94492.881923</td>
      <td>20281426.580972</td>
    </tr>
    <tr>
      <th>middle</th>
      <td>1.101543</td>
      <td>1.30347</td>
      <td>1.290699</td>
      <td>1.325916</td>
      <td>1.466733</td>
      <td>1.588707</td>
      <td>1.541218</td>
    </tr>
    <tr>
      <th>rbegin</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.020369</td>
      <td>-0.28295</td>
      <td>36.958438</td>
      <td>49.406192</td>
    </tr>
    <tr>
      <th>rdiscont</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.066385</td>
      <td>0.375421</td>
      <td>0.761464</td>
    </tr>
    <tr>
      <th>redit</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.071189</td>
      <td>0.086227</td>
    </tr>
    <tr>
      <th>rend</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.007655</td>
      <td>-0.007593</td>
      <td>4424.263222</td>
      <td>661.575013</td>
    </tr>
    <tr>
      <th>rend16</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.003393</td>
      <td>-0.010514</td>
      <td>-7664.018684</td>
      <td>345.917179</td>
    </tr>
    <tr>
      <th>rend32</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.005349</td>
      <td>-0.013172</td>
      <td>3202.681647</td>
      <td>-1057.05651</td>
    </tr>
    <tr>
      <th>rev</th>
      <td>0.026757</td>
      <td>0.189909</td>
      <td>0.013992</td>
      <td>0.097585</td>
      <td>0.142791</td>
      <td>0.08288</td>
      <td>0.153721</td>
    </tr>
    <tr>
      <th>rmiddle</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.0</td>
      <td>-0.0</td>
      <td>-0.324716</td>
      <td>-0.207068</td>
      <td>-0.456371</td>
    </tr>
    <tr>
      <th>rot</th>
      <td>0.009222</td>
      <td>0.185687</td>
      <td>0.108468</td>
      <td>0.197021</td>
      <td>0.108146</td>
      <td>-0.095643</td>
      <td>0.077719</td>
    </tr>
    <tr>
      <th>size</th>
      <td>1.100532</td>
      <td>1.300222</td>
      <td>1.099463</td>
      <td>1.183553</td>
      <td>1.22329</td>
      <td>0.938597</td>
      <td>1.295707</td>
    </tr>
    <tr>
      <th>name</th>
      <td>medpos</td>
      <td>pos</td>
      <td>Lasso-0.200000</td>
      <td>Lasso-0.100000</td>
      <td>Lasso-0.010000</td>
      <td>med</td>
      <td>reg</td>
    </tr>
    <tr>
      <th>intercept_</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>r2</th>
      <td>0.75269</td>
      <td>0.790545</td>
      <td>0.766911</td>
      <td>0.782541</td>
      <td>0.807546</td>
      <td>0.79245</td>
      <td>0.815741</td>
    </tr>
    <tr>
      <th>mae</th>
      <td>0.646834</td>
      <td>0.676866</td>
      <td>0.680344</td>
      <td>0.676499</td>
      <td>0.629886</td>
      <td>0.567939</td>
      <td>0.636887</td>
    </tr>
    <tr>
      <th>model</th>
      <td>(StandardScaler(with_mean=False), QuantileLine...</td>
      <td>(StandardScaler(with_mean=False), LinearRegres...</td>
      <td>(StandardScaler(with_mean=False), Lasso(alpha=...</td>
      <td>(StandardScaler(with_mean=False), Lasso(alpha=...</td>
      <td>(StandardScaler(with_mean=False), Lasso(alpha=...</td>
      <td>(StandardScaler(with_mean=False), QuantileLine...</td>
      <td>(StandardScaler(with_mean=False), LinearRegres...</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfcoef</span><span class="p">[[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;performance accross models&quot;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_60_0.png" src="../_images/onnx_operator_cost_60_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">dfp</span> <span class="o">=</span> <span class="n">dfcoef</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dfp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">dfcoef</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">dfp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dfp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">dfp</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../_images/onnx_operator_cost_61_0.png" src="../_images/onnx_operator_cost_61_0.png" />
</section>
</section>
<section id="investigation">
<h2><a class="toc-backref" href="#id17">Investigation</a><a class="headerlink" href="#investigation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_err</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;context_size&quot;</span><span class="p">,</span> <span class="s2">&quot;repeat&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">])</span>
<span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;abserr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">])</span>
<span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;rel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">data_err</span><span class="p">[</span><span class="s1">&#39;average&#39;</span><span class="p">]</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">data_err</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abserr&#39;</span><span class="p">)</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>number</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
      <th>predict</th>
      <th>err</th>
      <th>abserr</th>
      <th>rel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28</th>
      <td>0.000113</td>
      <td>0.000029</td>
      <td>0.000061</td>
      <td>0.000141</td>
      <td>50</td>
      <td>(1, 0, 2)</td>
      <td>(43, 44, 45)</td>
      <td>1.515711</td>
      <td>3</td>
      <td>0.000113</td>
      <td>1.251063e-07</td>
      <td>1.251063e-07</td>
      <td>0.001111</td>
    </tr>
    <tr>
      <th>55</th>
      <td>0.000893</td>
      <td>0.000212</td>
      <td>0.000646</td>
      <td>0.001477</td>
      <td>50</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>8.339926</td>
      <td>4</td>
      <td>0.000893</td>
      <td>-2.410649e-07</td>
      <td>2.410649e-07</td>
      <td>-0.000270</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.000077</td>
      <td>0.000008</td>
      <td>0.000069</td>
      <td>0.000101</td>
      <td>50</td>
      <td>(0, 2, 1)</td>
      <td>(43, 44, 45)</td>
      <td>1.032759</td>
      <td>3</td>
      <td>0.000077</td>
      <td>4.172780e-07</td>
      <td>4.172780e-07</td>
      <td>0.005440</td>
    </tr>
    <tr>
      <th>39</th>
      <td>0.000126</td>
      <td>0.000017</td>
      <td>0.000107</td>
      <td>0.000185</td>
      <td>50</td>
      <td>(2, 0, 1, 3)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.180996</td>
      <td>4</td>
      <td>0.000115</td>
      <td>-1.179187e-05</td>
      <td>1.179187e-05</td>
      <td>-0.093246</td>
    </tr>
    <tr>
      <th>66</th>
      <td>0.000195</td>
      <td>0.000019</td>
      <td>0.000163</td>
      <td>0.000258</td>
      <td>50</td>
      <td>(0, 3, 1, 2)</td>
      <td>(1, 244, 244, 3)</td>
      <td>1.598770</td>
      <td>4</td>
      <td>0.000210</td>
      <td>1.510728e-05</td>
      <td>1.510728e-05</td>
      <td>0.077417</td>
    </tr>
    <tr>
      <th>50</th>
      <td>0.000692</td>
      <td>0.000136</td>
      <td>0.000529</td>
      <td>0.001021</td>
      <td>50</td>
      <td>(0, 3, 2, 1)</td>
      <td>(3, 244, 244, 1)</td>
      <td>6.460759</td>
      <td>4</td>
      <td>0.000709</td>
      <td>1.714180e-05</td>
      <td>1.714180e-05</td>
      <td>0.024778</td>
    </tr>
    <tr>
      <th>76</th>
      <td>0.000824</td>
      <td>0.000288</td>
      <td>0.000515</td>
      <td>0.001879</td>
      <td>50</td>
      <td>(1, 3, 2, 0)</td>
      <td>(1, 244, 244, 3)</td>
      <td>6.752663</td>
      <td>4</td>
      <td>0.000843</td>
      <td>1.902846e-05</td>
      <td>1.902846e-05</td>
      <td>0.023087</td>
    </tr>
    <tr>
      <th>54</th>
      <td>0.000818</td>
      <td>0.000278</td>
      <td>0.000625</td>
      <td>0.001522</td>
      <td>50</td>
      <td>(2, 1, 3, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>7.634646</td>
      <td>4</td>
      <td>0.000843</td>
      <td>2.572773e-05</td>
      <td>2.572773e-05</td>
      <td>0.031471</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000048</td>
      <td>0.000003</td>
      <td>0.000045</td>
      <td>0.000058</td>
      <td>50</td>
      <td>(0, 1, 3, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.820821</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-4.837787e-05</td>
      <td>4.837787e-05</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000049</td>
      <td>0.000003</td>
      <td>0.000045</td>
      <td>0.000062</td>
      <td>50</td>
      <td>(3, 0, 1, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>0.823070</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-4.851040e-05</td>
      <td>4.851040e-05</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>120</th>
      <td>0.005918</td>
      <td>0.001085</td>
      <td>0.004598</td>
      <td>0.008312</td>
      <td>15</td>
      <td>(1, 0, 3, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.597357</td>
      <td>4</td>
      <td>0.008259</td>
      <td>2.341673e-03</td>
      <td>2.341673e-03</td>
      <td>0.395716</td>
    </tr>
    <tr>
      <th>128</th>
      <td>0.010677</td>
      <td>0.001457</td>
      <td>0.008504</td>
      <td>0.014070</td>
      <td>15</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.882191</td>
      <td>4</td>
      <td>0.008132</td>
      <td>-2.545011e-03</td>
      <td>2.545011e-03</td>
      <td>-0.238356</td>
    </tr>
    <tr>
      <th>121</th>
      <td>0.006106</td>
      <td>0.000556</td>
      <td>0.005619</td>
      <td>0.007305</td>
      <td>15</td>
      <td>(2, 0, 3, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.648325</td>
      <td>4</td>
      <td>0.008700</td>
      <td>2.593662e-03</td>
      <td>2.593662e-03</td>
      <td>0.424746</td>
    </tr>
    <tr>
      <th>118</th>
      <td>0.003780</td>
      <td>0.000882</td>
      <td>0.002701</td>
      <td>0.005402</td>
      <td>15</td>
      <td>(3, 0, 1, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.020432</td>
      <td>4</td>
      <td>0.006488</td>
      <td>2.707333e-03</td>
      <td>2.707333e-03</td>
      <td>0.716171</td>
    </tr>
    <tr>
      <th>115</th>
      <td>0.003653</td>
      <td>0.000874</td>
      <td>0.002567</td>
      <td>0.005244</td>
      <td>15</td>
      <td>(1, 2, 3, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>0.986071</td>
      <td>4</td>
      <td>0.006488</td>
      <td>2.834624e-03</td>
      <td>2.834624e-03</td>
      <td>0.775972</td>
    </tr>
    <tr>
      <th>129</th>
      <td>0.012421</td>
      <td>0.003052</td>
      <td>0.007818</td>
      <td>0.018106</td>
      <td>15</td>
      <td>(3, 2, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.352770</td>
      <td>4</td>
      <td>0.009386</td>
      <td>-3.034652e-03</td>
      <td>3.034652e-03</td>
      <td>-0.244323</td>
    </tr>
    <tr>
      <th>119</th>
      <td>0.004938</td>
      <td>0.000367</td>
      <td>0.004532</td>
      <td>0.005844</td>
      <td>15</td>
      <td>(1, 3, 0, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.333061</td>
      <td>4</td>
      <td>0.008700</td>
      <td>3.761588e-03</td>
      <td>3.761588e-03</td>
      <td>0.761694</td>
    </tr>
    <tr>
      <th>127</th>
      <td>0.010339</td>
      <td>0.002789</td>
      <td>0.005878</td>
      <td>0.018301</td>
      <td>15</td>
      <td>(0, 3, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.790823</td>
      <td>4</td>
      <td>0.005271</td>
      <td>-5.068171e-03</td>
      <td>5.068171e-03</td>
      <td>-0.490205</td>
    </tr>
    <tr>
      <th>130</th>
      <td>0.013432</td>
      <td>0.004496</td>
      <td>0.006536</td>
      <td>0.021250</td>
      <td>15</td>
      <td>(3, 2, 0, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.625680</td>
      <td>4</td>
      <td>0.008132</td>
      <td>-5.299336e-03</td>
      <td>5.299336e-03</td>
      <td>-0.394540</td>
    </tr>
    <tr>
      <th>131</th>
      <td>0.014579</td>
      <td>0.004026</td>
      <td>0.007144</td>
      <td>0.020739</td>
      <td>15</td>
      <td>(3, 0, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.935483</td>
      <td>4</td>
      <td>0.008259</td>
      <td>-6.320138e-03</td>
      <td>6.320138e-03</td>
      <td>-0.433499</td>
    </tr>
  </tbody>
</table>
</div><p>All big errors are negative. The model seems to give a lower value for
all big errors. These errors may be outliers, the processor was busy
doing something else at that time.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">data_err</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;predict&#39;</span><span class="p">)</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>number</th>
      <th>perm</th>
      <th>shape</th>
      <th>ratio</th>
      <th>dim</th>
      <th>predict</th>
      <th>err</th>
      <th>abserr</th>
      <th>rel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20</th>
      <td>0.000158</td>
      <td>0.000021</td>
      <td>0.000127</td>
      <td>0.000192</td>
      <td>50</td>
      <td>(3, 0, 2, 1)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.684876</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-0.000158</td>
      <td>0.000158</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>42</th>
      <td>0.000147</td>
      <td>0.000017</td>
      <td>0.000106</td>
      <td>0.000175</td>
      <td>50</td>
      <td>(0, 1, 3, 2)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.369978</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-0.000147</td>
      <td>0.000147</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>34</th>
      <td>0.000151</td>
      <td>0.000016</td>
      <td>0.000136</td>
      <td>0.000197</td>
      <td>50</td>
      <td>(1, 2, 0)</td>
      <td>(3, 244, 244)</td>
      <td>1.438446</td>
      <td>3</td>
      <td>0.000000</td>
      <td>-0.000151</td>
      <td>0.000151</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>33</th>
      <td>0.000124</td>
      <td>0.000017</td>
      <td>0.000108</td>
      <td>0.000171</td>
      <td>50</td>
      <td>(2, 0, 1)</td>
      <td>(3, 244, 244)</td>
      <td>1.185666</td>
      <td>3</td>
      <td>0.000000</td>
      <td>-0.000124</td>
      <td>0.000124</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>44</th>
      <td>0.000189</td>
      <td>0.000044</td>
      <td>0.000142</td>
      <td>0.000265</td>
      <td>50</td>
      <td>(1, 2, 3, 0)</td>
      <td>(3, 244, 244, 1)</td>
      <td>1.766905</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-0.000189</td>
      <td>0.000189</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.000097</td>
      <td>0.000004</td>
      <td>0.000083</td>
      <td>0.000110</td>
      <td>50</td>
      <td>(2, 0, 1)</td>
      <td>(43, 44, 45)</td>
      <td>1.300915</td>
      <td>3</td>
      <td>0.000000</td>
      <td>-0.000097</td>
      <td>0.000097</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.000074</td>
      <td>0.000009</td>
      <td>0.000065</td>
      <td>0.000109</td>
      <td>50</td>
      <td>(0, 1, 2)</td>
      <td>(43, 44, 45)</td>
      <td>1.000000</td>
      <td>3</td>
      <td>0.000000</td>
      <td>-0.000074</td>
      <td>0.000074</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.000073</td>
      <td>0.000009</td>
      <td>0.000062</td>
      <td>0.000094</td>
      <td>50</td>
      <td>(1, 2, 0)</td>
      <td>(43, 44, 45)</td>
      <td>0.985513</td>
      <td>3</td>
      <td>0.000000</td>
      <td>-0.000073</td>
      <td>0.000073</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.000214</td>
      <td>0.000060</td>
      <td>0.000136</td>
      <td>0.000295</td>
      <td>50</td>
      <td>(1, 0, 3, 2)</td>
      <td>(12, 13, 15, 18)</td>
      <td>3.627240</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-0.000214</td>
      <td>0.000214</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.000164</td>
      <td>0.000045</td>
      <td>0.000124</td>
      <td>0.000231</td>
      <td>50</td>
      <td>(3, 1, 2, 0)</td>
      <td>(12, 13, 15, 18)</td>
      <td>2.778193</td>
      <td>4</td>
      <td>0.000000</td>
      <td>-0.000164</td>
      <td>0.000164</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>128</th>
      <td>0.010677</td>
      <td>0.001457</td>
      <td>0.008504</td>
      <td>0.014070</td>
      <td>15</td>
      <td>(2, 3, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.882191</td>
      <td>4</td>
      <td>0.008132</td>
      <td>-0.002545</td>
      <td>0.002545</td>
      <td>-0.238356</td>
    </tr>
    <tr>
      <th>130</th>
      <td>0.013432</td>
      <td>0.004496</td>
      <td>0.006536</td>
      <td>0.021250</td>
      <td>15</td>
      <td>(3, 2, 0, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.625680</td>
      <td>4</td>
      <td>0.008132</td>
      <td>-0.005299</td>
      <td>0.005299</td>
      <td>-0.394540</td>
    </tr>
    <tr>
      <th>122</th>
      <td>0.006722</td>
      <td>0.001807</td>
      <td>0.005067</td>
      <td>0.011245</td>
      <td>15</td>
      <td>(1, 3, 2, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.814552</td>
      <td>4</td>
      <td>0.008259</td>
      <td>0.001537</td>
      <td>0.001537</td>
      <td>0.228654</td>
    </tr>
    <tr>
      <th>125</th>
      <td>0.007815</td>
      <td>0.001757</td>
      <td>0.005932</td>
      <td>0.010779</td>
      <td>15</td>
      <td>(2, 1, 3, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>2.109489</td>
      <td>4</td>
      <td>0.008259</td>
      <td>0.000444</td>
      <td>0.000444</td>
      <td>0.056871</td>
    </tr>
    <tr>
      <th>120</th>
      <td>0.005918</td>
      <td>0.001085</td>
      <td>0.004598</td>
      <td>0.008312</td>
      <td>15</td>
      <td>(1, 0, 3, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.597357</td>
      <td>4</td>
      <td>0.008259</td>
      <td>0.002342</td>
      <td>0.002342</td>
      <td>0.395716</td>
    </tr>
    <tr>
      <th>123</th>
      <td>0.007071</td>
      <td>0.000982</td>
      <td>0.005454</td>
      <td>0.008559</td>
      <td>15</td>
      <td>(3, 1, 0, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.908667</td>
      <td>4</td>
      <td>0.008259</td>
      <td>0.001188</td>
      <td>0.001188</td>
      <td>0.168070</td>
    </tr>
    <tr>
      <th>131</th>
      <td>0.014579</td>
      <td>0.004026</td>
      <td>0.007144</td>
      <td>0.020739</td>
      <td>15</td>
      <td>(3, 0, 2, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.935483</td>
      <td>4</td>
      <td>0.008259</td>
      <td>-0.006320</td>
      <td>0.006320</td>
      <td>-0.433499</td>
    </tr>
    <tr>
      <th>121</th>
      <td>0.006106</td>
      <td>0.000556</td>
      <td>0.005619</td>
      <td>0.007305</td>
      <td>15</td>
      <td>(2, 0, 3, 1)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.648325</td>
      <td>4</td>
      <td>0.008700</td>
      <td>0.002594</td>
      <td>0.002594</td>
      <td>0.424746</td>
    </tr>
    <tr>
      <th>119</th>
      <td>0.004938</td>
      <td>0.000367</td>
      <td>0.004532</td>
      <td>0.005844</td>
      <td>15</td>
      <td>(1, 3, 0, 2)</td>
      <td>(3, 244, 244, 6)</td>
      <td>1.333061</td>
      <td>4</td>
      <td>0.008700</td>
      <td>0.003762</td>
      <td>0.003762</td>
      <td>0.761694</td>
    </tr>
    <tr>
      <th>129</th>
      <td>0.012421</td>
      <td>0.003052</td>
      <td>0.007818</td>
      <td>0.018106</td>
      <td>15</td>
      <td>(3, 2, 1, 0)</td>
      <td>(3, 244, 244, 6)</td>
      <td>3.352770</td>
      <td>4</td>
      <td>0.009386</td>
      <td>-0.003035</td>
      <td>0.003035</td>
      <td>-0.244323</td>
    </tr>
  </tbody>
</table>
</div><section id="correlation-between-predictors">
<h3><a class="toc-backref" href="#id18">Correlation between predictors</a><a class="headerlink" href="#correlation-between-predictors" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coefs</span><span class="p">]))</span>
<span class="n">cc</span><span class="p">[</span><span class="s1">&#39;yt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yt</span>
<span class="n">cc</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reg</th>
      <th>med</th>
      <th>Lasso-0.010000</th>
      <th>Lasso-0.100000</th>
      <th>Lasso-0.200000</th>
      <th>pos</th>
      <th>medpos</th>
      <th>yt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.298789</td>
      <td>0.052436</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.044222</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000000</td>
      <td>0.071575</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.048378</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000000</td>
      <td>0.048393</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.048510</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000000</td>
      <td>0.048393</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.048954</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.248089</td>
      <td>0.050781</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.050805</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>127</th>
      <td>5.270700</td>
      <td>4.177012</td>
      <td>4.917105</td>
      <td>4.615490</td>
      <td>4.464429</td>
      <td>4.837032</td>
      <td>4.251381</td>
      <td>10.338870</td>
    </tr>
    <tr>
      <th>128</th>
      <td>8.132342</td>
      <td>7.354799</td>
      <td>8.107191</td>
      <td>7.646966</td>
      <td>7.334861</td>
      <td>7.858363</td>
      <td>6.706548</td>
      <td>10.677354</td>
    </tr>
    <tr>
      <th>129</th>
      <td>9.386005</td>
      <td>8.186190</td>
      <td>8.991256</td>
      <td>8.082431</td>
      <td>7.397300</td>
      <td>8.771040</td>
      <td>6.896204</td>
      <td>12.420657</td>
    </tr>
    <tr>
      <th>130</th>
      <td>8.132342</td>
      <td>7.354799</td>
      <td>8.107191</td>
      <td>7.646966</td>
      <td>7.334861</td>
      <td>7.858363</td>
      <td>6.706548</td>
      <td>13.431679</td>
    </tr>
    <tr>
      <th>131</th>
      <td>8.259236</td>
      <td>7.561004</td>
      <td>7.962160</td>
      <td>7.605605</td>
      <td>7.334861</td>
      <td>7.829728</td>
      <td>6.738972</td>
      <td>14.579374</td>
    </tr>
  </tbody>
</table>
<p>132 rows × 8 columns</p>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reg</th>
      <th>med</th>
      <th>Lasso-0.010000</th>
      <th>Lasso-0.100000</th>
      <th>Lasso-0.200000</th>
      <th>pos</th>
      <th>medpos</th>
      <th>yt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>reg</th>
      <td>1.000000</td>
      <td>0.994124</td>
      <td>0.996922</td>
      <td>0.985715</td>
      <td>0.979826</td>
      <td>0.988323</td>
      <td>0.980433</td>
      <td>0.903528</td>
    </tr>
    <tr>
      <th>med</th>
      <td>0.994124</td>
      <td>1.000000</td>
      <td>0.995863</td>
      <td>0.989990</td>
      <td>0.987374</td>
      <td>0.990341</td>
      <td>0.988401</td>
      <td>0.894833</td>
    </tr>
    <tr>
      <th>Lasso-0.010000</th>
      <td>0.996922</td>
      <td>0.995863</td>
      <td>1.000000</td>
      <td>0.992689</td>
      <td>0.987930</td>
      <td>0.994420</td>
      <td>0.988358</td>
      <td>0.899384</td>
    </tr>
    <tr>
      <th>Lasso-0.100000</th>
      <td>0.985715</td>
      <td>0.989990</td>
      <td>0.992689</td>
      <td>1.000000</td>
      <td>0.998564</td>
      <td>0.998756</td>
      <td>0.997985</td>
      <td>0.886902</td>
    </tr>
    <tr>
      <th>Lasso-0.200000</th>
      <td>0.979826</td>
      <td>0.987374</td>
      <td>0.987930</td>
      <td>0.998564</td>
      <td>1.000000</td>
      <td>0.995092</td>
      <td>0.999385</td>
      <td>0.880614</td>
    </tr>
    <tr>
      <th>pos</th>
      <td>0.988323</td>
      <td>0.990341</td>
      <td>0.994420</td>
      <td>0.998756</td>
      <td>0.995092</td>
      <td>1.000000</td>
      <td>0.995169</td>
      <td>0.890093</td>
    </tr>
    <tr>
      <th>medpos</th>
      <td>0.980433</td>
      <td>0.988401</td>
      <td>0.988358</td>
      <td>0.997985</td>
      <td>0.999385</td>
      <td>0.995169</td>
      <td>1.000000</td>
      <td>0.881208</td>
    </tr>
    <tr>
      <th>yt</th>
      <td>0.903528</td>
      <td>0.894833</td>
      <td>0.899384</td>
      <td>0.886902</td>
      <td>0.880614</td>
      <td>0.890093</td>
      <td>0.881208</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></section>
</section>
<section id="standalone-predictions">
<h2><a class="toc-backref" href="#id19">Standalone predictions</a><a class="headerlink" href="#standalone-predictions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_coef</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scale_</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">c2</span> <span class="o">/</span> <span class="n">c1</span><span class="p">))</span>


<span class="n">get_coef</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;CST_&#39;</span><span class="p">:</span> <span class="mf">0.829481835464256</span><span class="p">,</span>
 <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;dbegin&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;dend&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;dim&#39;</span><span class="p">:</span> <span class="mf">0.08294721851224843</span><span class="p">,</span>
 <span class="s1">&#39;discont&#39;</span><span class="p">:</span> <span class="mf">0.07025394222472751</span><span class="p">,</span>
 <span class="s1">&#39;edit&#39;</span><span class="p">:</span> <span class="mf">0.03782977428195987</span><span class="p">,</span>
 <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;end16&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;end32&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin16&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin2&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin32&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin4&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin64&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;ibegin8&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend16&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend2&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend32&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend4&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend64&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;iend8&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;middle&#39;</span><span class="p">:</span> <span class="mf">3.42896339670081e-06</span><span class="p">,</span>
 <span class="s1">&#39;rbegin&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rdiscont&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;redit&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rend&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rend16&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rend32&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rev&#39;</span><span class="p">:</span> <span class="mf">0.11940214295823245</span><span class="p">,</span>
 <span class="s1">&#39;rmiddle&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="mf">0.023189032947793925</span><span class="p">,</span>
 <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mf">3.021302183272755e-06</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">perm</span><span class="p">):</span>
    <span class="n">feat</span> <span class="o">=</span> <span class="n">compute_features</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">feat</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">coefs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span> <span class="o">/</span> <span class="mi">1000</span>


<span class="k">def</span> <span class="nf">predict_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
    <span class="n">feat</span> <span class="o">=</span> <span class="n">compute_features</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">feat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>


<span class="n">coef</span> <span class="o">=</span> <span class="n">get_coef</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="p">(</span><span class="n">predict</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
 <span class="n">predict_model</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">0.005450704959759156</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.0054507</span><span class="p">]))</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="topk_cpp.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Fast TopK elements</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="numpy_api_onnx_ccl.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to a numpy API for ONNX: CustomClassifier</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>