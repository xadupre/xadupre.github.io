
.. _f-onnxinference:

module ``onnxrt.onnx_inference``
================================





.. inheritance-diagram:: mlprodict.onnxrt.onnx_inference


Short summary
+++++++++++++

module ``mlprodict.onnxrt.onnx_inference``

Implements a class able to compute the predictions
from on an :epkg:`ONNX` model.


:githublink:`%|py|7`




Classes
+++++++

+------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------+
| class                                                                  | truncated documentation                                                                                             |
+========================================================================+=====================================================================================================================+
| :class:`OnnxInference <mlprodict.onnxrt.onnx_inference.OnnxInference>` | Loads an :epkg:`ONNX` file or object or stream. Computes the output of the :epkg:`ONNX` graph. Several runtimes ... |
+------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------+






Properties
++++++++++

+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
| property                                                                                                    | truncated documentation                                                                                         |
+=============================================================================================================+=================================================================================================================+
| :meth:`input_names <mlprodict.onnxrt.onnx_inference.OnnxInference.input_names>`                             | Returns the names of all inputs. It does not include the optional inputs.                                       |
+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
| :meth:`input_names_shapes <mlprodict.onnxrt.onnx_inference.OnnxInference.input_names_shapes>`               | Returns the names and shapes of all inputs. This method assumes all inputs are tensors. It does not include ... |
+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
| :meth:`input_names_shapes_types <mlprodict.onnxrt.onnx_inference.OnnxInference.input_names_shapes_types>`   | Returns the names, shapes, types of all inputs. This method assumes all inputs are tensors. It does not ...     |
+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
| :meth:`output_names <mlprodict.onnxrt.onnx_inference.OnnxInference.output_names>`                           | Returns the names of all outputs.                                                                               |
+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
| :meth:`output_names_shapes <mlprodict.onnxrt.onnx_inference.OnnxInference.output_names_shapes>`             | Returns the names and shapes of all outputs. This method assumes all inputs are tensors.                        |
+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+
| :meth:`output_names_shapes_types <mlprodict.onnxrt.onnx_inference.OnnxInference.output_names_shapes_types>` | Returns the names, shapes, types of all outputs. This method assumes all inputs are tensors. It does not ...    |
+-------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------+




Static Methods
++++++++++++++

+--------------------------------------------------------------------------------------------------+-------------------------+
| staticmethod                                                                                     | truncated documentation |
+==================================================================================================+=========================+
| :py:meth:`_get_type_property <mlprodict.onnxrt.onnx_inference.OnnxInference._get_type_property>` |                         |
+--------------------------------------------------------------------------------------------------+-------------------------+




Methods
+++++++

+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| method                                                                                                                   | truncated documentation                                                                                                            |
+==========================================================================================================================+====================================================================================================================================+
| :py:meth:`__getitem__ <mlprodict.onnxrt.onnx_inference.OnnxInference.__getitem__>`                                       | Returns the ONNX verions of a node.                                                                                                |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__getstate__ <mlprodict.onnxrt.onnx_inference.OnnxInference.__getstate__>`                                     | To pickle the object.                                                                                                              |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.onnxrt.onnx_inference.OnnxInference.__init__>`                                             |                                                                                                                                    |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__repr__ <mlprodict.onnxrt.onnx_inference.OnnxInference.__repr__>`                                             | usual                                                                                                                              |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__setstate__ <mlprodict.onnxrt.onnx_inference.OnnxInference.__setstate__>`                                     | To unpickle the object.                                                                                                            |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__str__ <mlprodict.onnxrt.onnx_inference.OnnxInference.__str__>`                                               | usual                                                                                                                              |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_build_compile_run <mlprodict.onnxrt.onnx_inference.OnnxInference._build_compile_run>`                         | Rewrite the run function in python, compiles it, and adds it as a method.                                                          |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_guess_inplace <mlprodict.onnxrt.onnx_inference.OnnxInference._guess_inplace>`                                 | Looks into every node of the graph to see if there is a way to do the computation inplace. By default (*input_inplace=False*), ... |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_guess_input_dtype <mlprodict.onnxrt.onnx_inference.OnnxInference._guess_input_dtype>`                         |                                                                                                                                    |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_init <mlprodict.onnxrt.onnx_inference.OnnxInference._init>`                                                   | Prepares the instance to deliver predictions.                                                                                      |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_run_sequence_runtime <mlprodict.onnxrt.onnx_inference.OnnxInference._run_sequence_runtime>`                   |                                                                                                                                    |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_run_sequence_runtime_compiled <mlprodict.onnxrt.onnx_inference.OnnxInference._run_sequence_runtime_compiled>` | Executes a compiled version of :meth:`_run_sequence_runtime`, compiled with method :meth:`_build_compile_run`. ...                 |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_run_whole_runtime <mlprodict.onnxrt.onnx_inference.OnnxInference._run_whole_runtime>`                         |                                                                                                                                    |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_set_shape_inference_runtime <mlprodict.onnxrt.onnx_inference.OnnxInference._set_shape_inference_runtime>`     | Set shapes based on shape inference relying on the runtime. The values are stored in every node.                                   |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_set_size_inference_runtime <mlprodict.onnxrt.onnx_inference.OnnxInference._set_size_inference_runtime>`       | Set sizes allocated during inference relying on the runtime. The values are stored in every node.                                  |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_set_type_inference_runtime <mlprodict.onnxrt.onnx_inference.OnnxInference._set_type_inference_runtime>`       | Set types based on type inference relying on the runtime. The values are stored in every node.                                     |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`build_intermediate <mlprodict.onnxrt.onnx_inference.OnnxInference.build_intermediate>`                            | Builds every possible :epkg:`ONNX` file which computes one specific intermediate output from the inputs. ...                       |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`check_model <mlprodict.onnxrt.onnx_inference.OnnxInference.check_model>`                                          | Checks the model follow :epkg:`ONNX` conventions.                                                                                  |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`display_sequence <mlprodict.onnxrt.onnx_inference.OnnxInference.display_sequence>`                                | Shows the sequence of nodes to run if ``runtime=='python'``.                                                                       |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_execution_order <mlprodict.onnxrt.onnx_inference.OnnxInference.get_execution_order>`                          | This function returns a dictionary `{(kind, name): (order, op)}`, *name* can be a node name or a result name. In ...               |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_profiling <mlprodict.onnxrt.onnx_inference.OnnxInference.get_profiling>`                                      | Returns the profiling after a couple of execution.                                                                                 |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`global_index <mlprodict.onnxrt.onnx_inference.OnnxInference.global_index>`                                        | Maps every name to one integer to avoid using dictionaries when running the predictions.                                           |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`infer_shapes <mlprodict.onnxrt.onnx_inference.OnnxInference.infer_shapes>`                                        | Computes expected shapes.                                                                                                          |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`infer_sizes <mlprodict.onnxrt.onnx_inference.OnnxInference.infer_sizes>`                                          | Computes expected sizes.                                                                                                           |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`infer_types <mlprodict.onnxrt.onnx_inference.OnnxInference.infer_types>`                                          | Computes expected shapes.                                                                                                          |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`reduce_size <mlprodict.onnxrt.onnx_inference.OnnxInference.reduce_size>`                                          | Reduces the memory footprint as much as possible.                                                                                  |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`run <mlprodict.onnxrt.onnx_inference.OnnxInference.run>`                                                          | Computes the predictions for this :epkg:`onnx` graph.                                                                              |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`run2onnx <mlprodict.onnxrt.onnx_inference.OnnxInference.run2onnx>`                                                | Executes the graphs with the given inputs, then adds the intermediate results into ONNX nodes in the original graph. ...           |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`shape_inference <mlprodict.onnxrt.onnx_inference.OnnxInference.shape_inference>`                                  | Infers the shape of the outputs with :epkg:`onnx` package.                                                                         |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`switch_initializers_dtype <mlprodict.onnxrt.onnx_inference.OnnxInference.switch_initializers_dtype>`              | Switches all initializers to ``numpy.float64``. If *model* is None, a simple cast is done. Otherwise, the function ...             |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`to_sequence <mlprodict.onnxrt.onnx_inference.OnnxInference.to_sequence>`                                          | Produces a graph to facilitate the execution. One example:                                                                         |
+--------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------+


Documentation
+++++++++++++

.. automodule:: mlprodict.onnxrt.onnx_inference
    :members:
    :special-members: __init__
    :show-inheritance:



