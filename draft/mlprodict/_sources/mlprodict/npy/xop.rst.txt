
.. _f-xop:

module ``npy.xop``
==================





.. inheritance-diagram:: mlprodict.npy.xop


Short summary
+++++++++++++

module ``mlprodict.npy.xop``

Xop API to build onnx graphs. Inspired from :epkg:`sklearn-onnx`.





Classes
+++++++

+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| class                                                            | truncated documentation                                                                                                       |
+==================================================================+===============================================================================================================================+
| :class:`_GraphBuilder <mlprodict.npy.xop._GraphBuilder>`         | Graph builder. It takes a graph structure made with instances of :class:`OnnxOperatorBase`. The main method is `to_onnx`. ... |
+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| :class:`OnnxLoadFactory <mlprodict.npy.xop.OnnxLoadFactory>`     | Automatically creating all operators from onnx packages takes time. That's why function :class:`loadop` only creates ...      |
+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| :class:`OnnxOperator <mlprodict.npy.xop.OnnxOperator>`           | Ancestor to every *ONNX* operator exposed in :mod:`mlprodict.npy.xops` and :mod:`mlprodict.npy.xops_ml`.                      |
+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| :class:`OnnxOperatorBase <mlprodict.npy.xop.OnnxOperatorBase>`   | Base class for :class:`OnnxOperator`, :class:`OnnxOperator`Item, :class:`OnnxOperatorTuple`.                                  |
+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| :class:`OnnxOperatorItem <mlprodict.npy.xop.OnnxOperatorItem>`   | Accessor to one of the output returned by a :class:`OnnxOperator`.                                                            |
+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+
| :class:`OnnxOperatorTuple <mlprodict.npy.xop.OnnxOperatorTuple>` | Class used to return multiple :class:`OnnxVar` at the same time.                                                              |
+------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+




Functions
+++++++++

+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| function                                                                              | truncated documentation                                                                                                                                                        |
+=======================================================================================+================================================================================================================================================================================+
| :func:`_default_OPSET_TO_IR_VERSION <mlprodict.npy.xop._default_OPSET_TO_IR_VERSION>` | Returns the default mapping between opset and ir_version.                                                                                                                      |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :func:`_domain_to_class_name <mlprodict.npy.xop._domain_to_class_name>`               | Converts domain into a name.                                                                                                                                                   |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :func:`_dynamic_class_creation <mlprodict.npy.xop._dynamic_class_creation>`           | Automatically generates classes for each of the operators module *onnx* defines and described at `Operators <https://github.com/onnx/onnx/blob/master/docs/Operators.md>`_ ... |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :func:`_find_operator_domain <mlprodict.npy.xop._find_operator_domain>`               | Determines the domain of an operator. Raises an exception if not found or if there is an ambiguity.                                                                            |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :func:`_populate_schemas <mlprodict.npy.xop._populate_schemas>`                       | Populates all schemas.                                                                                                                                                         |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :func:`ClassFactory <mlprodict.npy.xop.ClassFactory>`                                 | Dynamically creates a class for a specific operator.                                                                                                                           |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| :func:`loadop <mlprodict.npy.xop.loadop>`                                             | Dynamically creates a class for a every operator type in the given list.                                                                                                       |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+




Properties
++++++++++

+-------------------------------------------------------------------------+-----------------------------------------------+
| property                                                                | truncated documentation                       |
+=========================================================================+===============================================+
| :meth:`inputs <mlprodict.npy.xop.OnnxOperatorItem.inputs>`              | Returns the only inputs in a list.            |
+-------------------------------------------------------------------------+-----------------------------------------------+
| :meth:`inputs <mlprodict.npy.xop.OnnxOperatorTuple.inputs>`             | Returns the only inputs in a list.            |
+-------------------------------------------------------------------------+-----------------------------------------------+
| :meth:`output_names <mlprodict.npy.xop.OnnxOperator.output_names>`      | Returns `self.output_names_`.                 |
+-------------------------------------------------------------------------+-----------------------------------------------+
| :meth:`output_names <mlprodict.npy.xop.OnnxOperatorBase.output_names>`  | This method should be overwritten.            |
+-------------------------------------------------------------------------+-----------------------------------------------+
| :meth:`output_names <mlprodict.npy.xop.OnnxOperatorItem.output_names>`  | Returns None.                                 |
+-------------------------------------------------------------------------+-----------------------------------------------+
| :meth:`output_names <mlprodict.npy.xop.OnnxOperatorTuple.output_names>` | Returns 'output_names' of attribute 'unique'. |
+-------------------------------------------------------------------------+-----------------------------------------------+
| :meth:`outputs <mlprodict.npy.xop.OnnxOperatorTuple.outputs>`           | Returns 'output_names' of attribute 'unique'. |
+-------------------------------------------------------------------------+-----------------------------------------------+




Static Methods
++++++++++++++

+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+
| staticmethod                                                                                              | truncated documentation                                               |
+===========================================================================================================+=======================================================================+
| :py:meth:`_merge_op_version <mlprodict.npy.xop.OnnxOperator._merge_op_version>`                           |                                                                       |
+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+
| :py:meth:`_node_to_graph_get_type <mlprodict.npy.xop.OnnxOperator._node_to_graph_get_type>`               |                                                                       |
+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+
| :py:meth:`_node_to_graph_preprocess_list <mlprodict.npy.xop.OnnxOperator._node_to_graph_preprocess_list>` |                                                                       |
+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+
| :py:meth:`_node_to_graph_process_input <mlprodict.npy.xop.OnnxOperator._node_to_graph_process_input>`     |                                                                       |
+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+
| :py:meth:`_node_to_graph_reorder_by_name <mlprodict.npy.xop.OnnxOperator._node_to_graph_reorder_by_name>` |                                                                       |
+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+
| :meth:`number2alpha <mlprodict.npy.xop._GraphBuilder.number2alpha>`                                       | Converts a numbers into a string keeping the same alphabetical order. |
+-----------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------+




Methods
+++++++

+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| method                                                                                        | truncated documentation                                                                                                                               |
+===============================================================================================+=======================================================================================================================================================+
| :py:meth:`__abs__ <mlprodict.npy.xop.OnnxOperator.__abs__>`                                   | Automatically adds operator `OnnxAbs` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__add__ <mlprodict.npy.xop.OnnxOperator.__add__>`                                   | Automatically adds operator `OnnxAdd` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__eq__ <mlprodict.npy.xop.OnnxOperator.__eq__>`                                     | Automatically adds operator `OnnxEqual` to the graph.                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__getattr__ <mlprodict.npy.xop.OnnxLoadFactory.__getattr__>`                        |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__getitem__ <mlprodict.npy.xop.OnnxOperator.__getitem__>`                           | Returns an accessor to one of the output of this node.                                                                                                |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__getitem__ <mlprodict.npy.xop.OnnxOperatorTuple.__getitem__>`                      | usual                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__gt__ <mlprodict.npy.xop.OnnxOperator.__gt__>`                                     | Automatically adds operator `OnnxGreater` to the graph.                                                                                               |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.npy.xop.OnnxLoadFactory.__init__>`                              |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.npy.xop.OnnxOperator.__init__>`                                 |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.npy.xop.OnnxOperatorBase.__init__>`                             |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.npy.xop.OnnxOperatorItem.__init__>`                             |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.npy.xop.OnnxOperatorTuple.__init__>`                            |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__init__ <mlprodict.npy.xop._GraphBuilder.__init__>`                                |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__iter__ <mlprodict.npy.xop.OnnxOperator.__iter__>`                                 | Allows expressions such as ``a, b = OnnxTopK(...)``.                                                                                                  |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__iter__ <mlprodict.npy.xop.OnnxOperatorTuple.__iter__>`                            | Iterates on the outputs.                                                                                                                              |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__len__ <mlprodict.npy.xop.OnnxOperatorTuple.__len__>`                              | usual                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__lt__ <mlprodict.npy.xop.OnnxOperator.__lt__>`                                     | Automatically adds operator `OnnxLess` to the graph.                                                                                                  |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__matmul__ <mlprodict.npy.xop.OnnxOperator.__matmul__>`                             | Automatically adds operator `OnnxMatMul` to the graph.                                                                                                |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__mod__ <mlprodict.npy.xop.OnnxOperator.__mod__>`                                   | Automatically adds operator `OnnxMod` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__mul__ <mlprodict.npy.xop.OnnxOperator.__mul__>`                                   | Automatically adds operator `OnnxMul` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__ne__ <mlprodict.npy.xop.OnnxOperator.__ne__>`                                     | Automatically adds operator `OnnxNot x OnnxEqual` to the graph.                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__pow__ <mlprodict.npy.xop.OnnxOperator.__pow__>`                                   | Automatically adds operator `OnnxPow` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__repr__ <mlprodict.npy.xop.OnnxOperator.__repr__>`                                 | usual                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__repr__ <mlprodict.npy.xop.OnnxOperatorItem.__repr__>`                             | usual                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__repr__ <mlprodict.npy.xop.OnnxOperatorTuple.__repr__>`                            | usual                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__str__ <mlprodict.npy.xop.OnnxOperatorItem.__str__>`                               | usual                                                                                                                                                 |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__sub__ <mlprodict.npy.xop.OnnxOperator.__sub__>`                                   | Automatically adds operator `OnnxSub` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`__truediv__ <mlprodict.npy.xop.OnnxOperator.__truediv__>`                           | Automatically adds operator `OnnxDiv` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_add_name <mlprodict.npy.xop._GraphBuilder._add_name>`                              |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_check <mlprodict.npy.xop.OnnxOperator._check>`                                     |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_node_to_graph <mlprodict.npy.xop.OnnxOperator._node_to_graph>`                     | Builds a graph as a list of nodes to walk through in that order.                                                                                      |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_post_process_attributes <mlprodict.npy.xop.OnnxOperator._post_process_attributes>` | Walks through attributes and replaces them by ONNX values.                                                                                            |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :py:meth:`_process_io <mlprodict.npy.xop._GraphBuilder._process_io>`                          |                                                                                                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`add_initializer <mlprodict.npy.xop._GraphBuilder.add_initializer>`                     | Adds an initializer to the graph.                                                                                                                     |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`add_node <mlprodict.npy.xop._GraphBuilder.add_node>`                                   | Adds a node to the graph.                                                                                                                             |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`add_to <mlprodict.npy.xop.OnnxOperator.add_to>`                                        | Adds to graph builder.                                                                                                                                |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`add_to <mlprodict.npy.xop.OnnxOperatorBase.add_to>`                                    | This method should be overwritten.                                                                                                                    |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`add_to <mlprodict.npy.xop.OnnxOperatorItem.add_to>`                                    | Adds to graph builder. Does nothing because the original node is already added.                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`add_to <mlprodict.npy.xop.OnnxOperatorTuple.add_to>`                                   | Adds to graph builder. Does nothing because the original node is already added.                                                                       |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`and_ <mlprodict.npy.xop.OnnxOperator.and_>`                                            | Automatically adds operator `OnnxAnd` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`astype <mlprodict.npy.xop.OnnxOperator.astype>`                                        | Automatically adds operator `OnnxCast` to the graph.                                                                                                  |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`find_schema <mlprodict.npy.xop.OnnxOperator.find_schema>`                              | Checks if there is an existing schema for a specific version.                                                                                         |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_input_names <mlprodict.npy.xop._GraphBuilder.get_input_names>`                     | Returns input names for node *node* and inputs *inputs*.                                                                                              |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_output <mlprodict.npy.xop.OnnxOperatorItem.get_output>`                            | Returns the output.                                                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_output_result <mlprodict.npy.xop.OnnxOperator.get_output_result>`                  | Returns the output name at position *i*.                                                                                                              |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_output_result <mlprodict.npy.xop.OnnxOperatorItem.get_output_result>`              | Returns the output name at position *i*.                                                                                                              |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_unique_name <mlprodict.npy.xop._GraphBuilder.get_unique_name>`                     | Returns a unique name to name an output.                                                                                                              |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`get_unique_output_name <mlprodict.npy.xop._GraphBuilder.get_unique_output_name>`       | Returns a unique output_name for a NodeResultName.                                                                                                    |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`not_ <mlprodict.npy.xop.OnnxOperator.not_>`                                            | Automatically adds operator `OnnxNot` to the graph.                                                                                                   |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`or_ <mlprodict.npy.xop.OnnxOperator.or_>`                                              | Automatically adds operator `OnnxOr` to the graph.                                                                                                    |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`reserve_name <mlprodict.npy.xop._GraphBuilder.reserve_name>`                           | Reserves a name so that it cannot be changed.                                                                                                         |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`reserve_names <mlprodict.npy.xop._GraphBuilder.reserve_names>`                         | Adds names to the list of reserved names. All must be unique.                                                                                         |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`to_onnx <mlprodict.npy.xop.OnnxOperator.to_onnx>`                                      | Converts this operator into an ONNX graph.                                                                                                            |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`to_onnx <mlprodict.npy.xop.OnnxOperatorTuple.to_onnx>`                                 | Converts this operator into an ONNX graph. It follows the same signature as :meth:`OnnxOperator.to_onnx <mlprodict.npy.xop.OnnxOperator.to_onnx>` ... |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`to_onnx <mlprodict.npy.xop._GraphBuilder.to_onnx>`                                     | Converts this operator into an ONNX graph.                                                                                                            |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| :meth:`update_max_item <mlprodict.npy.xop.OnnxOperator.update_max_item>`                      | Some operators return a undefined number of outputs. The method is called when require one of them (with `__getitem__`) ...                           |
+-----------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+


Documentation
+++++++++++++

.. automodule:: mlprodict.npy.xop
    :members:
    :special-members: __init__
    :show-inheritance:



