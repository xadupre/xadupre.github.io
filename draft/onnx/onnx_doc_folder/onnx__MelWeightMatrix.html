<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MelWeightMatrix &#8212; ONNX 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sample.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Min" href="onnx__Min.html" />
    <link rel="prev" title="MeanVarianceNormalization" href="onnx__MeanVarianceNormalization.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          ONNX Docs</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../onnx-api/index.html">API Overview</a></li>
                <li><a href="../operators/index.html">Op Schemas</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption" role="heading"><span class="caption-text">API Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.checker.html">onnx.checker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.compose.html">onnx.compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.external_data_helper.html">onnx.external_data_helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.helper.html">onnx.helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.hub.html">onnx.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.numpy_helper.html">onnx.numpy_helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.parser.html">onnx.parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.utils.html">onnx.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.version.version.html">onnx.version.version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx-api/modules/onnx.version_converter.html">onnx.version_converter</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Operators + OpSchemas</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ONNX operators</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">MelWeightMatrix</a><ul>
<li><a class="reference internal" href="#melweightmatrix-17">MelWeightMatrix - 17</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="onnx__MeanVarianceNormalization.html" title="Previous Chapter: MeanVarianceNormalization"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MeanVarianceN...</span>
    </a>
  </li>
  <li>
    <a href="onnx__Min.html" title="Next Chapter: Min"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Min &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/onnx_doc_folder/onnx__MelWeightMatrix.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="melweightmatrix">
<span id="l-onnx-doc-melweightmatrix"></span><h1>MelWeightMatrix<a class="headerlink" href="#melweightmatrix" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#melweightmatrix-17" id="id1">MelWeightMatrix - 17</a></p></li>
</ul>
</nav>
<section id="melweightmatrix-17">
<span id="l-onnx-op-melweightmatrix-17"></span><h2><a class="toc-backref" href="#id1" role="doc-backlink">MelWeightMatrix - 17</a><a class="headerlink" href="#melweightmatrix-17" title="Permalink to this heading">¶</a></h2>
<p><strong>Version</strong>
* <strong>name</strong>: <a class="reference external" href="https://github.com/onnx/onnx/blob/main/docs/Operators.md#MelWeightMatrix">MelWeightMatrix (GitHub)</a>
* <strong>domain</strong>: <strong>main</strong>
* <strong>since_version</strong>: <strong>17</strong>
* <strong>function</strong>: False
* <strong>support_level</strong>: SupportType.COMMON
* <strong>shape inference</strong>: True</p>
<p>This version of the operator has been available
<strong>since version 17</strong>.</p>
<p><strong>Summary</strong></p>
<p>Generate a MelWeightMatrix that can be used to re-weight a Tensor containing a linearly sampled frequency spectra (from DFT or STFT) into num_mel_bins frequency information based on the [lower_edge_hertz, upper_edge_hertz] range on the mel scale.
This function defines the mel scale in terms of a frequency in hertz according to the following formula:</p>
<blockquote>
<div><p>mel(f) = 2595 * log10(1 + f/700)</p>
</div></blockquote>
<p>In the returned matrix, all the triangles (filterbanks) have a peak value of 1.0.</p>
<p>The returned MelWeightMatrix can be used to right-multiply a spectrogram S of shape [frames, num_spectrogram_bins] of linear scale spectrum values (e.g. STFT magnitudes) to generate a “mel spectrogram” M of shape [frames, num_mel_bins].</p>
<p><strong>Attributes</strong>
* <strong>output_datatype</strong>:</p>
<blockquote>
<div><p>The data type of the output tensor. Strictly must be one of the
values from DataType enum in TensorProto whose values correspond to
T3. The default value is 1 = FLOAT.</p>
</div></blockquote>
<p><strong>Inputs</strong></p>
<ul class="simple">
<li><p><strong>num_mel_bins</strong> (heterogeneous) - <strong>T1</strong>:
The number of bands in the mel spectrum.</p></li>
<li><p><strong>dft_length</strong> (heterogeneous) - <strong>T1</strong>:
The size of the original DFT. The size of the original DFT is used
to infer the size of the onesided DFT, which is understood to be
floor(dft_length/2) + 1, i.e. the spectrogram only contains the
nonredundant DFT bins.</p></li>
<li><p><strong>sample_rate</strong> (heterogeneous) - <strong>T1</strong>:
Samples per second of the input signal used to create the
spectrogram. Used to figure out the frequencies corresponding to
each spectrogram bin, which dictates how they are mapped into the
mel scale.</p></li>
<li><p><strong>lower_edge_hertz</strong> (heterogeneous) - <strong>T2</strong>:
Lower bound on the frequencies to be included in the mel spectrum.
This corresponds to the lower edge of the lowest triangular band.</p></li>
<li><p><strong>upper_edge_hertz</strong> (heterogeneous) - <strong>T2</strong>:
The desired top edge of the highest frequency band.</p></li>
</ul>
<p><strong>Outputs</strong></p>
<ul class="simple">
<li><p><strong>output</strong> (heterogeneous) - <strong>T3</strong>:
The Mel Weight Matrix. The output has the shape:
[floor(dft_length/2) + 1][num_mel_bins].</p></li>
</ul>
<p><strong>Type Constraints</strong>
* <strong>T1</strong> in (</p>
<blockquote>
<div><p>tensor(int32),
tensor(int64)
):
Constrain to integer tensors.</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>T2</strong> in (
tensor(bfloat16),
tensor(double),
tensor(float),
tensor(float16)
):
Constrain to float tensors</p></li>
<li><p><strong>T3</strong> in (
tensor(bfloat16),
tensor(double),
tensor(float),
tensor(float16),
tensor(int16),
tensor(int32),
tensor(int64),
tensor(int8),
tensor(uint16),
tensor(uint32),
tensor(uint64),
tensor(uint8)
):
Constrain to any numerical types.</p></li>
</ul>
<p><strong>Examples</strong></p>
<p><strong>default</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span>
    <span class="s2">&quot;MelWeightMatrix&quot;</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;num_mel_bins&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dft_length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sample_rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lower_edge_hertz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;upper_edge_hertz&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">num_mel_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">dft_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">sample_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
<span class="n">lower_edge_hertz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">upper_edge_hertz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">8192</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">num_spectrogram_bins</span> <span class="o">=</span> <span class="n">dft_length</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">frequency_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_mel_bins</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">low_frequency_mel</span> <span class="o">=</span> <span class="mi">2595</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">lower_edge_hertz</span> <span class="o">/</span> <span class="mi">700</span><span class="p">)</span>
<span class="n">high_frequency_mel</span> <span class="o">=</span> <span class="mi">2595</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">upper_edge_hertz</span> <span class="o">/</span> <span class="mi">700</span><span class="p">)</span>
<span class="n">mel_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">high_frequency_mel</span> <span class="o">-</span> <span class="n">low_frequency_mel</span><span class="p">)</span> <span class="o">/</span> <span class="n">frequency_bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">frequency_bins</span> <span class="o">=</span> <span class="n">frequency_bins</span> <span class="o">*</span> <span class="n">mel_step</span> <span class="o">+</span> <span class="n">low_frequency_mel</span>
<span class="n">frequency_bins</span> <span class="o">=</span> <span class="mi">700</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">frequency_bins</span> <span class="o">/</span> <span class="mi">2595</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">frequency_bins</span> <span class="o">=</span> <span class="p">((</span><span class="n">dft_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">frequency_bins</span><span class="p">)</span> <span class="o">//</span> <span class="n">sample_rate</span>
<span class="n">frequency_bins</span> <span class="o">=</span> <span class="n">frequency_bins</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_spectrogram_bins</span><span class="p">,</span> <span class="n">num_mel_bins</span><span class="p">))</span>
<span class="n">output</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">writeable</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_mel_bins</span><span class="p">):</span>
    <span class="n">lower_frequency_value</span> <span class="o">=</span> <span class="n">frequency_bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># left</span>
    <span class="n">center_frequency_point</span> <span class="o">=</span> <span class="n">frequency_bins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># center</span>
    <span class="n">higher_frequency_point</span> <span class="o">=</span> <span class="n">frequency_bins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># right</span>
    <span class="n">low_to_center</span> <span class="o">=</span> <span class="n">center_frequency_point</span> <span class="o">-</span> <span class="n">lower_frequency_value</span>
    <span class="k">if</span> <span class="n">low_to_center</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="n">center_frequency_point</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_frequency_value</span><span class="p">,</span> <span class="n">center_frequency_point</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">lower_frequency_value</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">low_to_center</span>
            <span class="p">)</span>
    <span class="n">center_to_high</span> <span class="o">=</span> <span class="n">higher_frequency_point</span> <span class="o">-</span> <span class="n">center_frequency_point</span>
    <span class="k">if</span> <span class="n">center_to_high</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">center_frequency_point</span><span class="p">,</span> <span class="n">higher_frequency_point</span><span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">higher_frequency_point</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">center_to_high</span>
            <span class="p">)</span>

<span class="c1"># Expected output</span>
<span class="c1"># 1.000000, 1.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 1.000000, 1.000000, 0.000000, 0.000000, 0.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 1.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,</span>
<span class="c1"># 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000,</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span>
    <span class="n">node</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span>
        <span class="n">num_mel_bins</span><span class="p">,</span>
        <span class="n">dft_length</span><span class="p">,</span>
        <span class="n">sample_rate</span><span class="p">,</span>
        <span class="n">lower_edge_hertz</span><span class="p">,</span>
        <span class="n">upper_edge_hertz</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">output</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_melweightmatrix&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2022.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>