
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>LSTM &#8212; ONNX 1.12.0 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sample.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'onnx_doc_folder/onnx__LSTM';</script>
    <link rel="shortcut icon" href="../_static/onnx-favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LSTM - 7 vs 14" href="text_diff_LSTM_7_14.html" />
    <link rel="prev" title="LRN - 1 vs 13" href="text_diff_LRN_1_13.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="auto">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/ONNX_logo_main.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/ONNX_logo_main.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/onnx/onnx" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/onnx/onnx" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
<nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
    <p class="bd-links__title" role="heading" aria-level="1">
    </p>
    <div class="bd-toc-item navbar-nav">
      <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorial_python/index.html">
   Introduction to ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_python/index.html">
   API Reference
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   ONNX Operators
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label class="toctree-toggle" for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Abs.html">
     Abs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Acos.html">
     Acos
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Acosh.html">
     Acosh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Add.html">
     Add
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__And.html">
     And
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ArgMax.html">
     ArgMax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ArgMin.html">
     ArgMin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Asin.html">
     Asin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Asinh.html">
     Asinh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Atan.html">
     Atan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Atanh.html">
     Atanh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__AttributeHasValue.html">
     AttributeHasValue
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__AveragePool.html">
     AveragePool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__BatchNormalization.html">
     BatchNormalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Bernoulli.html">
     Bernoulli
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__BitShift.html">
     BitShift
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__BlackmanWindow.html">
     BlackmanWindow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Cast.html">
     Cast
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__CastLike.html">
     CastLike
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Ceil.html">
     Ceil
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Celu.html">
     Celu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__CenterCropPad.html">
     CenterCropPad
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Clip.html">
     Clip
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Col2Im.html">
     Col2Im
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Compress.html">
     Compress
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Concat.html">
     Concat
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ConcatFromSequence.html">
     ConcatFromSequence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Constant.html">
     Constant
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ConstantOfShape.html">
     ConstantOfShape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Conv.html">
     Conv
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ConvInteger.html">
     ConvInteger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ConvTranspose.html">
     ConvTranspose
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Cos.html">
     Cos
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Cosh.html">
     Cosh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__CumSum.html">
     CumSum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__DFT.html">
     DFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__DepthToSpace.html">
     DepthToSpace
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__DequantizeLinear.html">
     DequantizeLinear
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Det.html">
     Det
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Div.html">
     Div
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Dropout.html">
     Dropout
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__DynamicQuantizeLinear.html">
     DynamicQuantizeLinear
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Einsum.html">
     Einsum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Elu.html">
     Elu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Equal.html">
     Equal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Erf.html">
     Erf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Exp.html">
     Exp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Expand.html">
     Expand
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__EyeLike.html">
     EyeLike
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Flatten.html">
     Flatten
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Floor.html">
     Floor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GRU.html">
     GRU
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Gather.html">
     Gather
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GatherElements.html">
     GatherElements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GatherND.html">
     GatherND
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Gemm.html">
     Gemm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GlobalAveragePool.html">
     GlobalAveragePool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GlobalLpPool.html">
     GlobalLpPool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GlobalMaxPool.html">
     GlobalMaxPool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Greater.html">
     Greater
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GreaterOrEqual.html">
     GreaterOrEqual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__GridSample.html">
     GridSample
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__HammingWindow.html">
     HammingWindow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__HannWindow.html">
     HannWindow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__HardSigmoid.html">
     HardSigmoid
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__HardSwish.html">
     HardSwish
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Hardmax.html">
     Hardmax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Identity.html">
     Identity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__If.html">
     If
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__InstanceNormalization.html">
     InstanceNormalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__IsInf.html">
     IsInf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__IsNaN.html">
     IsNaN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LRN.html">
     LRN
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="current reference internal" href="#">
     LSTM
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label class="toctree-toggle" for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="text_diff_LSTM_7_14.html">
       LSTM - 7 vs 14
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="text_diff_LSTM_1_7.html">
       LSTM - 1 vs 7
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LayerNormalization.html">
     LayerNormalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LeakyRelu.html">
     LeakyRelu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Less.html">
     Less
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LessOrEqual.html">
     LessOrEqual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Log.html">
     Log
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LogSoftmax.html">
     LogSoftmax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Loop.html">
     Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LpNormalization.html">
     LpNormalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__LpPool.html">
     LpPool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MatMul.html">
     MatMul
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MatMulInteger.html">
     MatMulInteger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Max.html">
     Max
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MaxPool.html">
     MaxPool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MaxRoiPool.html">
     MaxRoiPool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MaxUnpool.html">
     MaxUnpool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Mean.html">
     Mean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MeanVarianceNormalization.html">
     MeanVarianceNormalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__MelWeightMatrix.html">
     MelWeightMatrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Min.html">
     Min
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Mish.html">
     Mish
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Mod.html">
     Mod
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Mul.html">
     Mul
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Multinomial.html">
     Multinomial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Neg.html">
     Neg
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__NegativeLogLikelihoodLoss.html">
     NegativeLogLikelihoodLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__NonMaxSuppression.html">
     NonMaxSuppression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__NonZero.html">
     NonZero
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Not.html">
     Not
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__OneHot.html">
     OneHot
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Optional.html">
     Optional
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__OptionalGetElement.html">
     OptionalGetElement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__OptionalHasElement.html">
     OptionalHasElement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Or.html">
     Or
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__PRelu.html">
     PRelu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Pad.html">
     Pad
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Pow.html">
     Pow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__QLinearConv.html">
     QLinearConv
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__QLinearMatMul.html">
     QLinearMatMul
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__QuantizeLinear.html">
     QuantizeLinear
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__RNN.html">
     RNN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__RandomNormal.html">
     RandomNormal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__RandomNormalLike.html">
     RandomNormalLike
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__RandomUniform.html">
     RandomUniform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__RandomUniformLike.html">
     RandomUniformLike
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Range.html">
     Range
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Reciprocal.html">
     Reciprocal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceL1.html">
     ReduceL1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceL2.html">
     ReduceL2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceLogSum.html">
     ReduceLogSum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceLogSumExp.html">
     ReduceLogSumExp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceMax.html">
     ReduceMax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceMean.html">
     ReduceMean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceMin.html">
     ReduceMin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceProd.html">
     ReduceProd
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceSum.html">
     ReduceSum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReduceSumSquare.html">
     ReduceSumSquare
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Relu.html">
     Relu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Reshape.html">
     Reshape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Resize.html">
     Resize
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ReverseSequence.html">
     ReverseSequence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__RoiAlign.html">
     RoiAlign
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Round.html">
     Round
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__STFT.html">
     STFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Scan.html">
     Scan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Scatter.html">
     Scatter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ScatterElements.html">
     ScatterElements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ScatterND.html">
     ScatterND
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Selu.html">
     Selu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceAt.html">
     SequenceAt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceConstruct.html">
     SequenceConstruct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceEmpty.html">
     SequenceEmpty
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceErase.html">
     SequenceErase
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceInsert.html">
     SequenceInsert
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceLength.html">
     SequenceLength
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SequenceMap.html">
     SequenceMap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Shape.html">
     Shape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Shrink.html">
     Shrink
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sigmoid.html">
     Sigmoid
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sign.html">
     Sign
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sin.html">
     Sin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sinh.html">
     Sinh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Size.html">
     Size
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Slice.html">
     Slice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Softmax.html">
     Softmax
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SoftmaxCrossEntropyLoss.html">
     SoftmaxCrossEntropyLoss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Softplus.html">
     Softplus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Softsign.html">
     Softsign
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SpaceToDepth.html">
     SpaceToDepth
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Split.html">
     Split
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__SplitToSequence.html">
     SplitToSequence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sqrt.html">
     Sqrt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Squeeze.html">
     Squeeze
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__StringNormalizer.html">
     StringNormalizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sub.html">
     Sub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Sum.html">
     Sum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Tan.html">
     Tan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Tanh.html">
     Tanh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__TfIdfVectorizer.html">
     TfIdfVectorizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__ThresholdedRelu.html">
     ThresholdedRelu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Tile.html">
     Tile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__TopK.html">
     TopK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Transpose.html">
     Transpose
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Trilu.html">
     Trilu
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Unique.html">
     Unique
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Unsqueeze.html">
     Unsqueeze
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Upsample.html">
     Upsample
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Where.html">
     Where
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx__Xor.html">
     Xor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_ArrayFeatureExtractor.html">
     ai.onnx.ml - ArrayFeatureExtractor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_Binarizer.html">
     ai.onnx.ml - Binarizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_CastMap.html">
     ai.onnx.ml - CastMap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_CategoryMapper.html">
     ai.onnx.ml - CategoryMapper
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_DictVectorizer.html">
     ai.onnx.ml - DictVectorizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_FeatureVectorizer.html">
     ai.onnx.ml - FeatureVectorizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_Imputer.html">
     ai.onnx.ml - Imputer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_LabelEncoder.html">
     ai.onnx.ml - LabelEncoder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_LinearClassifier.html">
     ai.onnx.ml - LinearClassifier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_LinearRegressor.html">
     ai.onnx.ml - LinearRegressor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_Normalizer.html">
     ai.onnx.ml - Normalizer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_OneHotEncoder.html">
     ai.onnx.ml - OneHotEncoder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_SVMClassifier.html">
     ai.onnx.ml - SVMClassifier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_SVMRegressor.html">
     ai.onnx.ml - SVMRegressor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_Scaler.html">
     ai.onnx.ml - Scaler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_TreeEnsembleClassifier.html">
     ai.onnx.ml - TreeEnsembleClassifier
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_TreeEnsembleRegressor.html">
     ai.onnx.ml - TreeEnsembleRegressor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxml_ZipMap.html">
     ai.onnx.ml - ZipMap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxpreviewtraining_Adagrad.html">
     ai.onnx.preview.training - Adagrad
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxpreviewtraining_Adam.html">
     ai.onnx.preview.training - Adam
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxpreviewtraining_Gradient.html">
     ai.onnx.preview.training - Gradient
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_aionnxpreviewtraining_Momentum.html">
     ai.onnx.preview.training - Momentum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="table_ai_onnx.html">
     operator table for domain ai.onnx
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="table_ai_onnx_ml.html">
     operator table for domain ai.onnx.ml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="table_ai_onnx_preview_training.html">
     operator table for domain ai.onnx.preview.training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../expect.html">
     Sample operator test code
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
  </nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="lstm">
<span id="l-onnx-doc-lstm"></span><h1>LSTM<a class="headerlink" href="#lstm" title="Permalink to this heading">#</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#lstm-14" id="id9">LSTM - 14</a></p></li>
<li><p><a class="reference internal" href="#lstm-7" id="id10">LSTM - 7</a></p></li>
<li><p><a class="reference internal" href="#lstm-1" id="id11">LSTM - 1</a></p></li>
</ul>
</nav>
<section id="lstm-14">
<span id="l-onnx-op-lstm-14"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink">LSTM - 14</a><a class="headerlink" href="#lstm-14" title="Permalink to this heading">#</a></h2>
<p><strong>Version</strong></p>
<ul class="simple">
<li><p><strong>name</strong>: <a class="reference external" href="https://github.com/onnx/onnx/blob/main/docs/Operators.md#LSTM">LSTM (GitHub)</a></p></li>
<li><p><strong>domain</strong>: <strong>main</strong></p></li>
<li><p><strong>since_version</strong>: <strong>14</strong></p></li>
<li><p><strong>function</strong>: False</p></li>
<li><p><strong>support_level</strong>: SupportType.COMMON</p></li>
<li><p><strong>shape inference</strong>: True</p></li>
</ul>
<p>This version of the operator has been available
<strong>since version 14</strong>.</p>
<p><strong>Summary</strong></p>
<p>Computes an one-layer LSTM. This operator is usually supported via some
custom implementation such as CuDNN.</p>
<p>Notations:</p>
<p><cite>X</cite> - input tensor</p>
<p><cite>i</cite> - input gate</p>
<p><cite>o</cite> - output gate</p>
<p><cite>f</cite> - forget gate</p>
<p><cite>c</cite> - cell gate</p>
<p><cite>t</cite> - time step (t-1 means previous time step)</p>
<p><cite>W[iofc]</cite> - W parameter weight matrix for input, output, forget, and cell gates</p>
<p><cite>R[iofc]</cite> - R recurrence weight matrix for input, output, forget, and cell gates</p>
<p><cite>Wb[iofc]</cite> - W bias vectors for input, output, forget, and cell gates</p>
<p><cite>Rb[iofc]</cite> - R bias vectors for input, output, forget, and cell gates</p>
<p><cite>P[iof]</cite>  - P peephole weight vector for input, output, and forget gates</p>
<p><cite>WB[iofc]</cite> - W parameter weight matrix for backward input, output, forget, and cell gates</p>
<p><cite>RB[iofc]</cite> - R recurrence weight matrix for backward input, output, forget, and cell gates</p>
<p><cite>WBb[iofc]</cite> - W bias vectors for backward input, output, forget, and cell gates</p>
<p><cite>RBb[iofc]</cite> - R bias vectors for backward input, output, forget, and cell gates</p>
<p><cite>PB[iof]</cite>  - P peephole weight vector for backward input, output, and forget gates</p>
<p><cite>H</cite> - Hidden state</p>
<p><cite>num_directions</cite> - 2 if direction == bidirectional else 1</p>
<p>Activation functions:</p>
<blockquote>
<div><p>Relu(x)                - max(0, x)</p>
<p>Tanh(x)                - (1 - e^{-2x})/(1 + e^{-2x})</p>
<p>Sigmoid(x)             - 1/(1 + e^{-x})</p>
<p>(NOTE: Below are optional)</p>
<p>Affine(x)              - alpha*x + beta</p>
<p>LeakyRelu(x)           - x if x &amp;gt;= 0 else alpha * x</p>
<p>ThresholdedRelu(x)     - x if x &amp;gt;= alpha else 0</p>
<p>ScaledTanh(x)          - alpha*Tanh(beta*x)</p>
<p>HardSigmoid(x)         - min(max(alpha*x + beta, 0), 1)</p>
<p>Elu(x)                 - x if x &amp;gt;= 0 else alpha*(e^x - 1)</p>
<p>Softsign(x)            - x/(1 + <a href="#id3"><span class="problematic" id="id4">|x|</span></a>)</p>
<p>Softplus(x)            - log(1 + e^x)</p>
</div></blockquote>
<p>Equations (Default: f=Sigmoid, g=Tanh, h=Tanh):</p>
<blockquote>
<div><ul class="simple">
<li><p>it = f(Xt*(Wi^T) + Ht-1*(Ri^T) + Pi (.) Ct-1 + Wbi + Rbi)</p></li>
<li><p>ft = f(Xt*(Wf^T) + Ht-1*(Rf^T) + Pf (.) Ct-1 + Wbf + Rbf)</p></li>
<li><p>ct = g(Xt*(Wc^T) + Ht-1*(Rc^T) + Wbc + Rbc)</p></li>
<li><p>Ct = ft (.) Ct-1 + it (.) ct</p></li>
<li><p>ot = f(Xt*(Wo^T) + Ht-1*(Ro^T) + Po (.) Ct + Wbo + Rbo)</p></li>
<li><p>Ht = ot (.) h(Ct)</p></li>
</ul>
</div></blockquote>
<p>This operator has <strong>optional</strong> inputs/outputs. See <a href="#id12"><span class="problematic" id="id13">`ONNX &amp;lt;https://github.com/onnx/onnx/blob/master/docs/IR.md&amp;gt;`_</span></a> for more details about the representation of optional arguments. An empty string may be used in the place of an actual argument's name to indicate a missing argument. Trailing optional arguments (those not followed by an argument that is present) may also be simply omitted.</p>
<p><strong>Attributes</strong></p>
<ul class="simple">
<li><p><strong>activation_alpha</strong>:
Optional scaling values used by some activation functions. The
values are consumed in the order of activation functions, for
example (f, g, h) in LSTM. Default values are the same as of
corresponding ONNX operators.For example with LeakyRelu, the default
alpha is 0.01.</p></li>
<li><p><strong>activation_beta</strong>:
Optional scaling values used by some activation functions. The
values are consumed in the order of activation functions, for
example (f, g, h) in LSTM. Default values are the same as of
corresponding ONNX operators.</p></li>
<li><p><strong>activations</strong>:
A list of 3 (or 6 if bidirectional) activation functions for input,
output, forget, cell, and hidden. The activation functions must be
one of the activation functions specified above. Optional: See the
equations for default if not specified.</p></li>
<li><p><strong>clip</strong>:
Cell clip threshold. Clipping bounds the elements of a tensor in the
range of [-threshold, +threshold] and is applied to the input of
activations. No clip if not specified.</p></li>
<li><p><strong>direction</strong>:
Specify if the RNN is forward, reverse, or bidirectional. Must be
one of forward (default), reverse, or bidirectional.</p></li>
<li><p><strong>hidden_size</strong>:
Number of neurons in the hidden layer</p></li>
<li><p><strong>input_forget</strong>:
Couple the input and forget gates if 1.</p></li>
<li><p><strong>layout</strong>:
The shape format of inputs X, initial_h, initial_c and outputs Y,
Y_h, Y_c. If 0, the following shapes are expected: X.shape =
[seq_length, batch_size, input_size], Y.shape = [seq_length,
num_directions, batch_size, hidden_size], initial_h.shape =
Y_h.shape = initial_c.shape = Y_c.shape = [num_directions,
batch_size, hidden_size]. If 1, the following shapes are expected:
X.shape = [batch_size, seq_length, input_size], Y.shape =
[batch_size, seq_length, num_directions, hidden_size],
initial_h.shape = Y_h.shape = initial_c.shape = Y_c.shape =
[batch_size, num_directions, hidden_size].</p></li>
</ul>
<p><strong>Inputs</strong></p>
<p>Between 3 and 8 inputs.</p>
<ul class="simple">
<li><p><strong>X</strong> (heterogeneous) - <strong>T</strong>:
The input sequences packed (and potentially padded) into one 3-D
tensor with the shape of <cite>[seq_length, batch_size, input_size]</cite>.</p></li>
<li><p><strong>W</strong> (heterogeneous) - <strong>T</strong>:
The weight tensor for the gates. Concatenation of <cite>W[iofc]</cite> and
<cite>WB[iofc]</cite> (if bidirectional) along dimension 0. The tensor has
shape <cite>[num_directions, 4*hidden_size, input_size]</cite>.</p></li>
<li><p><strong>R</strong> (heterogeneous) - <strong>T</strong>:
The recurrence weight tensor. Concatenation of <cite>R[iofc]</cite> and
<cite>RB[iofc]</cite> (if bidirectional) along dimension 0. This tensor has
shape <cite>[num_directions, 4*hidden_size, hidden_size]</cite>.</p></li>
<li><p><strong>B</strong> (optional, heterogeneous) - <strong>T</strong>:
The bias tensor for input gate. Concatenation of <cite>[Wb[iofc],
Rb[iofc]]</cite>, and <cite>[WBb[iofc], RBb[iofc]]</cite> (if bidirectional) along
dimension 0. This tensor has shape <cite>[num_directions,
8*hidden_size]</cite>. Optional: If not specified - assumed to be 0.</p></li>
<li><p><strong>sequence_lens</strong> (optional, heterogeneous) - <strong>T1</strong>:
Optional tensor specifying lengths of the sequences in a batch. If
not specified - assumed all sequences in the batch to have length
<cite>seq_length</cite>. It has shape <cite>[batch_size]</cite>.</p></li>
<li><p><strong>initial_h</strong> (optional, heterogeneous) - <strong>T</strong>:
Optional initial value of the hidden. If not specified - assumed to
be 0. It has shape <cite>[num_directions, batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>initial_c</strong> (optional, heterogeneous) - <strong>T</strong>:
Optional initial value of the cell. If not specified - assumed to be
0. It has shape <cite>[num_directions, batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>P</strong> (optional, heterogeneous) - <strong>T</strong>:
The weight tensor for peepholes. Concatenation of <cite>P[iof]</cite> and
<cite>PB[iof]</cite> (if bidirectional) along dimension 0. It has shape
<cite>[num_directions, 3*hidde_size]</cite>. Optional: If not specified -
assumed to be 0.</p></li>
</ul>
<p><strong>Outputs</strong></p>
<p>Between 0 and 3 outputs.</p>
<ul class="simple">
<li><p><strong>Y</strong> (optional, heterogeneous) - <strong>T</strong>:
A tensor that concats all the intermediate output values of the
hidden. It has shape <cite>[seq_length, num_directions, batch_size,
hidden_size]</cite>.</p></li>
<li><p><strong>Y_h</strong> (optional, heterogeneous) - <strong>T</strong>:
The last output value of the hidden. It has shape <cite>[num_directions,
batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>Y_c</strong> (optional, heterogeneous) - <strong>T</strong>:
The last output value of the cell. It has shape <cite>[num_directions,
batch_size, hidden_size]</cite>.</p></li>
</ul>
<p><strong>Type Constraints</strong></p>
<ul class="simple">
<li><p><strong>T</strong> in (
tensor(double),
tensor(float),
tensor(float16)
):
Constrain input and output types to float tensors.</p></li>
<li><p><strong>T1</strong> in (
tensor(int32)
):
Constrain seq_lens to integer tensor.</p></li>
</ul>
<p><strong>Examples</strong></p>
<p><strong>_defaults</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">onnx</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">weight_scale</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">number_of_gates</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span>
    <span class="o">&amp;</span><span class="c1">#34;LSTM&amp;#34;, inputs=[&amp;#34;X&amp;#34;, &amp;#34;W&amp;#34;, &amp;#34;R&amp;#34;], outputs=[&amp;#34;&amp;#34;, &amp;#34;Y_h&amp;#34;], hidden_size=hidden_size</span>
<span class="p">)</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">lstm</span> <span class="o">=</span> <span class="n">LSTM_Helper</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">Y_h</span> <span class="o">=</span> <span class="n">lstm</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span>
    <span class="n">node</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">Y_h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)],</span>
    <span class="n">name</span><span class="o">=&amp;</span><span class="c1">#34;test_lstm_defaults&amp;#34;,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>_initial_bias</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">onnx</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
<span class="p">)</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">weight_scale</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">custom_bias</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">number_of_gates</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span>
    <span class="o">&amp;</span><span class="c1">#34;LSTM&amp;#34;,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#34;X&amp;#34;, &amp;#34;W&amp;#34;, &amp;#34;R&amp;#34;, &amp;#34;B&amp;#34;],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#34;&amp;#34;, &amp;#34;Y_h&amp;#34;],</span>
    <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_size</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Adding custom bias</span>
<span class="n">W_B</span> <span class="o">=</span> <span class="n">custom_bias</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
<span class="p">)</span>
<span class="n">R_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">W_B</span><span class="p">,</span> <span class="n">R_B</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">lstm</span> <span class="o">=</span> <span class="n">LSTM_Helper</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">Y_h</span> <span class="o">=</span> <span class="n">lstm</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span>
    <span class="n">node</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">Y_h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)],</span>
    <span class="n">name</span><span class="o">=&amp;</span><span class="c1">#34;test_lstm_with_initial_bias&amp;#34;,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>_peepholes</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">onnx</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
<span class="p">)</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">weight_scale</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">number_of_gates</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">number_of_peepholes</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span>
    <span class="o">&amp;</span><span class="c1">#34;LSTM&amp;#34;,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#34;X&amp;#34;, &amp;#34;W&amp;#34;, &amp;#34;R&amp;#34;, &amp;#34;B&amp;#34;, &amp;#34;sequence_lens&amp;#34;, &amp;#34;initial_h&amp;#34;, &amp;#34;initial_c&amp;#34;, &amp;#34;P&amp;#34;],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#34;&amp;#34;, &amp;#34;Y_h&amp;#34;],</span>
    <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_size</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Initializing Inputs</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">seq_lens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">init_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hidden_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hidden_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_peepholes</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
<span class="p">)</span>

<span class="n">lstm</span> <span class="o">=</span> <span class="n">LSTM_Helper</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span> <span class="n">initial_c</span><span class="o">=</span><span class="n">init_c</span><span class="p">,</span> <span class="n">initial_h</span><span class="o">=</span><span class="n">init_h</span>
<span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">Y_h</span> <span class="o">=</span> <span class="n">lstm</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span>
    <span class="n">node</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">seq_lens</span><span class="p">,</span> <span class="n">init_h</span><span class="p">,</span> <span class="n">init_c</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">Y_h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)],</span>
    <span class="n">name</span><span class="o">=&amp;</span><span class="c1">#34;test_lstm_with_peepholes&amp;#34;,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>_batchwise</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">onnx</span>

<span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">input_size</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">weight_scale</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">number_of_gates</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">layout</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">make_node</span><span class="p">(</span>
    <span class="o">&amp;</span><span class="c1">#34;LSTM&amp;#34;,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#34;X&amp;#34;, &amp;#34;W&amp;#34;, &amp;#34;R&amp;#34;],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="o">&amp;</span><span class="c1">#34;Y&amp;#34;, &amp;#34;Y_h&amp;#34;],</span>
    <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_size</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">weight_scale</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_gates</span> <span class="o">*</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">lstm</span> <span class="o">=</span> <span class="n">LSTM_Helper</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">Y_h</span> <span class="o">=</span> <span class="n">lstm</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span>
    <span class="n">node</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">R</span><span class="p">],</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">Y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">Y_h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)],</span>
    <span class="n">name</span><span class="o">=&amp;</span><span class="c1">#34;test_lstm_batchwise&amp;#34;,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="text_diff_LSTM_7_14.html">LSTM - 7 vs 14</a></li>
</ul>
</div>
</section>
<section id="lstm-7">
<span id="l-onnx-op-lstm-7"></span><h2><a class="toc-backref" href="#id10" role="doc-backlink">LSTM - 7</a><a class="headerlink" href="#lstm-7" title="Permalink to this heading">#</a></h2>
<p><strong>Version</strong></p>
<ul class="simple">
<li><p><strong>name</strong>: <a class="reference external" href="https://github.com/onnx/onnx/blob/main/docs/Operators.md#LSTM">LSTM (GitHub)</a></p></li>
<li><p><strong>domain</strong>: <strong>main</strong></p></li>
<li><p><strong>since_version</strong>: <strong>7</strong></p></li>
<li><p><strong>function</strong>: False</p></li>
<li><p><strong>support_level</strong>: SupportType.COMMON</p></li>
<li><p><strong>shape inference</strong>: True</p></li>
</ul>
<p>This version of the operator has been available
<strong>since version 7</strong>.</p>
<p><strong>Summary</strong></p>
<p>Computes an one-layer LSTM. This operator is usually supported via some
custom implementation such as CuDNN.</p>
<p>Notations:</p>
<p><cite>X</cite> - input tensor</p>
<p><cite>i</cite> - input gate</p>
<p><cite>o</cite> - output gate</p>
<p><cite>f</cite> - forget gate</p>
<p><cite>c</cite> - cell gate</p>
<p><cite>t</cite> - time step (t-1 means previous time step)</p>
<p><cite>W[iofc]</cite> - W parameter weight matrix for input, output, forget, and cell gates</p>
<p><cite>R[iofc]</cite> - R recurrence weight matrix for input, output, forget, and cell gates</p>
<p><cite>Wb[iofc]</cite> - W bias vectors for input, output, forget, and cell gates</p>
<p><cite>Rb[iofc]</cite> - R bias vectors for input, output, forget, and cell gates</p>
<p><cite>P[iof]</cite>  - P peephole weight vector for input, output, and forget gates</p>
<p><cite>WB[iofc]</cite> - W parameter weight matrix for backward input, output, forget, and cell gates</p>
<p><cite>RB[iofc]</cite> - R recurrence weight matrix for backward input, output, forget, and cell gates</p>
<p><cite>WBb[iofc]</cite> - W bias vectors for backward input, output, forget, and cell gates</p>
<p><cite>RBb[iofc]</cite> - R bias vectors for backward input, output, forget, and cell gates</p>
<p><cite>PB[iof]</cite>  - P peephole weight vector for backward input, output, and forget gates</p>
<p><cite>H</cite> - Hidden state</p>
<p><cite>num_directions</cite> - 2 if direction == bidirectional else 1</p>
<p>Activation functions:</p>
<blockquote>
<div><p>Relu(x)                - max(0, x)</p>
<p>Tanh(x)                - (1 - e^{-2x})/(1 + e^{-2x})</p>
<p>Sigmoid(x)             - 1/(1 + e^{-x})</p>
<p>(NOTE: Below are optional)</p>
<p>Affine(x)              - alpha*x + beta</p>
<p>LeakyRelu(x)           - x if x &amp;gt;= 0 else alpha * x</p>
<p>ThresholdedRelu(x)     - x if x &amp;gt;= alpha else 0</p>
<p>ScaledTanh(x)          - alpha*Tanh(beta*x)</p>
<p>HardSigmoid(x)         - min(max(alpha*x + beta, 0), 1)</p>
<p>Elu(x)                 - x if x &amp;gt;= 0 else alpha*(e^x - 1)</p>
<p>Softsign(x)            - x/(1 + <a href="#id5"><span class="problematic" id="id6">|x|</span></a>)</p>
<p>Softplus(x)            - log(1 + e^x)</p>
</div></blockquote>
<p>Equations (Default: f=Sigmoid, g=Tanh, h=Tanh):</p>
<blockquote>
<div><ul class="simple">
<li><p>it = f(Xt*(Wi^T) + Ht-1*(Ri^T) + Pi (.) Ct-1 + Wbi + Rbi)</p></li>
<li><p>ft = f(Xt*(Wf^T) + Ht-1*(Rf^T) + Pf (.) Ct-1 + Wbf + Rbf)</p></li>
<li><p>ct = g(Xt*(Wc^T) + Ht-1*(Rc^T) + Wbc + Rbc)</p></li>
<li><p>Ct = ft (.) Ct-1 + it (.) ct</p></li>
<li><p>ot = f(Xt*(Wo^T) + Ht-1*(Ro^T) + Po (.) Ct + Wbo + Rbo)</p></li>
<li><p>Ht = ot (.) h(Ct)</p></li>
</ul>
</div></blockquote>
<p>This operator has <strong>optional</strong> inputs/outputs. See <a href="#id14"><span class="problematic" id="id15">`ONNX &amp;lt;https://github.com/onnx/onnx/blob/master/docs/IR.md&amp;gt;`_</span></a> for more details about the representation of optional arguments. An empty string may be used in the place of an actual argument's name to indicate a missing argument. Trailing optional arguments (those not followed by an argument that is present) may also be simply omitted.</p>
<p><strong>Attributes</strong></p>
<ul class="simple">
<li><p><strong>activation_alpha</strong>:
Optional scaling values used by some activation functions. The
values are consumed in the order of activation functions, for
example (f, g, h) in LSTM. Default values are the same as of
corresponding ONNX operators.For example with LeakyRelu, the default
alpha is 0.01.</p></li>
<li><p><strong>activation_beta</strong>:
Optional scaling values used by some activation functions. The
values are consumed in the order of activation functions, for
example (f, g, h) in LSTM. Default values are the same as of
corresponding ONNX operators.</p></li>
<li><p><strong>activations</strong>:
A list of 3 (or 6 if bidirectional) activation functions for input,
output, forget, cell, and hidden. The activation functions must be
one of the activation functions specified above. Optional: See the
equations for default if not specified.</p></li>
<li><p><strong>clip</strong>:
Cell clip threshold. Clipping bounds the elements of a tensor in the
range of [-threshold, +threshold] and is applied to the input of
activations. No clip if not specified.</p></li>
<li><p><strong>direction</strong>:
Specify if the RNN is forward, reverse, or bidirectional. Must be
one of forward (default), reverse, or bidirectional.</p></li>
<li><p><strong>hidden_size</strong>:
Number of neurons in the hidden layer</p></li>
<li><p><strong>input_forget</strong>:
Couple the input and forget gates if 1.</p></li>
</ul>
<p><strong>Inputs</strong></p>
<p>Between 3 and 8 inputs.</p>
<ul class="simple">
<li><p><strong>X</strong> (heterogeneous) - <strong>T</strong>:
The input sequences packed (and potentially padded) into one 3-D
tensor with the shape of <cite>[seq_length, batch_size, input_size]</cite>.</p></li>
<li><p><strong>W</strong> (heterogeneous) - <strong>T</strong>:
The weight tensor for the gates. Concatenation of <cite>W[iofc]</cite> and
<cite>WB[iofc]</cite> (if bidirectional) along dimension 0. The tensor has
shape <cite>[num_directions, 4*hidden_size, input_size]</cite>.</p></li>
<li><p><strong>R</strong> (heterogeneous) - <strong>T</strong>:
The recurrence weight tensor. Concatenation of <cite>R[iofc]</cite> and
<cite>RB[iofc]</cite> (if bidirectional) along dimension 0. This tensor has
shape <cite>[num_directions, 4*hidden_size, hidden_size]</cite>.</p></li>
<li><p><strong>B</strong> (optional, heterogeneous) - <strong>T</strong>:
The bias tensor for input gate. Concatenation of <cite>[Wb[iofc],
Rb[iofc]]</cite>, and <cite>[WBb[iofc], RBb[iofc]]</cite> (if bidirectional) along
dimension 0. This tensor has shape <cite>[num_directions,
8*hidden_size]</cite>. Optional: If not specified - assumed to be 0.</p></li>
<li><p><strong>sequence_lens</strong> (optional, heterogeneous) - <strong>T1</strong>:
Optional tensor specifying lengths of the sequences in a batch. If
not specified - assumed all sequences in the batch to have length
<cite>seq_length</cite>. It has shape <cite>[batch_size]</cite>.</p></li>
<li><p><strong>initial_h</strong> (optional, heterogeneous) - <strong>T</strong>:
Optional initial value of the hidden. If not specified - assumed to
be 0. It has shape <cite>[num_directions, batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>initial_c</strong> (optional, heterogeneous) - <strong>T</strong>:
Optional initial value of the cell. If not specified - assumed to be
0. It has shape <cite>[num_directions, batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>P</strong> (optional, heterogeneous) - <strong>T</strong>:
The weight tensor for peepholes. Concatenation of <cite>P[iof]</cite> and
<cite>PB[iof]</cite> (if bidirectional) along dimension 0. It has shape
<cite>[num_directions, 3*hidde_size]</cite>. Optional: If not specified -
assumed to be 0.</p></li>
</ul>
<p><strong>Outputs</strong></p>
<p>Between 0 and 3 outputs.</p>
<ul class="simple">
<li><p><strong>Y</strong> (optional, heterogeneous) - <strong>T</strong>:
A tensor that concats all the intermediate output values of the
hidden. It has shape <cite>[seq_length, num_directions, batch_size,
hidden_size]</cite>.</p></li>
<li><p><strong>Y_h</strong> (optional, heterogeneous) - <strong>T</strong>:
The last output value of the hidden. It has shape <cite>[num_directions,
batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>Y_c</strong> (optional, heterogeneous) - <strong>T</strong>:
The last output value of the cell. It has shape <cite>[num_directions,
batch_size, hidden_size]</cite>.</p></li>
</ul>
<p><strong>Type Constraints</strong></p>
<ul class="simple">
<li><p><strong>T</strong> in (
tensor(double),
tensor(float),
tensor(float16)
):
Constrain input and output types to float tensors.</p></li>
<li><p><strong>T1</strong> in (
tensor(int32)
):
Constrain seq_lens to integer tensor.</p></li>
</ul>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="text_diff_LSTM_1_7.html">LSTM - 1 vs 7</a></li>
</ul>
</div>
</section>
<section id="lstm-1">
<span id="l-onnx-op-lstm-1"></span><h2><a class="toc-backref" href="#id11" role="doc-backlink">LSTM - 1</a><a class="headerlink" href="#lstm-1" title="Permalink to this heading">#</a></h2>
<p><strong>Version</strong></p>
<ul class="simple">
<li><p><strong>name</strong>: <a class="reference external" href="https://github.com/onnx/onnx/blob/main/docs/Operators.md#LSTM">LSTM (GitHub)</a></p></li>
<li><p><strong>domain</strong>: <strong>main</strong></p></li>
<li><p><strong>since_version</strong>: <strong>1</strong></p></li>
<li><p><strong>function</strong>: False</p></li>
<li><p><strong>support_level</strong>: SupportType.COMMON</p></li>
<li><p><strong>shape inference</strong>: True</p></li>
</ul>
<p>This version of the operator has been available
<strong>since version 1</strong>.</p>
<p><strong>Summary</strong></p>
<p>Computes an one-layer LSTM. This operator is usually supported via some
custom implementation such as CuDNN.</p>
<p>Notations:</p>
<p><cite>X</cite> - input tensor</p>
<p><cite>i</cite> - input gate</p>
<p><cite>o</cite> - output gate</p>
<p><cite>f</cite> - forget gate</p>
<p><cite>c</cite> - cell gate</p>
<p><cite>t</cite> - time step (t-1 means previous time step)</p>
<p><cite>W[iofc]</cite> - W parameter weight matrix for input, output, forget, and cell gates</p>
<p><cite>R[iofc]</cite> - R recurrence weight matrix for input, output, forget, and cell gates</p>
<p><cite>Wb[iofc]</cite> - W bias vectors for input, output, forget, and cell gates</p>
<p><cite>Rb[iofc]</cite> - R bias vectors for input, output, forget, and cell gates</p>
<p><cite>P[iof]</cite>  - P peephole weight vector for input, output, and forget gates</p>
<p><cite>WB[iofc]</cite> - W parameter weight matrix for backward input, output, forget, and cell gates</p>
<p><cite>RB[iofc]</cite> - R recurrence weight matrix for backward input, output, forget, and cell gates</p>
<p><cite>WBb[iofc]</cite> - W bias vectors for backward input, output, forget, and cell gates</p>
<p><cite>RBb[iofc]</cite> - R bias vectors for backward input, output, forget, and cell gates</p>
<p><cite>PB[iof]</cite>  - P peephole weight vector for backward input, output, and forget gates</p>
<p><cite>H</cite> - Hidden state</p>
<p><cite>num_directions</cite> - 2 if direction == bidirectional else 1</p>
<p>Activation functions:</p>
<blockquote>
<div><p>Relu(x)                - max(0, x)</p>
<p>Tanh(x)                - (1 - e^{-2x})/(1 + e^{-2x})</p>
<p>Sigmoid(x)             - 1/(1 + e^{-x})</p>
<p>(NOTE: Below are optional)</p>
<p>Affine(x)              - alpha*x + beta</p>
<p>LeakyRelu(x)           - x if x &amp;gt;= 0 else alpha * x</p>
<p>ThresholdedRelu(x)     - x if x &amp;gt;= alpha else 0</p>
<p>ScaledTanh(x)          - alpha*Tanh(beta*x)</p>
<p>HardSigmoid(x)         - min(max(alpha*x + beta, 0), 1)</p>
<p>Elu(x)                 - x if x &amp;gt;= 0 else alpha*(e^x - 1)</p>
<p>Softsign(x)            - x/(1 + <a href="#id7"><span class="problematic" id="id8">|x|</span></a>)</p>
<p>Softplus(x)            - log(1 + e^x)</p>
</div></blockquote>
<p>Equations (Default: f=Sigmoid, g=Tanh, h=Tanh):</p>
<blockquote>
<div><ul class="simple">
<li><p>it = f(Xt*(Wi^T) + Ht-1*Ri + Pi (.) Ct-1 + Wbi + Rbi)</p></li>
<li><p>ft = f(Xt*(Wf^T) + Ht-1*Rf + Pf (.) Ct-1 + Wbf + Rbf)</p></li>
<li><p>ct = g(Xt*(Wc^T) + Ht-1*Rc + Wbc + Rbc)</p></li>
<li><p>Ct = ft (.) Ct-1 + it (.) ct</p></li>
<li><p>ot = f(Xt*(Wo^T) + Ht-1*Ro + Po (.) Ct + Wbo + Rbo)</p></li>
<li><p>Ht = ot (.) h(Ct)</p></li>
</ul>
</div></blockquote>
<p><strong>Attributes</strong></p>
<ul class="simple">
<li><p><strong>activation_alpha</strong>:
Optional scaling values used by some activation functions. The
values are consumed in the order of activation functions, for
example (f, g, h) in LSTM. Default values are the same as of
corresponding ONNX operators.For example with LeakyRelu, the default
alpha is 0.01.</p></li>
<li><p><strong>activation_beta</strong>:
Optional scaling values used by some activation functions. The
values are consumed in the order of activation functions, for
example (f, g, h) in LSTM. Default values are the same as of
corresponding ONNX operators.</p></li>
<li><p><strong>activations</strong>:
A list of 3 (or 6 if bidirectional) activation functions for input,
output, forget, cell, and hidden. The activation functions must be
one of the activation functions specified above. Optional: See the
equations for default if not specified.</p></li>
<li><p><strong>clip</strong>:
Cell clip threshold. Clipping bounds the elements of a tensor in the
range of [-threshold, +threshold] and is applied to the input of
activations. No clip if not specified.</p></li>
<li><p><strong>direction</strong>:
Specify if the RNN is forward, reverse, or bidirectional. Must be
one of forward (default), reverse, or bidirectional.</p></li>
<li><p><strong>hidden_size</strong>:
Number of neurons in the hidden layer</p></li>
<li><p><strong>input_forget</strong>:
Couple the input and forget gates if 1, default 0.</p></li>
<li><p><strong>output_sequence</strong>:
The sequence output for the hidden is optional if 0. Default 0.</p></li>
</ul>
<p><strong>Inputs</strong></p>
<p>Between 3 and 8 inputs.</p>
<ul class="simple">
<li><p><strong>X</strong> (heterogeneous) - <strong>T</strong>:
The input sequences packed (and potentially padded) into one 3-D
tensor with the shape of <cite>[seq_length, batch_size, input_size]</cite>.</p></li>
<li><p><strong>W</strong> (heterogeneous) - <strong>T</strong>:
The weight tensor for the gates. Concatenation of <cite>W[iofc]</cite> and
<cite>WB[iofc]</cite> (if bidirectional) along dimension 0. The tensor has
shape <cite>[num_directions, 4*hidden_size, input_size]</cite>.</p></li>
<li><p><strong>R</strong> (heterogeneous) - <strong>T</strong>:
The recurrence weight tensor. Concatenation of <cite>R[iofc]</cite> and
<cite>RB[iofc]</cite> (if bidirectional) along dimension 0. This tensor has
shape <cite>[num_directions, 4*hidden_size, hidden_size]</cite>.</p></li>
<li><p><strong>B</strong> (optional, heterogeneous) - <strong>T</strong>:
The bias tensor for input gate. Concatenation of <cite>[Wb[iofc],
Rb[iofc]]</cite>, and <cite>[WBb[iofc], RBb[iofc]]</cite> (if bidirectional) along
dimension 0. This tensor has shape <cite>[num_directions,
8*hidden_size]</cite>. Optional: If not specified - assumed to be 0.</p></li>
<li><p><strong>sequence_lens</strong> (optional, heterogeneous) - <strong>T1</strong>:
Optional tensor specifying lengths of the sequences in a batch. If
not specified - assumed all sequences in the batch to have length
<cite>seq_length</cite>. It has shape <cite>[batch_size]</cite>.</p></li>
<li><p><strong>initial_h</strong> (optional, heterogeneous) - <strong>T</strong>:
Optional initial value of the hidden. If not specified - assumed to
be 0. It has shape <cite>[num_directions, batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>initial_c</strong> (optional, heterogeneous) - <strong>T</strong>:
Optional initial value of the cell. If not specified - assumed to be
0. It has shape <cite>[num_directions, batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>P</strong> (optional, heterogeneous) - <strong>T</strong>:
The weight tensor for peepholes. Concatenation of <cite>P[iof]</cite> and
<cite>PB[iof]</cite> (if bidirectional) along dimension 0. It has shape
<cite>[num_directions, 3*hidde_size]</cite>. Optional: If not specified -
assumed to be 0.</p></li>
</ul>
<p><strong>Outputs</strong></p>
<p>Between 0 and 3 outputs.</p>
<ul class="simple">
<li><p><strong>Y</strong> (optional, heterogeneous) - <strong>T</strong>:
A tensor that concats all the intermediate output values of the
hidden. It has shape <cite>[seq_length, num_directions, batch_size,
hidden_size]</cite>. It is optional if <cite>output_sequence</cite> is 0.</p></li>
<li><p><strong>Y_h</strong> (optional, heterogeneous) - <strong>T</strong>:
The last output value of the hidden. It has shape <cite>[num_directions,
batch_size, hidden_size]</cite>.</p></li>
<li><p><strong>Y_c</strong> (optional, heterogeneous) - <strong>T</strong>:
The last output value of the cell. It has shape <cite>[num_directions,
batch_size, hidden_size]</cite>.</p></li>
</ul>
<p><strong>Type Constraints</strong></p>
<ul class="simple">
<li><p><strong>T</strong> in (
tensor(double),
tensor(float),
tensor(float16)
):
Constrain input and output types to float tensors.</p></li>
<li><p><strong>T1</strong> in (
tensor(int32)
):
Constrain seq_lens to integer tensor.</p></li>
</ul>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="text_diff_LRN_1_13.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">LRN - 1 vs 13</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="text_diff_LSTM_7_14.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">LSTM - 7 vs 14</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.2.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>