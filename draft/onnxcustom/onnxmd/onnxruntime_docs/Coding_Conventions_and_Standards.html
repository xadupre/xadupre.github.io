
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ONNX Runtime coding conventions and standards &#8212; onnxcustom</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Roadmap.html">
   ONNX Runtime Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Privacy.html">
   Privacy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Server.html">
   Build ONNX Runtime Server on Linux
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ONNX_Runtime_Server_Usage.html">
   How to Use build ONNX Runtime Server for Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="FAQ.html">
   FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="OperatorKernels.html">
   Supported Operators and Data Types
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Versioning.html">
   Versioning
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   ONNX Runtime coding conventions and standards
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ABI_Dev_Notes.html">
   Global Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PR_Guidelines.html">
   Guidelines for creating a good pull request
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Model_Test.html">
   Get the test data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="NotesOnThreading.html">
   Notes on Threading in ORT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Python_Dev_Notes.html">
   Python Dev Notes
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="C_API_Guidelines.html">
   ORT API Guidelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cmake_guideline.html">
   Scope the impact to minimal
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="onnxruntime_extensions.html">
   ONNXRuntime Extensions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ContribOperators.html">
   Contrib Operator Schemas
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Android_testing.html">
   Testing Android Changes using the Emulator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ORTMobilePackageOperatorTypeSupport.html">
   ONNX Runtime Mobile Pre-Built Package Operator and Type Support
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="WinML_principles.html">
   Contributing to Windows ML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Reduced_Operator_Kernel_build.html">
   ONNX Runtime Reduced Operator Kernel build
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ReleaseManagement.html">
   Release Management
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c-code-style">
   C++ Code Style
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clang-format">
     Clang-format
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-analysis">
   Code analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unit-testing-and-code-coverage">
   Unit Testing and Code Coverage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-code-style">
   Python Code Style
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objective-c-c-code-style">
   Objective-C/C++ Code Style
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="onnx-runtime-coding-conventions-and-standards">
<h1>ONNX Runtime coding conventions and standards<a class="headerlink" href="#onnx-runtime-coding-conventions-and-standards" title="Permalink to this headline">¶</a></h1>
<section id="c-code-style">
<h2>C++ Code Style<a class="headerlink" href="#c-code-style" title="Permalink to this headline">¶</a></h2>
<p>Google style from https://google.github.io/styleguide/cppguide.html with a few minor alterations:</p>
<ul class="simple">
<li><p>Max line length 120</p>
<ul>
<li><p>Aim for 80, but up to 120 is fine.</p></li>
</ul>
</li>
<li><p>Exceptions</p>
<ul>
<li><p>Allowed to throw fatal errors that are expected to result in a top level handler catching them, logging them and terminating the program.</p></li>
</ul>
</li>
<li><p>Non-const references</p>
<ul>
<li><p>Allowed</p></li>
<li><p>Use a non-const reference for arguments that are modifiable but cannot be nullptr so the API clearly advertises the intent</p></li>
<li><p>Const correctness and usage of smart pointers (shared_ptr and unique_ptr) is expected. A non-const reference equates to “this is a non-null object that you can change but are not being given ownership of”.</p></li>
</ul>
</li>
<li><p>‘using namespace’ permitted with limited scope</p>
<ul>
<li><p>Not allowing ‘using namespace’ at all is overly restrictive. Follow the C++ Core Guidelines:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rs-using">SF.6: Use using namespace directives for transition, for foundation libraries (such as std), or within a local scope (only)</a></p></li>
<li><p><a class="reference external" href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rs-using-directive">SF.7: Don’t write using namespace at global scope in a header file</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Other</p>
<ul class="simple">
<li><p>Qualify usages of ‘auto’ with ‘const’, ‘*’, ‘&amp;’ and ‘&amp;&amp;’ where applicable to more clearly express the intent</p></li>
<li><p>When adding a new class, disable copy/assignment/move until you have a proven need for these capabilities. If a need arises, enable copy/assignment/move selectively, and when doing so validate that the implementation of the class supports what is being enabled.</p>
<ul>
<li><p>Use ORT_DISALLOW_COPY_ASSIGNMENT_AND_MOVE initially</p></li>
<li><p>See the other ORT_DISALLOW_* macros in https://github.com/microsoft/onnxruntime/blob/master/include/onnxruntime/core/common/common.h</p></li>
</ul>
</li>
<li><p>Don’t use else after return. see: <a class="reference external" href="https://llvm.org/docs/CodingStandards.html#don-t-use-else-after-a-return">https://llvm.org/docs/CodingStandards.html#don-t-use-else-after-a-return</a></p></li>
<li><p>Don’t overuse std::shared_ptr. Use std::shared_ptr only if it’s not clear when and where the object will be deallocated. See also: <a class="reference external" href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-shared_ptr">https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-shared_ptr</a></p></li>
<li><p>Avoid using the ‘long’ type, which could be either 32 bits or 64 bits.</p></li>
<li><p>If there is a legitimate need to allocate objects on the heap, prefer using std::make_unique(). References for the reasoning:</p>
<ul>
<li><p>https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rh-make_unique</p></li>
<li><p>https://herbsutter.com/2013/05/29/gotw-89-solution-smart-pointers/</p></li>
<li><p>https://abseil.io/tips/126</p></li>
</ul>
</li>
<li><p>Use <a class="reference external" href="https://github.com/dcleblanc/SafeInt">SafeInt</a> when calculating the size of memory to allocate to protect against overflow errors</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;core/common/safeint.h&quot;</span></code></p></li>
<li><p>search for <code class="docutils literal notranslate"><span class="pre">SafeInt&lt;size_t&gt;</span></code> in the code for examples</p></li>
</ul>
</li>
</ul>
<section id="clang-format">
<h3>Clang-format<a class="headerlink" href="#clang-format" title="Permalink to this headline">¶</a></h3>
<p>Clang-format will handle automatically formatting code to these rules. There’s a Visual Studio plugin that can format on save at https://marketplace.visualstudio.com/items?itemName=LLVMExtensions.ClangFormat, or alternatively the latest versions of Visual Studio 2017 include <a class="reference external" href="https://blogs.msdn.microsoft.com/vcblog/2018/03/13/clangformat-support-in-visual-studio-2017-15-7-preview-1/">clang-format support</a>.</p>
<p>There is a .clang-format file in the root directory that has the max line length override and defaults to the google rules. This should be automatically discovered by the clang-format tools.</p>
</section>
</section>
<section id="code-analysis">
<h2>Code analysis<a class="headerlink" href="#code-analysis" title="Permalink to this headline">¶</a></h2>
<p>Visual Studio Code Analysis with <a class="reference external" href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md">C++ Core guidelines</a> rules enabled is configured to run on build for the onnxruntime_common, onnxruntime_graph and onnxruntime_util libraries. Updating the onnxruntime_framework and onnxruntime_provider libraries to enable Code Analysis and build warning free is pending.</p>
<p>Code changes should build with no Code Analysis warnings, however this is somewhat difficult to achieve consistently as the Code Analysis implementation is in fairly constant flux. Different minor releases may have less false positives (a build with the latest version may be warning free, and a build with an earlier version may not), or detect additional problems (an earlier version builds warning free and a later version doesn’t).</p>
</section>
<section id="unit-testing-and-code-coverage">
<h2>Unit Testing and Code Coverage<a class="headerlink" href="#unit-testing-and-code-coverage" title="Permalink to this headline">¶</a></h2>
<p>There should be unit tests that cover the core functionality of the product, expected edge cases, and expected errors.
Code coverage from these tests should aim at maintaining over 80% coverage.</p>
<p>All changes should be covered by new or existing unit tests.</p>
<p>In order to check that all the code you expect to be covered by testing is covered, run code coverage in Visual Studio using ‘Analyze Code Coverage’ under the Test menu.</p>
<p>There is a configuration file in onnxruntime\VSCodeCoverage.runsettings that can be used to configure code coverage so that it reports numbers for just the onnxruntime code. Select that file in Visual Studio via the Test menu: ‘Test’ -&gt; ‘Test Settings’ -&gt; ‘Select Test Settings File’.</p>
<p>Using ‘Show Code Coverage Coloring’ will allow you to visually inspect which lines were hit by the tests. See <a class="reference external" href="https://docs.microsoft.com/en-us/visualstudio/test/using-code-coverage-to-determine-how-much-code-is-being-tested?view=vs-2017">https://docs.microsoft.com/en-us/visualstudio/test/using-code-coverage-to-determine-how-much-code-is-being-tested?view=vs-2017</a>.</p>
</section>
<section id="python-code-style">
<h2>Python Code Style<a class="headerlink" href="#python-code-style" title="Permalink to this headline">¶</a></h2>
<p>Please adhere to the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8 Style Guide</a>.
A maximum line length of 120 characters is allowed for consistency with the C++ code.</p>
<p>Code can be validated with <a class="reference external" href="https://pypi.org/project/flake8/">flake8</a> using the configuration file in the root directory called <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/.flake8">.flake8</a>.</p>
<p>The <a class="reference external" href="https://pypi.org/project/autopep8/">autopep8</a> tool can be used to automatically fix a range of PEP8 issues, as can <a class="reference external" href="https://github.com/google/yapf">yapf</a>. There’s a yapf configuration file <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/onnxruntime/.style.yapf">here</a>.</p>
<p>Editors such as PyCharm <a class="reference external" href="https://www.jetbrains.com/help/pycharm/code-inspection.html">(see here)</a> and Visual Studio Code <a class="reference external" href="https://code.visualstudio.com/docs/python/linting#_flake8">(see here)</a> can be configured to check for PEP8 issues.</p>
</section>
<section id="objective-c-c-code-style">
<h2>Objective-C/C++ Code Style<a class="headerlink" href="#objective-c-c-code-style" title="Permalink to this headline">¶</a></h2>
<p>Please follow the <a class="reference external" href="https://google.github.io/styleguide/objcguide.html">Google Objective-C/C++ Style Guide</a>.</p>
<p>Clang-format can be used to format Objective-C/C++ code. The .clang-format file is in the repository root directory.</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>