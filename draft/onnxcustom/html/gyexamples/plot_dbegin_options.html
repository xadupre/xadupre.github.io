
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>One model, many possible conversions with options &#8212; onnxcustom</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Black list operators when converting" href="plot_dbegin_options_list.html" />
    <link rel="prev" title="What is the opset number?" href="plot_cbegin_opset.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_onnx/index.html">
   Introduction to ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_onnxruntime/index.html">
   Introduction to onnxruntime
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../tutorials/tutorial_skl/index.html">
   scikit-learn to ONNX Tutorial
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../tutorials/tutorial_skl/tutorial_1_simple.html">
     The easy case
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="plot_abegin_convert_pipeline.html">
       Train and deploy a scikit-learn pipeline
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_bbegin_measure_time.html">
       Benchmark ONNX conversion
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_cbegin_opset.html">
       What is the opset number?
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       One model, many possible conversions with options
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_dbegin_options_list.html">
       Black list operators when converting
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_dbegin_options_zipmap.html">
       Choose appropriate output of a classifier
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_ebegin_float_double.html">
       Issues when switching to float
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_funny_sigmoid.html">
       Funny discrepancies
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_fbegin_investigate.html">
       Intermediate results and investigation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_gbegin_dataframe.html">
       Dataframe as an input
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_gbegin_transfer_learning.html">
       Transfer Learning with ONNX
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_gbegin_cst.html">
       Store arrays in one onnx graph
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_gconverting.html">
       Modify the ONNX graph
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/tutorial_skl/tutorial_1-5_external.html">
     Using converter from other libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/tutorial_skl/tutorial_2_new_converter.html">
     A custom converter for a custom model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/tutorial_skl/tutorial_3_new_operator.html">
     Extend ONNX, extend runtime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/tutorial_skl/tutorial_4_complex.html">
     Complex Scenarios
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_training/index.html">
   Training Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_bench/index.html">
   Benchmarking and profiling Tutorial
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-zipmap">
   Option
   <em>
    zipmap
   </em>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-in-a-pipeline">
   Option in a pipeline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-raw-scores">
   Option
   <em>
    raw_scores
   </em>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#option-decision-path">
   Option
   <em>
    decision_path
   </em>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#list-of-available-options">
   List of available options
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-gyexamples-plot-dbegin-options-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="one-model-many-possible-conversions-with-options">
<span id="sphx-glr-gyexamples-plot-dbegin-options-py"></span><h1>One model, many possible conversions with options<a class="headerlink" href="#one-model-many-possible-conversions-with-options" title="Permalink to this headline">¶</a></h1>
<p id="index-0">There is not one way to convert a model. A new operator
might have been added in a newer version of <a class="reference external" href="https://onnx.ai/">ONNX</a>
and that speeds up the converted model. The rational choice
would be to use this new operator but what means the associated
runtime has an implementation for it. What if two different
users needs two different conversion for the same model?
Let’s see how this may be done.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#option-zipmap" id="id1">Option <em>zipmap</em></a></p></li>
<li><p><a class="reference internal" href="#option-in-a-pipeline" id="id2">Option in a pipeline</a></p></li>
<li><p><a class="reference internal" href="#option-raw-scores" id="id3">Option <em>raw_scores</em></a></p></li>
<li><p><a class="reference internal" href="#option-decision-path" id="id4">Option <em>decision_path</em></a></p></li>
<li><p><a class="reference internal" href="#list-of-available-options" id="id5">List of available options</a></p></li>
</ul>
</div>
<section id="option-zipmap">
<h2><a class="toc-backref" href="#id1">Option <em>zipmap</em></a><a class="headerlink" href="#option-zipmap" title="Permalink to this headline">¶</a></h2>
<p>Every classifier is by design converted into an ONNX graph which outputs
two results: the predicted label and the prediction probabilites
for every label. By default, the labels are integers and the
probabilites are stored in dictionaries. That’s the purpose
of operator <em>ZipMap</em> added at the end of the following graph.</p>

    <div id="gdot-140034106498688-cont"><div id="gdot-140034106498688" style="width:100%;height:100%;"></div>
    <script>

    require(['../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 4))\" fontsize=10];\n\n  output_label [shape=box color=green label=\"output_label\\nint64((0,))\" fontsize=10];\n  output_probability [shape=box color=green label=\"output_probability\\n[{int64, {'kind': 'tensor', 'elem': 'float', 'shape': }}]\" fontsize=10];\n\n\n  label [shape=box label=\"label\" fontsize=10];\n  probability_tensor [shape=box label=\"probability_tensor\" fontsize=10];\n  LinearClassifier [shape=box style=\"filled,rounded\" color=orange label=\"LinearClassifier\\n(LinearClassifier)\\nclasslabels_ints=[0 1 2]\\ncoefficients=[-0.37564358  0.88...\\nintercepts=[  8.58711     2.949...\\nmulti_class=1\\npost_transform=b'SOFTMAX'\" fontsize=10];\n  X -> LinearClassifier;\n  LinearClassifier -> label;\n  LinearClassifier -> probability_tensor;\n\n  Cast [shape=box style=\"filled,rounded\" color=orange label=\"Cast\\n(Cast)\\nto=7\" fontsize=10];\n  label -> Cast;\n  Cast -> output_label;\n\n  probabilities [shape=box label=\"probabilities\" fontsize=10];\n  Normalizer [shape=box style=\"filled,rounded\" color=orange label=\"Normalizer\\n(Normalizer)\\nnorm=b'L1'\" fontsize=10];\n  probability_tensor -> Normalizer;\n  Normalizer -> probabilities;\n\n  ZipMap [shape=box style=\"filled,rounded\" color=orange label=\"ZipMap\\n(ZipMap)\\nclasslabels_int64s=[0 1 2]\" fontsize=10];\n  probabilities -> ZipMap;\n  ZipMap -> output_probability;\n}\n");
    document.getElementById('gdot-140034106498688').innerHTML = svgGraph; });
    
</script>
</div><p>This operator is not really efficient as it copies every probabilies and
labels in a different container. This time is usually significant for
small classifiers. Then it makes sense to remove it.</p>

    <div id="gdot-140036317246176-cont"><div id="gdot-140036317246176" style="width:100%;height:100%;"></div>
    <script>

    require(['../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 4))\" fontsize=10];\n\n  label [shape=box color=green label=\"label\\nint64((0,))\" fontsize=10];\n  probabilities [shape=box color=green label=\"probabilities\\nfloat((0, 3))\" fontsize=10];\n\n\n  probability_tensor [shape=box label=\"probability_tensor\" fontsize=10];\n  LinearClassifier [shape=box style=\"filled,rounded\" color=orange label=\"LinearClassifier\\n(LinearClassifier)\\nclasslabels_ints=[0 1 2]\\ncoefficients=[-0.37564358  0.88...\\nintercepts=[  8.58711     2.949...\\nmulti_class=1\\npost_transform=b'SOFTMAX'\" fontsize=10];\n  X -> LinearClassifier;\n  LinearClassifier -> label;\n  LinearClassifier -> probability_tensor;\n\n  Normalizer [shape=box style=\"filled,rounded\" color=orange label=\"Normalizer\\n(Normalizer)\\nnorm=b'L1'\" fontsize=10];\n  probability_tensor -> Normalizer;\n  Normalizer -> probabilities;\n}\n");
    document.getElementById('gdot-140036317246176').innerHTML = svgGraph; });
    
</script>
</div><p>There might be in the graph many classifiers, it is important to have
a way to specify which classifier should keep its <em>ZipMap</em>
and which is not. So it is possible to specify options by id.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">InferenceSession</span>
<span class="kn">from</span> <span class="nn">pyquickhelper.helpgen.graphviz_helper</span> <span class="kn">import</span> <span class="n">plot_graphviz</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">skl2onnx.common._registration</span> <span class="kn">import</span> <span class="n">_converter_pool</span>
<span class="kn">from</span> <span class="nn">skl2onnx</span> <span class="kn">import</span> <span class="n">to_onnx</span>
<span class="kn">from</span> <span class="nn">mlprodict.onnxrt</span> <span class="kn">import</span> <span class="n">OnnxInference</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">__</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">clr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">clr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">clr</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">clr</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>
<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/var/lib/jenkins/workspace/onnxcustom/onnxcustom_UT_39_std/_venv/lib/python3.9/site-packages/sklearn/linear_model/_logistic.py:814: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(
OnnxInference(...)
    def compiled_run(dict_inputs, yield_ops=None):
        if yield_ops is not None:
            raise NotImplementedError(&#39;yields_ops should be None.&#39;)
        # inputs
        X = dict_inputs[&#39;X&#39;]
        (label, probability_tensor, ) = n0_linearclassifier(X)
        (probabilities, ) = n1_normalizer(probability_tensor)
        return {
            &#39;label&#39;: label,
            &#39;probabilities&#39;: probabilities,
        }
</pre></div>
</div>
<p>Visually.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_graphviz</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">to_dot</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dbegin_options_001.png" srcset="../_images/sphx_glr_plot_dbegin_options_001.png" alt="plot dbegin options" class = "sphx-glr-single-img"/><p>We need to compare that kind of visualisation to
what it would give with operator <em>ZipMap</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">clr</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>OnnxInference(...)
    def compiled_run(dict_inputs, yield_ops=None):
        if yield_ops is not None:
            raise NotImplementedError(&#39;yields_ops should be None.&#39;)
        # inputs
        X = dict_inputs[&#39;X&#39;]
        (label, probability_tensor, ) = n0_linearclassifier(X)
        (probabilities, ) = n1_normalizer(probability_tensor)
        (output_label, ) = n2_cast(label)
        (output_probability, ) = n3_zipmap(probabilities)
        return {
            &#39;output_label&#39;: output_label,
            &#39;output_probability&#39;: output_probability,
        }
</pre></div>
</div>
<p>Visually.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_graphviz</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">to_dot</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dbegin_options_002.png" srcset="../_images/sphx_glr_plot_dbegin_options_002.png" alt="plot dbegin options" class = "sphx-glr-single-img"/><p>Using function <em>id</em> has one flaw: it is not pickable.
It is just better to use strings.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">clr</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>OnnxInference(...)
    def compiled_run(dict_inputs, yield_ops=None):
        if yield_ops is not None:
            raise NotImplementedError(&#39;yields_ops should be None.&#39;)
        # inputs
        X = dict_inputs[&#39;X&#39;]
        (label, probability_tensor, ) = n0_linearclassifier(X)
        (probabilities, ) = n1_normalizer(probability_tensor)
        return {
            &#39;label&#39;: label,
            &#39;probabilities&#39;: probabilities,
        }
</pre></div>
</div>
<p>Visually.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_graphviz</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">to_dot</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dbegin_options_003.png" srcset="../_images/sphx_glr_plot_dbegin_options_003.png" alt="plot dbegin options" class = "sphx-glr-single-img"/></section>
<section id="option-in-a-pipeline">
<h2><a class="toc-backref" href="#id2">Option in a pipeline</a><a class="headerlink" href="#option-in-a-pipeline" title="Permalink to this headline">¶</a></h2>
<p>In a pipeline, <a class="reference external" href="https://github.com/onnx/sklearn-onnx">sklearn-onnx</a> uses the same
name convention.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;clr&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
<span class="p">])</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clr__zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>OnnxInference(...)
    def compiled_run(dict_inputs, yield_ops=None):
        if yield_ops is not None:
            raise NotImplementedError(&#39;yields_ops should be None.&#39;)
        # init: Ad_Addcst (Ad_Addcst)
        # init: Mu_Mulcst (Mu_Mulcst)
        # inputs
        X = dict_inputs[&#39;X&#39;]
        (Ca_output0, ) = n0_cast(X)
        (Mu_C0, ) = n1_mul(Ca_output0, Mu_Mulcst)
        (variable, ) = n2_add(Mu_C0, Ad_Addcst)
        (label, probability_tensor, ) = n3_linearclassifier(variable)
        (probabilities, ) = n4_normalizer(probability_tensor)
        return {
            &#39;label&#39;: label,
            &#39;probabilities&#39;: probabilities,
        }
</pre></div>
</div>
<p>Visually.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_graphviz</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">to_dot</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_dbegin_options_004.png" srcset="../_images/sphx_glr_plot_dbegin_options_004.png" alt="plot dbegin options" class = "sphx-glr-single-img"/></section>
<section id="option-raw-scores">
<h2><a class="toc-backref" href="#id3">Option <em>raw_scores</em></a><a class="headerlink" href="#option-raw-scores" title="Permalink to this headline">¶</a></h2>
<p>Every classifier is converted in a graph which
returns probabilities by default. But many models
compute unscaled <em>raw_scores</em>.
First, with probabilities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;clr&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
<span class="p">])</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>

<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]}))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;label&#39;: array([0, 0, 0, 0, 0]), &#39;probabilities&#39;: array([[0.88268614, 0.10948392, 0.00782984],
       [0.7944385 , 0.1972866 , 0.00827491],
       [0.85557765, 0.13792053, 0.00650185],
       [0.8262804 , 0.16634221, 0.00737737],
       [0.9005015 , 0.092388  , 0.00711049]], dtype=float32)}
</pre></div>
</div>
<p>Then with raw scores:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;raw_scores&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>

<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]}))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;label&#39;: array([0, 0, 0, 0, 0]), &#39;probabilities&#39;: array([[0.88268614, 0.10948392, 0.00782984],
       [0.7944385 , 0.1972866 , 0.00827491],
       [0.85557765, 0.13792053, 0.00650185],
       [0.8262804 , 0.16634221, 0.00737737],
       [0.9005015 , 0.092388  , 0.00711049]], dtype=float32)}
</pre></div>
</div>
<p>It did not seem to work… We need to tell
that applies on a specific part of the pipeline
and not the whole pipeline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span> <span class="p">{</span><span class="s1">&#39;raw_scores&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>

<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]}))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;label&#39;: array([0, 0, 0, 0, 0]), &#39;probabilities&#39;: array([[ 2.2707398 ,  0.18354774, -2.4542873 ],
       [ 1.9857953 ,  0.5928172 , -2.5786123 ],
       [ 2.2349296 ,  0.4098304 , -2.6447601 ],
       [ 2.1071343 ,  0.5042473 , -2.6113818 ],
       [ 2.3727787 ,  0.095824  , -2.4686027 ]], dtype=float32)}
</pre></div>
</div>
<p>There are negative values. That works.
Strings are still easier to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clr__raw_scores&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;clr__zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">model_def</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;python_compiled&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]}))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;label&#39;: array([0, 0, 0, 0, 0]), &#39;probabilities&#39;: array([[ 2.2707398 ,  0.18354774, -2.4542873 ],
       [ 1.9857953 ,  0.5928172 , -2.5786123 ],
       [ 2.2349296 ,  0.4098304 , -2.6447601 ],
       [ 2.1071343 ,  0.5042473 , -2.6113818 ],
       [ 2.3727787 ,  0.095824  , -2.4686027 ]], dtype=float32)}
</pre></div>
</div>
<p>Negative figures. We still have raw scores.</p>
</section>
<section id="option-decision-path">
<h2><a class="toc-backref" href="#id4">Option <em>decision_path</em></a><a class="headerlink" href="#option-decision-path" title="Permalink to this headline">¶</a></h2>
<p><em>scikit-learn</em> implements a function to retrieve the
decision path. It can be enabled by option <em>decision_path</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clrrf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">clrrf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">clrrf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">paths</span><span class="p">,</span> <span class="n">n_nodes_ptr</span> <span class="o">=</span> <span class="n">clrrf</span><span class="o">.</span><span class="n">decision_path</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">todense</span><span class="p">())</span>

<span class="n">model_def</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">clrrf</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">clrrf</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;decision_path&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                         <span class="s1">&#39;zipmap&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}})</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">model_def</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span>
                        <span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CPUExecutionProvider&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[1 0 1 0 1 1 0 1 0 1]
 [1 0 1 0 1 1 0 1 0 1]]
</pre></div>
</div>
<p>The model produces 3 outputs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;label&#39;, &#39;probabilities&#39;, &#39;decision_path&#39;]
</pre></div>
</div>
<p>Let’s display the last one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[&#39;10101&#39; &#39;10101&#39;]
 [&#39;10101&#39; &#39;10101&#39;]]
</pre></div>
</div>
</section>
<section id="list-of-available-options">
<h2><a class="toc-backref" href="#id5">List of available options</a><a class="headerlink" href="#list-of-available-options" title="Permalink to this headline">¶</a></h2>
<p>Options are registered for every converted to detect any
supported options while running the conversion.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_converter_pool</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_allowed_options</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Sklearn&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span> <span class="n">opts</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
        <span class="n">all_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;all options:&#39;</span><span class="p">,</span> <span class="n">pformat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">all_opts</span><span class="p">))))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>LgbmClassifier                 {&#39;zipmap&#39;: [True, False], &#39;nocl&#39;: [True, False]}
LightGbmBooster                {&#39;cast&#39;: [True, False]}
LightGbmLGBMClassifier         {&#39;nocl&#39;: [True, False], &#39;zipmap&#39;: [True, False, &#39;columns&#39;]}
LightGbmLGBMRegressor          {&#39;split&#39;: None}
AdaBoostClassifier             {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
BaggingClassifier              {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
BayesianGaussianMixture        {&#39;score_samples&#39;: [True, False]}
BayesianRidge                  {&#39;return_std&#39;: [True, False]}
BernoulliNB                    {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
CalibratedClassifierCV         {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
CategoricalNB                  {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
ComplementNB                   {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
CountVectorizer                {&#39;tokenexp&#39;: None, &#39;separators&#39;: None, &#39;nan&#39;: [True, False], &#39;keep_empty_string&#39;: [True, False]}
DecisionTreeClassifier         {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
DecisionTreeRegressor          {&#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
ExtraTreeClassifier            {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
ExtraTreeRegressor             {&#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
ExtraTreesClassifier           {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;raw_scores&#39;: [True, False], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
ExtraTreesRegressor            {&#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
GaussianMixture                {&#39;score_samples&#39;: [True, False]}
GaussianNB                     {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
GaussianProcessClassifier      {&#39;optim&#39;: [None, &#39;cdist&#39;], &#39;nocl&#39;: [False, True], &#39;output_class_labels&#39;: [False, True], &#39;zipmap&#39;: [False, True]}
GaussianProcessRegressor       {&#39;return_cov&#39;: [False, True], &#39;return_std&#39;: [False, True], &#39;optim&#39;: [None, &#39;cdist&#39;]}
GradientBoostingClassifier     {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;raw_scores&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
HistGradientBoostingClassifier {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;raw_scores&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
HistGradientBoostingRegressor  {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;raw_scores&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
IsolationForest                {&#39;score_samples&#39;: [True, False]}
KMeans                         {&#39;gemm&#39;: [True, False]}
KNNImputer                     {&#39;optim&#39;: [None, &#39;cdist&#39;]}
KNeighborsClassifier           {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;raw_scores&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;optim&#39;: [None, &#39;cdist&#39;]}
KNeighborsRegressor            {&#39;optim&#39;: [None, &#39;cdist&#39;]}
KNeighborsTransformer          {&#39;optim&#39;: [None, &#39;cdist&#39;]}
KernelPCA                      {&#39;optim&#39;: [None, &#39;cdist&#39;]}
LinearClassifier               {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
LinearSVC                      {&#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
LocalOutlierFactor             {&#39;score_samples&#39;: [True, False], &#39;optim&#39;: [None, &#39;cdist&#39;]}
MLPClassifier                  {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
MaxAbsScaler                   {&#39;div&#39;: [&#39;std&#39;, &#39;div&#39;, &#39;div_cast&#39;]}
MiniBatchKMeans                {&#39;gemm&#39;: [True, False]}
MultiOutputClassifier          {&#39;nocl&#39;: [False, True], &#39;output_class_labels&#39;: [False, True], &#39;zipmap&#39;: [False, True]}
MultinomialNB                  {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
NearestNeighbors               {&#39;optim&#39;: [None, &#39;cdist&#39;]}
OneVsRestClassifier            {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
RadiusNeighborsClassifier      {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;raw_scores&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;optim&#39;: [None, &#39;cdist&#39;]}
RadiusNeighborsRegressor       {&#39;optim&#39;: [None, &#39;cdist&#39;]}
RandomForestClassifier         {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;raw_scores&#39;: [True, False], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
RandomForestRegressor          {&#39;decision_path&#39;: [True, False], &#39;decision_leaf&#39;: [True, False]}
RobustScaler                   {&#39;div&#39;: [&#39;std&#39;, &#39;div&#39;, &#39;div_cast&#39;]}
SGDClassifier                  {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
SVC                            {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
Scaler                         {&#39;div&#39;: [&#39;std&#39;, &#39;div&#39;, &#39;div_cast&#39;]}
StackingClassifier             {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;nocl&#39;: [True, False], &#39;output_class_labels&#39;: [False, True], &#39;raw_scores&#39;: [True, False]}
TfidfTransformer               {&#39;nan&#39;: [True, False]}
TfidfVectorizer                {&#39;tokenexp&#39;: None, &#39;separators&#39;: None, &#39;nan&#39;: [True, False], &#39;keep_empty_string&#39;: [True, False]}
VotingClassifier               {&#39;zipmap&#39;: [True, False, &#39;columns&#39;], &#39;output_class_labels&#39;: [False, True], &#39;nocl&#39;: [True, False]}
WrappedLightGbmBoosterClassifier {&#39;zipmap&#39;: [True, False], &#39;nocl&#39;: [True, False]}
XGBoostXGBClassifier           {&#39;zipmap&#39;: [True, False], &#39;raw_scores&#39;: [True, False], &#39;nocl&#39;: [True, False]}
fct_score_cdist_sum            {&#39;cdist&#39;: [None, &#39;single-node&#39;]}
all options: [&#39;cast&#39;,
 &#39;cdist&#39;,
 &#39;decision_leaf&#39;,
 &#39;decision_path&#39;,
 &#39;div&#39;,
 &#39;gemm&#39;,
 &#39;keep_empty_string&#39;,
 &#39;nan&#39;,
 &#39;nocl&#39;,
 &#39;optim&#39;,
 &#39;output_class_labels&#39;,
 &#39;raw_scores&#39;,
 &#39;return_cov&#39;,
 &#39;return_std&#39;,
 &#39;score_samples&#39;,
 &#39;separators&#39;,
 &#39;split&#39;,
 &#39;tokenexp&#39;,
 &#39;zipmap&#39;]
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  5.231 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-gyexamples-plot-dbegin-options-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/243d44b404011b8d3644b2a874fcb7d6/plot_dbegin_options.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_dbegin_options.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c644eb3928e606ba9fa28e57d9262907/plot_dbegin_options.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_dbegin_options.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="plot_cbegin_opset.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">What is the opset number?</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="plot_dbegin_options_list.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Black list operators when converting</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>