
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dimension Denotation &#8212; onnxcustom</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="IR.html">
   Open Neural Network Exchange Intermediate Representation (ONNX IR) Specification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PythonAPIOverview.html">
   Python API Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="OpConventions.html">
   Operator Conventions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Dimension Denotation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Broadcasting.html">
   Broadcasting in ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ExternalData.html">
   External Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Hub.html">
   ONNX Model Hub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_metadata.html">
   Metatdata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ShapeInference.html">
   ONNX Shape Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CIPipelines.html">
   ONNX CI Pipelines
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Syntax.html">
   Overview
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Versioning.html">
   ONNX Versioning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="VersionConverter.html">
   ONNX Version Converter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Relicensing.html">
   Relicensing MIT to Apache-2.0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_releases.html">
   Onnx Releases
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_operators.html">
   ONNX Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_operators_ml.html">
   ONNX ML Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_changelog.html">
   Change Logs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_changelog_ml.html">
   ML Change Logs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_test_coverage.html">
   Test Coverage (Operators)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_test_coverage_ml.html">
   Test Coverage (ML Operators)
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_contributing.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_add_new_op.html">
   Adding a new operator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ImplementingAnOnnxBackend.html">
   Implementing an ONNX backend
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="OnnxBackendTest.html">
   ONNX Backend Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_managing.html">
   Onnx Releases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ONNXIFI.html">
   ONNX Interface for Framework Integration (ONNXIFI)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ONNXTypes.html">
   Optional Type
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="TypeAnnotations.html">
   Type annotations for ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="TypeDenotation.html">
   Type Denotation
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DefineDifferentiability.html">
   A Short Guide on the Differentiability Tag for ONNX Operators
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivation">
   Motivation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#denotation-definition">
   Denotation Definition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#denotation-propagation">
   Denotation Propagation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#denotation-verification">
   Denotation Verification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#type-denotation">
   Type Denotation
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <!--- SPDX-License-Identifier: Apache-2.0 -->
<section id="dimension-denotation">
<h1>Dimension Denotation<a class="headerlink" href="#dimension-denotation" title="Permalink to this headline">¶</a></h1>
<p>Dimension Denotation is an experimental attempt to give tensor axis semantic descriptions and thus types and perform verification steps based on them subsequently.</p>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>The motivation of such a mechanism can be illustrated via a simple example. In the linear neural network specification below, we assume a NCHW model input:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_in_NCHW</span> <span class="o">-&gt;</span> <span class="n">Transpose</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AveragePool</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In this neural network, a user mistakenly constructed a neural network that transposes an NCHW input to a weird NHCW format and pass through spatial pooling that assumes a NCHW input format. As clearly a mistake as it is, no existing infrastructure will report an error to the user. This is should be deeply unnerving to programmers who rely heavily on type checking as an integral part of program correctness guarantee. This proposal seeks to resolve this vacuum of proper type-checking inherent in the current paradigm of neural network specification.</p>
<p>This proposal consists of three key components: Denotation Definition, Denotation Propagation and Denotation Verification, each of which will be discussed in detail.</p>
</section>
<section id="denotation-definition">
<h2>Denotation Definition<a class="headerlink" href="#denotation-definition" title="Permalink to this headline">¶</a></h2>
<p>To begin with, we define a set of types for tensor types. Such types are defined based on the following principles:</p>
<ol class="arabic simple">
<li><p>Be fine grain enough to eliminate potential pitfalls. For instance, the above example illustrated in the motivation section mandates that we distinguish between a channel dimension and a spatial feature dimension to ensure the correctness of execution of the AveragePool op.</p></li>
<li><p>Be coarse grain enough to alleviate the mental burden of users. For instance, in the above example, there is significantly less need to distinguish between a width dimension and a height dimension because operations like pooling and convolution often do not draw a distinction between various spatial dimensions. Thus, we summarize all the spatial dimensions as feature dimensions.</p></li>
<li><p>As an important corollary of 2, be model agnostic. For instance, the semantics of feature dimensions in recurrent neural networks (RNN) and the semantics of spatial dimensions in convolutional neural network (CNN) are almost indistinguishable and therefore we permit users and developers to describe either as a feature dimension.</p></li>
</ol>
<p>Specifically, in our first proposal, we define the following set of standard denotations:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_BATCH</span></code> describes a batch dimension of the training data. This corresponds to the <code class="docutils literal notranslate"><span class="pre">N</span></code> dimension in the more commonly used tensor format notation <code class="docutils literal notranslate"><span class="pre">NCHW</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_CHANNEL</span></code> describes a channel dimension of the training data. This corresponds to the <code class="docutils literal notranslate"><span class="pre">C</span></code> dimension.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_TIME</span></code> describes a time dimension.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_FEATURE</span></code> describes a feature dimension. This corresponds to the <code class="docutils literal notranslate"><span class="pre">H</span></code>, <code class="docutils literal notranslate"><span class="pre">W</span></code> dimension or the feature dimension in RNN.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FILTER_IN_CHANNEL</span></code> describes a filter in-channel dimension. This is the dimension that is identical (in size) to the channel dimension of the input image feature maps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FILTER_OUT_CHANNEL</span></code> describes a filter out-channel dimension. This is the dimension that is identical (in size) to the channel dimension of the output image feature maps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FILTER_SPATIAL</span></code> describes a filter spatial dimension.</p></li>
</ol>
</section>
<section id="denotation-propagation">
<h2>Denotation Propagation<a class="headerlink" href="#denotation-propagation" title="Permalink to this headline">¶</a></h2>
<p>Denotation Propagation happens when an operation permutes, destroys or creates dimensions with respect to its input tensor. In such scenarios, we will implement customized, operation-specific functions to infer the output tensor dimension denotation based on the input tensor dimension denotation. An example operation where denotation propagation happens is Transpose operation where the pseudocode for output dimension denotation inference can be formulated as a function of the input dimension denotation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">perm</span><span class="p">):</span>
    <span class="n">out_dim_denotaion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_dim_denotation</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="denotation-verification">
<h2>Denotation Verification<a class="headerlink" href="#denotation-verification" title="Permalink to this headline">¶</a></h2>
<p>Denotation Verification happens when an operation expects its input to arrive in a particular format. An example operation where denotation verification happens is AveragePool operation where the input, if annotated with dimension denotation, in the 2D case should have the denotation [<code class="docutils literal notranslate"><span class="pre">DATA_BATCH</span></code>, <code class="docutils literal notranslate"><span class="pre">DATA_CHANNEL</span></code>, <code class="docutils literal notranslate"><span class="pre">DATA_FEATURE</span></code>, <code class="docutils literal notranslate"><span class="pre">DATA_FEATURE</span></code>]. If there is a mismatch between the expected dimension denotation and the actual dimension denotation, an error should be reported.</p>
</section>
<section id="type-denotation">
<h2>Type Denotation<a class="headerlink" href="#type-denotation" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference internal" href="TypeDenotation.html"><span class="doc std std-doc">type denotation documentation</span></a> for more details on how to describe images and other types.</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>