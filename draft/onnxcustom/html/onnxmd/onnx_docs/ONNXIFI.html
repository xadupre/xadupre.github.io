
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ONNX Interface for Framework Integration (ONNXIFI) &#8212; onnxcustom</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="IR.html">
   Open Neural Network Exchange Intermediate Representation (ONNX IR) Specification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PythonAPIOverview.html">
   Python API Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="OpConventions.html">
   Operator Conventions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DimensionDenotation.html">
   Dimension Denotation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Broadcasting.html">
   Broadcasting in ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ExternalData.html">
   External Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Hub.html">
   ONNX Model Hub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_metadata.html">
   Metatdata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ShapeInference.html">
   ONNX Shape Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CIPipelines.html">
   ONNX CI Pipelines
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Syntax.html">
   Overview
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Versioning.html">
   ONNX Versioning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="VersionConverter.html">
   ONNX Version Converter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Relicensing.html">
   Relicensing MIT to Apache-2.0
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_releases.html">
   Onnx Releases
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_operators.html">
   ONNX Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_operators_ml.html">
   ONNX ML Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_changelog.html">
   Change Logs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_changelog_ml.html">
   ML Change Logs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_test_coverage.html">
   Test Coverage (Operators)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_test_coverage_ml.html">
   Test Coverage (ML Operators)
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_contributing.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_add_new_op.html">
   Adding a new operator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ImplementingAnOnnxBackend.html">
   Implementing an ONNX backend
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="OnnxBackendTest.html">
   ONNX Backend Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../onnx_managing.html">
   Onnx Releases
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   ONNX Interface for Framework Integration (ONNXIFI)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ONNXTypes.html">
   Optional Type
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="TypeAnnotations.html">
   Type annotations for ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="TypeDenotation.html">
   Type Denotation
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DefineDifferentiability.html">
   A Short Guide on the Differentiability Tag for ONNX Operators
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#core-features">
   Core Features
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-features">
     Optional Features:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-use-onnx-interface-for-framework-integration">
   How to Use ONNX Interface for Framework Integration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-implement-onnx-interface-for-framework-integration">
   How to Implement ONNX Interface for Framework Integration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discovery">
     Discovery
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extensions">
     Extensions
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <!--- SPDX-License-Identifier: Apache-2.0 -->
<section id="onnx-interface-for-framework-integration-onnxifi">
<h1>ONNX Interface for Framework Integration (ONNXIFI)<a class="headerlink" href="#onnx-interface-for-framework-integration-onnxifi" title="Permalink to this headline">¶</a></h1>
<p>ONNXIFI is a cross-platform API for loading and executing ONNX graphs on optimized backends. High-level frameworks and applications can use this API to execute neural network and machine learning models. Hardware vendors can implement this API to expose specialized hardware accelerators and highly optimized software infrastructure to the users.</p>
<section id="core-features">
<h2>Core Features<a class="headerlink" href="#core-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Standardized interface for neural network inference on special-purpose accelerators (NPUs), CPUs, GPUs, DSPs, and FPGAs</p></li>
<li><p>Based on widely supported technologies</p>
<ul>
<li><p>C API for function calls</p></li>
<li><p>ONNX format for passing model graphs</p></li>
<li><p>NCHW tensor layout for passing inputs and outputs</p></li>
</ul>
</li>
<li><p>Dynamic discovery of available backends for model execution</p>
<ul>
<li><p>Multiple backends from different vendors can co-exist on the same system</p></li>
</ul>
</li>
<li><p>Dynamic discovery of supported ONNX Operators on each backend</p></li>
</ul>
<section id="optional-features">
<h3>Optional Features:<a class="headerlink" href="#optional-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Graphs with variable-shape inputs and/or outputs</p></li>
<li><p>Graphs with data-dependendent output shapes</p></li>
</ul>
</section>
</section>
<section id="how-to-use-onnx-interface-for-framework-integration">
<h2>How to Use ONNX Interface for Framework Integration<a class="headerlink" href="#how-to-use-onnx-interface-for-framework-integration" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple" start="0">
<li><p>(Optional) Use <code class="docutils literal notranslate"><span class="pre">onnxifi_load</span></code> to dynamically load the ONNX Interface for Framework Integration library.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxGetBackendIDs</span></code> to get stable identifiers of available backends. Note: it is possible there are no backends installed in the system.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxGetBackendInfo</span></code> to check additional information about any available backend.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxGetBackendCompatibility</span></code> to check which operations within your model can run on the backend.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxInitBackend</span></code> to initialize a backend, then call <code class="docutils literal notranslate"><span class="pre">onnxInitGraph</span></code> to offload one or more model graphs to the backend.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxSetGraphIO</span></code> to set locations and shapes for inputs and outputs of a graph.</p></li>
<li><p>Initialize an <code class="docutils literal notranslate"><span class="pre">inputFence</span></code> structure of type <code class="docutils literal notranslate"><span class="pre">onnxMemoryFenceV1</span></code>: set <code class="docutils literal notranslate"><span class="pre">tag</span></code> to <code class="docutils literal notranslate"><span class="pre">ONNXIFI_TAG_MEMORY_FENCE_V1</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> to <code class="docutils literal notranslate"><span class="pre">ONNXIFI_SYNCHRONIZATION_EVENT</span></code>, and call <code class="docutils literal notranslate"><span class="pre">onnxInitEvent</span></code> to initiaze the <code class="docutils literal notranslate"><span class="pre">event</span></code> member.</p></li>
<li><p>Initialize an <code class="docutils literal notranslate"><span class="pre">outputFence</span></code> structure of type <code class="docutils literal notranslate"><span class="pre">onnxMemoryFenceV1</span></code>: set <code class="docutils literal notranslate"><span class="pre">tag</span></code> to <code class="docutils literal notranslate"><span class="pre">ONNXIFI_TAG_MEMORY_FENCE_V1</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> to <code class="docutils literal notranslate"><span class="pre">ONNXIFI_SYNCHRONIZATION_EVENT</span></code>, and <code class="docutils literal notranslate"><span class="pre">event</span></code> to null.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxRunGraph</span></code> with the initialized <code class="docutils literal notranslate"><span class="pre">inputFence</span></code> and <code class="docutils literal notranslate"><span class="pre">outputFence</span></code> structures to enable execution of the graph. The call to <code class="docutils literal notranslate"><span class="pre">onnxRunGraph</span></code> will populate <code class="docutils literal notranslate"><span class="pre">event</span></code> member of the <code class="docutils literal notranslate"><span class="pre">outputFence</span></code> with a newly created event object, asynchronously execute the graph once <code class="docutils literal notranslate"><span class="pre">inputFence</span></code>’s <code class="docutils literal notranslate"><span class="pre">event</span></code> is signalled, and then signal the <code class="docutils literal notranslate"><span class="pre">outputFence</span></code>’s <code class="docutils literal notranslate"><span class="pre">event</span></code>.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxSignalEvent</span></code> with <code class="docutils literal notranslate"><span class="pre">event</span></code> member of <code class="docutils literal notranslate"><span class="pre">inputFence</span></code> to signal to the backend that the inputs are ready to be consumed.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">onnxWaitEvent</span></code> (alternatively, repeatedly call <code class="docutils literal notranslate"><span class="pre">onnxGetEventState</span></code> in a loop until the event state is <code class="docutils literal notranslate"><span class="pre">ONNXIFI_EVENT_STATE_SIGNALLED</span></code>) with <code class="docutils literal notranslate"><span class="pre">event</span></code> member of <code class="docutils literal notranslate"><span class="pre">outputFence</span></code> to wait until graph outputs are ready to be consumed. Release events for inputs and outputs using <code class="docutils literal notranslate"><span class="pre">onnxReleaseEvent</span></code>.</p></li>
<li><p>If your model works with fixed-size inputs and outputs, and shape and location of inputs and outputs does not change, one call to <code class="docutils literal notranslate"><span class="pre">onnxSetGraphIO</span></code> is sufficient for multiple <code class="docutils literal notranslate"><span class="pre">onnxRunGraph</span></code> calls. The previous call to <code class="docutils literal notranslate"><span class="pre">onnxRunGraph</span></code>, however, must have finished before a user calls <code class="docutils literal notranslate"><span class="pre">onnxRunGraph</span></code> again, because concurrent execution with the same input and output locations is not allowed. For models with variable-size inputs or outputs, you’d need to call <code class="docutils literal notranslate"><span class="pre">onnxSetGraphIO</span></code> before each <code class="docutils literal notranslate"><span class="pre">onnxRunGraph</span></code> call.</p></li>
<li><p>When done using the model, release the model graph(s) with <code class="docutils literal notranslate"><span class="pre">onnxReleaseGraph</span></code>, then release the backend with <code class="docutils literal notranslate"><span class="pre">onnxReleaseBackend</span></code> and backend ID with <code class="docutils literal notranslate"><span class="pre">onnxReleaseBackendID</span></code>.</p></li>
</ol>
</section>
<section id="how-to-implement-onnx-interface-for-framework-integration">
<h2>How to Implement ONNX Interface for Framework Integration<a class="headerlink" href="#how-to-implement-onnx-interface-for-framework-integration" title="Permalink to this headline">¶</a></h2>
<p>The minimum functionality an ONNXIFI implementation must provide is the following:</p>
<ul class="simple">
<li><p>Support ONNX 1.0 model format.</p>
<ul>
<li><p>There is no minimum list of Operators a backend has to support.</p></li>
</ul>
</li>
<li><p>Support graph inputs / outputs in CPU memory.</p></li>
<li><p>Support graph inputs / outputs with fixed shape, specified in GraphProto message.</p></li>
</ul>
<section id="discovery">
<h3>Discovery<a class="headerlink" href="#discovery" title="Permalink to this headline">¶</a></h3>
<p>Vendor-provided libraries should adhere to some rules to ensure discovery by ONNX-supported frameworks and applications:</p>
<ol class="arabic simple">
<li><p>The libraries must be installed in the following directories:</p></li>
</ol>
<ul class="simple">
<li><p>GNU/Linux: user-installed system library directory (typically /usr/lib)</p></li>
<li><p>macOS: /opt/onnx/lib</p></li>
<li><p>Windows: system directory (typically C:\Windows\System32)</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Filenames of vendor-specific libraries must follow the rule below:</p></li>
</ol>
<ul class="simple">
<li><p>On Windows, library filename must match wildcard <code class="docutils literal notranslate"><span class="pre">onnxifi-*.dll</span></code></p></li>
<li><p>On macOS, library filename must match wildcard <code class="docutils literal notranslate"><span class="pre">libonnxifi-*.dylib</span></code></p></li>
<li><p>On Linux and other OSes, library filename must match wildcard <code class="docutils literal notranslate"><span class="pre">libonnxifi-*.so</span></code></p></li>
</ul>
</section>
<section id="extensions">
<h3>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h3>
<p>Hardware vendors are welcome to add their own extensions to ONNX backend interface. The backend interface offers several extension mechanisms:</p>
<ul class="simple">
<li><p>Experimental, exotic, or vendor-specific operators can be supported in a private domain using NodeProto.domain attribute.</p></li>
<li><p>Vendor-provided ONNXIFI implementation can expose additional functions.</p></li>
</ul>
</section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>