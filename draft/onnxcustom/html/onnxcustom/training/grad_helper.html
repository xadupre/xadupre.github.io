
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>module training.grad_helper &#8212; onnxcustom</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="module training.optimizers" href="optimizers.html" />
    <link rel="prev" title="module training.excs" href="excs.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../doc.html">
   Agility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_ex.html">
   Short examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_faq.html">
   FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_cmd.html">
   Command lines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HISTORY.html">
   History
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   onnxcustom: custom ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../all_indexes.html">
   All indexes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../all_report.html">
   Statistics on code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../filechanges.html">
   Changes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_class.html">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_function.html">
   Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_method.html">
   Methods
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index_module.html">
   Modules
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       __init__
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../__main__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       __main__
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cli/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       cli
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cli/profiling.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       cli.profiling
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../plotting/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       plotting
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../plotting/plotting_onnx.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       plotting.plotting_onnx
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_base.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_base_estimator.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base_estimator
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_base_onnx_function.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base_onnx_function
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data_loader.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.data_loader
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="excs.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.excs
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.grad_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="optimizers.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.optimizers
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="optimizers_partial.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.optimizers_partial
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ortgradient.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.ortgradient
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sgd_learning_loss.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_loss
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sgd_learning_penalty.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_penalty
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sgd_learning_rate.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_rate
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/benchmark.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.benchmark
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/doc_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.doc_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/imagenet_classes.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.imagenet_classes
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/nvprof2json.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.nvprof2json
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnx_function.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_function
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnx_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnx_rewriter.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_rewriter
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnxruntime_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnxruntime_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/orttraining_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.orttraining_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/print_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.print_helper
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_staticmethod.html">
   Static Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../blog/blogindex.html">
   Blog Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../license.html">
   License
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#short-summary">
   Short summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classes">
   Classes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-onnxcustom.training.grad_helper">
   Documentation
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="module-training-grad-helper">
<span id="f-gradhelper"></span><h1>module <code class="docutils literal notranslate"><span class="pre">training.grad_helper</span></code><a class="headerlink" href="#module-training-grad-helper" title="Permalink to this headline">¶</a></h1>
<div class="graphviz"><object data="../../_images/inheritance-320ebec18bae54784655c71f43b9ad305fa76499.svg" type="image/svg+xml" class="inheritance graphviz">
<p class="warning">Inheritance diagram of onnxcustom.training.grad_helper</p></object></div>
<section id="short-summary">
<h2>Short summary<a class="headerlink" href="#short-summary" title="Permalink to this headline">¶</a></h2>
<p>module <code class="docutils literal notranslate"><span class="pre">onnxcustom.training.grad_helper</span></code></p>
<p>ONNX and gradient.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/grad_helper.py#L6">source on GitHub</a></p>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<table class="table">
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>class</p></th>
<th class="head"><p>truncated documentation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.grad_helper.DerivativeOptions" title="onnxcustom.training.grad_helper.DerivativeOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">DerivativeOptions</span></code></a></p></td>
<td><p>Options defining how to build the onnx graph of the gradients.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<table class="table">
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>function</p></th>
<th class="head"><p>truncated documentation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.grad_helper._default_inputs" title="onnxcustom.training.grad_helper._default_inputs"><code class="xref py py-func docutils literal notranslate"><span class="pre">_default_inputs</span></code></a></p></td>
<td><p>Guesses default inputs (float ones) if not specified.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.training.grad_helper._onnx_derivative_fw" title="onnxcustom.training.grad_helper._onnx_derivative_fw"><code class="xref py py-func docutils literal notranslate"><span class="pre">_onnx_derivative_fw</span></code></a></p></td>
<td><p>Implements a gradient based on class <cite>OrtModuleGraphBuilder</cite>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.grad_helper._onnx_derivative_loss" title="onnxcustom.training.grad_helper._onnx_derivative_loss"><code class="xref py py-func docutils literal notranslate"><span class="pre">_onnx_derivative_loss</span></code></a></p></td>
<td><p>Implements a gradient based on class <cite>PyGradientGraphBuilder</cite>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.training.grad_helper.onnx_derivative" title="onnxcustom.training.grad_helper.onnx_derivative"><code class="xref py py-func docutils literal notranslate"><span class="pre">onnx_derivative</span></code></a></p></td>
<td><p>Builds the gradient for an onnx graph.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-onnxcustom.training.grad_helper">
<span id="documentation"></span><h2>Documentation<a class="headerlink" href="#module-onnxcustom.training.grad_helper" title="Permalink to this headline">¶</a></h2>
<p>ONNX and gradient.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/grad_helper.py#L6">source on GitHub</a></p>
<dl class="py class">
<dt class="sig sig-object py" id="onnxcustom.training.grad_helper.DerivativeOptions">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">onnxcustom.training.grad_helper.</span></span><span class="sig-name descname"><span class="pre">DerivativeOptions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.grad_helper.DerivativeOptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntFlag" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntFlag</span></code></a></p>
<p>Options defining how to build the onnx graph of the
gradients.</p>
<ul class="simple">
<li><p><cite>Zero</cite>: default option, all options are disabled</p></li>
<li><p><cite>KeepYieldOp</cite>: keeps the operator <em>YieldOp</em> in the graph,
see <a class="reference internal" href="#onnxcustom.training.grad_helper.onnx_derivative" title="onnxcustom.training.grad_helper.onnx_derivative"><code class="xref py py-func docutils literal notranslate"><span class="pre">onnx_derivative</span></code></a></p></li>
<li><p><cite>KeepOutputs</cite>: keeps the output of the original graph</p></li>
<li><p><cite>FillGrad</cite>: does not add any output to specify the gradient
of the output but assumes it is one</p></li>
<li><p><cite>Loss</cite>: the function assumes the loss was added to the graph</p></li>
</ul>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/grad_helper.py#L30">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.training.grad_helper._default_inputs">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.training.grad_helper.</span></span><span class="sig-name descname"><span class="pre">_default_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.grad_helper._default_inputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Guesses default inputs (float ones) if not specified.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.training.grad_helper._onnx_derivative_fw">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.training.grad_helper.</span></span><span class="sig-name descname"><span class="pre">_onnx_derivative_fw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.grad_helper._onnx_derivative_fw" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements a gradient based on class <cite>OrtModuleGraphBuilder</cite>.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/grad_helper.py#L194">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.training.grad_helper._onnx_derivative_loss">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.training.grad_helper.</span></span><span class="sig-name descname"><span class="pre">_onnx_derivative_loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.grad_helper._onnx_derivative_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements a gradient based on class <cite>PyGradientGraphBuilder</cite>.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/grad_helper.py#L300">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.training.grad_helper.onnx_derivative">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.training.grad_helper.</span></span><span class="sig-name descname"><span class="pre">onnx_derivative</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inputs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">DerivativeOptions.Zero</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.grad_helper.onnx_derivative" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds the gradient for an onnx graph.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>onx</strong> – onnx graph</p></li>
<li><p><strong>weights</strong> – gradient against those weights, None for all real weights</p></li>
<li><p><strong>inputs</strong> – gradient against inputs, None for all real inputs</p></li>
<li><p><strong>options</strong> – options of type <a class="reference internal" href="#onnxcustom.training.grad_helper.DerivativeOptions" title="onnxcustom.training.grad_helper.DerivativeOptions"><code class="xref py py-class docutils literal notranslate"><span class="pre">DerivativeOptions</span></code></a></p></li>
<li><p><strong>loss</strong> – loss output in case a loss was added in the graph,
<em>options</em> must be equal to <cite>DerivativeOptions.Loss</cite></p></li>
<li><p><strong>label</strong> – if <em>loss</em> is specified, then the label must be
specified as well</p></li>
<li><p><strong>path_name</strong> – if <em>options</em> equal to <cite>DerivativeOptions.Loss</cite>,
the gradient is saved to that path</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>onnx graph</p>
</dd>
</dl>
<p>The function calls <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/onnxmd/onnxruntime_python/training_partial.html#ortmodulegraphbuilderconfiguration">OrtModuleGraphBuilderConfiguration</a>
from <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/orttraining">onnxruntime-training</a>. This graph is meant to be used
with <a class="reference internal" href="ortgradient.html#onnxcustom.training.ortgradient.OrtGradientForwardBackward" title="onnxcustom.training.ortgradient.OrtGradientForwardBackward"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrtGradientForwardBackward</span></code></a> and includes
operator <cite>YieldOp</cite>. That’s the graph looks this way:</p>

    <div id="gdot-140034457276320-cont"><div id="gdot-140034457276320" style="width:100%;height:100%;"></div>
    <script>

    require(['../../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst [shape=box color=red label=\"Ad_Addcst\\nfloat((1,))\" fontsize=10];\n\n  X_grad [shape=box color=green label=\"X_grad\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst_grad [shape=box color=green label=\"Ad_Addcst_grad\\nfloat((1,))\" fontsize=10];\n\n\n  Y [shape=box label=\"Y\" fontsize=10];\n  Ad_Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Ad_Add)\" fontsize=10];\n  X -> Ad_Add;\n  Ad_Addcst -> Ad_Add;\n  Ad_Add -> Y;\n\n  Y_grad [shape=box label=\"Y_grad\" fontsize=10];\n  YieldOp [shape=box style=\"filled,rounded\" color=orange label=\"YieldOp\\n(YieldOp)\\nfull_shape_outputs=[0]\" fontsize=10];\n  Y -> YieldOp;\n  YieldOp -> Y_grad;\n\n  Ad_Add_Grad_Shape_Ad_Addcst [shape=box label=\"Ad_Add_Grad_Shape_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_Ad_Addcst_rhs)\" fontsize=10];\n  Ad_Addcst -> Ad_Add_Grad_Shape_Ad_Addcst_rhs;\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs -> Ad_Add_Grad_Shape_Ad_Addcst;\n\n  Ad_Add_Grad_Shape_X [shape=box label=\"Ad_Add_Grad_Shape_X\" fontsize=10];\n  Ad_Add_Grad_Shape_X_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_X_lhs)\" fontsize=10];\n  X -> Ad_Add_Grad_Shape_X_lhs;\n  Ad_Add_Grad_Shape_X_lhs -> Ad_Add_Grad_Shape_X;\n\n  Ad_Add_Grad_ReduceAxes_X [shape=box label=\"Ad_Add_Grad_ReduceAxes_X\" fontsize=10];\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceAxes_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\\n(Ad_Add_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_X;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_Ad_Addcst;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_5)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceSum_5 -> Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst;\n\n  Ad_Add_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_6)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Reshape_6 -> Ad_Addcst_grad;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_X\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_3)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceAxes_X -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceSum_3 -> Ad_Add_Grad_ReduceSum_Y_grad_for_X;\n\n  Ad_Add_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_4)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Reshape_4 -> X_grad;\n}\n");
    document.getElementById('gdot-140034457276320').innerHTML = svgGraph; });
    
</script>
</div><p>These operators are the outputs of the
initial graph and must be replaced by the gradient of these
outputs to compute the gradient of the weights and the inputs.
After they are replaced, it looks this way:</p>

    <div id="gdot-140034457275312-cont"><div id="gdot-140034457275312" style="width:100%;height:100%;"></div>
    <script>

    require(['../../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst [shape=box color=red label=\"Ad_Addcst\\nfloat((1,))\" fontsize=10];\n  Y_grad [shape=box color=red label=\"Y_grad\\nfloat((0, 10))\" fontsize=10];\n\n  X_grad [shape=box color=green label=\"X_grad\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst_grad [shape=box color=green label=\"Ad_Addcst_grad\\nfloat((1,))\" fontsize=10];\n\n\n  Ad_Add_Grad_Shape_Ad_Addcst [shape=box label=\"Ad_Add_Grad_Shape_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_Ad_Addcst_rhs)\" fontsize=10];\n  Ad_Addcst -> Ad_Add_Grad_Shape_Ad_Addcst_rhs;\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs -> Ad_Add_Grad_Shape_Ad_Addcst;\n\n  Ad_Add_Grad_Shape_X [shape=box label=\"Ad_Add_Grad_Shape_X\" fontsize=10];\n  Ad_Add_Grad_Shape_X_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_X_lhs)\" fontsize=10];\n  X -> Ad_Add_Grad_Shape_X_lhs;\n  Ad_Add_Grad_Shape_X_lhs -> Ad_Add_Grad_Shape_X;\n\n  Ad_Add_Grad_ReduceAxes_X [shape=box label=\"Ad_Add_Grad_ReduceAxes_X\" fontsize=10];\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceAxes_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\\n(Ad_Add_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_X;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_Ad_Addcst;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_5)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceSum_5 -> Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst;\n\n  Ad_Add_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_6)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Reshape_6 -> Ad_Addcst_grad;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_X\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_3)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceAxes_X -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceSum_3 -> Ad_Add_Grad_ReduceSum_Y_grad_for_X;\n\n  Ad_Add_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_4)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Reshape_4 -> X_grad;\n}\n");
    document.getElementById('gdot-140034457275312').innerHTML = svgGraph; });
    
</script>
</div><p>The user can still compute the outputs.</p>

    <div id="gdot-140034457275840-cont"><div id="gdot-140034457275840" style="width:100%;height:100%;"></div>
    <script>

    require(['../../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst [shape=box color=red label=\"Ad_Addcst\\nfloat((1,))\" fontsize=10];\n  Y_grad [shape=box color=red label=\"Y_grad\\nfloat((0, 10))\" fontsize=10];\n\n  X_grad [shape=box color=green label=\"X_grad\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst_grad [shape=box color=green label=\"Ad_Addcst_grad\\nfloat((1,))\" fontsize=10];\n  Y [shape=box color=green label=\"Y\\nfloat((0, 10))\" fontsize=10];\n\n\n  Ad_Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Ad_Add)\" fontsize=10];\n  X -> Ad_Add;\n  Ad_Addcst -> Ad_Add;\n  Ad_Add -> Y;\n\n  Ad_Add_Grad_Shape_Ad_Addcst [shape=box label=\"Ad_Add_Grad_Shape_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_Ad_Addcst_rhs)\" fontsize=10];\n  Ad_Addcst -> Ad_Add_Grad_Shape_Ad_Addcst_rhs;\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs -> Ad_Add_Grad_Shape_Ad_Addcst;\n\n  Ad_Add_Grad_Shape_X [shape=box label=\"Ad_Add_Grad_Shape_X\" fontsize=10];\n  Ad_Add_Grad_Shape_X_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_X_lhs)\" fontsize=10];\n  X -> Ad_Add_Grad_Shape_X_lhs;\n  Ad_Add_Grad_Shape_X_lhs -> Ad_Add_Grad_Shape_X;\n\n  Ad_Add_Grad_ReduceAxes_X [shape=box label=\"Ad_Add_Grad_ReduceAxes_X\" fontsize=10];\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceAxes_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\\n(Ad_Add_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_X;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_Ad_Addcst;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_5)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceSum_5 -> Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst;\n\n  Ad_Add_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_6)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Reshape_6 -> Ad_Addcst_grad;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_X\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_3)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceAxes_X -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceSum_3 -> Ad_Add_Grad_ReduceSum_Y_grad_for_X;\n\n  Ad_Add_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_4)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Reshape_4 -> X_grad;\n}\n");
    document.getElementById('gdot-140034457275840').innerHTML = svgGraph; });
    
</script>
</div><p>The input gradient can be filled with a constant matrix
filled with one and with the expected shape.</p>

    <div id="gdot-140034457276368-cont"><div id="gdot-140034457276368" style="width:100%;height:100%;"></div>
    <script>

    require(['../../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst [shape=box color=red label=\"Ad_Addcst\\nfloat((1,))\" fontsize=10];\n\n  X_grad [shape=box color=green label=\"X_grad\\nfloat((0, 10))\" fontsize=10];\n  Ad_Addcst_grad [shape=box color=green label=\"Ad_Addcst_grad\\nfloat((1,))\" fontsize=10];\n  Y [shape=box color=green label=\"Y\\nfloat((0, 10))\" fontsize=10];\n\n\n  Ad_Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Ad_Add)\" fontsize=10];\n  X -> Ad_Add;\n  Ad_Addcst -> Ad_Add;\n  Ad_Add -> Y;\n\n  Ad_Add_Grad_Shape_Ad_Addcst [shape=box label=\"Ad_Add_Grad_Shape_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_Ad_Addcst_rhs)\" fontsize=10];\n  Ad_Addcst -> Ad_Add_Grad_Shape_Ad_Addcst_rhs;\n  Ad_Add_Grad_Shape_Ad_Addcst_rhs -> Ad_Add_Grad_Shape_Ad_Addcst;\n\n  Ad_Add_Grad_Shape_X [shape=box label=\"Ad_Add_Grad_Shape_X\" fontsize=10];\n  Ad_Add_Grad_Shape_X_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Ad_Add_Grad_Shape_X_lhs)\" fontsize=10];\n  X -> Ad_Add_Grad_Shape_X_lhs;\n  Ad_Add_Grad_Shape_X_lhs -> Ad_Add_Grad_Shape_X;\n\n  Ad_Add_Grad_ReduceAxes_X [shape=box label=\"Ad_Add_Grad_ReduceAxes_X\" fontsize=10];\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceAxes_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\\n(Ad_Add_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_BroadcastGradientArgs_2;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_X;\n  Ad_Add_Grad_BroadcastGradientArgs_2 -> Ad_Add_Grad_ReduceAxes_Ad_Addcst;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_5)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceAxes_Ad_Addcst -> Ad_Add_Grad_ReduceSum_5;\n  Ad_Add_Grad_ReduceSum_5 -> Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst;\n\n  Ad_Add_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_6)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Shape_Ad_Addcst -> Ad_Add_Grad_Reshape_6;\n  Ad_Add_Grad_Reshape_6 -> Ad_Addcst_grad;\n\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X [shape=box label=\"Ad_Add_Grad_ReduceSum_Y_grad_for_X\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(Ad_Add_Grad_ReduceSum_3)\\nkeepdims=1\\nnoop_with_empty_axes=1\" fontsize=10];\n  Y_grad -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceAxes_X -> Ad_Add_Grad_ReduceSum_3;\n  Ad_Add_Grad_ReduceSum_3 -> Ad_Add_Grad_ReduceSum_Y_grad_for_X;\n\n  Ad_Add_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Ad_Add_Grad_Reshape_4)\\nallowzero=0\" fontsize=10];\n  Ad_Add_Grad_ReduceSum_Y_grad_for_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Shape_X -> Ad_Add_Grad_Reshape_4;\n  Ad_Add_Grad_Reshape_4 -> X_grad;\n\n  Y_shape [shape=box label=\"Y_shape\" fontsize=10];\n  Shape [shape=box style=\"filled,rounded\" color=orange label=\"Shape\\n(Shape)\" fontsize=10];\n  Y -> Shape;\n  Shape -> Y_shape;\n\n  Y_grad [shape=box label=\"Y_grad\" fontsize=10];\n  ConstantOfShape [shape=box style=\"filled,rounded\" color=orange label=\"ConstantOfShape\\n(ConstantOfShape)\\nvalue=[1.]\" fontsize=10];\n  Y_shape -> ConstantOfShape;\n  ConstantOfShape -> Y_grad;\n}\n");
    document.getElementById('gdot-140034457276368').innerHTML = svgGraph; });
    
</script>
</div><p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/grad_helper.py#L160">source on GitHub</a></p>
</dd></dl>

</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="excs.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">module <code class="docutils literal notranslate"><span class="pre">training.excs</span></code></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="optimizers.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">module <code class="docutils literal notranslate"><span class="pre">training.optimizers</span></code></p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>