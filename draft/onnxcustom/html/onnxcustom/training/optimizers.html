
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>module training.optimizers &#8212; onnxcustom</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="module training.optimizers_partial" href="optimizers_partial.html" />
    <link rel="prev" title="module training.grad_helper" href="grad_helper.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../doc.html">
   Agility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_ex.html">
   Short examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_faq.html">
   FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_cmd.html">
   Command lines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HISTORY.html">
   History
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   onnxcustom: custom ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../all_indexes.html">
   All indexes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../all_report.html">
   Statistics on code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../filechanges.html">
   Changes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_class.html">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_function.html">
   Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_method.html">
   Methods
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index_module.html">
   Modules
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       __init__
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../__main__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       __main__
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cli/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       cli
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cli/profiling.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       cli.profiling
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../plotting/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       plotting
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../plotting/plotting_onnx.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       plotting.plotting_onnx
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_base.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_base_estimator.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base_estimator
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="_base_onnx_function.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base_onnx_function
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data_loader.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.data_loader
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="excs.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.excs
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="grad_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.grad_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.optimizers
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="optimizers_partial.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.optimizers_partial
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ortgradient.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.ortgradient
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sgd_learning_loss.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_loss
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sgd_learning_penalty.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_penalty
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sgd_learning_rate.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_rate
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/benchmark.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.benchmark
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/doc_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.doc_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/imagenet_classes.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.imagenet_classes
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/nvprof2json.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.nvprof2json
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnx_function.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_function
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnx_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnx_rewriter.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_rewriter
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/onnxruntime_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnxruntime_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/orttraining_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.orttraining_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../utils/print_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.print_helper
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_staticmethod.html">
   Static Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../blog/blogindex.html">
   Blog Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../license.html">
   License
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#short-summary">
   Short summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classes">
   Classes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#methods">
   Methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-onnxcustom.training.optimizers">
   Documentation
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="module-training-optimizers">
<span id="f-optimizers"></span><h1>module <code class="docutils literal notranslate"><span class="pre">training.optimizers</span></code><a class="headerlink" href="#module-training-optimizers" title="Permalink to this headline">¶</a></h1>
<div class="graphviz"><object data="../../_images/inheritance-2418caf6f20bcdc26f1a8aec9c9fe1ccfba9c94e.svg" type="image/svg+xml" class="inheritance graphviz">
<p class="warning">Inheritance diagram of onnxcustom.training.optimizers</p></object></div>
<section id="short-summary">
<h2>Short summary<a class="headerlink" href="#short-summary" title="Permalink to this headline">¶</a></h2>
<p>module <code class="docutils literal notranslate"><span class="pre">onnxcustom.training.optimizers</span></code></p>
<p>Optimizer with <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/orttraining">onnxruntime-training</a>.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L5">source on GitHub</a></p>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<table class="table">
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>class</p></th>
<th class="head"><p>truncated documentation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer" title="onnxcustom.training.optimizers.OrtGradientOptimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrtGradientOptimizer</span></code></a></p></td>
<td><p>Implements a simple <a class="reference external" href="https://en.wikipedia.org/wiki/Stochastic_gradient_descent">Stochastic Gradient Descent</a> with <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/orttraining">onnxruntime-training</a>.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<table class="table">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>method</p></th>
<th class="head"><p>truncated documentation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.__init__" title="onnxcustom.training.optimizers.OrtGradientOptimizer.__init__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._bind_input_ortvalue" title="onnxcustom.training.optimizers.OrtGradientOptimizer._bind_input_ortvalue"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_bind_input_ortvalue</span></code></a></p></td>
<td><p>Binds <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/onnxmd/onnxruntime_python/ortvalue.html#c-class-ortvaluevector">C_OrtValue</a> to the structure used by <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/onnxmd/onnxruntime_python/inference.html#python-wrapper-for-inferencesession">InferenceSession</a> to run inference.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._create_training_session" title="onnxcustom.training.optimizers.OrtGradientOptimizer._create_training_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_create_training_session</span></code></a></p></td>
<td><p>Creates an instance of <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/api/onnxruntime_python/training.html#onnxruntime.TrainingSession">TrainingSession</a>.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._evaluation" title="onnxcustom.training.optimizers.OrtGradientOptimizer._evaluation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_evaluation</span></code></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._iteration" title="onnxcustom.training.optimizers.OrtGradientOptimizer._iteration"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_iteration</span></code></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.fit" title="onnxcustom.training.optimizers.OrtGradientOptimizer.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fit</span></code></a></p></td>
<td><p>Trains the model.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.get_state" title="onnxcustom.training.optimizers.OrtGradientOptimizer.get_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_state</span></code></a></p></td>
<td><p>Returns the trained weights.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.get_trained_onnx" title="onnxcustom.training.optimizers.OrtGradientOptimizer.get_trained_onnx"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_trained_onnx</span></code></a></p></td>
<td><p>Returns the trained onnx graph, the initial graph modified by replacing the initializers with the trained …</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.set_state" title="onnxcustom.training.optimizers.OrtGradientOptimizer.set_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_state</span></code></a></p></td>
<td><p>Changes the trained weights.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-onnxcustom.training.optimizers">
<span id="documentation"></span><h2>Documentation<a class="headerlink" href="#module-onnxcustom.training.optimizers" title="Permalink to this headline">¶</a></h2>
<p>Optimizer with <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/orttraining">onnxruntime-training</a>.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L5">source on GitHub</a></p>
<dl class="py class">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">onnxcustom.training.optimizers.</span></span><span class="sig-name descname"><span class="pre">OrtGradientOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_onnx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights_to_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_output_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'loss'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training_optimizer_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SGDOptimizer'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SGD'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warm_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_every</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saved_gradient</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_weight_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weight'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="_base_estimator.html#onnxcustom.training._base_estimator.BaseEstimator" title="onnxcustom.training._base_estimator.BaseEstimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">onnxcustom.training._base_estimator.BaseEstimator</span></code></a></p>
<p>Implements a simple <a class="reference external" href="https://en.wikipedia.org/wiki/Stochastic_gradient_descent">Stochastic Gradient Descent</a>
with <a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/orttraining">onnxruntime-training</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_onnx</strong> – onnx graph to train</p></li>
<li><p><strong>weights_to_train</strong> – names of initializers to be optimized</p></li>
<li><p><strong>loss_output_name</strong> – name of the loss output</p></li>
<li><p><strong>max_iter</strong> – number of training iterations</p></li>
<li><p><strong>training_optimizer_name</strong> – optimizing algorithm</p></li>
<li><p><strong>batch_size</strong> – batch size (see class <em>DataLoader</em>)</p></li>
<li><p><strong>learning_rate</strong> – a name or a learning rate instance or a float,
see module <a class="reference internal" href="sgd_learning_rate.html#module-onnxcustom.training.sgd_learning_rate" title="onnxcustom.training.sgd_learning_rate"><code class="xref py py-mod docutils literal notranslate"><span class="pre">onnxcustom.training.sgd_learning_rate</span></code></a></p></li>
<li><p><strong>device</strong> – device as <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/api/onnxruntime_python/helpers.html#c-class-ortdevice">C_OrtDevice</a> or a string
representing this device</p></li>
<li><p><strong>warm_start</strong> – when set to True, reuse the solution of the previous
call to fit as initialization, otherwise, just erase the previous
solution.</p></li>
<li><p><strong>verbose</strong> – use <a class="reference external" href="https://github.com/tqdm/tqdm">tqdm</a> to display the training progress</p></li>
<li><p><strong>validation_every</strong> – validation with a test set every
<em>validation_every</em> iterations</p></li>
<li><p><strong>saved_gradient</strong> – if not None, a filename,
the optimizer saves the gradient into it</p></li>
<li><p><strong>sample_weight_name</strong> – name of the sample weight input</p></li>
</ul>
</dd>
</dl>
<p>Once initialized, the class creates the attribute
<cite>train_session_</cite> which holds an instance of <a class="reference internal" href="../../api/onnxruntime_python/training.html#l-ort-training-session"><span class="std std-ref">Python Wrapper for TrainingSession</span></a>.</p>
<p>See example <a class="reference internal" href="../../gyexamples/plot_orttraining_nn_gpu.html#l-orttraining-nn-gpu"><span class="std std-ref">Train a scikit-learn neural network with onnxruntime-training on GPU</span></a>.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L46">source on GitHub</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_onnx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights_to_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_output_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'loss'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training_optimizer_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SGDOptimizer'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SGD'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warm_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_every</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saved_gradient</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_weight_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weight'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.__init__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer._bind_input_ortvalue">
<span class="sig-name descname"><span class="pre">_bind_input_ortvalue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_ortvalue</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._bind_input_ortvalue" title="Permalink to this definition">¶</a></dt>
<dd><p>Binds <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/onnxmd/onnxruntime_python/ortvalue.html#c-class-ortvaluevector">C_OrtValue</a> to the structure used by
<a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/onnxmd/onnxruntime_python/inference.html#python-wrapper-for-inferencesession">InferenceSession</a> to run inference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – str</p></li>
<li><p><strong>bind</strong> – python structure</p></li>
<li><p><strong>c_ortvalue</strong> – C structure for OrtValue (<a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/onnxmd/onnxruntime_python/ortvalue.html#c-class-ortvaluevector">C_OrtValue</a>),
it can be also a numpy array</p></li>
</ul>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L168">source on GitHub</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer._create_training_session">
<span class="sig-name descname"><span class="pre">_create_training_session</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">training_onnx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights_to_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_output_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'loss'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">training_optimizer_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SGDOptimizer'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._create_training_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an instance of <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/api/onnxruntime_python/training.html#onnxruntime.TrainingSession">TrainingSession</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>training_onnx</strong> – an ONNX graph with a loss function</p></li>
<li><p><strong>weights_to_train</strong> – list of initializer names to optimize</p></li>
<li><p><strong>loss_output_name</strong> – output name for the loss</p></li>
<li><p><strong>training_optimizer_name</strong> – optimizer name</p></li>
<li><p><strong>device</strong> – one <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/api/onnxruntime_python/helpers.html#c-class-ortdevice">C_OrtDevice</a> or a string</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>an instance of <a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/api/onnxruntime_python/training.html#onnxruntime.TrainingSession">TrainingSession</a></p>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L280">source on GitHub</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer._evaluation">
<span class="sig-name descname"><span class="pre">_evaluation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._evaluation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer._iteration">
<span class="sig-name descname"><span class="pre">_iteration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ort_lr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_numpy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_weight</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer._iteration" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_val</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_val</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_numpy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Trains the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> – features</p></li>
<li><p><strong>y</strong> – expected output</p></li>
<li><p><strong>sample_weight</strong> – sample weight if any</p></li>
<li><p><strong>X_val</strong> – evaluation dataset</p></li>
<li><p><strong>y_val</strong> – evaluation dataset</p></li>
<li><p><strong>use_numpy</strong> – if True, slow iterator using numpy,
otherwise, minimizes copy</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>self</p>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L87">source on GitHub</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer.get_state">
<span class="sig-name descname"><span class="pre">get_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.get_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the trained weights.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L331">source on GitHub</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer.get_trained_onnx">
<span class="sig-name descname"><span class="pre">get_trained_onnx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.get_trained_onnx" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the trained onnx graph, the initial graph
modified by replacing the initializers with the trained
weights. If model is not specified, it uses the model
given as an argument to this class. This graph outputs
the loss and not the predictions. Parameter <em>model</em>
can be used to use the graph before loss was added
and then the returned graph will produce the predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>model</strong> – replace the weights in another graph
than the training graph</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>onnx graph</p>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L351">source on GitHub</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="onnxcustom.training.optimizers.OrtGradientOptimizer.set_state">
<span class="sig-name descname"><span class="pre">set_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.training.optimizers.OrtGradientOptimizer.set_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the trained weights.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/training/optimizers.py#L357">source on GitHub</a></p>
</dd></dl>

</dd></dl>

</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="grad_helper.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">module <code class="docutils literal notranslate"><span class="pre">training.grad_helper</span></code></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="optimizers_partial.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">module <code class="docutils literal notranslate"><span class="pre">training.optimizers_partial</span></code></p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>