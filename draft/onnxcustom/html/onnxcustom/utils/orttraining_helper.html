
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>module utils.orttraining_helper &#8212; onnxcustom</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="module utils.print_helper" href="print_helper.html" />
    <link rel="prev" title="module utils.onnxruntime_helper" href="onnxruntime_helper.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../doc.html">
   Agility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_ex.html">
   Short examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_faq.html">
   FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../i_cmd.html">
   Command lines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HISTORY.html">
   History
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   onnxcustom: custom ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../all_indexes.html">
   All indexes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../all_report.html">
   Statistics on code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../filechanges.html">
   Changes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_class.html">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_function.html">
   Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_method.html">
   Methods
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../index_module.html">
   Modules
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       __init__
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../__main__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       __main__
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cli/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       cli
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cli/profiling.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       cli.profiling
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../plotting/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       plotting
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../plotting/plotting_onnx.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       plotting.plotting_onnx
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/_base.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/_base_estimator.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base_estimator
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/_base_onnx_function.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training._base_onnx_function
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/data_loader.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.data_loader
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/excs.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.excs
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/grad_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.grad_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/optimizers.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.optimizers
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/optimizers_partial.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.optimizers_partial
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/ortgradient.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.ortgradient
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/sgd_learning_loss.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_loss
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/sgd_learning_penalty.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_penalty
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../training/sgd_learning_rate.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       training.sgd_learning_rate
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="__init__.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="benchmark.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.benchmark
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="doc_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.doc_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="imagenet_classes.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.imagenet_classes
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="nvprof2json.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.nvprof2json
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_function.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_function
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnx_rewriter.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnx_rewriter
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="onnxruntime_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.onnxruntime_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.orttraining_helper
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="print_helper.html">
     module
     <code class="docutils literal notranslate">
      <span class="pre">
       utils.print_helper
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../index_staticmethod.html">
   Static Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../blog/blogindex.html">
   Blog Gallery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../license.html">
   License
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#short-summary">
   Short summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-onnxcustom.utils.orttraining_helper">
   Documentation
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="module-utils-orttraining-helper">
<span id="f-orttraininghelper"></span><h1>module <code class="docutils literal notranslate"><span class="pre">utils.orttraining_helper</span></code><a class="headerlink" href="#module-utils-orttraining-helper" title="Permalink to this headline">¶</a></h1>
<section id="short-summary">
<h2>Short summary<a class="headerlink" href="#short-summary" title="Permalink to this headline">¶</a></h2>
<p>module <code class="docutils literal notranslate"><span class="pre">onnxcustom.utils.orttraining_helper</span></code></p>
<p>ONNX manipulations to help build ONNX gradient graphs.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L6">source on GitHub</a></p>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<table class="table">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>function</p></th>
<th class="head"><p>truncated documentation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper._loss_elastic" title="onnxcustom.utils.orttraining_helper._loss_elastic"><code class="xref py py-func docutils literal notranslate"><span class="pre">_loss_elastic</span></code></a></p></td>
<td><p>Implements mixture of losses l1 and l2.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper._loss_l1" title="onnxcustom.utils.orttraining_helper._loss_l1"><code class="xref py py-func docutils literal notranslate"><span class="pre">_loss_l1</span></code></a></p></td>
<td><p>Implements loss l1.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper._loss_l2" title="onnxcustom.utils.orttraining_helper._loss_l2"><code class="xref py py-func docutils literal notranslate"><span class="pre">_loss_l2</span></code></a></p></td>
<td><p>Implements loss l2.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper._loss_log" title="onnxcustom.utils.orttraining_helper._loss_log"><code class="xref py py-func docutils literal notranslate"><span class="pre">_loss_log</span></code></a></p></td>
<td><p>This only works for a binary classification. The log loss is <cite>‘log(yt, yp) = (1-yt)log(1-yp) - ytlog(yp)</cite>, this …</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper._rewrite_op_no_grad" title="onnxcustom.utils.orttraining_helper._rewrite_op_no_grad"><code class="xref py py-func docutils literal notranslate"><span class="pre">_rewrite_op_no_grad</span></code></a></p></td>
<td><p>Rewrites operators with no gradient.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper._unique_name" title="onnxcustom.utils.orttraining_helper._unique_name"><code class="xref py py-func docutils literal notranslate"><span class="pre">_unique_name</span></code></a></p></td>
<td><p>Returns a name different from any name in <em>existing_names</em>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper.add_loss_output" title="onnxcustom.utils.orttraining_helper.add_loss_output"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_loss_output</span></code></a></p></td>
<td><p>Modifies an ONNX graph to add operators to score and allow training.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper.get_train_initializer" title="onnxcustom.utils.orttraining_helper.get_train_initializer"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_train_initializer</span></code></a></p></td>
<td><p>Returns the list of initializers to train.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#onnxcustom.utils.orttraining_helper.penalty_loss_onnx" title="onnxcustom.utils.orttraining_helper.penalty_loss_onnx"><code class="xref py py-func docutils literal notranslate"><span class="pre">penalty_loss_onnx</span></code></a></p></td>
<td><p>Returns onnx nodes to compute <img class="math" src="../../_images/math/91b038be4528c1c617558f77187f9fe2db22285b.svg" alt="|w| \alpha + w^2 \beta"/> where <img class="math" src="../../_images/math/56aa65e1112c70186c7f2d4d5acd0c38fc35eadb.svg" alt="\alpha=l1"/> and <img class="math" src="../../_images/math/ea00a1aa5063be99782362e40783db39e3b9b0c5.svg" alt="\beta=l2"/>.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-onnxcustom.utils.orttraining_helper">
<span id="documentation"></span><h2>Documentation<a class="headerlink" href="#module-onnxcustom.utils.orttraining_helper" title="Permalink to this headline">¶</a></h2>
<p>ONNX manipulations to help build ONNX gradient graphs.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L6">source on GitHub</a></p>
<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper._loss_elastic">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">_loss_elastic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">existing_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elem</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper._loss_elastic" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements mixture of losses l1 and l2.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L96">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper._loss_l1">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">_loss_l1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">existing_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elem</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper._loss_l1" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements loss l1.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L41">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper._loss_l2">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">_loss_l2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">existing_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elem</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper._loss_l2" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements loss l2.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L68">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper._loss_log">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">_loss_log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">existing_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elem</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper._loss_log" title="Permalink to this definition">¶</a></dt>
<dd><p>This only works for a binary classification.
The log loss is <cite>‘log(yt, yp) = (1-yt)log(1-yp) - ytlog(yp)</cite>,
this only works for a binary classification where <em>yp</em> is the
predicted probability, <em>yt</em> is the expected probability.
<em>yt</em> is expected to be binary, <em>yp</em> is a matrix with two
columns, the sum on every line is 1.
Parameter <em>eps</em> is used to avoid computing <em>log(0)</em>.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L148">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper._rewrite_op_no_grad">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">_rewrite_op_no_grad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper._rewrite_op_no_grad" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites operators with no gradient.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L313">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper._unique_name">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">_unique_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">existing_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper._unique_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a name different from any name in <em>existing_names</em>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>existing_names</strong> – set of names</p></li>
<li><p><strong>name</strong> – current</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>unique name</p>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L23">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper.add_loss_output">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">add_loss_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'squared_error'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'loss'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'label'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">penalty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper.add_loss_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Modifies an ONNX graph to add operators to score and allow training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>onx</strong> – onx graph</p></li>
<li><p><strong>score_name</strong> – name of the score</p></li>
<li><p><strong>loss_name</strong> – name of the output loss</p></li>
<li><p><strong>label_name</strong> – name of the label input</p></li>
<li><p><strong>weight_name</strong> – None or any value to consider weight
while computing loss</p></li>
<li><p><strong>penalty</strong> – dictionary similar to the
following one <cite>{ weight_name: {‘l1’: alpha, ‘l2’: beta} }</cite>
or <cite>{ weight_name: beta}</cite>,
it adds a L1 and/or L2 penalty to one input or initializer,
penalty = <img class="math" src="../../_images/math/91b038be4528c1c617558f77187f9fe2db22285b.svg" alt="|w| \alpha + w^2 \beta"/></p></li>
<li><p><strong>output_index</strong> – the output used to compute the loss,
if None, the function assumes there is only one output,
it must be specified if there are more than 1,
it can be an integer or a string (output name)</p></li>
<li><p><strong>kwargs</strong> – additional arguments for losses (see below)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>modified graph</p>
</dd>
</dl>
<p>Possible values for <em>score_name</em>:</p>
<ul class="simple">
<li><p><cite>‘squared_error’</cite> or <cite>‘l2</cite>’: <img class="math" src="../../_images/math/3ce503ccebd25e39c9192ac6835fea7887c2ae40.svg" alt="\sum_i{(f(x_i)-y_i)^2}"/> or
<img class="math" src="../../_images/math/3b9953c61bcaec5083dba602c1d11bb2cc324211.svg" alt="\sum_i{w_i (f(x_i)-y_i)^2}"/> if <em>weight_name</em>
is not None</p></li>
<li><p><cite>‘absolute_error’</cite> or <cite>‘l1</cite>’: <img class="math" src="../../_images/math/76a9ba0ec201283f6e206c9fadcbb3a8f69c5d68.svg" alt="\sum_i{|f(x_i)-y_i|}"/> or
<img class="math" src="../../_images/math/f985941b12650ddc1b68894ebadb6ac56b43feb1.svg" alt="\sum_i{w_i |f(x_i)-y_i|}"/> if <em>weight_name</em>
is not None</p></li>
<li><p><cite>‘elastic’</cite>: mixture of losses, kwargs must define
<em>l1_weight</em> and <em>l2_weight</em>, undefined, default value are 0.5</p></li>
<li><dl class="simple">
<dt><cite>‘log(yt, yp)’</cite>: log loss <img class="math" src="../../_images/math/2223d6c8a8961fd153c54d09af7c0f2358ffb258.svg" alt="(1-yt)\log(1-yp) - yt\log(yp)"/>,</dt><dd><p>this only works for a binary classification where <em>yp</em> is the
predicted probability, <em>yt</em> is the expected probability.
<em>yt</em> is expected to be binary, <em>yp</em> is a matrix with two
columns, the sum on every line is 1.</p>
</dd>
</dl>
</li>
</ul>
<p>See example <a class="reference internal" href="../../gyexamples/plot_orttraining_nn_gpu.html#l-orttraining-nn-gpu"><span class="std std-ref">Train a scikit-learn neural network with onnxruntime-training on GPU</span></a>.
Next example shows the loss with L1 and L2 loss.</p>

    <div id="gdot-140034594397632-cont"><div id="gdot-140034594397632" style="width:100%;height:100%;"></div>
    <script>

    require(['../../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 10))\" fontsize=10];\n  label [shape=box color=red label=\"label\\nfloat((0, 1))\" fontsize=10];\n  weight [shape=box color=red label=\"weight\\nfloat((0,))\" fontsize=10];\n\n  loss [shape=box color=green label=\"loss\\nfloat((1, 1))\" fontsize=10];\n  variable [shape=box color=green label=\"variable\\nfloat((0, 1))\" fontsize=10];\n\n  coef [shape=box label=\"coef\\nfloat32((10, 1))\\n[[77.475]\\n [ 1.425]\\n [34.21 ]\\n [61.477]\\n [82.19 ]\\n...\" fontsize=10];\n  intercept [shape=box label=\"intercept\\nfloat32((1,))\\n[2.]\" fontsize=10];\n  shape_tensor [shape=box label=\"shape_tensor\\nint64((2,))\\n[-1  1]\" fontsize=10];\n  l1_name [shape=box label=\"l1_name\\nfloat32((1,))\\n[0.1]\" fontsize=10];\n  l2_name [shape=box label=\"l2_name\\nfloat32((1,))\\n[0.9]\" fontsize=10];\n\n  multiplied [shape=box label=\"multiplied\" fontsize=10];\n  MatMul [shape=box style=\"filled,rounded\" color=orange label=\"MatMul\\n(MatMul)\" fontsize=10];\n  X -> MatMul;\n  coef -> MatMul;\n  MatMul -> multiplied;\n\n  resh [shape=box label=\"resh\" fontsize=10];\n  Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add)\" fontsize=10];\n  multiplied -> Add;\n  intercept -> Add;\n  Add -> resh;\n\n  Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape)\" fontsize=10];\n  resh -> Reshape;\n  shape_tensor -> Reshape;\n  Reshape -> variable;\n\n  loss_diff [shape=box label=\"loss_diff\" fontsize=10];\n  Sub [shape=box style=\"filled,rounded\" color=orange label=\"Sub\\n(Sub)\" fontsize=10];\n  variable -> Sub;\n  label -> Sub;\n  Sub -> loss_diff;\n\n  loss_l2 [shape=box label=\"loss_l2\" fontsize=10];\n  Mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul)\" fontsize=10];\n  loss_diff -> Mul;\n  loss_diff -> Mul;\n  Mul -> loss_l2;\n\n  loss_l1 [shape=box label=\"loss_l1\" fontsize=10];\n  Abs [shape=box style=\"filled,rounded\" color=orange label=\"Abs\\n(Abs)\" fontsize=10];\n  loss_diff -> Abs;\n  Abs -> loss_l1;\n\n  loss_l1_2 [shape=box label=\"loss_l1_2\" fontsize=10];\n  Mul1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul1)\" fontsize=10];\n  loss_l1 -> Mul1;\n  l1_name -> Mul1;\n  Mul1 -> loss_l1_2;\n\n  loss_l2_2 [shape=box label=\"loss_l2_2\" fontsize=10];\n  Mul12 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul12)\" fontsize=10];\n  loss_l2 -> Mul12;\n  l2_name -> Mul12;\n  Mul12 -> loss_l2_2;\n\n  final_loss [shape=box label=\"final_loss\" fontsize=10];\n  Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add)\" fontsize=10];\n  loss_l1_2 -> Add;\n  loss_l2_2 -> Add;\n  Add -> final_loss;\n\n  loss_diff_weight [shape=box label=\"loss_diff_weight\" fontsize=10];\n  Mul123 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul123)\" fontsize=10];\n  final_loss -> Mul123;\n  weight -> Mul123;\n  Mul123 -> loss_diff_weight;\n\n  ReduceSum [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(ReduceSum)\" fontsize=10];\n  loss_diff_weight -> ReduceSum;\n  ReduceSum -> loss;\n}\n");
    document.getElementById('gdot-140034594397632').innerHTML = svgGraph; });
    
</script>
</div><p>Next example shows how to add a L2 loss with L1 and L2 penalties
on the coefficients.</p>

    <div id="gdot-140034595129520-cont"><div id="gdot-140034595129520" style="width:100%;height:100%;"></div>
    <script>

    require(['../../_static/viz.js'], function() { var svgGraph = Viz(" digraph{\n  size=7;\n  orientation=portrait;\n  nodesep=0.05;\n  ranksep=0.25;\n\n  X [shape=box color=red label=\"X\\nfloat((0, 10))\" fontsize=10];\n  label [shape=box color=red label=\"label\\nfloat((0, 1))\" fontsize=10];\n  weight [shape=box color=red label=\"weight\\nfloat((0,))\" fontsize=10];\n\n  loss [shape=box color=green label=\"loss\\nfloat((1, 1))\" fontsize=10];\n  variable [shape=box color=green label=\"variable\\nfloat((0, 1))\" fontsize=10];\n\n  coef [shape=box label=\"coef\\nfloat32((10, 1))\\n[[77.475]\\n [ 1.425]\\n [34.21 ]\\n [61.477]\\n [82.19 ]\\n...\" fontsize=10];\n  intercept [shape=box label=\"intercept\\nfloat32((1,))\\n[2.]\" fontsize=10];\n  shape_tensor [shape=box label=\"shape_tensor\\nint64((2,))\\n[-1  1]\" fontsize=10];\n  l1_name [shape=box label=\"l1_name\\nfloat32((1,))\\n[0.5]\" fontsize=10];\n  l2_name [shape=box label=\"l2_name\\nfloat32((1,))\\n[0.5]\" fontsize=10];\n  shape_coef [shape=box label=\"shape_coef\\nint64((1,))\\n[-1]\" fontsize=10];\n  l1_weight_coef [shape=box label=\"l1_weight_coef\\nfloat32((1,))\\n[0.5]\" fontsize=10];\n  l2_weight_coef [shape=box label=\"l2_weight_coef\\nfloat32((1,))\\n[0.5]\" fontsize=10];\n  shape_intercept [shape=box label=\"shape_intercept\\nint64((1,))\\n[-1]\" fontsize=10];\n  l1_weight_intercept [shape=box label=\"l1_weight_intercept\\nfloat32((1,))\\n[0.5]\" fontsize=10];\n  l2_weight_intercept [shape=box label=\"l2_weight_intercept\\nfloat32((1,))\\n[0.5]\" fontsize=10];\n  shapevect [shape=box label=\"shapevect\\nint64((2,))\\n[-1  1]\" fontsize=10];\n\n  multiplied [shape=box label=\"multiplied\" fontsize=10];\n  MatMul [shape=box style=\"filled,rounded\" color=orange label=\"MatMul\\n(MatMul)\" fontsize=10];\n  X -> MatMul;\n  coef -> MatMul;\n  MatMul -> multiplied;\n\n  resh [shape=box label=\"resh\" fontsize=10];\n  Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add)\" fontsize=10];\n  multiplied -> Add;\n  intercept -> Add;\n  Add -> resh;\n\n  Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape)\" fontsize=10];\n  resh -> Reshape;\n  shape_tensor -> Reshape;\n  Reshape -> variable;\n\n  loss_diff [shape=box label=\"loss_diff\" fontsize=10];\n  Sub [shape=box style=\"filled,rounded\" color=orange label=\"Sub\\n(Sub)\" fontsize=10];\n  variable -> Sub;\n  label -> Sub;\n  Sub -> loss_diff;\n\n  loss_l2 [shape=box label=\"loss_l2\" fontsize=10];\n  Mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul)\" fontsize=10];\n  loss_diff -> Mul;\n  loss_diff -> Mul;\n  Mul -> loss_l2;\n\n  loss_l1 [shape=box label=\"loss_l1\" fontsize=10];\n  Abs [shape=box style=\"filled,rounded\" color=orange label=\"Abs\\n(Abs)\" fontsize=10];\n  loss_diff -> Abs;\n  Abs -> loss_l1;\n\n  loss_l1_2 [shape=box label=\"loss_l1_2\" fontsize=10];\n  Mul1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul1)\" fontsize=10];\n  loss_l1 -> Mul1;\n  l1_name -> Mul1;\n  Mul1 -> loss_l1_2;\n\n  loss_l2_2 [shape=box label=\"loss_l2_2\" fontsize=10];\n  Mul12 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul12)\" fontsize=10];\n  loss_l2 -> Mul12;\n  l2_name -> Mul12;\n  Mul12 -> loss_l2_2;\n\n  final_loss [shape=box label=\"final_loss\" fontsize=10];\n  Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add)\" fontsize=10];\n  loss_l1_2 -> Add;\n  loss_l2_2 -> Add;\n  Add -> final_loss;\n\n  loss_diff_weight [shape=box label=\"loss_diff_weight\" fontsize=10];\n  Mul123 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul123)\" fontsize=10];\n  final_loss -> Mul123;\n  weight -> Mul123;\n  Mul123 -> loss_diff_weight;\n\n  loss_diff_2 [shape=box label=\"loss_diff_2\" fontsize=10];\n  ReduceSum [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(ReduceSum)\" fontsize=10];\n  loss_diff_weight -> ReduceSum;\n  ReduceSum -> loss_diff_2;\n\n  reshaped_coef [shape=box label=\"reshaped_coef\" fontsize=10];\n  Reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape)\" fontsize=10];\n  coef -> Reshape;\n  shape_coef -> Reshape;\n  Reshape -> reshaped_coef;\n\n  reducedm_coef [shape=box label=\"reducedm_coef\" fontsize=10];\n  Mul1234 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul1234)\" fontsize=10];\n  reshaped_coef -> Mul1234;\n  reshaped_coef -> Mul1234;\n  Mul1234 -> reducedm_coef;\n\n  reduced2_coef [shape=box label=\"reduced2_coef\" fontsize=10];\n  ReduceSum1 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(ReduceSum1)\" fontsize=10];\n  reducedm_coef -> ReduceSum1;\n  ReduceSum1 -> reduced2_coef;\n\n  penalty2_coef [shape=box label=\"penalty2_coef\" fontsize=10];\n  Mul12345 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul12345)\" fontsize=10];\n  reduced2_coef -> Mul12345;\n  l2_weight_coef -> Mul12345;\n  Mul12345 -> penalty2_coef;\n\n  absolute_coef [shape=box label=\"absolute_coef\" fontsize=10];\n  Abs1 [shape=box style=\"filled,rounded\" color=orange label=\"Abs\\n(Abs1)\" fontsize=10];\n  reshaped_coef -> Abs1;\n  Abs1 -> absolute_coef;\n\n  reduced1_coef [shape=box label=\"reduced1_coef\" fontsize=10];\n  ReduceSum12 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(ReduceSum12)\" fontsize=10];\n  absolute_coef -> ReduceSum12;\n  ReduceSum12 -> reduced1_coef;\n\n  penalty1_coef [shape=box label=\"penalty1_coef\" fontsize=10];\n  Mul123456 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul123456)\" fontsize=10];\n  reduced1_coef -> Mul123456;\n  l1_weight_coef -> Mul123456;\n  Mul123456 -> penalty1_coef;\n\n  penalty_coef [shape=box label=\"penalty_coef\" fontsize=10];\n  Add1 [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add1)\" fontsize=10];\n  penalty1_coef -> Add1;\n  penalty2_coef -> Add1;\n  Add1 -> penalty_coef;\n\n  reshaped_intercept [shape=box label=\"reshaped_intercept\" fontsize=10];\n  Reshape1 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape1)\" fontsize=10];\n  intercept -> Reshape1;\n  shape_intercept -> Reshape1;\n  Reshape1 -> reshaped_intercept;\n\n  reducedm_intercept [shape=box label=\"reducedm_intercept\" fontsize=10];\n  Mul1234567 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul1234567)\" fontsize=10];\n  reshaped_intercept -> Mul1234567;\n  reshaped_intercept -> Mul1234567;\n  Mul1234567 -> reducedm_intercept;\n\n  reduced2_intercept [shape=box label=\"reduced2_intercept\" fontsize=10];\n  ReduceSum123 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(ReduceSum123)\" fontsize=10];\n  reducedm_intercept -> ReduceSum123;\n  ReduceSum123 -> reduced2_intercept;\n\n  penalty2_intercept [shape=box label=\"penalty2_intercept\" fontsize=10];\n  Mul12345678 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul12345678)\" fontsize=10];\n  reduced2_intercept -> Mul12345678;\n  l2_weight_intercept -> Mul12345678;\n  Mul12345678 -> penalty2_intercept;\n\n  absolute_intercept [shape=box label=\"absolute_intercept\" fontsize=10];\n  Abs12 [shape=box style=\"filled,rounded\" color=orange label=\"Abs\\n(Abs12)\" fontsize=10];\n  reshaped_intercept -> Abs12;\n  Abs12 -> absolute_intercept;\n\n  reduced1_intercept [shape=box label=\"reduced1_intercept\" fontsize=10];\n  ReduceSum1234 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\\n(ReduceSum1234)\" fontsize=10];\n  absolute_intercept -> ReduceSum1234;\n  ReduceSum1234 -> reduced1_intercept;\n\n  penalty1_intercept [shape=box label=\"penalty1_intercept\" fontsize=10];\n  Mul123456789 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\\n(Mul123456789)\" fontsize=10];\n  reduced1_intercept -> Mul123456789;\n  l1_weight_intercept -> Mul123456789;\n  Mul123456789 -> penalty1_intercept;\n\n  penalty_intercept [shape=box label=\"penalty_intercept\" fontsize=10];\n  Add12 [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add12)\" fontsize=10];\n  penalty1_intercept -> Add12;\n  penalty2_intercept -> Add12;\n  Add12 -> penalty_intercept;\n\n  sumop [shape=box label=\"sumop\" fontsize=10];\n  Add123 [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add123)\" fontsize=10];\n  penalty_coef -> Add123;\n  penalty_intercept -> Add123;\n  Add123 -> sumop;\n\n  penalty_reshape [shape=box label=\"penalty_reshape\" fontsize=10];\n  Reshape12 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape12)\" fontsize=10];\n  sumop -> Reshape12;\n  shapevect -> Reshape12;\n  Reshape12 -> penalty_reshape;\n\n  loss_reshape [shape=box label=\"loss_reshape\" fontsize=10];\n  Reshape123 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\\n(Reshape123)\" fontsize=10];\n  loss_diff_2 -> Reshape123;\n  shapevect -> Reshape123;\n  Reshape123 -> loss_reshape;\n\n  Add1234 [shape=box style=\"filled,rounded\" color=orange label=\"Add\\n(Add1234)\" fontsize=10];\n  penalty_reshape -> Add1234;\n  loss_reshape -> Add1234;\n  Add1234 -> loss;\n}\n");
    document.getElementById('gdot-140034595129520').innerHTML = svgGraph; });
    
</script>
</div><p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L449">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper.get_train_initializer">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">get_train_initializer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">onx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper.get_train_initializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the list of initializers to train.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dictionary <cite>{name: (value, tensor)}</cite></p>
</dd>
</dl>
<p>The function walk through the list of initializers and
returns all tensors with elements from types float or double.</p>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L299">source on GitHub</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="onnxcustom.utils.orttraining_helper.penalty_loss_onnx">
<span class="sig-prename descclassname"><span class="pre">onnxcustom.utils.orttraining_helper.</span></span><span class="sig-name descname"><span class="pre">penalty_loss_onnx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">existing_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#onnxcustom.utils.orttraining_helper.penalty_loss_onnx" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns onnx nodes to compute
<img class="math" src="../../_images/math/91b038be4528c1c617558f77187f9fe2db22285b.svg" alt="|w| \alpha + w^2 \beta"/>
where <img class="math" src="../../_images/math/56aa65e1112c70186c7f2d4d5acd0c38fc35eadb.svg" alt="\alpha=l1"/> and <img class="math" src="../../_images/math/ea00a1aa5063be99782362e40783db39e3b9b0c5.svg" alt="\beta=l2"/>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – name of weights</p></li>
<li><p><strong>dtype</strong> – numpy dtype</p></li>
<li><p><strong>l1</strong> – coefficient for L1 norm</p></li>
<li><p><strong>l2</strong> – coefficient for L2 norm</p></li>
<li><p><strong>existing_names</strong> – names already taken in the ONNX graph</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>initializer, nodes</p>
</dd>
</dl>
<p><a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/onnxcustom/utils/orttraining_helper.py#L227">source on GitHub</a></p>
</dd></dl>

</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="onnxruntime_helper.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">module <code class="docutils literal notranslate"><span class="pre">utils.onnxruntime_helper</span></code></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="print_helper.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">module <code class="docutils literal notranslate"><span class="pre">utils.print_helper</span></code></p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>