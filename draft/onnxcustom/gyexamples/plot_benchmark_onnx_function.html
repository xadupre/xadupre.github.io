
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Compares numpy to onnxruntime on simple functions &#8212; onnxcustom</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/require.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Benchmarking and profiling Tutorial" href="../tutorials/tutorial_bench/index.html" />
    <link rel="prev" title="Benchmark, comparison sklearn - forward-backward - classification" href="plot_orttraining_benchmark_fwbw_cls.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_onnx/index.html">
   Introduction to ONNX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_onnxruntime/index.html">
   Introduction to onnxruntime
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_skl/index.html">
   scikit-learn to ONNX Tutorial
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../tutorials/tutorial_training/index.html">
   Training Tutorial
  </a>
  <input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/tutorial_training/tutorial_6_training.html">
     Full Training with OrtGradientOptimizer
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../tutorials/tutorial_training/tutorial_6_training_partial.html">
     Partial Training with OrtGradientForwardBackwardOptimizer
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="plot_orttraining_linear_regression_fwbw.html">
       Train a linear regression with forward backward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_orttraining_nn_gpu_fwbw.html">
       Forward backward on a neural network on GPU
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_orttraining_nn_gpu_fwbw_nesterov.html">
       Forward backward on a neural network on GPU (Nesterov) and penalty
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_orttraining_benchmark_fwbw.html">
       Benchmark, comparison scikit-learn - forward-backward
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="plot_orttraining_benchmark_fwbw_cls.html">
       Benchmark, comparison sklearn - forward-backward - classification
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Compares numpy to onnxruntime on simple functions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/tutorial_bench/index.html">
   Benchmarking and profiling Tutorial
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#axpy">
   axpy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#axpyw">
   axpyw
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#axpyw2">
   axpyw2
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#copy">
   copy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grad-loss-absolute-error">
   grad_loss_absolute_error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grad-loss-square-error">
   grad_loss_square_error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grad-loss-elastic-error">
   grad_loss_elastic_error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#n-penalty-elastic-error">
   n_penalty_elastic_error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#update-penalty-elastic-error">
   update_penalty_elastic_error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grad-sigmoid-neg-log-loss-error">
   grad_sigmoid_neg_log_loss_error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-gyexamples-plot-benchmark-onnx-function-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="compares-numpy-to-onnxruntime-on-simple-functions">
<span id="benchmark-inference-onnx-function"></span><span id="sphx-glr-gyexamples-plot-benchmark-onnx-function-py"></span><h1>Compares numpy to onnxruntime on simple functions<a class="headerlink" href="#compares-numpy-to-onnxruntime-on-simple-functions" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://microsoft.github.io/onnxruntime/">onnxruntime</a> can be used a replacement to <a class="reference external" href="https://numpy.org/">numpy</a>.
It can be used to implement a training algorithm,
<a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/master/orttraining">onnxruntime-training</a> differentiate an onnx graph and
runs it to compute the gradient. Simple functions are implemented
in ONNX and ran with <a class="reference external" href="https://microsoft.github.io/onnxruntime/">onnxruntime</a> to update the weights.
<a class="reference internal" href="../onnxcustom/utils/onnx_function.html#onnxcustom.utils.onnx_function.function_onnx_graph" title="onnxcustom.utils.onnx_function.function_onnx_graph"><code class="xref py py-func docutils literal notranslate"><span class="pre">function_onnx_graph</span></code></a> returns many
functions used to implement a training algorithm.
The following benchmarks compares a couple of implementations:</p>
<ul class="simple">
<li><p><cite>numpy</cite>: an implementation based on numpy, not optimized</p></li>
<li><p><cite>sess</cite>: inference through an ONNX graph executed with
method <cite>onnxruntime.InferenceSession.run</cite></p></li>
<li><p><cite>bind</cite>: inference through an ONNX graph executed with
method <cite>onnxruntime.InferenceSession.run_with_iobinding</cite></p></li>
<li><p><cite>run</cite>: inference through an ONNX graph executed with
method <cite>onnxruntime.InferenceSession.run_with_iobinding</cite>
but without counting the binding assuming input buffers
are reused and do not need binding again</p></li>
</ul>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#axpy" id="id1">axpy</a></p></li>
<li><p><a class="reference internal" href="#axpyw" id="id2">axpyw</a></p></li>
<li><p><a class="reference internal" href="#axpyw2" id="id3">axpyw2</a></p></li>
<li><p><a class="reference internal" href="#copy" id="id4">copy</a></p></li>
<li><p><a class="reference internal" href="#grad-loss-absolute-error" id="id5">grad_loss_absolute_error</a></p></li>
<li><p><a class="reference internal" href="#grad-loss-square-error" id="id6">grad_loss_square_error</a></p></li>
<li><p><a class="reference internal" href="#grad-loss-elastic-error" id="id7">grad_loss_elastic_error</a></p></li>
<li><p><a class="reference internal" href="#n-penalty-elastic-error" id="id8">n_penalty_elastic_error</a></p></li>
<li><p><a class="reference internal" href="#update-penalty-elastic-error" id="id9">update_penalty_elastic_error</a></p></li>
<li><p><a class="reference internal" href="#grad-sigmoid-neg-log-loss-error" id="id10">grad_sigmoid_neg_log_loss_error</a></p></li>
<li><p><a class="reference internal" href="#results" id="id11">Results</a></p></li>
</ul>
</div>
<section id="axpy">
<h2><a class="toc-backref" href="#id1">axpy</a><a class="headerlink" href="#axpy" title="Permalink to this headline">¶</a></h2>
<p>This function implements <img class="math" src="../_images/math/a1b5f40c45564a485bc620e91c1c80cf336589b7.svg" alt="Y = f(X1, X2, \alpha) = \alpha X1 + X2"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">expit</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">cpyquickhelper.numbers.speed_measure</span> <span class="kn">import</span> <span class="n">measure_time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">InferenceSession</span>
<span class="kn">from</span> <span class="nn">onnxruntime.capi._pybind_state</span> <span class="kn">import</span> <span class="p">(</span>  <span class="c1"># pylint: disable=E0611</span>
    <span class="n">SessionIOBinding</span><span class="p">,</span> <span class="n">OrtDevice</span> <span class="k">as</span> <span class="n">C_OrtDevice</span><span class="p">,</span>
    <span class="n">OrtValue</span> <span class="k">as</span> <span class="n">C_OrtValue</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mlprodict.plotting.text_plot</span> <span class="kn">import</span> <span class="n">onnx_simple_text_plot</span>
<span class="kn">from</span> <span class="nn">onnxcustom.utils.onnx_function</span> <span class="kn">import</span> <span class="n">function_onnx_graph</span>

<span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;axpy&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=14
input: name=&#39;X1&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;alpha&#39; type=dtype(&#39;float32&#39;) shape=(1,)
Mul(X1, alpha) -&gt; Mu_C0
  Add(Mu_C0, X2) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>The numpy implementation is the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">X1</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">X2</span>
</pre></div>
</div>
<p>The benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">[:</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="k">def</span> <span class="nf">bind_and_run</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">bind</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">out_names</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">bind</span><span class="o">.</span><span class="n">bind_ortvalue_input</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">out_names</span><span class="p">:</span>
        <span class="n">bind</span><span class="o">.</span><span class="n">bind_output</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run_with_iobinding</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bind</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">nobind_just_run</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">bind</span><span class="p">):</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run_with_iobinding</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">benchmark</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
              <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)):</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">InferenceSession</span><span class="p">(</span><span class="n">onx</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">C_OrtDevice</span><span class="p">(</span>
        <span class="n">C_OrtDevice</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="n">C_OrtDevice</span><span class="o">.</span><span class="n">default_memory</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()]</span>
    <span class="n">out_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Size mismatch </span><span class="si">%d</span><span class="s2"> != </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dims</span><span class="p">):</span>
        <span class="n">new_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">ortvalues</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">C_OrtValue</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">new_args</span><span class="p">]</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">measure_time</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">fct_numpy</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">),</span>
                          <span class="n">repeat</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>

        <span class="n">inps</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">new_args</span><span class="p">)}</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">measure_time</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">inps</span><span class="p">))</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;sess&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>

        <span class="n">bind</span> <span class="o">=</span> <span class="n">SessionIOBinding</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">_sess</span><span class="p">)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">measure_time</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">bind_and_run</span><span class="p">(</span>
                <span class="n">sess</span><span class="o">.</span><span class="n">_sess</span><span class="p">,</span> <span class="n">bind</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">ortvalues</span><span class="p">,</span> <span class="n">out_names</span><span class="p">,</span> <span class="n">device</span><span class="p">))</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;bind_run&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">measure_time</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">nobind_just_run</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">_sess</span><span class="p">,</span> <span class="n">bind</span><span class="p">))</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">impl</span><span class="o">=</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rows</span>
</pre></div>
</div>
<p>Back to function axpy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;axpy&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:01,  4.46it/s]
 25%|##5       | 2/8 [00:00&lt;00:01,  4.42it/s]
 38%|###7      | 3/8 [00:00&lt;00:01,  4.07it/s]
 50%|#####     | 4/8 [00:00&lt;00:01,  3.88it/s]
 62%|######2   | 5/8 [00:01&lt;00:00,  3.62it/s]
 75%|#######5  | 6/8 [00:01&lt;00:00,  3.23it/s]
 88%|########7 | 7/8 [00:02&lt;00:00,  3.02it/s]
100%|##########| 8/8 [00:02&lt;00:00,  2.90it/s]
100%|##########| 8/8 [00:02&lt;00:00,  3.29it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.004020</td>
      <td>0.002472</td>
      <td>0.001767</td>
      <td>0.003834</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004144</td>
      <td>0.002464</td>
      <td>0.001897</td>
      <td>0.003902</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.004209</td>
      <td>0.003188</td>
      <td>0.001983</td>
      <td>0.004204</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.004304</td>
      <td>0.003303</td>
      <td>0.002080</td>
      <td>0.004269</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.004564</td>
      <td>0.003738</td>
      <td>0.002329</td>
      <td>0.004624</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.005001</td>
      <td>0.004787</td>
      <td>0.002745</td>
      <td>0.005261</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.004988</td>
      <td>0.004789</td>
      <td>0.002764</td>
      <td>0.005207</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.005004</td>
      <td>0.004765</td>
      <td>0.002741</td>
      <td>0.005211</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_001.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_001.png" alt="axpy lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;axpy\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="axpyw">
<h2><a class="toc-backref" href="#id2">axpyw</a><a class="headerlink" href="#axpyw" title="Permalink to this headline">¶</a></h2>
<p>It does <img class="math" src="../_images/math/b0236330dfad444e53e590680f30523f9e0d7f4d.svg" alt="Y, Z = f(X1, X2, G, \alpha, \beta) = (Y, Z)"/>
where <img class="math" src="../_images/math/fefbd6622f90e3be598bda000a7528dd9a1da434.svg" alt="Z = \beta G + \alpha X1"/> and
<img class="math" src="../_images/math/52d6715d201f5b213b3d76ff62d9753fd00ae4df.svg" alt="Y = Z + X2"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;axpyw&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=14
input: name=&#39;X1&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;G&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;alpha&#39; type=dtype(&#39;float32&#39;) shape=(1,)
input: name=&#39;beta&#39; type=dtype(&#39;float32&#39;) shape=(1,)
Mul(X1, alpha) -&gt; Mu_C0
Mul(G, beta) -&gt; Mu_C02
  Add(Mu_C0, Mu_C02) -&gt; Z
    Add(Z, X2) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
output: name=&#39;Z&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="p">(</span>
    <span class="n">x1</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">g</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;axpyw&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:03,  1.90it/s]
 25%|##5       | 2/8 [00:01&lt;00:03,  1.89it/s]
 38%|###7      | 3/8 [00:01&lt;00:02,  1.71it/s]
 50%|#####     | 4/8 [00:02&lt;00:02,  1.59it/s]
 62%|######2   | 5/8 [00:03&lt;00:02,  1.44it/s]
 75%|#######5  | 6/8 [00:04&lt;00:01,  1.25it/s]
 88%|########7 | 7/8 [00:05&lt;00:00,  1.15it/s]
100%|##########| 8/8 [00:06&lt;00:00,  1.10it/s]
100%|##########| 8/8 [00:06&lt;00:00,  1.28it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.005410</td>
      <td>0.008006</td>
      <td>0.002002</td>
      <td>0.004804</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.005511</td>
      <td>0.008061</td>
      <td>0.002049</td>
      <td>0.004867</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.005652</td>
      <td>0.010279</td>
      <td>0.002217</td>
      <td>0.005257</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.005859</td>
      <td>0.011089</td>
      <td>0.002417</td>
      <td>0.005517</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.006377</td>
      <td>0.012870</td>
      <td>0.002917</td>
      <td>0.006208</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.007307</td>
      <td>0.016126</td>
      <td>0.003762</td>
      <td>0.007902</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.007499</td>
      <td>0.016227</td>
      <td>0.003889</td>
      <td>0.007580</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.007290</td>
      <td>0.016235</td>
      <td>0.003779</td>
      <td>0.007562</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_002.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_002.png" alt="axpyw lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;axpyw\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="axpyw2">
<h2><a class="toc-backref" href="#id3">axpyw2</a><a class="headerlink" href="#axpyw2" title="Permalink to this headline">¶</a></h2>
<p>It implements <img class="math" src="../_images/math/b0236330dfad444e53e590680f30523f9e0d7f4d.svg" alt="Y, Z = f(X1, X2, G, \alpha, \beta) = (Y, Z)"/>
where <img class="math" src="../_images/math/fefbd6622f90e3be598bda000a7528dd9a1da434.svg" alt="Z = \beta G + \alpha X1"/> and
<img class="math" src="../_images/math/6da7b97b4d9f5431c352efcad9a6d983686d7a50.svg" alt="Y = \beta * Z + \alpha X1 + X2"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;axpyw2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=14
input: name=&#39;X1&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;G&#39; type=dtype(&#39;float32&#39;) shape=()
input: name=&#39;alpha&#39; type=dtype(&#39;float32&#39;) shape=(1,)
input: name=&#39;beta&#39; type=dtype(&#39;float32&#39;) shape=(1,)
Mul(X1, alpha) -&gt; Mu_C0
Mul(G, beta) -&gt; Mu_C03
  Add(Mu_C0, Mu_C03) -&gt; Z
    Mul(Z, beta) -&gt; Mu_C02
  Add(Mu_C0, Mu_C02) -&gt; Ad_C0
    Add(Ad_C0, X2) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
output: name=&#39;Z&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="p">(</span>
    <span class="n">x1</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">g</span><span class="p">),</span>
    <span class="n">x1</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;axpyw2&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:04,  1.42it/s]
 25%|##5       | 2/8 [00:01&lt;00:04,  1.42it/s]
 38%|###7      | 3/8 [00:02&lt;00:03,  1.27it/s]
 50%|#####     | 4/8 [00:03&lt;00:03,  1.18it/s]
 62%|######2   | 5/8 [00:04&lt;00:02,  1.06it/s]
 75%|#######5  | 6/8 [00:05&lt;00:02,  1.09s/it]
 88%|########7 | 7/8 [00:07&lt;00:01,  1.20s/it]
100%|##########| 8/8 [00:08&lt;00:00,  1.27s/it]
100%|##########| 8/8 [00:08&lt;00:00,  1.07s/it]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.005715</td>
      <td>0.011349</td>
      <td>0.002276</td>
      <td>0.005124</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.005753</td>
      <td>0.011395</td>
      <td>0.002312</td>
      <td>0.005138</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.006031</td>
      <td>0.014726</td>
      <td>0.002566</td>
      <td>0.005628</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.006341</td>
      <td>0.015799</td>
      <td>0.002866</td>
      <td>0.006004</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.007087</td>
      <td>0.018475</td>
      <td>0.003629</td>
      <td>0.007236</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.008660</td>
      <td>0.023100</td>
      <td>0.004913</td>
      <td>0.008972</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.008596</td>
      <td>0.023859</td>
      <td>0.004916</td>
      <td>0.009152</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.008592</td>
      <td>0.023808</td>
      <td>0.004910</td>
      <td>0.009274</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /></section>
<section id="copy">
<h2><a class="toc-backref" href="#id4">copy</a><a class="headerlink" href="#copy" title="Permalink to this headline">¶</a></h2>
<p>It implements a copy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;copy&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=15
input: name=&#39;X&#39; type=dtype(&#39;float32&#39;) shape=()
Identity(X) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:00,  9.82it/s]
 25%|##5       | 2/8 [00:00&lt;00:00,  9.80it/s]
 38%|###7      | 3/8 [00:00&lt;00:00,  9.28it/s]
 50%|#####     | 4/8 [00:00&lt;00:00,  8.91it/s]
 62%|######2   | 5/8 [00:00&lt;00:00,  8.43it/s]
 75%|#######5  | 6/8 [00:00&lt;00:00,  7.76it/s]
 88%|########7 | 7/8 [00:00&lt;00:00,  7.38it/s]
100%|##########| 8/8 [00:01&lt;00:00,  7.18it/s]
100%|##########| 8/8 [00:01&lt;00:00,  7.89it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.002721</td>
      <td>0.000649</td>
      <td>0.001098</td>
      <td>0.002707</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.002737</td>
      <td>0.000627</td>
      <td>0.001103</td>
      <td>0.002724</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.002757</td>
      <td>0.000836</td>
      <td>0.001135</td>
      <td>0.002853</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.002794</td>
      <td>0.000900</td>
      <td>0.001172</td>
      <td>0.002910</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.002894</td>
      <td>0.001054</td>
      <td>0.001247</td>
      <td>0.003066</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.002964</td>
      <td>0.001348</td>
      <td>0.001341</td>
      <td>0.003318</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.002971</td>
      <td>0.001361</td>
      <td>0.001360</td>
      <td>0.003253</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.002981</td>
      <td>0.001324</td>
      <td>0.001353</td>
      <td>0.003254</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_003.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_003.png" alt="copy lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;copy\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="grad-loss-absolute-error">
<h2><a class="toc-backref" href="#id5">grad_loss_absolute_error</a><a class="headerlink" href="#grad-loss-absolute-error" title="Permalink to this headline">¶</a></h2>
<p>It implements <img class="math" src="../_images/math/9107d2357809bcf88d34442b8e9e88f1f066aa53.svg" alt="Y = f(X1, X2) = \lVert X1 - X2 \rVert"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;grad_loss_absolute_error&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=14
input: name=&#39;X1&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
init: name=&#39;Re_Reshapecst&#39; type=dtype(&#39;int64&#39;) shape=(1,) -- array([-1])
Sub(X1, X2) -&gt; Su_C0
  Sign(Su_C0) -&gt; Y_grad
  Abs(Su_C0) -&gt; Ab_Y0
    ReduceSum(Ab_Y0) -&gt; Re_reduced0
      Reshape(Re_reduced0, Re_Reshapecst) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
output: name=&#39;Y_grad&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="p">(</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;grad_loss_absolute_error&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:02,  2.56it/s]
 25%|##5       | 2/8 [00:00&lt;00:02,  2.55it/s]
 38%|###7      | 3/8 [00:01&lt;00:02,  2.26it/s]
 50%|#####     | 4/8 [00:01&lt;00:01,  2.04it/s]
 62%|######2   | 5/8 [00:02&lt;00:01,  1.74it/s]
 75%|#######5  | 6/8 [00:03&lt;00:01,  1.38it/s]
 88%|########7 | 7/8 [00:04&lt;00:00,  1.21it/s]
100%|##########| 8/8 [00:05&lt;00:00,  1.12it/s]
100%|##########| 8/8 [00:05&lt;00:00,  1.41it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.004892</td>
      <td>0.005378</td>
      <td>0.002343</td>
      <td>0.004455</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004940</td>
      <td>0.005400</td>
      <td>0.002387</td>
      <td>0.004474</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.005286</td>
      <td>0.007336</td>
      <td>0.002758</td>
      <td>0.005016</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.005728</td>
      <td>0.008320</td>
      <td>0.003188</td>
      <td>0.005466</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.006940</td>
      <td>0.010785</td>
      <td>0.004406</td>
      <td>0.006787</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.008976</td>
      <td>0.015394</td>
      <td>0.006398</td>
      <td>0.008920</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.009048</td>
      <td>0.015723</td>
      <td>0.006436</td>
      <td>0.008967</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.009012</td>
      <td>0.015590</td>
      <td>0.006411</td>
      <td>0.008881</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_004.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_004.png" alt="grad_loss_absolute_error lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;grad_loss_absolute_error\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="grad-loss-square-error">
<h2><a class="toc-backref" href="#id6">grad_loss_square_error</a><a class="headerlink" href="#grad-loss-square-error" title="Permalink to this headline">¶</a></h2>
<p>It implements <img class="math" src="../_images/math/ae51697364ea94d838a0963a1ad6bffc573f7f2c.svg" alt="Y = f(X1, X2) = \lVert X1 - X2 \rVert^2"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;grad_loss_square_error&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=14
input: name=&#39;X1&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
init: name=&#39;Mu_Mulcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([1.], dtype=float32)
init: name=&#39;Re_Reshapecst&#39; type=dtype(&#39;int64&#39;) shape=(1,) -- array([-1])
init: name=&#39;Mu_Mulcst1&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([-2.], dtype=float32)
Sub(X1, X2) -&gt; Su_C0
  Mul(Su_C0, Mu_Mulcst1) -&gt; Y_grad
ReduceSumSquare(Su_C0) -&gt; Re_reduced0
  Mul(Re_reduced0, Mu_Mulcst) -&gt; Mu_C0
    Reshape(Mu_C0, Re_Reshapecst) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
output: name=&#39;Y_grad&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="p">(</span>
    <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;grad_loss_square_error&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:03,  2.17it/s]
 25%|##5       | 2/8 [00:00&lt;00:02,  2.16it/s]
 38%|###7      | 3/8 [00:01&lt;00:02,  1.97it/s]
 50%|#####     | 4/8 [00:02&lt;00:02,  1.88it/s]
 62%|######2   | 5/8 [00:02&lt;00:01,  1.74it/s]
 75%|#######5  | 6/8 [00:03&lt;00:01,  1.54it/s]
 88%|########7 | 7/8 [00:04&lt;00:00,  1.43it/s]
100%|##########| 8/8 [00:05&lt;00:00,  1.37it/s]
100%|##########| 8/8 [00:05&lt;00:00,  1.57it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.004992</td>
      <td>0.006728</td>
      <td>0.002403</td>
      <td>0.004590</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004987</td>
      <td>0.006741</td>
      <td>0.002423</td>
      <td>0.004630</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.005123</td>
      <td>0.008606</td>
      <td>0.002535</td>
      <td>0.004961</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.005240</td>
      <td>0.008759</td>
      <td>0.002665</td>
      <td>0.005020</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.005583</td>
      <td>0.010121</td>
      <td>0.003018</td>
      <td>0.005441</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.006175</td>
      <td>0.012511</td>
      <td>0.003565</td>
      <td>0.006238</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.006152</td>
      <td>0.012755</td>
      <td>0.003566</td>
      <td>0.006123</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.006152</td>
      <td>0.012709</td>
      <td>0.003568</td>
      <td>0.006112</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_005.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_005.png" alt="grad_loss_square_error lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;grad_loss_square_error\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="grad-loss-elastic-error">
<h2><a class="toc-backref" href="#id7">grad_loss_elastic_error</a><a class="headerlink" href="#grad-loss-elastic-error" title="Permalink to this headline">¶</a></h2>
<p>It implements <img class="math" src="../_images/math/f3fe32d89d8e8f397acd7f02c07275a8a7cd2573.svg" alt="Y = f(X1, X2) = \beta \lVert X1 - X2 \rVert +
\alpha \lVert X1 - X2 \rVert^2"/> or
<img class="math" src="../_images/math/e9f62b08536b40015e0b13b5ed597b0806b860e4.svg" alt="Y = f(X1, X2) = \beta \lVert w(X1 - X2) \rVert +
\alpha \lVert (\sqrt{w}(X1 - X2) \rVert^2"/> if
<em>weight_name</em> is not None and its gradient.
<em>l1_weight</em> is <img class="math" src="../_images/math/8fd96498a01957a1ce6cb102fc544d7e32ae2973.svg" alt="\beta"/> and
<em>l2_weight</em> is <img class="math" src="../_images/math/35093c7ccc735c18e6452789bcb7ec50e0cb0c43.svg" alt="\alpha"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;grad_loss_elastic_error&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=15
input: name=&#39;X1&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
init: name=&#39;Mu_Mulcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([0.01], dtype=float32)
init: name=&#39;Re_Reshapecst&#39; type=dtype(&#39;int64&#39;) shape=(1,) -- array([-1])
init: name=&#39;Mu_Mulcst3&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([-0.02], dtype=float32)
Identity(Mu_Mulcst) -&gt; Mu_Mulcst1
Identity(Mu_Mulcst) -&gt; Mu_Mulcst2
Sub(X1, X2) -&gt; Su_C0
  Mul(Su_C0, Mu_Mulcst3) -&gt; Mu_C05
Sign(Su_C0) -&gt; Si_output0
  Mul(Si_output0, Mu_Mulcst2) -&gt; Mu_C04
    Add(Mu_C04, Mu_C05) -&gt; Ad_C02
      Identity(Ad_C02) -&gt; Y_grad
  Mul(Su_C0, Su_C0) -&gt; Mu_C03
  Mul(Mu_C03, Mu_Mulcst1) -&gt; Mu_C02
Abs(Su_C0) -&gt; Ab_Y0
  Mul(Ab_Y0, Mu_Mulcst) -&gt; Mu_C0
    Add(Mu_C0, Mu_C02) -&gt; Ad_C0
      ReduceSum(Ad_C0) -&gt; Re_reduced0
        Reshape(Re_reduced0, Re_Reshapecst) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
output: name=&#39;Y_grad&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="p">(</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;grad_loss_elastic_error&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:01&lt;00:07,  1.12s/it]
 25%|##5       | 2/8 [00:02&lt;00:06,  1.12s/it]
 38%|###7      | 3/8 [00:03&lt;00:06,  1.23s/it]
 50%|#####     | 4/8 [00:05&lt;00:05,  1.33s/it]
 62%|######2   | 5/8 [00:06&lt;00:04,  1.48s/it]
 75%|#######5  | 6/8 [00:09&lt;00:03,  1.74s/it]
 88%|########7 | 7/8 [00:11&lt;00:01,  1.90s/it]
100%|##########| 8/8 [00:13&lt;00:00,  2.00s/it]
100%|##########| 8/8 [00:13&lt;00:00,  1.69s/it]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.006727</td>
      <td>0.018878</td>
      <td>0.004245</td>
      <td>0.006339</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.006791</td>
      <td>0.018810</td>
      <td>0.004312</td>
      <td>0.006345</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.007568</td>
      <td>0.023246</td>
      <td>0.005018</td>
      <td>0.007241</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.008349</td>
      <td>0.024948</td>
      <td>0.005816</td>
      <td>0.008013</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.010447</td>
      <td>0.029153</td>
      <td>0.007927</td>
      <td>0.010274</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.014111</td>
      <td>0.036601</td>
      <td>0.011493</td>
      <td>0.014316</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.014031</td>
      <td>0.036314</td>
      <td>0.011409</td>
      <td>0.014508</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.014107</td>
      <td>0.036410</td>
      <td>0.011520</td>
      <td>0.014311</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_006.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_006.png" alt="grad_loss_elastic_error lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;grad_loss_elastic_error\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="n-penalty-elastic-error">
<h2><a class="toc-backref" href="#id8">n_penalty_elastic_error</a><a class="headerlink" href="#n-penalty-elastic-error" title="Permalink to this headline">¶</a></h2>
<p>It implements <img class="math" src="../_images/math/bc32869601fdf6da777897b62d8bfef898364298.svg" alt="Y = f(W) = \beta \lVert W \rVert +
\alpha \lVert W \rVert^2"/>
<em>l1_weight</em> is <img class="math" src="../_images/math/8fd96498a01957a1ce6cb102fc544d7e32ae2973.svg" alt="\beta"/> and
<em>l2_weight</em> is <img class="math" src="../_images/math/35093c7ccc735c18e6452789bcb7ec50e0cb0c43.svg" alt="\alpha"/>.
It does that for <em>n_tensors</em> and adds all of the results
to an input loss.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;n_penalty_elastic_error&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=15
input: name=&#39;loss&#39; type=dtype(&#39;float32&#39;) shape=(1, 1)
input: name=&#39;W0&#39; type=dtype(&#39;float32&#39;) shape=()
init: name=&#39;Mu_Mulcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([0.01], dtype=float32)
init: name=&#39;Re_Reshapecst&#39; type=dtype(&#39;int64&#39;) shape=(1,) -- array([-1])
Abs(W0) -&gt; Ab_Y0
  ReduceSum(Ab_Y0) -&gt; Re_reduced0
    Mul(Re_reduced0, Mu_Mulcst) -&gt; Mu_C0
ReduceSumSquare(W0) -&gt; Re_reduced02
Identity(Mu_Mulcst) -&gt; Mu_Mulcst1
  Mul(Re_reduced02, Mu_Mulcst1) -&gt; Mu_C02
    Add(Mu_C0, Mu_C02) -&gt; Ad_C01
      Add(loss, Ad_C01) -&gt; Ad_C0
        Reshape(Ad_C0, Re_Reshapecst) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=(0,)
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">loss</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.9</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;n_penalty_elastic_error&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:04,  1.45it/s]
 25%|##5       | 2/8 [00:01&lt;00:04,  1.45it/s]
 38%|###7      | 3/8 [00:02&lt;00:03,  1.38it/s]
 50%|#####     | 4/8 [00:02&lt;00:02,  1.34it/s]
 62%|######2   | 5/8 [00:03&lt;00:02,  1.28it/s]
 75%|#######5  | 6/8 [00:04&lt;00:01,  1.20it/s]
 88%|########7 | 7/8 [00:05&lt;00:00,  1.16it/s]
100%|##########| 8/8 [00:06&lt;00:00,  1.13it/s]
100%|##########| 8/8 [00:06&lt;00:00,  1.22it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.004585</td>
      <td>0.011367</td>
      <td>0.002621</td>
      <td>0.004443</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.004578</td>
      <td>0.011417</td>
      <td>0.002631</td>
      <td>0.004412</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.004684</td>
      <td>0.012726</td>
      <td>0.002711</td>
      <td>0.004551</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.004766</td>
      <td>0.013061</td>
      <td>0.002809</td>
      <td>0.004637</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.005022</td>
      <td>0.014097</td>
      <td>0.003079</td>
      <td>0.004913</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.005446</td>
      <td>0.015708</td>
      <td>0.003480</td>
      <td>0.005334</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.005418</td>
      <td>0.015659</td>
      <td>0.003477</td>
      <td>0.005255</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.005448</td>
      <td>0.015799</td>
      <td>0.003486</td>
      <td>0.005266</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_007.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_007.png" alt="n_penalty_elastic_error lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;n_penalty_elastic_error\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="update-penalty-elastic-error">
<h2><a class="toc-backref" href="#id9">update_penalty_elastic_error</a><a class="headerlink" href="#update-penalty-elastic-error" title="Permalink to this headline">¶</a></h2>
<p>It implements <img class="math" src="../_images/math/f29329c678cb190134a14d51b279d5178d027ec2.svg" alt="Y = f(W) = W - 2 \beta W - \alpha sign(W)"/>
<em>l1</em> is <img class="math" src="../_images/math/8fd96498a01957a1ce6cb102fc544d7e32ae2973.svg" alt="\beta"/> and
<em>l2</em> is <img class="math" src="../_images/math/35093c7ccc735c18e6452789bcb7ec50e0cb0c43.svg" alt="\alpha"/>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;update_penalty_elastic_error&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=14
input: name=&#39;X&#39; type=dtype(&#39;float32&#39;) shape=()
init: name=&#39;Mu_Mulcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([0.9998], dtype=float32)
init: name=&#39;Mu_Mulcst1&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([1.e-04], dtype=float32)
Mul(X, Mu_Mulcst) -&gt; Mu_C0
Sign(X) -&gt; Si_output0
  Mul(Si_output0, Mu_Mulcst1) -&gt; Mu_C02
  Sub(Mu_C0, Mu_C02) -&gt; Y
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;update_penalty_elastic_error&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:00&lt;00:03,  2.26it/s]
 25%|##5       | 2/8 [00:00&lt;00:02,  2.26it/s]
 38%|###7      | 3/8 [00:01&lt;00:02,  2.00it/s]
 50%|#####     | 4/8 [00:02&lt;00:02,  1.81it/s]
 62%|######2   | 5/8 [00:02&lt;00:01,  1.56it/s]
 75%|#######5  | 6/8 [00:03&lt;00:01,  1.26it/s]
 88%|########7 | 7/8 [00:05&lt;00:00,  1.13it/s]
100%|##########| 8/8 [00:06&lt;00:00,  1.05it/s]
100%|##########| 8/8 [00:06&lt;00:00,  1.31it/s]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.003592</td>
      <td>0.006939</td>
      <td>0.001929</td>
      <td>0.003570</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.003595</td>
      <td>0.006948</td>
      <td>0.001966</td>
      <td>0.003547</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.004011</td>
      <td>0.009130</td>
      <td>0.002370</td>
      <td>0.004365</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.004455</td>
      <td>0.010068</td>
      <td>0.002836</td>
      <td>0.004784</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.005754</td>
      <td>0.012711</td>
      <td>0.004112</td>
      <td>0.006313</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.007908</td>
      <td>0.016946</td>
      <td>0.006276</td>
      <td>0.008500</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.007889</td>
      <td>0.016904</td>
      <td>0.006242</td>
      <td>0.008482</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.007912</td>
      <td>0.017042</td>
      <td>0.006264</td>
      <td>0.008486</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_008.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_008.png" alt="update_penalty_elastic_error lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;update_penalty_elastic_error\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="grad-sigmoid-neg-log-loss-error">
<h2><a class="toc-backref" href="#id10">grad_sigmoid_neg_log_loss_error</a><a class="headerlink" href="#grad-sigmoid-neg-log-loss-error" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="../onnxcustom/utils/onnx_function.html#onnxcustom.utils.onnx_function._onnx_grad_sigmoid_neg_log_loss_error" title="onnxcustom.utils.onnx_function._onnx_grad_sigmoid_neg_log_loss_error"><code class="xref py py-func docutils literal notranslate"><span class="pre">_onnx_grad_sigmoid_neg_log_loss_error</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fct_onx</span> <span class="o">=</span> <span class="n">function_onnx_graph</span><span class="p">(</span><span class="s2">&quot;grad_sigmoid_neg_log_loss_error&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct_onx</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>opset: domain=&#39;&#39; version=15
input: name=&#39;X1&#39; type=dtype(&#39;int64&#39;) shape=(0, 0)
input: name=&#39;X2&#39; type=dtype(&#39;float32&#39;) shape=(0, 0)
init: name=&#39;Su_Subcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([1.], dtype=float32)
init: name=&#39;Cl_Clipcst&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([1.e-05], dtype=float32)
init: name=&#39;Cl_Clipcst1&#39; type=dtype(&#39;float32&#39;) shape=(1,) -- array([0.99999], dtype=float32)
init: name=&#39;Re_Reshapecst&#39; type=dtype(&#39;int64&#39;) shape=(1,) -- array([-1])
Cast(X1, to=1) -&gt; Ca_output0
  Sub(Su_Subcst, Ca_output0) -&gt; Su_C0
Sigmoid(X2) -&gt; Si_Y0
  Clip(Si_Y0, Cl_Clipcst, Cl_Clipcst1) -&gt; Cl_output0
    Log(Cl_output0) -&gt; Lo_output02
  Mul(Ca_output0, Lo_output02) -&gt; Mu_C02
Identity(Su_Subcst) -&gt; Su_Subcst1
  Sub(Su_Subcst1, Cl_output0) -&gt; Su_C02
    Log(Su_C02) -&gt; Lo_output0
    Mul(Su_C0, Lo_output0) -&gt; Mu_C0
    Add(Mu_C0, Mu_C02) -&gt; Ad_C0
      Neg(Ad_C0) -&gt; Ne_Y0
        ReduceSum(Ne_Y0) -&gt; Re_reduced0
          Reshape(Re_reduced0, Re_Reshapecst) -&gt; Y
  Sub(Cl_output0, Ca_output0) -&gt; Y_grad
output: name=&#39;Y&#39; type=dtype(&#39;float32&#39;) shape=()
output: name=&#39;Y_grad&#39; type=dtype(&#39;float32&#39;) shape=()
</pre></div>
</div>
<p>benchmark</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>
    <span class="n">lo</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cl</span><span class="p">)</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lo</span>


<span class="n">fct_numpy</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="p">(</span><span class="n">loss</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">expit</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span>
    <span class="s1">&#39;grad_sigmoid_neg_log_loss_error&#39;</span><span class="p">,</span> <span class="n">fct_onx</span><span class="p">,</span> <span class="n">fct_numpy</span><span class="p">,</span>
    <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">all_rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/8 [00:00&lt;?, ?it/s]
 12%|#2        | 1/8 [00:01&lt;00:12,  1.81s/it]
 25%|##5       | 2/8 [00:03&lt;00:11,  1.87s/it]
 38%|###7      | 3/8 [00:06&lt;00:12,  2.41s/it]
 50%|#####     | 4/8 [00:10&lt;00:12,  3.13s/it]
 62%|######2   | 5/8 [00:18&lt;00:14,  4.74s/it]
 75%|#######5  | 6/8 [00:32&lt;00:15,  7.71s/it]
 88%|########7 | 7/8 [00:45&lt;00:09,  9.60s/it]
100%|##########| 8/8 [00:59&lt;00:00, 10.84s/it]
100%|##########| 8/8 [00:59&lt;00:00,  7.38s/it]
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>impl</th>
      <th>bind_run</th>
      <th>numpy</th>
      <th>run</th>
      <th>sess</th>
    </tr>
    <tr>
      <th>dim</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.007246</td>
      <td>0.032292</td>
      <td>0.004600</td>
      <td>0.006824</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.007825</td>
      <td>0.034267</td>
      <td>0.005167</td>
      <td>0.007362</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.011676</td>
      <td>0.054584</td>
      <td>0.009018</td>
      <td>0.011367</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.015957</td>
      <td>0.075253</td>
      <td>0.013220</td>
      <td>0.015670</td>
    </tr>
    <tr>
      <th>500</th>
      <td>0.028750</td>
      <td>0.135132</td>
      <td>0.025942</td>
      <td>0.028400</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>0.049898</td>
      <td>0.239883</td>
      <td>0.046879</td>
      <td>0.050397</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>0.050270</td>
      <td>0.240150</td>
      <td>0.047119</td>
      <td>0.049828</td>
    </tr>
    <tr>
      <th>10000</th>
      <td>0.050023</td>
      <td>0.240576</td>
      <td>0.046890</td>
      <td>0.049994</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lower is better&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_benchmark_onnx_function_009.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_009.png" alt="grad_sigmoid_neg_log_loss_error lower is better" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;grad_sigmoid_neg_log_loss_error\nlower is better&#39;)
</pre></div>
</div>
</section>
<section id="results">
<h2><a class="toc-backref" href="#id11">Results</a><a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_rows</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average</th>
      <th>deviation</th>
      <th>min_exec</th>
      <th>max_exec</th>
      <th>repeat</th>
      <th>number</th>
      <th>ttime</th>
      <th>context_size</th>
      <th>name</th>
      <th>impl</th>
      <th>dim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.002472</td>
      <td>0.000016</td>
      <td>0.002451</td>
      <td>0.002533</td>
      <td>50</td>
      <td>100</td>
      <td>0.123616</td>
      <td>64</td>
      <td>axpy</td>
      <td>numpy</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.003834</td>
      <td>0.000048</td>
      <td>0.003807</td>
      <td>0.003975</td>
      <td>10</td>
      <td>50</td>
      <td>0.038343</td>
      <td>64</td>
      <td>axpy</td>
      <td>sess</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.004020</td>
      <td>0.000032</td>
      <td>0.004004</td>
      <td>0.004114</td>
      <td>10</td>
      <td>50</td>
      <td>0.040200</td>
      <td>64</td>
      <td>axpy</td>
      <td>bind_run</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001767</td>
      <td>0.000022</td>
      <td>0.001750</td>
      <td>0.001827</td>
      <td>10</td>
      <td>50</td>
      <td>0.017672</td>
      <td>64</td>
      <td>axpy</td>
      <td>run</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.002464</td>
      <td>0.000014</td>
      <td>0.002445</td>
      <td>0.002531</td>
      <td>50</td>
      <td>100</td>
      <td>0.123204</td>
      <td>64</td>
      <td>axpy</td>
      <td>numpy</td>
      <td>10</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>315</th>
      <td>0.047119</td>
      <td>0.000050</td>
      <td>0.047072</td>
      <td>0.047253</td>
      <td>10</td>
      <td>50</td>
      <td>0.471192</td>
      <td>64</td>
      <td>grad_sigmoid_neg_log_loss_error</td>
      <td>run</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>316</th>
      <td>0.240576</td>
      <td>0.000649</td>
      <td>0.239843</td>
      <td>0.242718</td>
      <td>50</td>
      <td>100</td>
      <td>12.028781</td>
      <td>64</td>
      <td>grad_sigmoid_neg_log_loss_error</td>
      <td>numpy</td>
      <td>10000</td>
    </tr>
    <tr>
      <th>317</th>
      <td>0.049994</td>
      <td>0.000101</td>
      <td>0.049930</td>
      <td>0.050287</td>
      <td>10</td>
      <td>50</td>
      <td>0.499941</td>
      <td>64</td>
      <td>grad_sigmoid_neg_log_loss_error</td>
      <td>sess</td>
      <td>10000</td>
    </tr>
    <tr>
      <th>318</th>
      <td>0.050023</td>
      <td>0.000121</td>
      <td>0.049916</td>
      <td>0.050353</td>
      <td>10</td>
      <td>50</td>
      <td>0.500229</td>
      <td>64</td>
      <td>grad_sigmoid_neg_log_loss_error</td>
      <td>bind_run</td>
      <td>10000</td>
    </tr>
    <tr>
      <th>319</th>
      <td>0.046890</td>
      <td>0.000041</td>
      <td>0.046851</td>
      <td>0.047002</td>
      <td>10</td>
      <td>50</td>
      <td>0.468904</td>
      <td>64</td>
      <td>grad_sigmoid_neg_log_loss_error</td>
      <td>run</td>
      <td>10000</td>
    </tr>
  </tbody>
</table>
<p>320 rows × 11 columns</p>
</div>
</div>
<br />
<br /><p>Pivot</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">piv</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">)</span>
<span class="n">piv</span>
<span class="nb">print</span><span class="p">(</span><span class="n">piv</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>dim                                          1      ...     10000
name                            impl                ...
axpy                            bind_run  0.004020  ...  0.005004
                                numpy     0.002472  ...  0.004765
                                run       0.001767  ...  0.002741
                                sess      0.003834  ...  0.005211
axpyw                           bind_run  0.005410  ...  0.007290
                                numpy     0.008006  ...  0.016235
                                run       0.002002  ...  0.003779
                                sess      0.004804  ...  0.007562
axpyw2                          bind_run  0.005715  ...  0.008592
                                numpy     0.011349  ...  0.023808
                                run       0.002276  ...  0.004910
                                sess      0.005124  ...  0.009274
copy                            bind_run  0.002721  ...  0.002981
                                numpy     0.000649  ...  0.001324
                                run       0.001098  ...  0.001353
                                sess      0.002707  ...  0.003254
grad_loss_absolute_error        bind_run  0.004892  ...  0.009012
                                numpy     0.005378  ...  0.015590
                                run       0.002343  ...  0.006411
                                sess      0.004455  ...  0.008881
grad_loss_elastic_error         bind_run  0.006727  ...  0.014107
                                numpy     0.018878  ...  0.036410
                                run       0.004245  ...  0.011520
                                sess      0.006339  ...  0.014311
grad_loss_square_error          bind_run  0.004992  ...  0.006152
                                numpy     0.006728  ...  0.012709
                                run       0.002403  ...  0.003568
                                sess      0.004590  ...  0.006112
grad_sigmoid_neg_log_loss_error bind_run  0.007246  ...  0.050023
                                numpy     0.032292  ...  0.240576
                                run       0.004600  ...  0.046890
                                sess      0.006824  ...  0.049994
n_penalty_elastic_error         bind_run  0.004585  ...  0.005448
                                numpy     0.011367  ...  0.015799
                                run       0.002621  ...  0.003486
                                sess      0.004443  ...  0.005266
update_penalty_elastic_error    bind_run  0.003592  ...  0.007912
                                numpy     0.006939  ...  0.017042
                                run       0.001929  ...  0.006264
                                sess      0.003570  ...  0.008486

[40 rows x 8 columns]
</pre></div>
</div>
<p>Graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>


<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))):</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
    <span class="n">piv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="s1">&#39;impl&#39;</span><span class="p">,</span> <span class="s1">&#39;average&#39;</span><span class="p">)</span>
    <span class="n">piv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;lower is better&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>


<span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;lower is better&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>


<span class="c1"># plt.show()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_plot_benchmark_onnx_function_010.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_010.png" alt="lower is better, axpy, axpyw, axpyw2, copy" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_plot_benchmark_onnx_function_011.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_011.png" alt="lower is better, grad_loss_absolute_error, grad_loss_elastic_error, grad_loss_square_error, grad_sigmoid_neg_log_loss_error" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_plot_benchmark_onnx_function_012.png" srcset="../_images/sphx_glr_plot_benchmark_onnx_function_012.png" alt="lower is better, n_penalty_elastic_error, update_penalty_elastic_error" class = "sphx-glr-multi-img"/></li>
</ul>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 2 minutes  28.826 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-gyexamples-plot-benchmark-onnx-function-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/83b9612400a88aa5b452789221aea6e3/plot_benchmark_onnx_function.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_benchmark_onnx_function.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e176ceb345aa5b6b998f44a9281af86b/plot_benchmark_onnx_function.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_benchmark_onnx_function.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="plot_orttraining_benchmark_fwbw_cls.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Benchmark, comparison sklearn - forward-backward - classification</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../tutorials/tutorial_bench/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Benchmarking and profiling Tutorial</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>