
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Stochastic Gradient Descent on simple function &#8212; onnxcustom</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style_notebook_snippet.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxtrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../_static/my-styles.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/require.js"></script>
    <script src="../_static/embed-amd.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../_static/sphinxtrib-images/LightBox2/lightbox2_customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Notebooks Coverage" href="../all_notebooks_coverage.html" />
    <link rel="prev" title="Convert a tree into ONNX" href="tree_to_onnx.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/project_ico.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../tutorials/index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/apis.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../gyexamples/index.html">
  Examples Gallery
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../all_notebooks.html">
  Notebooks Gallery
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../other_pages.html">
  Other pages
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../blog/blogindex.html">
  Blog Gallery
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tree_to_onnx.html">
   Convert a tree into ONNX
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Stochastic Gradient Descent on simple function
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../all_notebooks_coverage.html">
   Notebooks Coverage
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-simple-problem">
   A simple problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gradient-retropropagation">
   Gradient : retropropagation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-a-square-loss">
   Add a square loss
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gradient-again-loss-retropropagation">
   Gradient again : loss + retropropagation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trainingsession">
   TrainingSession
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fordward-backward-trainingagent">
   Fordward backward: TrainingAgent
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mlpregressor">
   MLPregressor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#not-exactly-the-same-nesterov">
   Not exactly the same: Nesterov?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#profiling">
   Profiling
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="stochastic-gradient-descent-on-simple-function">
<span id="onnxruntimetrainingnbrst"></span><h1>Stochastic Gradient Descent on simple function<a class="headerlink" href="#stochastic-gradient-descent-on-simple-function" title="Permalink to this headline">¶</a></h1>
<p><strong>Links:</strong> <a class="reference download internal" download="" href="../_downloads/81a1fe0177ef0b28240cd85c24484274/onnxruntime_training_nb.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">notebook</span></code></a>, <a class="reference internal" href="onnxruntime_training_nb2html.html">html</a>, <a class="reference download internal" download="" href="../_downloads/28cfb5b3f5247212e82f093386b3eb76/onnxruntime_training_nb.pdf"><code class="xref download docutils literal notranslate"><span class="pre">PDF</span></code></a>, <a class="reference download internal" download="" href="../_downloads/a528705cd2011038a58ba93febe8ac3b/onnxruntime_training_nb.py"><code class="xref download docutils literal notranslate"><span class="pre">python</span></code></a>, <a class="reference internal" href="onnxruntime_training_nb.slides.html">slides</a>, <a class="reference external" href="https://github.com/sdpython/onnxcustom/blob/master/_doc/notebooks/onnxruntime_training_nb.ipynb">GitHub</a></p>
<p><a class="reference external" href="https://github.com/microsoft/onnxruntime">onnxruntime-training</a> is
an extension onnxruntime or more precisely the same library compiled
with different settings. It provides a way to compute a gradient of a
function defined by an ONNX graph.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jyquickhelper</span> <span class="kn">import</span> <span class="n">add_notebook_menu</span>
<span class="n">add_notebook_menu</span><span class="p">()</span>
</pre></div>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#a-simple-problem" id="id1">A simple problem</a></p></li>
<li><p><a class="reference internal" href="#gradient-retropropagation" id="id2">Gradient : retropropagation</a></p></li>
<li><p><a class="reference internal" href="#add-a-square-loss" id="id3">Add a square loss</a></p></li>
<li><p><a class="reference internal" href="#gradient-again-loss-retropropagation" id="id4">Gradient again : loss + retropropagation</a></p></li>
<li><p><a class="reference internal" href="#trainingsession" id="id5">TrainingSession</a></p></li>
<li><p><a class="reference internal" href="#fordward-backward-trainingagent" id="id6">Fordward backward: TrainingAgent</a></p></li>
<li><p><a class="reference internal" href="#mlpregressor" id="id7">MLPregressor</a></p></li>
<li><p><a class="reference internal" href="#not-exactly-the-same-nesterov" id="id8">Not exactly the same: Nesterov?</a></p></li>
<li><p><a class="reference internal" href="#profiling" id="id9">Profiling</a></p></li>
</ul>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> mlprodict
</pre></div>
</div>
<section id="a-simple-problem">
<h2><a class="toc-backref" href="#id1">A simple problem</a><a class="headerlink" href="#a-simple-problem" title="Permalink to this headline">¶</a></h2>
<p>Let’s choose a simple regression problem defined by
<img class="math" src="../_images/math/ba5b1fb569b1337db3798e94e852ce0f6afb5ea4.svg" alt="z = -1 - 2x + 3y + \frac{1}{2}x^2 -\frac{1}{3} y^2 +\epsilon"/> and
we try to approximate by a function
<img class="math" src="../_images/math/ea6628e36d2fc2b8add067181469b5c50fa133f2.svg" alt="f(x,y) = a + bx + cy + dx^2 + ey^2"/>. Every coefficient is
determined from an optimization problem solved with a stochastic
gradient descent.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">mlprodict.npy.numpy_onnx_impl</span> <span class="k">as</span> <span class="nn">npnx</span>
<span class="kn">from</span> <span class="nn">mlprodict.npy</span> <span class="kn">import</span> <span class="n">onnxnumpy_default</span><span class="p">,</span> <span class="n">NDArray</span>


<span class="nd">@onnxnumpy_default</span>
<span class="k">def</span> <span class="nf">fct</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
    <span class="n">coef_x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">coef_x2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.33333</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">coef_x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">coef_x2</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">poly</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bias</span>
    <span class="k">return</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">fct</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span>        <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">2.5</span>       <span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.6666701</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.16667008</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.6666799</span> <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">onnxview</span> fct.to_onnx()
</pre></div>
</div>
<div id="M8f6b27c914ca4a3a93cfaf1a2e26fcdf-cont"><div id="M8f6b27c914ca4a3a93cfaf1a2e26fcdf" style="width:;height:;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  size=7;\n  orientation=portrait;\n  ranksep=0.25;\n  nodesep=0.05;\n\n  x [shape=box color=red label=\"x\nfloat((0, 2))\" fontsize=10];\n\n  y [shape=box color=green label=\"y\nfloat((0, 1))\" fontsize=10];\n\n  init [shape=box label=\"init\nfloat32((1, 2))\n[[ 0.5     -0.33333]]\" fontsize=10];\n  init_1 [shape=box label=\"init_1\nfloat32((1, 2))\n[[-2.  3.]]\" fontsize=10];\n  init_2 [shape=box label=\"init_2\nint64((1,))\n[1]\" fontsize=10];\n  init_3 [shape=box label=\"init_3\nint64((1,))\n[2]\" fontsize=10];\n  init_5 [shape=box label=\"init_5\nint64((1,))\n[0]\" fontsize=10];\n  init_b10 [shape=box label=\"init_b10\nfloat32((1,))\n[-1.]\" fontsize=10];\n  init_b11 [shape=box label=\"init_b11\nint64((2,))\n[-1  1]\" fontsize=10];\n\n  out_mul_0 [shape=box label=\"out_mul_0\" fontsize=10];\n  _mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul)\" fontsize=10];\n  x -> _mul;\n  x -> _mul;\n  _mul -> out_mul_0;\n\n  out_mul_0_1 [shape=box label=\"out_mul_0_1\" fontsize=10];\n  _mul_1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_1)\" fontsize=10];\n  out_mul_0 -> _mul_1;\n  init -> _mul_1;\n  _mul_1 -> out_mul_0_1;\n\n  out_mul_0_2 [shape=box label=\"out_mul_0_2\" fontsize=10];\n  _mul_2 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_2)\" fontsize=10];\n  x -> _mul_2;\n  init_1 -> _mul_2;\n  _mul_2 -> out_mul_0_2;\n\n  out_add_0 [shape=box label=\"out_add_0\" fontsize=10];\n  _add [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add)\" fontsize=10];\n  out_mul_0_2 -> _add;\n  out_mul_0_1 -> _add;\n  _add -> out_add_0;\n\n  out_sli_0 [shape=box label=\"out_sli_0\" fontsize=10];\n  _slice [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(_slice)\" fontsize=10];\n  out_add_0 -> _slice;\n  init_2 -> _slice;\n  init_3 -> _slice;\n  init_2 -> _slice;\n  _slice -> out_sli_0;\n\n  out_sli_0_1 [shape=box label=\"out_sli_0_1\" fontsize=10];\n  _slice_1 [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(_slice_1)\" fontsize=10];\n  out_add_0 -> _slice_1;\n  init_5 -> _slice_1;\n  init_2 -> _slice_1;\n  init_2 -> _slice_1;\n  _slice_1 -> out_sli_0_1;\n\n  out_squ_0 [shape=box label=\"out_squ_0\" fontsize=10];\n  _squeeze [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(_squeeze)\" fontsize=10];\n  out_sli_0 -> _squeeze;\n  init_2 -> _squeeze;\n  _squeeze -> out_squ_0;\n\n  out_squ_0_1 [shape=box label=\"out_squ_0_1\" fontsize=10];\n  _squeeze_1 [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(_squeeze_1)\" fontsize=10];\n  out_sli_0_1 -> _squeeze_1;\n  init_2 -> _squeeze_1;\n  _squeeze_1 -> out_squ_0_1;\n\n  out_add_0_1 [shape=box label=\"out_add_0_1\" fontsize=10];\n  _add_1 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add_1)\" fontsize=10];\n  out_squ_0_1 -> _add_1;\n  out_squ_0 -> _add_1;\n  _add_1 -> out_add_0_1;\n\n  out_add_0_2 [shape=box label=\"out_add_0_2\" fontsize=10];\n  _add_2 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add_2)\" fontsize=10];\n  out_add_0_1 -> _add_2;\n  init_b10 -> _add_2;\n  _add_2 -> out_add_0_2;\n\n  _reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_reshape)\" fontsize=10];\n  out_add_0_2 -> _reshape;\n  init_b11 -> _reshape;\n  _reshape -> y;\n}");
document.getElementById('M8f6b27c914ca4a3a93cfaf1a2e26fcdf').innerHTML = svgGraph; });

</script><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlprodict.plotting.text_plot</span> <span class="kn">import</span> <span class="n">onnx_simple_text_plot</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">fct</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span>    <span class="p">,</span> <span class="o">-</span><span class="mf">0.33333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_5&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b11&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">out_mul_0</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_1</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">out_mul_0_2</span><span class="p">,</span> <span class="n">out_mul_0_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_3</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_5</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0_1</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0_1</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0_1</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">out_squ_0_1</span><span class="p">,</span> <span class="n">out_squ_0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_1</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">out_add_0_1</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_2</span>
            <span class="n">Reshape</span><span class="p">(</span><span class="n">out_add_0_2</span><span class="p">,</span> <span class="n">init_b11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gradient-retropropagation">
<h2><a class="toc-backref" href="#id2">Gradient : retropropagation</a><a class="headerlink" href="#gradient-retropropagation" title="Permalink to this headline">¶</a></h2>
<p>Let’s look into the gradient.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxcustom.training.grad_helper</span> <span class="kn">import</span> <span class="n">onnx_derivative</span><span class="p">,</span> <span class="n">DerivativeOptions</span>

<span class="n">onx</span> <span class="o">=</span> <span class="n">fct</span><span class="o">.</span><span class="n">to_onnx</span><span class="p">()</span>
<span class="n">grad</span> <span class="o">=</span> <span class="n">onnx_derivative</span><span class="p">(</span><span class="n">onx</span><span class="p">)</span>
<span class="o">%</span><span class="k">onnxview</span> grad
</pre></div>
</div>
<div id="M35735c6ae970406aafb74b702b5795a4-cont"><div id="M35735c6ae970406aafb74b702b5795a4" style="width:;height:;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  size=7;\n  orientation=portrait;\n  ranksep=0.25;\n  nodesep=0.05;\n\n  x [shape=box color=red label=\"x\nfloat((0, 2))\" fontsize=10];\n  init [shape=box color=red label=\"init\nfloat((1, 2))\" fontsize=10];\n  init_1 [shape=box color=red label=\"init_1\nfloat((1, 2))\" fontsize=10];\n  init_b10 [shape=box color=red label=\"init_b10\nfloat((1,))\" fontsize=10];\n  y_grad [shape=box color=red label=\"y_grad\nfloat((0, 1))\" fontsize=10];\n\n  x_grad [shape=box color=green label=\"x_grad\nfloat((0, 2))\" fontsize=10];\n  init_grad [shape=box color=green label=\"init_grad\nfloat((1, 2))\" fontsize=10];\n  init_1_grad [shape=box color=green label=\"init_1_grad\nfloat((1, 2))\" fontsize=10];\n  init_b10_grad [shape=box color=green label=\"init_b10_grad\nfloat((1,))\" fontsize=10];\n\n  init_5 [shape=box label=\"init_5\nint64((1,))\n[0]\" fontsize=10];\n  init_2 [shape=box label=\"init_2\nint64((1,))\n[1]\" fontsize=10];\n  init_3 [shape=box label=\"init_3\nint64((1,))\n[2]\" fontsize=10];\n\n  out_mul_0 [shape=box label=\"out_mul_0\" fontsize=10];\n  _mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul)\" fontsize=10];\n  x -> _mul;\n  x -> _mul;\n  _mul -> out_mul_0;\n\n  out_mul_0_1 [shape=box label=\"out_mul_0_1\" fontsize=10];\n  _mul_1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_1)\" fontsize=10];\n  out_mul_0 -> _mul_1;\n  init -> _mul_1;\n  _mul_1 -> out_mul_0_1;\n\n  out_mul_0_2 [shape=box label=\"out_mul_0_2\" fontsize=10];\n  _mul_2 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_2)\" fontsize=10];\n  x -> _mul_2;\n  init_1 -> _mul_2;\n  _mul_2 -> out_mul_0_2;\n\n  out_add_0 [shape=box label=\"out_add_0\" fontsize=10];\n  _add [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add)\" fontsize=10];\n  out_mul_0_2 -> _add;\n  out_mul_0_1 -> _add;\n  _add -> out_add_0;\n\n  out_sli_0 [shape=box label=\"out_sli_0\" fontsize=10];\n  _slice [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(_slice)\" fontsize=10];\n  out_add_0 -> _slice;\n  init_2 -> _slice;\n  init_3 -> _slice;\n  init_2 -> _slice;\n  _slice -> out_sli_0;\n\n  out_squ_0 [shape=box label=\"out_squ_0\" fontsize=10];\n  _squeeze [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(_squeeze)\" fontsize=10];\n  out_sli_0 -> _squeeze;\n  init_2 -> _squeeze;\n  _squeeze -> out_squ_0;\n\n  out_sli_0_1 [shape=box label=\"out_sli_0_1\" fontsize=10];\n  _slice_1 [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(_slice_1)\" fontsize=10];\n  out_add_0 -> _slice_1;\n  init_5 -> _slice_1;\n  init_2 -> _slice_1;\n  init_2 -> _slice_1;\n  _slice_1 -> out_sli_0_1;\n\n  out_squ_0_1 [shape=box label=\"out_squ_0_1\" fontsize=10];\n  _squeeze_1 [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(_squeeze_1)\" fontsize=10];\n  out_sli_0_1 -> _squeeze_1;\n  init_2 -> _squeeze_1;\n  _squeeze_1 -> out_squ_0_1;\n\n  out_add_0_1 [shape=box label=\"out_add_0_1\" fontsize=10];\n  _add_1 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add_1)\" fontsize=10];\n  out_squ_0_1 -> _add_1;\n  out_squ_0 -> _add_1;\n  _add_1 -> out_add_0_1;\n\n  out_add_0_2 [shape=box label=\"out_add_0_2\" fontsize=10];\n  _add_2 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add_2)\" fontsize=10];\n  out_add_0_1 -> _add_2;\n  init_b10 -> _add_2;\n  _add_2 -> out_add_0_2;\n\n  _reshape_Grad_x_shape [shape=box label=\"_reshape_Grad_x_shape\" fontsize=10];\n  _reshape_Grad_Shape_0 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_reshape_Grad_Shape_0)\" fontsize=10];\n  out_add_0_2 -> _reshape_Grad_Shape_0;\n  _reshape_Grad_Shape_0 -> _reshape_Grad_x_shape;\n\n  out_add_0_2_grad [shape=box label=\"out_add_0_2_grad\" fontsize=10];\n  _reshape_Grad_Reshape_1 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_reshape_Grad_Reshape_1)\nallowzero=0\" fontsize=10];\n  y_grad -> _reshape_Grad_Reshape_1;\n  _reshape_Grad_x_shape -> _reshape_Grad_Reshape_1;\n  _reshape_Grad_Reshape_1 -> out_add_0_2_grad;\n\n  _add_2_Grad_Shape_init_b10 [shape=box label=\"_add_2_Grad_Shape_init_b10\" fontsize=10];\n  _add_2_Grad_Shape_init_b10_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_add_2_Grad_Shape_init_b10_rhs)\" fontsize=10];\n  init_b10 -> _add_2_Grad_Shape_init_b10_rhs;\n  _add_2_Grad_Shape_init_b10_rhs -> _add_2_Grad_Shape_init_b10;\n\n  _add_2_Grad_Shape_out_add_0_1 [shape=box label=\"_add_2_Grad_Shape_out_add_0_1\" fontsize=10];\n  _add_2_Grad_Shape_out_add_0_1_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_add_2_Grad_Shape_out_add_0_1_lhs)\" fontsize=10];\n  out_add_0_1 -> _add_2_Grad_Shape_out_add_0_1_lhs;\n  _add_2_Grad_Shape_out_add_0_1_lhs -> _add_2_Grad_Shape_out_add_0_1;\n\n  _add_2_Grad_ReduceAxes_out_add_0_1 [shape=box label=\"_add_2_Grad_ReduceAxes_out_add_0_1\" fontsize=10];\n  _add_2_Grad_ReduceAxes_init_b10 [shape=box label=\"_add_2_Grad_ReduceAxes_init_b10\" fontsize=10];\n  _add_2_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(_add_2_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  _add_2_Grad_Shape_out_add_0_1 -> _add_2_Grad_BroadcastGradientArgs_2;\n  _add_2_Grad_Shape_init_b10 -> _add_2_Grad_BroadcastGradientArgs_2;\n  _add_2_Grad_BroadcastGradientArgs_2 -> _add_2_Grad_ReduceAxes_out_add_0_1;\n  _add_2_Grad_BroadcastGradientArgs_2 -> _add_2_Grad_ReduceAxes_init_b10;\n\n  _add_2_Grad_ReduceSum_out_add_0_2_grad_for_out_add_0_1 [shape=box label=\"_add_2_Grad_ReduceSum_out_add_0_2_grad_for_out_add_0_1\" fontsize=10];\n  _add_2_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_add_2_Grad_ReduceSum_3)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  out_add_0_2_grad -> _add_2_Grad_ReduceSum_3;\n  _add_2_Grad_ReduceAxes_out_add_0_1 -> _add_2_Grad_ReduceSum_3;\n  _add_2_Grad_ReduceSum_3 -> _add_2_Grad_ReduceSum_out_add_0_2_grad_for_out_add_0_1;\n\n  out_add_0_1_grad [shape=box label=\"out_add_0_1_grad\" fontsize=10];\n  _add_2_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_add_2_Grad_Reshape_4)\nallowzero=0\" fontsize=10];\n  _add_2_Grad_ReduceSum_out_add_0_2_grad_for_out_add_0_1 -> _add_2_Grad_Reshape_4;\n  _add_2_Grad_Shape_out_add_0_1 -> _add_2_Grad_Reshape_4;\n  _add_2_Grad_Reshape_4 -> out_add_0_1_grad;\n\n  _add_1_Grad_Shape_out_squ_0 [shape=box label=\"_add_1_Grad_Shape_out_squ_0\" fontsize=10];\n  _add_1_Grad_Shape_out_squ_0_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_add_1_Grad_Shape_out_squ_0_rhs)\" fontsize=10];\n  out_squ_0 -> _add_1_Grad_Shape_out_squ_0_rhs;\n  _add_1_Grad_Shape_out_squ_0_rhs -> _add_1_Grad_Shape_out_squ_0;\n\n  _add_1_Grad_Shape_out_squ_0_1 [shape=box label=\"_add_1_Grad_Shape_out_squ_0_1\" fontsize=10];\n  _add_1_Grad_Shape_out_squ_0_1_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_add_1_Grad_Shape_out_squ_0_1_lhs)\" fontsize=10];\n  out_squ_0_1 -> _add_1_Grad_Shape_out_squ_0_1_lhs;\n  _add_1_Grad_Shape_out_squ_0_1_lhs -> _add_1_Grad_Shape_out_squ_0_1;\n\n  _add_1_Grad_ReduceAxes_out_squ_0_1 [shape=box label=\"_add_1_Grad_ReduceAxes_out_squ_0_1\" fontsize=10];\n  _add_1_Grad_ReduceAxes_out_squ_0 [shape=box label=\"_add_1_Grad_ReduceAxes_out_squ_0\" fontsize=10];\n  _add_1_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(_add_1_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  _add_1_Grad_Shape_out_squ_0_1 -> _add_1_Grad_BroadcastGradientArgs_2;\n  _add_1_Grad_Shape_out_squ_0 -> _add_1_Grad_BroadcastGradientArgs_2;\n  _add_1_Grad_BroadcastGradientArgs_2 -> _add_1_Grad_ReduceAxes_out_squ_0_1;\n  _add_1_Grad_BroadcastGradientArgs_2 -> _add_1_Grad_ReduceAxes_out_squ_0;\n\n  _add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0 [shape=box label=\"_add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0\" fontsize=10];\n  _add_1_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_add_1_Grad_ReduceSum_5)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  out_add_0_1_grad -> _add_1_Grad_ReduceSum_5;\n  _add_1_Grad_ReduceAxes_out_squ_0 -> _add_1_Grad_ReduceSum_5;\n  _add_1_Grad_ReduceSum_5 -> _add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0;\n\n  out_squ_0_grad [shape=box label=\"out_squ_0_grad\" fontsize=10];\n  _add_1_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_add_1_Grad_Reshape_6)\nallowzero=0\" fontsize=10];\n  _add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0 -> _add_1_Grad_Reshape_6;\n  _add_1_Grad_Shape_out_squ_0 -> _add_1_Grad_Reshape_6;\n  _add_1_Grad_Reshape_6 -> out_squ_0_grad;\n\n  out_sli_0_grad [shape=box label=\"out_sli_0_grad\" fontsize=10];\n  _squeeze_Grad_Unsqueeze_0 [shape=box style=\"filled,rounded\" color=orange label=\"Unsqueeze\n(_squeeze_Grad_Unsqueeze_0)\" fontsize=10];\n  out_squ_0_grad -> _squeeze_Grad_Unsqueeze_0;\n  init_2 -> _squeeze_Grad_Unsqueeze_0;\n  _squeeze_Grad_Unsqueeze_0 -> out_sli_0_grad;\n\n  _slice_Grad_I0_shape [shape=box label=\"_slice_Grad_I0_shape\" fontsize=10];\n  _slice_Grad_Shape_0 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_slice_Grad_Shape_0)\" fontsize=10];\n  out_add_0 -> _slice_Grad_Shape_0;\n  _slice_Grad_Shape_0 -> _slice_Grad_I0_shape;\n\n  out_add_0_grad_1 [shape=box label=\"out_add_0_grad_1\" fontsize=10];\n  _slice_Grad_SliceGrad_1 [shape=box style=\"filled,rounded\" color=orange label=\"SliceGrad\n(_slice_Grad_SliceGrad_1)\" fontsize=10];\n  out_sli_0_grad -> _slice_Grad_SliceGrad_1;\n  _slice_Grad_I0_shape -> _slice_Grad_SliceGrad_1;\n  init_2 -> _slice_Grad_SliceGrad_1;\n  init_3 -> _slice_Grad_SliceGrad_1;\n  init_2 -> _slice_Grad_SliceGrad_1;\n  _slice_Grad_SliceGrad_1 -> out_add_0_grad_1;\n\n  _add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0_1 [shape=box label=\"_add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0_1\" fontsize=10];\n  _add_1_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_add_1_Grad_ReduceSum_3)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  out_add_0_1_grad -> _add_1_Grad_ReduceSum_3;\n  _add_1_Grad_ReduceAxes_out_squ_0_1 -> _add_1_Grad_ReduceSum_3;\n  _add_1_Grad_ReduceSum_3 -> _add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0_1;\n\n  out_squ_0_1_grad [shape=box label=\"out_squ_0_1_grad\" fontsize=10];\n  _add_1_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_add_1_Grad_Reshape_4)\nallowzero=0\" fontsize=10];\n  _add_1_Grad_ReduceSum_out_add_0_1_grad_for_out_squ_0_1 -> _add_1_Grad_Reshape_4;\n  _add_1_Grad_Shape_out_squ_0_1 -> _add_1_Grad_Reshape_4;\n  _add_1_Grad_Reshape_4 -> out_squ_0_1_grad;\n\n  out_sli_0_1_grad [shape=box label=\"out_sli_0_1_grad\" fontsize=10];\n  _squeeze_1_Grad_Unsqueeze_0 [shape=box style=\"filled,rounded\" color=orange label=\"Unsqueeze\n(_squeeze_1_Grad_Unsqueeze_0)\" fontsize=10];\n  out_squ_0_1_grad -> _squeeze_1_Grad_Unsqueeze_0;\n  init_2 -> _squeeze_1_Grad_Unsqueeze_0;\n  _squeeze_1_Grad_Unsqueeze_0 -> out_sli_0_1_grad;\n\n  out_add_0_grad_0 [shape=box label=\"out_add_0_grad_0\" fontsize=10];\n  _slice_1_Grad_SliceGrad_1 [shape=box style=\"filled,rounded\" color=orange label=\"SliceGrad\n(_slice_1_Grad_SliceGrad_1)\" fontsize=10];\n  out_sli_0_1_grad -> _slice_1_Grad_SliceGrad_1;\n  _slice_Grad_I0_shape -> _slice_1_Grad_SliceGrad_1;\n  init_5 -> _slice_1_Grad_SliceGrad_1;\n  init_2 -> _slice_1_Grad_SliceGrad_1;\n  init_2 -> _slice_1_Grad_SliceGrad_1;\n  _slice_1_Grad_SliceGrad_1 -> out_add_0_grad_0;\n\n  out_add_0_grad [shape=box label=\"out_add_0_grad\" fontsize=10];\n  AccumulateGrad_out_add_0_grad [shape=box style=\"filled,rounded\" color=orange label=\"Sum\n(AccumulateGrad_out_add_0_grad)\" fontsize=10];\n  out_add_0_grad_0 -> AccumulateGrad_out_add_0_grad;\n  out_add_0_grad_1 -> AccumulateGrad_out_add_0_grad;\n  AccumulateGrad_out_add_0_grad -> out_add_0_grad;\n\n  _add_Grad_Shape_out_mul_0_1 [shape=box label=\"_add_Grad_Shape_out_mul_0_1\" fontsize=10];\n  _add_Grad_Shape_out_mul_0_1_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_add_Grad_Shape_out_mul_0_1_rhs)\" fontsize=10];\n  out_mul_0_1 -> _add_Grad_Shape_out_mul_0_1_rhs;\n  _add_Grad_Shape_out_mul_0_1_rhs -> _add_Grad_Shape_out_mul_0_1;\n\n  _add_Grad_Shape_out_mul_0_2 [shape=box label=\"_add_Grad_Shape_out_mul_0_2\" fontsize=10];\n  _add_Grad_Shape_out_mul_0_2_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_add_Grad_Shape_out_mul_0_2_lhs)\" fontsize=10];\n  out_mul_0_2 -> _add_Grad_Shape_out_mul_0_2_lhs;\n  _add_Grad_Shape_out_mul_0_2_lhs -> _add_Grad_Shape_out_mul_0_2;\n\n  _add_Grad_ReduceAxes_out_mul_0_2 [shape=box label=\"_add_Grad_ReduceAxes_out_mul_0_2\" fontsize=10];\n  _add_Grad_ReduceAxes_out_mul_0_1 [shape=box label=\"_add_Grad_ReduceAxes_out_mul_0_1\" fontsize=10];\n  _add_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(_add_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  _add_Grad_Shape_out_mul_0_2 -> _add_Grad_BroadcastGradientArgs_2;\n  _add_Grad_Shape_out_mul_0_1 -> _add_Grad_BroadcastGradientArgs_2;\n  _add_Grad_BroadcastGradientArgs_2 -> _add_Grad_ReduceAxes_out_mul_0_2;\n  _add_Grad_BroadcastGradientArgs_2 -> _add_Grad_ReduceAxes_out_mul_0_1;\n\n  _add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_1 [shape=box label=\"_add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_1\" fontsize=10];\n  _add_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_add_Grad_ReduceSum_5)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  out_add_0_grad -> _add_Grad_ReduceSum_5;\n  _add_Grad_ReduceAxes_out_mul_0_1 -> _add_Grad_ReduceSum_5;\n  _add_Grad_ReduceSum_5 -> _add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_1;\n\n  out_mul_0_1_grad [shape=box label=\"out_mul_0_1_grad\" fontsize=10];\n  _add_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_add_Grad_Reshape_6)\nallowzero=0\" fontsize=10];\n  _add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_1 -> _add_Grad_Reshape_6;\n  _add_Grad_Shape_out_mul_0_1 -> _add_Grad_Reshape_6;\n  _add_Grad_Reshape_6 -> out_mul_0_1_grad;\n\n  _mul_1_Grad_PreReduceGrad0 [shape=box label=\"_mul_1_Grad_PreReduceGrad0\" fontsize=10];\n  _mul_1_Grad_Mul_3 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_1_Grad_Mul_3)\" fontsize=10];\n  out_mul_0_1_grad -> _mul_1_Grad_Mul_3;\n  init -> _mul_1_Grad_Mul_3;\n  _mul_1_Grad_Mul_3 -> _mul_1_Grad_PreReduceGrad0;\n\n  _mul_1_Grad_Shape_init [shape=box label=\"_mul_1_Grad_Shape_init\" fontsize=10];\n  _mul_1_Grad_Shape_init_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_mul_1_Grad_Shape_init_rhs)\" fontsize=10];\n  init -> _mul_1_Grad_Shape_init_rhs;\n  _mul_1_Grad_Shape_init_rhs -> _mul_1_Grad_Shape_init;\n\n  _mul_1_Grad_Shape_out_mul_0 [shape=box label=\"_mul_1_Grad_Shape_out_mul_0\" fontsize=10];\n  _mul_1_Grad_Shape_out_mul_0_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_mul_1_Grad_Shape_out_mul_0_lhs)\" fontsize=10];\n  out_mul_0 -> _mul_1_Grad_Shape_out_mul_0_lhs;\n  _mul_1_Grad_Shape_out_mul_0_lhs -> _mul_1_Grad_Shape_out_mul_0;\n\n  _mul_1_Grad_ReduceAxes_out_mul_0 [shape=box label=\"_mul_1_Grad_ReduceAxes_out_mul_0\" fontsize=10];\n  _mul_1_Grad_ReduceAxes_init [shape=box label=\"_mul_1_Grad_ReduceAxes_init\" fontsize=10];\n  _mul_1_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(_mul_1_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  _mul_1_Grad_Shape_out_mul_0 -> _mul_1_Grad_BroadcastGradientArgs_2;\n  _mul_1_Grad_Shape_init -> _mul_1_Grad_BroadcastGradientArgs_2;\n  _mul_1_Grad_BroadcastGradientArgs_2 -> _mul_1_Grad_ReduceAxes_out_mul_0;\n  _mul_1_Grad_BroadcastGradientArgs_2 -> _mul_1_Grad_ReduceAxes_init;\n\n  _mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad0_for_out_mul_0 [shape=box label=\"_mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad0_for_out_mul_0\" fontsize=10];\n  _mul_1_Grad_ReduceSum_4 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_mul_1_Grad_ReduceSum_4)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  _mul_1_Grad_PreReduceGrad0 -> _mul_1_Grad_ReduceSum_4;\n  _mul_1_Grad_ReduceAxes_out_mul_0 -> _mul_1_Grad_ReduceSum_4;\n  _mul_1_Grad_ReduceSum_4 -> _mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad0_for_out_mul_0;\n\n  out_mul_0_grad [shape=box label=\"out_mul_0_grad\" fontsize=10];\n  _mul_1_Grad_Reshape_5 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_mul_1_Grad_Reshape_5)\nallowzero=0\" fontsize=10];\n  _mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad0_for_out_mul_0 -> _mul_1_Grad_Reshape_5;\n  _mul_1_Grad_Shape_out_mul_0 -> _mul_1_Grad_Reshape_5;\n  _mul_1_Grad_Reshape_5 -> out_mul_0_grad;\n\n  x_grad_2 [shape=box label=\"x_grad_2\" fontsize=10];\n  _mul_Grad_Mul_1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_Grad_Mul_1)\" fontsize=10];\n  out_mul_0_grad -> _mul_Grad_Mul_1;\n  x -> _mul_Grad_Mul_1;\n  _mul_Grad_Mul_1 -> x_grad_2;\n\n  _add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_2 [shape=box label=\"_add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_2\" fontsize=10];\n  _add_Grad_ReduceSum_3 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_add_Grad_ReduceSum_3)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  out_add_0_grad -> _add_Grad_ReduceSum_3;\n  _add_Grad_ReduceAxes_out_mul_0_2 -> _add_Grad_ReduceSum_3;\n  _add_Grad_ReduceSum_3 -> _add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_2;\n\n  out_mul_0_2_grad [shape=box label=\"out_mul_0_2_grad\" fontsize=10];\n  _add_Grad_Reshape_4 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_add_Grad_Reshape_4)\nallowzero=0\" fontsize=10];\n  _add_Grad_ReduceSum_out_add_0_grad_for_out_mul_0_2 -> _add_Grad_Reshape_4;\n  _add_Grad_Shape_out_mul_0_2 -> _add_Grad_Reshape_4;\n  _add_Grad_Reshape_4 -> out_mul_0_2_grad;\n\n  _mul_2_Grad_PreReduceGrad0 [shape=box label=\"_mul_2_Grad_PreReduceGrad0\" fontsize=10];\n  _mul_2_Grad_Mul_3 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_2_Grad_Mul_3)\" fontsize=10];\n  out_mul_0_2_grad -> _mul_2_Grad_Mul_3;\n  init_1 -> _mul_2_Grad_Mul_3;\n  _mul_2_Grad_Mul_3 -> _mul_2_Grad_PreReduceGrad0;\n\n  _mul_2_Grad_Shape_init_1 [shape=box label=\"_mul_2_Grad_Shape_init_1\" fontsize=10];\n  _mul_2_Grad_Shape_init_1_rhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_mul_2_Grad_Shape_init_1_rhs)\" fontsize=10];\n  init_1 -> _mul_2_Grad_Shape_init_1_rhs;\n  _mul_2_Grad_Shape_init_1_rhs -> _mul_2_Grad_Shape_init_1;\n\n  _mul_2_Grad_Shape_x [shape=box label=\"_mul_2_Grad_Shape_x\" fontsize=10];\n  _mul_2_Grad_Shape_x_lhs [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(_mul_2_Grad_Shape_x_lhs)\" fontsize=10];\n  x -> _mul_2_Grad_Shape_x_lhs;\n  _mul_2_Grad_Shape_x_lhs -> _mul_2_Grad_Shape_x;\n\n  _mul_2_Grad_ReduceAxes_x [shape=box label=\"_mul_2_Grad_ReduceAxes_x\" fontsize=10];\n  _mul_2_Grad_ReduceAxes_init_1 [shape=box label=\"_mul_2_Grad_ReduceAxes_init_1\" fontsize=10];\n  _mul_2_Grad_BroadcastGradientArgs_2 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(_mul_2_Grad_BroadcastGradientArgs_2)\" fontsize=10];\n  _mul_2_Grad_Shape_x -> _mul_2_Grad_BroadcastGradientArgs_2;\n  _mul_2_Grad_Shape_init_1 -> _mul_2_Grad_BroadcastGradientArgs_2;\n  _mul_2_Grad_BroadcastGradientArgs_2 -> _mul_2_Grad_ReduceAxes_x;\n  _mul_2_Grad_BroadcastGradientArgs_2 -> _mul_2_Grad_ReduceAxes_init_1;\n\n  _mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad0_for_x [shape=box label=\"_mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad0_for_x\" fontsize=10];\n  _mul_2_Grad_ReduceSum_4 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_mul_2_Grad_ReduceSum_4)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  _mul_2_Grad_PreReduceGrad0 -> _mul_2_Grad_ReduceSum_4;\n  _mul_2_Grad_ReduceAxes_x -> _mul_2_Grad_ReduceSum_4;\n  _mul_2_Grad_ReduceSum_4 -> _mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad0_for_x;\n\n  x_grad_0 [shape=box label=\"x_grad_0\" fontsize=10];\n  _mul_2_Grad_Reshape_5 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_mul_2_Grad_Reshape_5)\nallowzero=0\" fontsize=10];\n  _mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad0_for_x -> _mul_2_Grad_Reshape_5;\n  _mul_2_Grad_Shape_x -> _mul_2_Grad_Reshape_5;\n  _mul_2_Grad_Reshape_5 -> x_grad_0;\n\n  AccumulateGrad_x_grad [shape=box style=\"filled,rounded\" color=orange label=\"Sum\n(AccumulateGrad_x_grad)\" fontsize=10];\n  x_grad_0 -> AccumulateGrad_x_grad;\n  x_grad_2 -> AccumulateGrad_x_grad;\n  x_grad_2 -> AccumulateGrad_x_grad;\n  AccumulateGrad_x_grad -> x_grad;\n\n  _add_2_Grad_ReduceSum_out_add_0_2_grad_for_init_b10 [shape=box label=\"_add_2_Grad_ReduceSum_out_add_0_2_grad_for_init_b10\" fontsize=10];\n  _add_2_Grad_ReduceSum_5 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_add_2_Grad_ReduceSum_5)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  out_add_0_2_grad -> _add_2_Grad_ReduceSum_5;\n  _add_2_Grad_ReduceAxes_init_b10 -> _add_2_Grad_ReduceSum_5;\n  _add_2_Grad_ReduceSum_5 -> _add_2_Grad_ReduceSum_out_add_0_2_grad_for_init_b10;\n\n  _add_2_Grad_Reshape_6 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_add_2_Grad_Reshape_6)\nallowzero=0\" fontsize=10];\n  _add_2_Grad_ReduceSum_out_add_0_2_grad_for_init_b10 -> _add_2_Grad_Reshape_6;\n  _add_2_Grad_Shape_init_b10 -> _add_2_Grad_Reshape_6;\n  _add_2_Grad_Reshape_6 -> init_b10_grad;\n\n  _mul_1_Grad_PreReduceGrad1 [shape=box label=\"_mul_1_Grad_PreReduceGrad1\" fontsize=10];\n  _mul_1_Grad_Mul_6 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_1_Grad_Mul_6)\" fontsize=10];\n  out_mul_0_1_grad -> _mul_1_Grad_Mul_6;\n  out_mul_0 -> _mul_1_Grad_Mul_6;\n  _mul_1_Grad_Mul_6 -> _mul_1_Grad_PreReduceGrad1;\n\n  _mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad1_for_init [shape=box label=\"_mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad1_for_init\" fontsize=10];\n  _mul_1_Grad_ReduceSum_7 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_mul_1_Grad_ReduceSum_7)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  _mul_1_Grad_PreReduceGrad1 -> _mul_1_Grad_ReduceSum_7;\n  _mul_1_Grad_ReduceAxes_init -> _mul_1_Grad_ReduceSum_7;\n  _mul_1_Grad_ReduceSum_7 -> _mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad1_for_init;\n\n  _mul_1_Grad_Reshape_8 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_mul_1_Grad_Reshape_8)\nallowzero=0\" fontsize=10];\n  _mul_1_Grad_ReduceSum__mul_1_Grad_PreReduceGrad1_for_init -> _mul_1_Grad_Reshape_8;\n  _mul_1_Grad_Shape_init -> _mul_1_Grad_Reshape_8;\n  _mul_1_Grad_Reshape_8 -> init_grad;\n\n  _mul_2_Grad_PreReduceGrad1 [shape=box label=\"_mul_2_Grad_PreReduceGrad1\" fontsize=10];\n  _mul_2_Grad_Mul_6 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_2_Grad_Mul_6)\" fontsize=10];\n  out_mul_0_2_grad -> _mul_2_Grad_Mul_6;\n  x -> _mul_2_Grad_Mul_6;\n  _mul_2_Grad_Mul_6 -> _mul_2_Grad_PreReduceGrad1;\n\n  _mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad1_for_init_1 [shape=box label=\"_mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad1_for_init_1\" fontsize=10];\n  _mul_2_Grad_ReduceSum_7 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(_mul_2_Grad_ReduceSum_7)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  _mul_2_Grad_PreReduceGrad1 -> _mul_2_Grad_ReduceSum_7;\n  _mul_2_Grad_ReduceAxes_init_1 -> _mul_2_Grad_ReduceSum_7;\n  _mul_2_Grad_ReduceSum_7 -> _mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad1_for_init_1;\n\n  _mul_2_Grad_Reshape_8 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_mul_2_Grad_Reshape_8)\nallowzero=0\" fontsize=10];\n  _mul_2_Grad_ReduceSum__mul_2_Grad_PreReduceGrad1_for_init_1 -> _mul_2_Grad_Reshape_8;\n  _mul_2_Grad_Shape_init_1 -> _mul_2_Grad_Reshape_8;\n  _mul_2_Grad_Reshape_8 -> init_1_grad;\n}");
document.getElementById('M35735c6ae970406aafb74b702b5795a4').innerHTML = svgGraph; });

</script><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlprodict.plotting.text_plot</span> <span class="kn">import</span> <span class="n">onnx_text_plot_io</span><span class="p">,</span> <span class="n">onnx_simple_text_plot</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_text_plot_io</span><span class="p">(</span><span class="n">grad</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft.nchwc&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.ml&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.ms.internal.nhwc&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.training&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.preview.training&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft.experimental&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_5&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlprodict.onnx_tools.onnx_manipulations</span> <span class="kn">import</span> <span class="n">onnx_rename_names</span>
<span class="n">renamed</span> <span class="o">=</span> <span class="n">onnx_rename_names</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">renamed</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft.nchwc&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.ml&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.ms.internal.nhwc&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.training&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.preview.training&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft.experimental&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r0</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r1</span>
    <span class="n">Shape</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r32</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r3</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r4</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">r4</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r5</span>
        <span class="n">Shape</span><span class="p">(</span><span class="n">r5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r18</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r6</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">r6</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r7</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">r7</span><span class="p">,</span> <span class="n">r5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r8</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">r8</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r9</span>
            <span class="n">Shape</span><span class="p">(</span><span class="n">r9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r10</span>
              <span class="n">Reshape</span><span class="p">(</span><span class="n">y_grad</span><span class="p">,</span> <span class="n">r10</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r11</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r12</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r13</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r13</span><span class="p">,</span> <span class="n">r12</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r14</span><span class="p">,</span> <span class="n">r15</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r11</span><span class="p">,</span> <span class="n">r14</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r16</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r16</span><span class="p">,</span> <span class="n">r13</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r17</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r19</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r19</span><span class="p">,</span> <span class="n">r18</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r20</span><span class="p">,</span> <span class="n">r21</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r17</span><span class="p">,</span> <span class="n">r21</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r22</span>
      <span class="n">Reshape</span><span class="p">(</span><span class="n">r22</span><span class="p">,</span> <span class="n">r18</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r23</span>
        <span class="n">Unsqueeze</span><span class="p">(</span><span class="n">r23</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r24</span>
    <span class="n">Shape</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r25</span>
      <span class="n">SliceGrad</span><span class="p">(</span><span class="n">r24</span><span class="p">,</span> <span class="n">r25</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r26</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r17</span><span class="p">,</span> <span class="n">r20</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r27</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r27</span><span class="p">,</span> <span class="n">r19</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r28</span>
    <span class="n">Unsqueeze</span><span class="p">(</span><span class="n">r28</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r29</span>
      <span class="n">SliceGrad</span><span class="p">(</span><span class="n">r29</span><span class="p">,</span> <span class="n">r25</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r30</span>
        <span class="n">Sum</span><span class="p">(</span><span class="n">r30</span><span class="p">,</span> <span class="n">r26</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r31</span>
  <span class="n">Shape</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r33</span>
    <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r33</span><span class="p">,</span> <span class="n">r32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r34</span><span class="p">,</span> <span class="n">r35</span>
      <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r31</span><span class="p">,</span> <span class="n">r35</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r36</span>
      <span class="n">Reshape</span><span class="p">(</span><span class="n">r36</span><span class="p">,</span> <span class="n">r32</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r37</span>
        <span class="n">Mul</span><span class="p">(</span><span class="n">r37</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r38</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r39</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r40</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r40</span><span class="p">,</span> <span class="n">r39</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r41</span><span class="p">,</span> <span class="n">r42</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r38</span><span class="p">,</span> <span class="n">r41</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r43</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r43</span><span class="p">,</span> <span class="n">r40</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r44</span>
    <span class="n">Mul</span><span class="p">(</span><span class="n">r44</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r45</span>
<span class="n">ReduceSum</span><span class="p">(</span><span class="n">r31</span><span class="p">,</span> <span class="n">r34</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r46</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r46</span><span class="p">,</span> <span class="n">r33</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r47</span>
    <span class="n">Mul</span><span class="p">(</span><span class="n">r47</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r48</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r49</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r50</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r50</span><span class="p">,</span> <span class="n">r49</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r51</span><span class="p">,</span> <span class="n">r52</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r48</span><span class="p">,</span> <span class="n">r51</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r53</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r53</span><span class="p">,</span> <span class="n">r50</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r54</span>
    <span class="n">Sum</span><span class="p">(</span><span class="n">r54</span><span class="p">,</span> <span class="n">r45</span><span class="p">,</span> <span class="n">r45</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x_grad</span>
<span class="n">ReduceSum</span><span class="p">(</span><span class="n">r11</span><span class="p">,</span> <span class="n">r15</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r55</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r55</span><span class="p">,</span> <span class="n">r12</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">init_b10_grad</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">r37</span><span class="p">,</span> <span class="n">r0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r56</span>
  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r56</span><span class="p">,</span> <span class="n">r42</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r57</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r57</span><span class="p">,</span> <span class="n">r39</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">init_grad</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">r47</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r58</span>
  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r58</span><span class="p">,</span> <span class="n">r52</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r59</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r59</span><span class="p">,</span> <span class="n">r49</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">init_1_grad</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">op_type</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">grad</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span>
 <span class="s1">&#39;BroadcastGradientArgs&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Mul&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ReduceSum&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Reshape&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Shape&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Slice&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SliceGrad&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Squeeze&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Sum&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Unsqueeze&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The resulting graph assumes the gradient for <code class="docutils literal notranslate"><span class="pre">y_grad</span></code> is known. That’s
the case for a layer in a neural network. In our case, this gradient
should come from the loss. Let’s add it to the graph.</p>
</section>
<section id="add-a-square-loss">
<h2><a class="toc-backref" href="#id3">Add a square loss</a><a class="headerlink" href="#add-a-square-loss" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxcustom.utils.orttraining_helper</span> <span class="kn">import</span> <span class="n">add_loss_output</span>
<span class="n">onx_loss</span> <span class="o">=</span> <span class="n">add_loss_output</span><span class="p">(</span><span class="n">onx</span><span class="p">)</span>

<span class="o">%</span><span class="k">onnxview</span> onx_loss
</pre></div>
</div>
<div id="Me642ba63bf8e494d8c8e236c8f867838-cont"><div id="Me642ba63bf8e494d8c8e236c8f867838" style="width:;height:;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  size=7;\n  orientation=portrait;\n  ranksep=0.25;\n  nodesep=0.05;\n\n  x [shape=box color=red label=\"x\nfloat((0, 2))\" fontsize=10];\n  label [shape=box color=red label=\"label\nfloat((0, 1))\" fontsize=10];\n\n  loss [shape=box color=green label=\"loss\nfloat((1, 1))\" fontsize=10];\n  y [shape=box color=green label=\"y\nfloat((0, 1))\" fontsize=10];\n\n  init [shape=box label=\"init\nfloat32((1, 2))\n[[ 0.5     -0.33333]]\" fontsize=10];\n  init_1 [shape=box label=\"init_1\nfloat32((1, 2))\n[[-2.  3.]]\" fontsize=10];\n  init_2 [shape=box label=\"init_2\nint64((1,))\n[1]\" fontsize=10];\n  init_3 [shape=box label=\"init_3\nint64((1,))\n[2]\" fontsize=10];\n  init_5 [shape=box label=\"init_5\nint64((1,))\n[0]\" fontsize=10];\n  init_b10 [shape=box label=\"init_b10\nfloat32((1,))\n[-1.]\" fontsize=10];\n  init_b11 [shape=box label=\"init_b11\nint64((2,))\n[-1  1]\" fontsize=10];\n\n  out_mul_0 [shape=box label=\"out_mul_0\" fontsize=10];\n  _mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul)\" fontsize=10];\n  x -> _mul;\n  x -> _mul;\n  _mul -> out_mul_0;\n\n  out_mul_0_1 [shape=box label=\"out_mul_0_1\" fontsize=10];\n  _mul_1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_1)\" fontsize=10];\n  out_mul_0 -> _mul_1;\n  init -> _mul_1;\n  _mul_1 -> out_mul_0_1;\n\n  out_mul_0_2 [shape=box label=\"out_mul_0_2\" fontsize=10];\n  _mul_2 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(_mul_2)\" fontsize=10];\n  x -> _mul_2;\n  init_1 -> _mul_2;\n  _mul_2 -> out_mul_0_2;\n\n  out_add_0 [shape=box label=\"out_add_0\" fontsize=10];\n  _add [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add)\" fontsize=10];\n  out_mul_0_2 -> _add;\n  out_mul_0_1 -> _add;\n  _add -> out_add_0;\n\n  out_sli_0 [shape=box label=\"out_sli_0\" fontsize=10];\n  _slice [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(_slice)\" fontsize=10];\n  out_add_0 -> _slice;\n  init_2 -> _slice;\n  init_3 -> _slice;\n  init_2 -> _slice;\n  _slice -> out_sli_0;\n\n  out_sli_0_1 [shape=box label=\"out_sli_0_1\" fontsize=10];\n  _slice_1 [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(_slice_1)\" fontsize=10];\n  out_add_0 -> _slice_1;\n  init_5 -> _slice_1;\n  init_2 -> _slice_1;\n  init_2 -> _slice_1;\n  _slice_1 -> out_sli_0_1;\n\n  out_squ_0 [shape=box label=\"out_squ_0\" fontsize=10];\n  _squeeze [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(_squeeze)\" fontsize=10];\n  out_sli_0 -> _squeeze;\n  init_2 -> _squeeze;\n  _squeeze -> out_squ_0;\n\n  out_squ_0_1 [shape=box label=\"out_squ_0_1\" fontsize=10];\n  _squeeze_1 [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(_squeeze_1)\" fontsize=10];\n  out_sli_0_1 -> _squeeze_1;\n  init_2 -> _squeeze_1;\n  _squeeze_1 -> out_squ_0_1;\n\n  out_add_0_1 [shape=box label=\"out_add_0_1\" fontsize=10];\n  _add_1 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add_1)\" fontsize=10];\n  out_squ_0_1 -> _add_1;\n  out_squ_0 -> _add_1;\n  _add_1 -> out_add_0_1;\n\n  out_add_0_2 [shape=box label=\"out_add_0_2\" fontsize=10];\n  _add_2 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(_add_2)\" fontsize=10];\n  out_add_0_1 -> _add_2;\n  init_b10 -> _add_2;\n  _add_2 -> out_add_0_2;\n\n  _reshape [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(_reshape)\" fontsize=10];\n  out_add_0_2 -> _reshape;\n  init_b11 -> _reshape;\n  _reshape -> y;\n\n  loss_diff [shape=box label=\"loss_diff\" fontsize=10];\n  Sub [shape=box style=\"filled,rounded\" color=orange label=\"Sub\n(Sub)\" fontsize=10];\n  y -> Sub;\n  label -> Sub;\n  Sub -> loss_diff;\n\n  loss_diff_2 [shape=box label=\"loss_diff_2\" fontsize=10];\n  Mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mul)\" fontsize=10];\n  loss_diff -> Mul;\n  loss_diff -> Mul;\n  Mul -> loss_diff_2;\n\n  ReduceSum [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(ReduceSum)\" fontsize=10];\n  loss_diff_2 -> ReduceSum;\n  ReduceSum -> loss;\n}");
document.getElementById('Me642ba63bf8e494d8c8e236c8f867838').innerHTML = svgGraph; });

</script><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onx_loss</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;label&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span>    <span class="p">,</span> <span class="o">-</span><span class="mf">0.33333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_5&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b11&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">out_mul_0</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_1</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">out_mul_0_2</span><span class="p">,</span> <span class="n">out_mul_0_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_3</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_5</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0_1</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0_1</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0_1</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">out_squ_0_1</span><span class="p">,</span> <span class="n">out_squ_0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_1</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">out_add_0_1</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_2</span>
            <span class="n">Reshape</span><span class="p">(</span><span class="n">out_add_0_2</span><span class="p">,</span> <span class="n">init_b11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span>
              <span class="n">Sub</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss_diff</span>
                <span class="n">Mul</span><span class="p">(</span><span class="n">loss_diff</span><span class="p">,</span> <span class="n">loss_diff</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss_diff_2</span>
                  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">loss_diff_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The graph has 5 inputs: <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code> or the expected target, and the
weights and two outputs, the function output and the loss. We don’t need
the first one so we remove it.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlprodict.onnx_tools.onnx_manipulations</span> <span class="kn">import</span> <span class="n">select_model_inputs_outputs</span>

<span class="n">onx_loss_only</span> <span class="o">=</span> <span class="n">select_model_inputs_outputs</span><span class="p">(</span><span class="n">onx_loss</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onx_loss_only</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;label&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span>    <span class="p">,</span> <span class="o">-</span><span class="mf">0.33333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_5&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b11&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">out_mul_0</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_1</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">out_mul_0_2</span><span class="p">,</span> <span class="n">out_mul_0_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_5</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0_1</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0_1</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0_1</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_3</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">out_squ_0_1</span><span class="p">,</span> <span class="n">out_squ_0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_1</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">out_add_0_1</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_2</span>
            <span class="n">Reshape</span><span class="p">(</span><span class="n">out_add_0_2</span><span class="p">,</span> <span class="n">init_b11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span>
              <span class="n">Sub</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss_diff</span>
                <span class="n">Mul</span><span class="p">(</span><span class="n">loss_diff</span><span class="p">,</span> <span class="n">loss_diff</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss_diff_2</span>
                  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">loss_diff_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gradient-again-loss-retropropagation">
<h2><a class="toc-backref" href="#id4">Gradient again : loss + retropropagation</a><a class="headerlink" href="#gradient-again-loss-retropropagation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grad_loss</span> <span class="o">=</span> <span class="n">onnx_rename_names</span><span class="p">(</span><span class="n">onnx_derivative</span><span class="p">(</span>
    <span class="n">onx_loss_only</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">DerivativeOptions</span><span class="o">.</span><span class="n">FillGrad</span> <span class="o">|</span> <span class="n">DerivativeOptions</span><span class="o">.</span><span class="n">KeepOutputs</span><span class="p">))</span>
<span class="o">%</span><span class="k">onnxview</span> grad_loss
</pre></div>
</div>
<div id="M4b0d3ea4884a46af83b00a88611df88a-cont"><div id="M4b0d3ea4884a46af83b00a88611df88a" style="width:;height:;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  size=7;\n  orientation=portrait;\n  ranksep=0.25;\n  nodesep=0.05;\n\n  x [shape=box color=red label=\"x\nfloat((0, 2))\" fontsize=10];\n  label [shape=box color=red label=\"label\nfloat((0, 1))\" fontsize=10];\n  init [shape=box color=red label=\"init\nfloat((1, 2))\" fontsize=10];\n  init_1 [shape=box color=red label=\"init_1\nfloat((1, 2))\" fontsize=10];\n  init_b10 [shape=box color=red label=\"init_b10\nfloat((1,))\" fontsize=10];\n\n  x_grad [shape=box color=green label=\"x_grad\nfloat((0, 2))\" fontsize=10];\n  label_grad [shape=box color=green label=\"label_grad\nfloat((0, 1))\" fontsize=10];\n  init_grad [shape=box color=green label=\"init_grad\nfloat((1, 2))\" fontsize=10];\n  init_1_grad [shape=box color=green label=\"init_1_grad\nfloat((1, 2))\" fontsize=10];\n  init_b10_grad [shape=box color=green label=\"init_b10_grad\nfloat((1,))\" fontsize=10];\n  loss [shape=box color=green label=\"loss\nfloat((1, 1))\" fontsize=10];\n\n  i0 [shape=box label=\"i0\nint64((2,))\n[-1  1]\" fontsize=10];\n  i1 [shape=box label=\"i1\nint64((1,))\n[0]\" fontsize=10];\n  i2 [shape=box label=\"i2\nint64((1,))\n[1]\" fontsize=10];\n  i3 [shape=box label=\"i3\nint64((1,))\n[2]\" fontsize=10];\n\n  r0 [shape=box label=\"r0\" fontsize=10];\n  n0 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n0)\" fontsize=10];\n  x -> n0;\n  init_1 -> n0;\n  n0 -> r0;\n\n  r1 [shape=box label=\"r1\" fontsize=10];\n  n1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n1)\" fontsize=10];\n  x -> n1;\n  x -> n1;\n  n1 -> r1;\n\n  r2 [shape=box label=\"r2\" fontsize=10];\n  n2 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n2)\" fontsize=10];\n  r1 -> n2;\n  init -> n2;\n  n2 -> r2;\n\n  r3 [shape=box label=\"r3\" fontsize=10];\n  n3 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(n3)\" fontsize=10];\n  r0 -> n3;\n  r2 -> n3;\n  n3 -> r3;\n\n  r4 [shape=box label=\"r4\" fontsize=10];\n  n4 [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(n4)\" fontsize=10];\n  r3 -> n4;\n  i1 -> n4;\n  i2 -> n4;\n  i2 -> n4;\n  n4 -> r4;\n\n  r5 [shape=box label=\"r5\" fontsize=10];\n  n5 [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(n5)\" fontsize=10];\n  r4 -> n5;\n  i2 -> n5;\n  n5 -> r5;\n\n  r6 [shape=box label=\"r6\" fontsize=10];\n  n6 [shape=box style=\"filled,rounded\" color=orange label=\"Slice\n(n6)\" fontsize=10];\n  r3 -> n6;\n  i2 -> n6;\n  i3 -> n6;\n  i2 -> n6;\n  n6 -> r6;\n\n  r7 [shape=box label=\"r7\" fontsize=10];\n  n7 [shape=box style=\"filled,rounded\" color=orange label=\"Squeeze\n(n7)\" fontsize=10];\n  r6 -> n7;\n  i2 -> n7;\n  n7 -> r7;\n\n  r8 [shape=box label=\"r8\" fontsize=10];\n  n8 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(n8)\" fontsize=10];\n  r5 -> n8;\n  r7 -> n8;\n  n8 -> r8;\n\n  r9 [shape=box label=\"r9\" fontsize=10];\n  n9 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(n9)\" fontsize=10];\n  r8 -> n9;\n  init_b10 -> n9;\n  n9 -> r9;\n\n  r10 [shape=box label=\"r10\" fontsize=10];\n  n10 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n10)\nallowzero=0\" fontsize=10];\n  r9 -> n10;\n  i0 -> n10;\n  n10 -> r10;\n\n  r11 [shape=box label=\"r11\" fontsize=10];\n  n11 [shape=box style=\"filled,rounded\" color=orange label=\"Sub\n(n11)\" fontsize=10];\n  r10 -> n11;\n  label -> n11;\n  n11 -> r11;\n\n  r12 [shape=box label=\"r12\" fontsize=10];\n  n12 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n12)\" fontsize=10];\n  r11 -> n12;\n  r11 -> n12;\n  n12 -> r12;\n\n  n13 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n13)\nkeepdims=1\nnoop_with_empty_axes=0\" fontsize=10];\n  r12 -> n13;\n  n13 -> loss;\n\n  r13 [shape=box label=\"r13\" fontsize=10];\n  n14 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n14)\" fontsize=10];\n  r12 -> n14;\n  n14 -> r13;\n\n  r15 [shape=box label=\"r15\" fontsize=10];\n  n15 [shape=box style=\"filled,rounded\" color=orange label=\"Expand\n(n15)\" fontsize=10];\n  r14 -> n15;\n  r13 -> n15;\n  n15 -> r15;\n\n  r16 [shape=box label=\"r16\" fontsize=10];\n  n16 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n16)\" fontsize=10];\n  r15 -> n16;\n  r11 -> n16;\n  n16 -> r16;\n\n  r17 [shape=box label=\"r17\" fontsize=10];\n  n17 [shape=box style=\"filled,rounded\" color=orange label=\"Sum\n(n17)\" fontsize=10];\n  r16 -> n17;\n  r16 -> n17;\n  n17 -> r17;\n\n  r18 [shape=box label=\"r18\" fontsize=10];\n  n18 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n18)\" fontsize=10];\n  label -> n18;\n  n18 -> r18;\n\n  r19 [shape=box label=\"r19\" fontsize=10];\n  n19 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n19)\" fontsize=10];\n  r10 -> n19;\n  n19 -> r19;\n\n  r20 [shape=box label=\"r20\" fontsize=10];\n  r21 [shape=box label=\"r21\" fontsize=10];\n  n20 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(n20)\" fontsize=10];\n  r19 -> n20;\n  r18 -> n20;\n  n20 -> r20;\n  n20 -> r21;\n\n  r22 [shape=box label=\"r22\" fontsize=10];\n  n21 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n21)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r17 -> n21;\n  r20 -> n21;\n  n21 -> r22;\n\n  r23 [shape=box label=\"r23\" fontsize=10];\n  n22 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n22)\nallowzero=0\" fontsize=10];\n  r22 -> n22;\n  r19 -> n22;\n  n22 -> r23;\n\n  r24 [shape=box label=\"r24\" fontsize=10];\n  n23 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n23)\" fontsize=10];\n  r9 -> n23;\n  n23 -> r24;\n\n  r25 [shape=box label=\"r25\" fontsize=10];\n  n24 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n24)\nallowzero=0\" fontsize=10];\n  r23 -> n24;\n  r24 -> n24;\n  n24 -> r25;\n\n  r26 [shape=box label=\"r26\" fontsize=10];\n  n25 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n25)\" fontsize=10];\n  init_b10 -> n25;\n  n25 -> r26;\n\n  r27 [shape=box label=\"r27\" fontsize=10];\n  n26 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n26)\" fontsize=10];\n  r8 -> n26;\n  n26 -> r27;\n\n  r28 [shape=box label=\"r28\" fontsize=10];\n  r29 [shape=box label=\"r29\" fontsize=10];\n  n27 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(n27)\" fontsize=10];\n  r27 -> n27;\n  r26 -> n27;\n  n27 -> r28;\n  n27 -> r29;\n\n  r30 [shape=box label=\"r30\" fontsize=10];\n  n28 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n28)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r25 -> n28;\n  r28 -> n28;\n  n28 -> r30;\n\n  r31 [shape=box label=\"r31\" fontsize=10];\n  n29 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n29)\nallowzero=0\" fontsize=10];\n  r30 -> n29;\n  r27 -> n29;\n  n29 -> r31;\n\n  r32 [shape=box label=\"r32\" fontsize=10];\n  n30 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n30)\" fontsize=10];\n  r7 -> n30;\n  n30 -> r32;\n\n  r33 [shape=box label=\"r33\" fontsize=10];\n  n31 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n31)\" fontsize=10];\n  r5 -> n31;\n  n31 -> r33;\n\n  r34 [shape=box label=\"r34\" fontsize=10];\n  r35 [shape=box label=\"r35\" fontsize=10];\n  n32 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(n32)\" fontsize=10];\n  r33 -> n32;\n  r32 -> n32;\n  n32 -> r34;\n  n32 -> r35;\n\n  r36 [shape=box label=\"r36\" fontsize=10];\n  n33 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n33)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r31 -> n33;\n  r34 -> n33;\n  n33 -> r36;\n\n  r37 [shape=box label=\"r37\" fontsize=10];\n  n34 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n34)\nallowzero=0\" fontsize=10];\n  r36 -> n34;\n  r33 -> n34;\n  n34 -> r37;\n\n  r38 [shape=box label=\"r38\" fontsize=10];\n  n35 [shape=box style=\"filled,rounded\" color=orange label=\"Unsqueeze\n(n35)\" fontsize=10];\n  r37 -> n35;\n  i2 -> n35;\n  n35 -> r38;\n\n  r39 [shape=box label=\"r39\" fontsize=10];\n  n36 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n36)\" fontsize=10];\n  r3 -> n36;\n  n36 -> r39;\n\n  r40 [shape=box label=\"r40\" fontsize=10];\n  n37 [shape=box style=\"filled,rounded\" color=orange label=\"SliceGrad\n(n37)\" fontsize=10];\n  r38 -> n37;\n  r39 -> n37;\n  i1 -> n37;\n  i2 -> n37;\n  i2 -> n37;\n  n37 -> r40;\n\n  r41 [shape=box label=\"r41\" fontsize=10];\n  n38 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n38)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r31 -> n38;\n  r35 -> n38;\n  n38 -> r41;\n\n  r42 [shape=box label=\"r42\" fontsize=10];\n  n39 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n39)\nallowzero=0\" fontsize=10];\n  r41 -> n39;\n  r32 -> n39;\n  n39 -> r42;\n\n  r43 [shape=box label=\"r43\" fontsize=10];\n  n40 [shape=box style=\"filled,rounded\" color=orange label=\"Unsqueeze\n(n40)\" fontsize=10];\n  r42 -> n40;\n  i2 -> n40;\n  n40 -> r43;\n\n  r44 [shape=box label=\"r44\" fontsize=10];\n  n41 [shape=box style=\"filled,rounded\" color=orange label=\"SliceGrad\n(n41)\" fontsize=10];\n  r43 -> n41;\n  r39 -> n41;\n  i2 -> n41;\n  i3 -> n41;\n  i2 -> n41;\n  n41 -> r44;\n\n  r45 [shape=box label=\"r45\" fontsize=10];\n  n42 [shape=box style=\"filled,rounded\" color=orange label=\"Sum\n(n42)\" fontsize=10];\n  r44 -> n42;\n  r40 -> n42;\n  n42 -> r45;\n\n  r46 [shape=box label=\"r46\" fontsize=10];\n  n43 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n43)\" fontsize=10];\n  r2 -> n43;\n  n43 -> r46;\n\n  r47 [shape=box label=\"r47\" fontsize=10];\n  n44 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n44)\" fontsize=10];\n  r0 -> n44;\n  n44 -> r47;\n\n  r48 [shape=box label=\"r48\" fontsize=10];\n  r49 [shape=box label=\"r49\" fontsize=10];\n  n45 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(n45)\" fontsize=10];\n  r47 -> n45;\n  r46 -> n45;\n  n45 -> r48;\n  n45 -> r49;\n\n  r50 [shape=box label=\"r50\" fontsize=10];\n  n46 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n46)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r45 -> n46;\n  r48 -> n46;\n  n46 -> r50;\n\n  r51 [shape=box label=\"r51\" fontsize=10];\n  n47 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n47)\nallowzero=0\" fontsize=10];\n  r50 -> n47;\n  r47 -> n47;\n  n47 -> r51;\n\n  r52 [shape=box label=\"r52\" fontsize=10];\n  n48 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n48)\" fontsize=10];\n  r51 -> n48;\n  init_1 -> n48;\n  n48 -> r52;\n\n  r53 [shape=box label=\"r53\" fontsize=10];\n  n49 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n49)\" fontsize=10];\n  init_1 -> n49;\n  n49 -> r53;\n\n  r54 [shape=box label=\"r54\" fontsize=10];\n  n50 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n50)\" fontsize=10];\n  x -> n50;\n  n50 -> r54;\n\n  r55 [shape=box label=\"r55\" fontsize=10];\n  r56 [shape=box label=\"r56\" fontsize=10];\n  n51 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(n51)\" fontsize=10];\n  r54 -> n51;\n  r53 -> n51;\n  n51 -> r55;\n  n51 -> r56;\n\n  r57 [shape=box label=\"r57\" fontsize=10];\n  n52 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n52)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r52 -> n52;\n  r55 -> n52;\n  n52 -> r57;\n\n  r58 [shape=box label=\"r58\" fontsize=10];\n  n53 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n53)\nallowzero=0\" fontsize=10];\n  r57 -> n53;\n  r54 -> n53;\n  n53 -> r58;\n\n  r59 [shape=box label=\"r59\" fontsize=10];\n  n54 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n54)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r45 -> n54;\n  r49 -> n54;\n  n54 -> r59;\n\n  r60 [shape=box label=\"r60\" fontsize=10];\n  n55 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n55)\nallowzero=0\" fontsize=10];\n  r59 -> n55;\n  r46 -> n55;\n  n55 -> r60;\n\n  r61 [shape=box label=\"r61\" fontsize=10];\n  n56 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n56)\" fontsize=10];\n  r60 -> n56;\n  init -> n56;\n  n56 -> r61;\n\n  r62 [shape=box label=\"r62\" fontsize=10];\n  n57 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n57)\" fontsize=10];\n  init -> n57;\n  n57 -> r62;\n\n  r63 [shape=box label=\"r63\" fontsize=10];\n  n58 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n58)\" fontsize=10];\n  r1 -> n58;\n  n58 -> r63;\n\n  r64 [shape=box label=\"r64\" fontsize=10];\n  r65 [shape=box label=\"r65\" fontsize=10];\n  n59 [shape=box style=\"filled,rounded\" color=orange label=\"BroadcastGradientArgs\n(n59)\" fontsize=10];\n  r63 -> n59;\n  r62 -> n59;\n  n59 -> r64;\n  n59 -> r65;\n\n  r66 [shape=box label=\"r66\" fontsize=10];\n  n60 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n60)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r61 -> n60;\n  r64 -> n60;\n  n60 -> r66;\n\n  r67 [shape=box label=\"r67\" fontsize=10];\n  n61 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n61)\nallowzero=0\" fontsize=10];\n  r66 -> n61;\n  r63 -> n61;\n  n61 -> r67;\n\n  r68 [shape=box label=\"r68\" fontsize=10];\n  n62 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n62)\" fontsize=10];\n  r67 -> n62;\n  x -> n62;\n  n62 -> r68;\n\n  n63 [shape=box style=\"filled,rounded\" color=orange label=\"Sum\n(n63)\" fontsize=10];\n  r68 -> n63;\n  r68 -> n63;\n  r58 -> n63;\n  n63 -> x_grad;\n\n  r69 [shape=box label=\"r69\" fontsize=10];\n  n64 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n64)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r17 -> n64;\n  r21 -> n64;\n  n64 -> r69;\n\n  r70 [shape=box label=\"r70\" fontsize=10];\n  n65 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n65)\nallowzero=0\" fontsize=10];\n  r69 -> n65;\n  r18 -> n65;\n  n65 -> r70;\n\n  n66 [shape=box style=\"filled,rounded\" color=orange label=\"Neg\n(n66)\" fontsize=10];\n  r70 -> n66;\n  n66 -> label_grad;\n\n  r71 [shape=box label=\"r71\" fontsize=10];\n  n67 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n67)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r25 -> n67;\n  r29 -> n67;\n  n67 -> r71;\n\n  n68 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n68)\nallowzero=0\" fontsize=10];\n  r71 -> n68;\n  r26 -> n68;\n  n68 -> init_b10_grad;\n\n  r72 [shape=box label=\"r72\" fontsize=10];\n  n69 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n69)\" fontsize=10];\n  r51 -> n69;\n  x -> n69;\n  n69 -> r72;\n\n  r73 [shape=box label=\"r73\" fontsize=10];\n  n70 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n70)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r72 -> n70;\n  r56 -> n70;\n  n70 -> r73;\n\n  n71 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n71)\nallowzero=0\" fontsize=10];\n  r73 -> n71;\n  r53 -> n71;\n  n71 -> init_1_grad;\n\n  r74 [shape=box label=\"r74\" fontsize=10];\n  n72 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(n72)\" fontsize=10];\n  r60 -> n72;\n  r1 -> n72;\n  n72 -> r74;\n\n  r75 [shape=box label=\"r75\" fontsize=10];\n  n73 [shape=box style=\"filled,rounded\" color=orange label=\"ReduceSum\n(n73)\nkeepdims=1\nnoop_with_empty_axes=1\" fontsize=10];\n  r74 -> n73;\n  r65 -> n73;\n  n73 -> r75;\n\n  n74 [shape=box style=\"filled,rounded\" color=orange label=\"Reshape\n(n74)\nallowzero=0\" fontsize=10];\n  r75 -> n74;\n  r62 -> n74;\n  n74 -> init_grad;\n\n  r76 [shape=box label=\"r76\" fontsize=10];\n  n75 [shape=box style=\"filled,rounded\" color=orange label=\"Shape\n(n75)\" fontsize=10];\n  loss -> n75;\n  n75 -> r76;\n\n  r14 [shape=box label=\"r14\" fontsize=10];\n  n76 [shape=box style=\"filled,rounded\" color=orange label=\"ConstantOfShape\n(n76)\nvalue=[1.]\" fontsize=10];\n  r76 -> n76;\n  n76 -> r14;\n}");
document.getElementById('M4b0d3ea4884a46af83b00a88611df88a').innerHTML = svgGraph; });

</script><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">grad_loss</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft.nchwc&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.ml&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.ms.internal.nhwc&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.training&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;ai.onnx.preview.training&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;com.microsoft.experimental&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;label&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i0&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;i3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r0</span>
  <span class="n">Shape</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r47</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r1</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r3</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r4</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">r4</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r5</span>
        <span class="n">Shape</span><span class="p">(</span><span class="n">r5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r33</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r6</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">r6</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r7</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">r5</span><span class="p">,</span> <span class="n">r7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r8</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">r8</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r9</span>
            <span class="n">Reshape</span><span class="p">(</span><span class="n">r9</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r10</span>
              <span class="n">Sub</span><span class="p">(</span><span class="n">r10</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r11</span>
                <span class="n">Mul</span><span class="p">(</span><span class="n">r11</span><span class="p">,</span> <span class="n">r11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r12</span>
                  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r12</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">loss</span>
                    <span class="n">Shape</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r76</span>
                      <span class="n">ConstantOfShape</span><span class="p">(</span><span class="n">r76</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r14</span>
                  <span class="n">Shape</span><span class="p">(</span><span class="n">r12</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r13</span>
                    <span class="n">Expand</span><span class="p">(</span><span class="n">r14</span><span class="p">,</span> <span class="n">r13</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r15</span>
                <span class="n">Mul</span><span class="p">(</span><span class="n">r15</span><span class="p">,</span> <span class="n">r11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r16</span>
                  <span class="n">Sum</span><span class="p">(</span><span class="n">r16</span><span class="p">,</span> <span class="n">r16</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r17</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r18</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r19</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r19</span><span class="p">,</span> <span class="n">r18</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r20</span><span class="p">,</span> <span class="n">r21</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r17</span><span class="p">,</span> <span class="n">r20</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r22</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r22</span><span class="p">,</span> <span class="n">r19</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r23</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r24</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r23</span><span class="p">,</span> <span class="n">r24</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r25</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r26</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r8</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r27</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r27</span><span class="p">,</span> <span class="n">r26</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r28</span><span class="p">,</span> <span class="n">r29</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r25</span><span class="p">,</span> <span class="n">r28</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r30</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r30</span><span class="p">,</span> <span class="n">r27</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r31</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r32</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r33</span><span class="p">,</span> <span class="n">r32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r34</span><span class="p">,</span> <span class="n">r35</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r31</span><span class="p">,</span> <span class="n">r34</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r36</span>
      <span class="n">Reshape</span><span class="p">(</span><span class="n">r36</span><span class="p">,</span> <span class="n">r33</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r37</span>
        <span class="n">Unsqueeze</span><span class="p">(</span><span class="n">r37</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r38</span>
    <span class="n">Shape</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r39</span>
      <span class="n">SliceGrad</span><span class="p">(</span><span class="n">r38</span><span class="p">,</span> <span class="n">r39</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r40</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r31</span><span class="p">,</span> <span class="n">r35</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r41</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r41</span><span class="p">,</span> <span class="n">r32</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r42</span>
    <span class="n">Unsqueeze</span><span class="p">(</span><span class="n">r42</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r43</span>
      <span class="n">SliceGrad</span><span class="p">(</span><span class="n">r43</span><span class="p">,</span> <span class="n">r39</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">i3</span><span class="p">,</span> <span class="n">i2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r44</span>
        <span class="n">Sum</span><span class="p">(</span><span class="n">r44</span><span class="p">,</span> <span class="n">r40</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r45</span>
    <span class="n">Shape</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r46</span>
    <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r47</span><span class="p">,</span> <span class="n">r46</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r48</span><span class="p">,</span> <span class="n">r49</span>
      <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r45</span><span class="p">,</span> <span class="n">r48</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r50</span>
    <span class="n">Reshape</span><span class="p">(</span><span class="n">r50</span><span class="p">,</span> <span class="n">r47</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r51</span>
      <span class="n">Mul</span><span class="p">(</span><span class="n">r51</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r52</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r53</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r54</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r54</span><span class="p">,</span> <span class="n">r53</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r55</span><span class="p">,</span> <span class="n">r56</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r52</span><span class="p">,</span> <span class="n">r55</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r57</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r57</span><span class="p">,</span> <span class="n">r54</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r58</span>
<span class="n">ReduceSum</span><span class="p">(</span><span class="n">r45</span><span class="p">,</span> <span class="n">r49</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r59</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r59</span><span class="p">,</span> <span class="n">r46</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r60</span>
    <span class="n">Mul</span><span class="p">(</span><span class="n">r60</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r61</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r62</span>
<span class="n">Shape</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r63</span>
  <span class="n">BroadcastGradientArgs</span><span class="p">(</span><span class="n">r63</span><span class="p">,</span> <span class="n">r62</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r64</span><span class="p">,</span> <span class="n">r65</span>
    <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r61</span><span class="p">,</span> <span class="n">r64</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r66</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r66</span><span class="p">,</span> <span class="n">r63</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r67</span>
    <span class="n">Mul</span><span class="p">(</span><span class="n">r67</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r68</span>
    <span class="n">Sum</span><span class="p">(</span><span class="n">r68</span><span class="p">,</span> <span class="n">r68</span><span class="p">,</span> <span class="n">r58</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x_grad</span>
<span class="n">ReduceSum</span><span class="p">(</span><span class="n">r17</span><span class="p">,</span> <span class="n">r21</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r69</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r69</span><span class="p">,</span> <span class="n">r18</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r70</span>
    <span class="n">Neg</span><span class="p">(</span><span class="n">r70</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">label_grad</span>
<span class="n">ReduceSum</span><span class="p">(</span><span class="n">r25</span><span class="p">,</span> <span class="n">r29</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r71</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r71</span><span class="p">,</span> <span class="n">r26</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">init_b10_grad</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">r51</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r72</span>
  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r72</span><span class="p">,</span> <span class="n">r56</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r73</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r73</span><span class="p">,</span> <span class="n">r53</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">init_1_grad</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">r60</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r74</span>
  <span class="n">ReduceSum</span><span class="p">(</span><span class="n">r74</span><span class="p">,</span> <span class="n">r65</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noop_with_empty_axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r75</span>
  <span class="n">Reshape</span><span class="p">(</span><span class="n">r75</span><span class="p">,</span> <span class="n">r62</span><span class="p">,</span> <span class="n">allowzero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">init_grad</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;label_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10_grad&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s compute the gradient.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">fct</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.</span>        <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">2.5</span>       <span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.6666701</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.16667008</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.6666799</span> <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlprodict.onnxrt</span> <span class="kn">import</span> <span class="n">OnnxInference</span>

<span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">grad_loss</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;onnxruntime1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">init</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.33333</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init_b10</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                   <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="n">init</span><span class="p">,</span> <span class="s1">&#39;init_1&#39;</span><span class="p">:</span> <span class="n">init_1</span><span class="p">,</span> <span class="s1">&#39;init_b10&#39;</span><span class="p">:</span> <span class="n">init_b10</span><span class="p">})</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;init_1_grad&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mf">109.333244</span><span class="p">,</span> <span class="mf">102.666565</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;init_b10_grad&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">76.6666</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;init_grad&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mf">193.33316</span><span class="p">,</span> <span class="mf">186.66649</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;label_grad&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span> <span class="o">-</span><span class="mf">4.</span>      <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">12.</span>      <span class="p">],</span>
       <span class="p">[</span> <span class="o">-</span><span class="mf">5.33332</span> <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">13.333321</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">41.99996</span> <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mf">532.5546</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;x_grad&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span>  <span class="mf">2.</span>      <span class="p">,</span>   <span class="mf">1.33332</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">54.</span>      <span class="p">,</span>   <span class="mf">3.99996</span> <span class="p">],</span>
       <span class="p">[</span>  <span class="mf">2.66666</span> <span class="p">,</span>  <span class="mf">33.777676</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">59.999943</span><span class="p">,</span>  <span class="mf">84.44432</span> <span class="p">],</span>
       <span class="p">[</span><span class="mf">356.99966</span> <span class="p">,</span> <span class="mf">517.9994</span>  <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)}</span>
</pre></div>
</div>
<p>We could use this gradient to implement a stochastic gradient descent in
python. Two comments: * If we implement it this with numpy, it cannot
work on GPU. * If we use OrtValue (tensor from onnxruntime), how to do
simple addition between OrtValue ?</p>
<p>We need to implemented the second option. A simple addition between two
OrtValue must be done with an ONNX graph.</p>
</section>
<section id="trainingsession">
<h2><a class="toc-backref" href="#id5">TrainingSession</a><a class="headerlink" href="#trainingsession" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">fct</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">onx</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.5</span>    <span class="p">,</span> <span class="o">-</span><span class="mf">0.33333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_5&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b11&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">out_mul_0</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_1</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">out_mul_0_2</span><span class="p">,</span> <span class="n">out_mul_0_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_3</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_5</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0_1</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0_1</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0_1</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">out_squ_0_1</span><span class="p">,</span> <span class="n">out_squ_0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_1</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">out_add_0_1</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_2</span>
            <span class="n">Reshape</span><span class="p">(</span><span class="n">out_add_0_2</span><span class="p">,</span> <span class="n">init_b11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxcustom.training.optimizers</span> <span class="kn">import</span> <span class="n">OrtGradientOptimizer</span>

<span class="n">train_session</span> <span class="o">=</span> <span class="n">OrtGradientOptimizer</span><span class="p">(</span>
    <span class="n">onx_loss</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;init_1&#39;</span><span class="p">,</span> <span class="s1">&#39;init_b10&#39;</span><span class="p">],</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">train_session</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrtGradientOptimizer</span><span class="p">(</span><span class="n">model_onnx</span><span class="o">=</span><span class="s1">&#39;ir_version...&#39;</span><span class="p">,</span> <span class="n">weights_to_train</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;init_1&#39;</span><span class="p">,</span> <span class="s1">&#39;init_b10&#39;</span><span class="p">],</span> <span class="n">loss_output_name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">training_optimizer_name</span><span class="o">=</span><span class="s1">&#39;SGDOptimizer&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">LearningRateSGD</span><span class="p">(</span><span class="n">eta0</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">power_t</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;invscaling&#39;</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.03162277660168379</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">validation_every</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">saved_gradient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_weight_name</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span><span class="o">.</span><span class="n">trained_coef_</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.34785354</span><span class="p">,</span>  <span class="mf">1.1399053</span> <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;init_1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.9156165</span><span class="p">,</span>  <span class="mf">2.4292002</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;init_b10&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0016667</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.0036812867</span><span class="p">,</span> <span class="mf">0.0038135047</span><span class="p">,</span> <span class="mf">0.0037041684</span><span class="p">,</span> <span class="mf">0.0037206002</span><span class="p">,</span> <span class="mf">0.0032002896</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>

<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="n">train_session</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">})</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/onnxruntime_training_nb_34_0.png" src="../_images/onnxruntime_training_nb_34_0.png" />
</section>
<section id="fordward-backward-trainingagent">
<h2><a class="toc-backref" href="#id6">Fordward backward: TrainingAgent</a><a class="headerlink" href="#fordward-backward-trainingagent" title="Permalink to this headline">¶</a></h2>
<p>This second implementation uses
<a class="reference external" href="http://www.xavierdupre.fr/app/onnxcustom/helpsphinx/api/onnxruntime_python/training_partial.html#trainingagent">TrainingAgent</a>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxcustom.training.optimizers_partial</span> <span class="kn">import</span> <span class="n">OrtGradientForwardBackwardOptimizer</span>

<span class="n">train_session</span> <span class="o">=</span> <span class="n">OrtGradientForwardBackwardOptimizer</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;init_1&#39;</span><span class="p">,</span> <span class="s1">&#39;init_b10&#39;</span><span class="p">],</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrtGradientForwardBackwardOptimizer</span><span class="p">(</span><span class="n">model_onnx</span><span class="o">=</span><span class="s1">&#39;ir_version...&#39;</span><span class="p">,</span> <span class="n">weights_to_train</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;init_1&#39;</span><span class="p">,</span> <span class="s1">&#39;init_b10&#39;</span><span class="p">],</span> <span class="n">loss_output_name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">training_optimizer_name</span><span class="o">=</span><span class="s1">&#39;SGDOptimizer&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">LearningRateSGD</span><span class="p">(</span><span class="n">eta0</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">power_t</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;invscaling&#39;</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.03162277660168379</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">validation_every</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">learning_loss</span><span class="o">=</span><span class="n">SquareLearningLoss</span><span class="p">(),</span> <span class="n">enable_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">learning_penalty</span><span class="o">=</span><span class="n">NoLearningPenalty</span><span class="p">(),</span> <span class="n">exc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.00040441833</span><span class="p">,</span> <span class="mf">0.00037421435</span><span class="p">,</span> <span class="mf">0.00049950054</span><span class="p">,</span> <span class="mf">0.00042527347</span><span class="p">,</span> <span class="mf">0.00031072882</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="n">train_session</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">})</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/onnxruntime_training_nb_39_0.png" src="../_images/onnxruntime_training_nb_39_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span><span class="o">.</span><span class="n">trained_coef_</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">OrtValue</span> <span class="n">at</span> <span class="mh">0x162a9199fb0</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;init_1&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">OrtValue</span> <span class="n">at</span> <span class="mh">0x162a91a20f0</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="s1">&#39;init_b10&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">OrtValue</span> <span class="n">at</span> <span class="mh">0x162a91a2030</span><span class="o">&gt;</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">train_session</span><span class="o">.</span><span class="n">trained_coef_</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.35357383</span><span class="p">,</span>  <span class="mf">0.6850407</span> <span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;init_1&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.916494</span> <span class="p">,</span>  <span class="mf">2.8799832</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">),</span>
 <span class="s1">&#39;init_b10&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0036615</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)}</span>
</pre></div>
</div>
<p>Not the same weights? What about the prediction?</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trained_onx</span> <span class="o">=</span> <span class="n">train_session</span><span class="o">.</span><span class="n">get_trained_onnx</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">onnx_simple_text_plot</span><span class="p">(</span><span class="n">trained_onx</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opset</span><span class="p">:</span> <span class="n">domain</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="n">version</span><span class="o">=</span><span class="mi">14</span>
<span class="nb">input</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.35357383</span><span class="p">,</span>  <span class="mf">0.6850407</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_1&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.916494</span> <span class="p">,</span>  <span class="mf">2.8799832</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_2&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_3&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_5&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b10&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0036615</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
<span class="n">init</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;init_b11&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span> <span class="o">--</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int64</span><span class="p">)</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0</span>
  <span class="n">Mul</span><span class="p">(</span><span class="n">out_mul_0</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_1</span>
<span class="n">Mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">init_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_mul_0_2</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">out_mul_0_2</span><span class="p">,</span> <span class="n">out_mul_0_1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_3</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0</span>
    <span class="n">Slice</span><span class="p">(</span><span class="n">out_add_0</span><span class="p">,</span> <span class="n">init_5</span><span class="p">,</span> <span class="n">init_2</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_sli_0_1</span>
      <span class="n">Squeeze</span><span class="p">(</span><span class="n">out_sli_0_1</span><span class="p">,</span> <span class="n">init_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_squ_0_1</span>
        <span class="n">Add</span><span class="p">(</span><span class="n">out_squ_0_1</span><span class="p">,</span> <span class="n">out_squ_0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_1</span>
          <span class="n">Add</span><span class="p">(</span><span class="n">out_add_0_1</span><span class="p">,</span> <span class="n">init_b10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">out_add_0_2</span>
            <span class="n">Reshape</span><span class="p">(</span><span class="n">out_add_0_2</span><span class="p">,</span> <span class="n">init_b11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span>
<span class="n">output</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oinf</span> <span class="o">=</span> <span class="n">OnnxInference</span><span class="p">(</span><span class="n">trained_onx</span><span class="p">)</span>
<span class="n">oinf</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">X</span><span class="p">})[</span><span class="s1">&#39;y&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.6123954</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.303561</span> <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">2.0257921</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.2778704</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.9708453</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.58675164</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.3148587</span> <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">2.0666485</span> <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.272753</span>  <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.95404863</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>It works.</p>
</section>
<section id="mlpregressor">
<h2><a class="toc-backref" href="#id7">MLPregressor</a><a class="headerlink" href="#mlpregressor" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">onnxruntime</span> <span class="kn">import</span> <span class="n">get_device</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="kn">from</span> <span class="nn">skl2onnx</span> <span class="kn">import</span> <span class="n">to_onnx</span>


<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">max_iter</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">nn</span> <span class="o">=</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
                  <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">,</span>
                  <span class="n">n_iter_no_change</span><span class="o">=</span><span class="n">max_iter</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                  <span class="n">learning_rate</span><span class="o">=</span><span class="s2">&quot;invscaling&quot;</span><span class="p">,</span>
                  <span class="c1"># default values</span>
                  <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">nesterovs_momentum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">power_t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<p>Conversion to ONNX</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxcustom.utils.onnx_helper</span> <span class="kn">import</span> <span class="n">onnx_rename_weights</span>
<span class="n">onx</span> <span class="o">=</span> <span class="n">to_onnx</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">target_opset</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">onx</span> <span class="o">=</span> <span class="n">onnx_rename_weights</span><span class="p">(</span><span class="n">onx</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span> <span class="o">=</span> <span class="n">OrtGradientForwardBackwardOptimizer</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">,</span>
    <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrtGradientForwardBackwardOptimizer</span><span class="p">(</span><span class="n">model_onnx</span><span class="o">=</span><span class="s1">&#39;ir_version...&#39;</span><span class="p">,</span> <span class="n">weights_to_train</span><span class="o">=</span><span class="s2">&quot;[&#39;I0_coeff...&quot;</span><span class="p">,</span> <span class="n">loss_output_name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">training_optimizer_name</span><span class="o">=</span><span class="s1">&#39;SGDOptimizer&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">LearningRateSGD</span><span class="p">(</span><span class="n">eta0</span><span class="o">=</span><span class="mf">5e-05</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">power_t</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;invscaling&#39;</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.5811388300841898e-05</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">validation_every</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">learning_loss</span><span class="o">=</span><span class="n">SquareLearningLoss</span><span class="p">(),</span> <span class="n">enable_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">learning_penalty</span><span class="o">=</span><span class="n">NoLearningPenalty</span><span class="p">(),</span> <span class="n">exc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">skl_loss</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">loss_curve_</span><span class="p">,</span> <span class="n">ort_loss</span><span class="o">=</span><span class="n">train_session</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/onnxruntime_training_nb_55_0.png" src="../_images/onnxruntime_training_nb_55_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> -n 1 -r 1 nn.fit(X_train, y_train)
</pre></div>
</div>
<pre class="literal-block">C:Python395_x64libsite-packagessklearnneural_network_multilayer_perceptron.py:692: ConvergenceWarning: Stochastic Optimizer: Maximum iterations (100) reached and the optimization hasn't converged yet.
  warnings.warn(</pre>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.98 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> -n 1 -r 1 train_session.fit(X_train, y_train)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.88 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)
</pre></div>
</div>
</section>
<section id="not-exactly-the-same-nesterov">
<h2><a class="toc-backref" href="#id8">Not exactly the same: Nesterov?</a><a class="headerlink" href="#not-exactly-the-same-nesterov" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">onnxcustom.training.sgd_learning_rate</span> <span class="kn">import</span> <span class="n">LearningRateSGDNesterov</span>

<span class="n">train_session2</span> <span class="o">=</span> <span class="n">OrtGradientForwardBackwardOptimizer</span><span class="p">(</span>
    <span class="n">onx</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="n">LearningRateSGDNesterov</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">nesterov</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_session2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrtGradientForwardBackwardOptimizer</span><span class="p">(</span><span class="n">model_onnx</span><span class="o">=</span><span class="s1">&#39;ir_version...&#39;</span><span class="p">,</span> <span class="n">weights_to_train</span><span class="o">=</span><span class="s2">&quot;[&#39;I0_coeff...&quot;</span><span class="p">,</span> <span class="n">loss_output_name</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">training_optimizer_name</span><span class="o">=</span><span class="s1">&#39;SGDOptimizer&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">LearningRateSGDNesterov</span><span class="p">(</span><span class="n">eta0</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">power_t</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;invscaling&#39;</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">nesterov</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">3.162277660168379e-06</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">validation_every</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">learning_loss</span><span class="o">=</span><span class="n">SquareLearningLoss</span><span class="p">(),</span> <span class="n">enable_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">learning_penalty</span><span class="o">=</span><span class="n">NoLearningPenalty</span><span class="p">(),</span> <span class="n">exc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">skl_loss</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">loss_curve_</span><span class="p">,</span>
                      <span class="n">ort_loss</span><span class="o">=</span><span class="n">train_session</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">,</span>
                      <span class="n">ort_loss2</span><span class="o">=</span><span class="n">train_session2</span><span class="o">.</span><span class="n">train_losses_</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<img alt="../_images/onnxruntime_training_nb_61_0.png" src="../_images/onnxruntime_training_nb_61_0.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> -n 1 -r 1 train_session2.fit(X_train, y_train)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>2.26 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)
</pre></div>
</div>
</section>
<section id="profiling">
<h2><a class="toc-backref" href="#id9">Profiling</a><a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clean_name</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;onnxruntime&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;sklearn&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;onnxcustom&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;site-packages&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">text</span>

<span class="kn">from</span> <span class="nn">pyquickhelper.pycode.profiling</span> <span class="kn">import</span> <span class="n">profile</span><span class="p">,</span> <span class="n">profile2graph</span>

<span class="n">ps</span> <span class="o">=</span> <span class="n">profile</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="n">train_session2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">root</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">profile2graph</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">clean_text</span><span class="o">=</span><span class="n">clean_name</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">to_text</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>                                                     <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">3.78074</span> <span class="o">--</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">81</span><span class="o">-</span><span class="mi">1255</span><span class="n">a3a5f723</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="n">fit</span>                                                      <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00181</span> <span class="mf">3.78073</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">263</span><span class="p">:</span><span class="n">fit</span> <span class="p">(</span><span class="n">fit</span><span class="p">)</span>
        <span class="fm">__init__</span>                                             <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">data_loader</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="fm">__init__</span> <span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
            <span class="n">get_ort_device</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">get_ort_device</span> <span class="p">(</span><span class="n">get_ort_device</span><span class="p">)</span>
            <span class="n">numpy_to_ort_value</span>                               <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxruntime_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">120</span><span class="p">:</span><span class="n">numpy_to_ort_value</span> <span class="p">(</span><span class="n">numpy_to_ort_value</span><span class="p">)</span> <span class="o">+++</span>
        <span class="n">needs_grad</span>                                           <span class="o">--</span>       <span class="mi">3</span>       <span class="mi">3</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">99</span><span class="p">:</span><span class="n">needs_grad</span> <span class="p">(</span><span class="n">needs_grad</span><span class="p">)</span>
            <span class="n">needs_grad</span>                                       <span class="o">--</span>       <span class="mi">3</span>       <span class="mi">3</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">299</span><span class="p">:</span><span class="n">needs_grad</span> <span class="p">(</span><span class="n">needs_grad</span><span class="p">)</span>
        <span class="n">get_full_state</span>                                       <span class="o">--</span>     <span class="mi">101</span>     <span class="mi">101</span> <span class="o">--</span> <span class="mf">0.00020</span> <span class="mf">0.00093</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">147</span><span class="p">:</span><span class="n">get_full_state</span> <span class="p">(</span><span class="n">get_full_state</span><span class="p">)</span> <span class="o">+++</span>
        <span class="n">set_state</span>                                            <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00008</span> <span class="mf">0.00026</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">196</span><span class="p">:</span><span class="n">set_state</span> <span class="p">(</span><span class="n">set_state</span><span class="p">)</span>
            <span class="n">_get_att_state</span>                                   <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">139</span><span class="p">:</span><span class="n">_get_att_state</span> <span class="p">(</span><span class="n">_get_att_state</span><span class="p">)</span> <span class="o">+++</span>
            <span class="n">numpy_to_ort_value</span>                               <span class="o">--</span>      <span class="mi">24</span>      <span class="mi">24</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00011</span> <span class="o">--</span> <span class="n">onnxruntime_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">120</span><span class="p">:</span><span class="n">numpy_to_ort_value</span> <span class="p">(</span><span class="n">numpy_to_ort_value</span><span class="p">)</span> <span class="o">+++</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="o">&gt;</span>                    <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>              <span class="o">--</span>      <span class="mi">56</span>      <span class="mi">56</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>            <span class="o">--</span>      <span class="mi">24</span>      <span class="mi">24</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00095</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">311</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">get_initializer</span>                                  <span class="o">--</span>       <span class="mi">7</span>       <span class="mi">7</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00094</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">269</span><span class="p">:</span><span class="n">get_initializer</span> <span class="p">(</span><span class="n">get_initializer</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00083</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">315</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">get_initializer</span>                                  <span class="o">--</span>       <span class="mi">7</span>       <span class="mi">7</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00082</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">269</span><span class="p">:</span><span class="n">get_initializer</span> <span class="p">(</span><span class="n">get_initializer</span><span class="p">)</span> <span class="o">+++</span>
        <span class="n">_iteration</span>                                           <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.41903</span> <span class="mf">3.74610</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">397</span><span class="p">:</span><span class="n">_iteration</span> <span class="p">(</span><span class="n">_iteration</span><span class="p">)</span>
            <span class="n">iter_ortvalue</span>                                    <span class="o">--</span>    <span class="mi">6800</span>    <span class="mi">6800</span> <span class="o">--</span> <span class="mf">0.02838</span> <span class="mf">0.14761</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">data_loader</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">139</span><span class="p">:</span><span class="n">iter_ortvalue</span> <span class="p">(</span><span class="n">iter_ortvalue</span><span class="p">)</span>
                <span class="n">_next_iter</span>                                   <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00946</span> <span class="mf">0.07207</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">data_loader</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">93</span><span class="p">:</span><span class="n">_next_iter</span> <span class="p">(</span><span class="n">_next_iter</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>           <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00245</span> <span class="mf">0.00423</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                    <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;randint&#39;</span> <span class="n">o</span><span class="o">...</span><span class="n">domState</span><span class="s1">&#39; objects&gt; --    6700    6700 -- 0.05838 0.05838 -- ~:0:&lt;method &#39;</span><span class="n">randint</span><span class="s1">&#39; of &#39;</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">mtrand</span><span class="o">.</span><span class="n">RandomState</span><span class="s1">&#39; objects&gt; (&lt;method &#39;</span><span class="n">randint</span><span class="s1">&#39; of &#39;</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">mtrand</span><span class="o">.</span><span class="n">RandomState</span><span class="s1">&#39; objects&gt;)</span>
                <span class="n">numpy_to_ort_value</span>                           <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.00658</span> <span class="mf">0.03860</span> <span class="o">--</span> <span class="n">onnxruntime_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">120</span><span class="p">:</span><span class="n">numpy_to_ort_value</span> <span class="p">(</span><span class="n">numpy_to_ort_value</span><span class="p">)</span> <span class="o">+++</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>               <span class="o">--</span>    <span class="mi">6900</span>    <span class="mi">6900</span> <span class="o">--</span> <span class="mf">0.00467</span> <span class="mf">0.00855</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
            <span class="n">forward</span>                                          <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.31685</span> <span class="mf">0.44643</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">623</span><span class="p">:</span><span class="n">forward</span> <span class="p">(</span><span class="n">forward</span><span class="p">)</span>
                <span class="n">input_to_ort</span>                                 <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.08002</span> <span class="mf">0.11492</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">552</span><span class="p">:</span><span class="n">input_to_ort</span> <span class="p">(</span><span class="n">input_to_ort</span><span class="p">)</span> <span class="o">+++</span>
                <span class="n">save_for_backward</span>                            <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.01032</span> <span class="mf">0.01032</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">604</span><span class="p">:</span><span class="n">save_for_backward</span> <span class="p">(</span><span class="n">save_for_backward</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>          <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00434</span> <span class="mf">0.00434</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
            <span class="n">backward</span>                                         <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.43012</span> <span class="mf">0.48957</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">702</span><span class="p">:</span><span class="n">backward</span> <span class="p">(</span><span class="n">backward</span><span class="p">)</span>
                <span class="n">input_to_ort</span>                                 <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.04148</span> <span class="mf">0.05262</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">552</span><span class="p">:</span><span class="n">input_to_ort</span> <span class="p">(</span><span class="n">input_to_ort</span><span class="p">)</span> <span class="o">+++</span>
                <span class="n">saved_tensors</span>                                <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00207</span> <span class="mf">0.00207</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">613</span><span class="p">:</span><span class="n">saved_tensors</span> <span class="p">(</span><span class="n">saved_tensors</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;pop&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>             <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00476</span> <span class="mf">0.00476</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;pop&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;pop&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">loss_gradient</span>                                    <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.05841</span> <span class="mf">0.26967</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_loss</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="n">loss_gradient</span> <span class="p">(</span><span class="n">loss_gradient</span><span class="p">)</span>
                <span class="n">clear_binding_inputs</span>                         <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00545</span> <span class="mf">0.01270</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">130</span><span class="p">:</span><span class="n">clear_binding_inputs</span> <span class="p">(</span><span class="n">clear_binding_inputs</span><span class="p">)</span>
                    <span class="n">_cache_in_clear</span>                          <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00568</span> <span class="mf">0.00725</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">119</span><span class="p">:</span><span class="n">_cache_in_clear</span> <span class="p">(</span><span class="n">_cache_in_clear</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span>        <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00157</span> <span class="mf">0.00157</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                <span class="n">_bind_input_ortvalue</span>                         <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.02070</span> <span class="mf">0.07545</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">159</span><span class="p">:</span><span class="n">_bind_input_ortvalue</span> <span class="p">(</span><span class="n">_bind_input_ortvalue</span><span class="p">)</span> <span class="o">+++</span>
                <span class="n">_call_iobinding</span>                              <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.11997</span> <span class="mf">0.11997</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_loss</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="n">_call_iobinding</span> <span class="p">(</span><span class="n">_call_iobinding</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>           <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.00315</span> <span class="mf">0.00315</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
            <span class="n">penalty_loss</span>                                     <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00112</span> <span class="mf">0.00112</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_penalty</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">84</span><span class="p">:</span><span class="n">penalty_loss</span> <span class="p">(</span><span class="n">penalty_loss</span><span class="p">)</span>
            <span class="n">update_weights</span>                                   <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.00651</span> <span class="mf">0.00651</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_penalty</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="n">update_weights</span> <span class="p">(</span><span class="n">update_weights</span><span class="p">)</span>
            <span class="n">update_weights</span>                                   <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.40487</span> <span class="mf">1.94238</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">345</span><span class="p">:</span><span class="n">update_weights</span> <span class="p">(</span><span class="n">update_weights</span><span class="p">)</span>
                <span class="n">_bind_input_ortvalue</span>                         <span class="o">--</span>  <span class="mi">201000</span>  <span class="mi">201000</span> <span class="o">--</span> <span class="mf">0.19630</span> <span class="mf">0.51693</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">159</span><span class="p">:</span><span class="n">_bind_input_ortvalue</span> <span class="p">(</span><span class="n">_bind_input_ortvalue</span><span class="p">)</span> <span class="o">+++</span>
                <span class="n">_bind_output_ortvalue</span>                        <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.07458</span> <span class="mf">0.18952</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">202</span><span class="p">:</span><span class="n">_bind_output_ortvalue</span> <span class="p">(</span><span class="n">_bind_output_ortvalue</span><span class="p">)</span>
                    <span class="n">_bio_cache</span>                               <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.04417</span> <span class="mf">0.05406</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">138</span><span class="p">:</span><span class="n">_bio_cache</span> <span class="p">(</span><span class="n">_bio_cache</span><span class="p">)</span> <span class="o">+++</span>
                    <span class="n">_bio_ptr</span>                                 <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.05222</span> <span class="mf">0.05222</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">155</span><span class="p">:</span><span class="n">_bio_ptr</span> <span class="p">(</span><span class="n">_bio_ptr</span><span class="p">)</span> <span class="o">+++</span>
                    <span class="n">_bio_do_bind_out</span>                         <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">198</span><span class="p">:</span><span class="n">_bio_do_bind_out</span> <span class="p">(</span><span class="n">_bio_do_bind_out</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>    <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.00863</span> <span class="mf">0.00863</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                <span class="n">_call_iobinding</span>                              <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.63987</span> <span class="mf">0.63987</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="n">_call_iobinding</span> <span class="p">(</span><span class="n">_call_iobinding</span><span class="p">)</span>
                <span class="n">value</span>                                        <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.00953</span> <span class="mf">0.00953</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">160</span><span class="p">:</span><span class="n">value</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+++</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnx</span><span class="o">...</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.16512</span> <span class="mf">0.16512</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>           <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.01655</span> <span class="mf">0.01655</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;mean&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>       <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00026</span> <span class="mf">0.00426</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;mean&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;mean&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
                <span class="n">_mean</span>                                        <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00163</span> <span class="mf">0.00400</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">_methods</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">162</span><span class="p">:</span><span class="n">_mean</span> <span class="p">(</span><span class="n">_mean</span><span class="p">)</span>
                    <span class="n">_count_reduce_items</span>                      <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00097</span> <span class="mf">0.00107</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">_methods</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="n">_count_reduce_items</span> <span class="p">(</span><span class="n">_count_reduce_items</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="o">...</span><span class="n">lize_axis_index</span><span class="o">&gt;</span> <span class="o">--</span>     <span class="mi">200</span>     <span class="mi">200</span> <span class="o">--</span> <span class="mf">0.00010</span> <span class="mf">0.00010</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_multiarray_umath</span><span class="o">.</span><span class="n">normalize_axis_index</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_multiarray_umath</span><span class="o">.</span><span class="n">normalize_axis_index</span><span class="o">&gt;</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asanyarray</span><span class="o">&gt;</span>       <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00004</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asanyarray</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asanyarray</span><span class="o">&gt;</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reduce&#39;</span> <span class="n">of</span><span class="o">...</span><span class="n">py</span><span class="o">.</span><span class="n">ufunc</span><span class="s1">&#39; objects&gt; --     100     100 -- 0.00109 0.00109 -- ~:0:&lt;method &#39;</span><span class="n">reduce</span><span class="s1">&#39; of &#39;</span><span class="n">numpy</span><span class="o">.</span><span class="n">ufunc</span><span class="s1">&#39; objects&gt; (&lt;method &#39;</span><span class="n">reduce</span><span class="s1">&#39; of &#39;</span><span class="n">numpy</span><span class="o">.</span><span class="n">ufunc</span><span class="s1">&#39; objects&gt;)</span>
                    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>       <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00006</span> <span class="mf">0.00006</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>    <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00004</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">issubclass</span><span class="o">&gt;</span>    <span class="o">--</span>     <span class="mi">200</span>     <span class="mi">200</span> <span class="o">--</span> <span class="mf">0.00007</span> <span class="mf">0.00007</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">issubclass</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">issubclass</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">&gt;</span>                    <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00358</span> <span class="mf">0.00358</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>              <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00169</span> <span class="mf">0.00169</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>                   <span class="o">--</span>   <span class="mi">40300</span>   <span class="mi">40300</span> <span class="o">--</span> <span class="mf">0.01424</span> <span class="mf">0.01424</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="n">_create_training_session</span>                             <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.02824</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">626</span><span class="p">:</span><span class="n">_create_training_session</span> <span class="p">(</span><span class="n">_create_training_session</span><span class="p">)</span>
            <span class="fm">__init__</span>                                         <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00008</span> <span class="mf">0.02820</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="fm">__init__</span> <span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">91</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">94</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">113</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                <span class="n">_init_next</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00010</span> <span class="mf">0.02809</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">163</span><span class="p">:</span><span class="n">_init_next</span> <span class="p">(</span><span class="n">_init_next</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">173</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">175</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                    <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">178</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                    <span class="n">_create_onnx_graphs</span>                      <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00662</span> <span class="mf">0.02797</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">287</span><span class="p">:</span><span class="n">_create_onnx_graphs</span> <span class="p">(</span><span class="n">_create_onnx_graphs</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">396</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">397</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">399</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                            <span class="n">_provider_name_to_device_type</span>    <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">260</span><span class="p">:</span><span class="n">_provider_name_to_device_type</span> <span class="p">(</span><span class="n">_provider_name_to_device_type</span><span class="p">)</span> <span class="o">+++</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">404</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                            <span class="n">_provider_name_to_device_type</span>    <span class="o">--</span>       <span class="mi">7</span>       <span class="mi">7</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">260</span><span class="p">:</span><span class="n">_provider_name_to_device_type</span> <span class="p">(</span><span class="n">_provider_name_to_device_type</span><span class="p">)</span> <span class="o">+++</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">410</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                            <span class="n">_provider_name_to_device_type</span>    <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">260</span><span class="p">:</span><span class="n">_provider_name_to_device_type</span> <span class="p">(</span><span class="n">_provider_name_to_device_type</span><span class="p">)</span> <span class="o">+++</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">479</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">480</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                        <span class="n">get_inputs</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">111</span><span class="p">:</span><span class="n">get_inputs</span> <span class="p">(</span><span class="n">get_inputs</span><span class="p">)</span>
                        <span class="n">get_outputs</span>                          <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">115</span><span class="p">:</span><span class="n">get_outputs</span> <span class="p">(</span><span class="n">get_outputs</span><span class="p">)</span>
                        <span class="fm">__init__</span>                             <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.02063</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">283</span><span class="p">:</span><span class="fm">__init__</span> <span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
                            <span class="n">get</span>                              <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00004</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">_collections_abc</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">759</span><span class="p">:</span><span class="n">get</span> <span class="p">(</span><span class="n">get</span><span class="p">)</span>
                                <span class="fm">__getitem__</span>                  <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">os</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">674</span><span class="p">:</span><span class="fm">__getitem__</span> <span class="p">(</span><span class="fm">__getitem__</span><span class="p">)</span>
                                    <span class="n">encodekey</span>                <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">os</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">746</span><span class="p">:</span><span class="n">encodekey</span> <span class="p">(</span><span class="n">encodekey</span><span class="p">)</span>
                                        <span class="n">check_str</span>            <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">os</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">740</span><span class="p">:</span><span class="n">check_str</span> <span class="p">(</span><span class="n">check_str</span><span class="p">)</span>
                            <span class="fm">__init__</span>                         <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">101</span><span class="p">:</span><span class="fm">__init__</span> <span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
                            <span class="n">_create_inference_session</span>        <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.02045</span> <span class="mf">0.02055</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">346</span><span class="p">:</span><span class="n">_create_inference_session</span> <span class="p">(</span><span class="n">_create_inference_session</span><span class="p">)</span>
                                <span class="n">check_and_nor</span><span class="o">...</span><span class="n">rovider_args</span> <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00008</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="n">check_and_normalize_provider_args</span> <span class="p">(</span><span class="n">check_and_normalize_provider_args</span><span class="p">)</span>
                                    <span class="n">set_provider_options</span>     <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="n">set_provider_options</span> <span class="p">(</span><span class="n">set_provider_options</span><span class="p">)</span>
                                        <span class="o">&lt;</span><span class="n">dictcomp</span><span class="o">&gt;</span>           <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">62</span><span class="p">:</span><span class="o">&lt;</span><span class="n">dictcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">dictcomp</span><span class="o">&gt;</span><span class="p">)</span>
                                    <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>               <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">75</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                                    <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>               <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">Windows</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">capi</span><span class="o">/</span><span class="n">onnxruntime_inference_collection</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">78</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
                        <span class="n">load_model</span>                           <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00049</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">107</span><span class="p">:</span><span class="n">load_model</span> <span class="p">(</span><span class="n">load_model</span><span class="p">)</span>
                            <span class="n">_load_bytes</span>                      <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="n">_load_bytes</span> <span class="p">(</span><span class="n">_load_bytes</span><span class="p">)</span>
                                <span class="n">inner</span>                        <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">typing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">262</span><span class="p">:</span><span class="n">inner</span> <span class="p">(</span><span class="n">inner</span><span class="p">)</span> <span class="o">+++</span>
                                <span class="n">cast</span>                         <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">typing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1333</span><span class="p">:</span><span class="n">cast</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span> <span class="o">+++</span>
                            <span class="n">_get_file_path</span>                   <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="n">_get_file_path</span> <span class="p">(</span><span class="n">_get_file_path</span><span class="p">)</span>
                            <span class="n">load_model_from_string</span>           <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00045</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">147</span><span class="p">:</span><span class="n">load_model_from_string</span> <span class="p">(</span><span class="n">load_model_from_string</span><span class="p">)</span>
                                <span class="n">_deserialize</span>                 <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00044</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">81</span><span class="p">:</span><span class="n">_deserialize</span> <span class="p">(</span><span class="n">_deserialize</span><span class="p">)</span>
                                    <span class="n">inner</span>                    <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">typing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">262</span><span class="p">:</span><span class="n">inner</span> <span class="p">(</span><span class="n">inner</span><span class="p">)</span> <span class="o">+++</span>
                                    <span class="n">cast</span>                     <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">typing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1333</span><span class="p">:</span><span class="n">cast</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span> <span class="o">+++</span>
                                    <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;Pa...&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00042</span> <span class="mf">0.00042</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;ParseFromString&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;ParseFromString&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
                        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>       <span class="o">--</span>      <span class="mi">16</span>      <span class="mi">16</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
                        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;Serializ...essage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00014</span> <span class="mf">0.00014</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;SerializeToString&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;SerializeToString&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">new_instance</span>                                     <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">211</span><span class="p">:</span><span class="n">new_instance</span> <span class="p">(</span><span class="n">new_instance</span><span class="p">)</span>
                <span class="fm">__init__</span>                                     <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">501</span><span class="p">:</span><span class="fm">__init__</span> <span class="p">(</span><span class="fm">__init__</span><span class="p">)</span>
            <span class="n">device_to_providers</span>                              <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="n">onnxruntime_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">133</span><span class="p">:</span><span class="n">device_to_providers</span> <span class="p">(</span><span class="n">device_to_providers</span><span class="p">)</span>
        <span class="n">value</span>                                                <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">160</span><span class="p">:</span><span class="n">value</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+++</span>
        <span class="n">init_learning_rate</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">307</span><span class="p">:</span><span class="n">init_learning_rate</span> <span class="p">(</span><span class="n">init_learning_rate</span><span class="p">)</span>
            <span class="n">init_learning_rate</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">176</span><span class="p">:</span><span class="n">init_learning_rate</span> <span class="p">(</span><span class="n">init_learning_rate</span><span class="p">)</span>
        <span class="n">update_learning_rate</span>                                 <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00015</span> <span class="mf">0.00098</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">314</span><span class="p">:</span><span class="n">update_learning_rate</span> <span class="p">(</span><span class="n">update_learning_rate</span><span class="p">)</span>
            <span class="n">update_learning_rate</span>                             <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00084</span> <span class="mf">0.00084</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">194</span><span class="p">:</span><span class="n">update_learning_rate</span> <span class="p">(</span><span class="n">update_learning_rate</span><span class="p">)</span>
        <span class="n">proto_type_to_dtype</span>                                  <span class="o">--</span>       <span class="mi">6</span>       <span class="mi">6</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">onnx_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="n">proto_type_to_dtype</span> <span class="p">(</span><span class="n">proto_type_to_dtype</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>                  <span class="o">--</span>     <span class="mi">107</span>     <span class="mi">107</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>                       <span class="o">--</span>     <span class="mi">108</span>     <span class="mi">108</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;randn&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy...nd.RandomState&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>       <span class="mi">6</span>       <span class="mi">6</span> <span class="o">--</span> <span class="mf">0.00040</span> <span class="mf">0.00040</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;randn&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.random.mtrand.RandomState&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;randn&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.random.mtrand.RandomState&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">inner</span>                                                        <span class="o">--</span>       <span class="mi">6</span>       <span class="mi">6</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">typing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">262</span><span class="p">:</span><span class="n">inner</span> <span class="p">(</span><span class="n">inner</span><span class="p">)</span>
<span class="n">cast</span>                                                         <span class="o">--</span>       <span class="mi">6</span>       <span class="mi">6</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">typing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1333</span><span class="p">:</span><span class="n">cast</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span>
<span class="n">_bio_cache</span>                                                   <span class="o">--</span>  <span class="mi">294800</span>  <span class="mi">294800</span> <span class="o">--</span> <span class="mf">0.18126</span> <span class="mf">0.22052</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">138</span><span class="p">:</span><span class="n">_bio_cache</span> <span class="p">(</span><span class="n">_bio_cache</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span>                            <span class="o">--</span>  <span class="mi">294800</span>  <span class="mi">294800</span> <span class="o">--</span> <span class="mf">0.03926</span> <span class="mf">0.03926</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
<span class="n">_bio_ptr</span>                                                     <span class="o">--</span>  <span class="mi">294800</span>  <span class="mi">294800</span> <span class="o">--</span> <span class="mf">0.20762</span> <span class="mf">0.20762</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">155</span><span class="p">:</span><span class="n">_bio_ptr</span> <span class="p">(</span><span class="n">_bio_ptr</span><span class="p">)</span>
<span class="n">_bind_input_ortvalue</span>                                         <span class="o">--</span>  <span class="mi">214400</span>  <span class="mi">214400</span> <span class="o">--</span> <span class="mf">0.21699</span> <span class="mf">0.59239</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">159</span><span class="p">:</span><span class="n">_bind_input_ortvalue</span> <span class="p">(</span><span class="n">_bind_input_ortvalue</span><span class="p">)</span>
    <span class="n">_bio_cache</span>                                               <span class="o">--</span>  <span class="mi">214400</span>  <span class="mi">214400</span> <span class="o">--</span> <span class="mf">0.13709</span> <span class="mf">0.16646</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">138</span><span class="p">:</span><span class="n">_bio_cache</span> <span class="p">(</span><span class="n">_bio_cache</span><span class="p">)</span> <span class="o">+++</span>
    <span class="n">_bio_do_bind_in</span>                                          <span class="o">--</span>   <span class="mi">14000</span>   <span class="mi">14000</span> <span class="o">--</span> <span class="mf">0.03012</span> <span class="mf">0.03012</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">151</span><span class="p">:</span><span class="n">_bio_do_bind_in</span> <span class="p">(</span><span class="n">_bio_do_bind_in</span><span class="p">)</span>
    <span class="n">_bio_ptr</span>                                                 <span class="o">--</span>  <span class="mi">214400</span>  <span class="mi">214400</span> <span class="o">--</span> <span class="mf">0.15540</span> <span class="mf">0.15540</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">_base_onnx_function</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">155</span><span class="p">:</span><span class="n">_bio_ptr</span> <span class="p">(</span><span class="n">_bio_ptr</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>                    <span class="o">--</span>  <span class="mi">214400</span>  <span class="mi">214400</span> <span class="o">--</span> <span class="mf">0.02341</span> <span class="mf">0.02341</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
<span class="n">_get_att_state</span>                                               <span class="o">--</span>     <span class="mi">205</span>     <span class="mi">205</span> <span class="o">--</span> <span class="mf">0.00007</span> <span class="mf">0.00007</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">139</span><span class="p">:</span><span class="n">_get_att_state</span> <span class="p">(</span><span class="n">_get_att_state</span><span class="p">)</span>
<span class="n">get_full_state</span>                                               <span class="o">--</span>     <span class="mi">101</span>     <span class="mi">301</span> <span class="o">--</span> <span class="mf">0.00049</span> <span class="mf">0.00093</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">147</span><span class="p">:</span><span class="n">get_full_state</span> <span class="p">(</span><span class="n">get_full_state</span><span class="p">)</span>
    <span class="n">_get_att_state</span>                                           <span class="o">--</span>     <span class="mi">201</span>     <span class="mi">201</span> <span class="o">--</span> <span class="mf">0.00007</span> <span class="mf">0.00007</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">139</span><span class="p">:</span><span class="n">_get_att_state</span> <span class="p">(</span><span class="n">_get_att_state</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                               <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00021</span> <span class="mf">0.00072</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">152</span><span class="p">:</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="n">get_full_state</span>                                       <span class="o">--</span>     <span class="mi">200</span>     <span class="mi">200</span> <span class="o">--</span> <span class="mf">0.00030</span> <span class="mf">0.00050</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">optimizers_partial</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">147</span><span class="p">:</span><span class="n">get_full_state</span> <span class="p">(</span><span class="n">get_full_state</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span>                       <span class="o">--</span>     <span class="mi">201</span>     <span class="mi">201</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00004</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>                       <span class="o">--</span>     <span class="mi">201</span>     <span class="mi">201</span> <span class="o">--</span> <span class="mf">0.00005</span> <span class="mf">0.00005</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>                    <span class="o">--</span>     <span class="mi">301</span>     <span class="mi">301</span> <span class="o">--</span> <span class="mf">0.00007</span> <span class="mf">0.00007</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
<span class="n">_provider_name_to_device_type</span>                                <span class="o">--</span>       <span class="mi">9</span>       <span class="mi">9</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">260</span><span class="p">:</span><span class="n">_provider_name_to_device_type</span> <span class="p">(</span><span class="n">_provider_name_to_device_type</span><span class="p">)</span>
<span class="n">get_initializer</span>                                              <span class="o">--</span>      <span class="mi">14</span>      <span class="mi">14</span> <span class="o">--</span> <span class="mf">0.00008</span> <span class="mf">0.00175</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">269</span><span class="p">:</span><span class="n">get_initializer</span> <span class="p">(</span><span class="n">get_initializer</span><span class="p">)</span>
    <span class="n">to_array</span>                                                 <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00009</span> <span class="mf">0.00168</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">numpy_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="n">to_array</span> <span class="p">(</span><span class="n">to_array</span><span class="p">)</span>
        <span class="n">uses_external_data</span>                                   <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">onnx</span><span class="o">/</span><span class="n">external_data_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">224</span><span class="p">:</span><span class="n">uses_external_data</span> <span class="p">(</span><span class="n">uses_external_data</span><span class="p">)</span>
            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;...age.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;astype&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>         <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00006</span> <span class="mf">0.00006</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;astype&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;astype&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reshape&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>        <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reshape&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reshape&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="o">&gt;</span>                      <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00148</span> <span class="mf">0.00148</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span>                   <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;go...ssage.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>      <span class="mi">24</span>      <span class="mi">24</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
<span class="n">input_to_ort</span>                                                 <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.12150</span> <span class="mf">0.16754</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">552</span><span class="p">:</span><span class="n">input_to_ort</span> <span class="p">(</span><span class="n">input_to_ort</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="o">&gt;</span>                           <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.01681</span> <span class="mf">0.03690</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>                    <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.00712</span> <span class="mf">0.00712</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>                           <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.00202</span> <span class="mf">0.00202</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
<span class="n">value</span>                                                        <span class="o">--</span>   <span class="mi">40300</span>   <span class="mi">40300</span> <span class="o">--</span> <span class="mf">0.00955</span> <span class="mf">0.00955</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">sgd_learning_rate</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">160</span><span class="p">:</span><span class="n">value</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="n">numpy_to_ort_value</span>                                           <span class="o">--</span>   <span class="mi">13426</span>   <span class="mi">13426</span> <span class="o">--</span> <span class="mf">0.00661</span> <span class="mf">0.03872</span> <span class="o">--</span> <span class="n">onnxruntime_helper</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">120</span><span class="p">:</span><span class="n">numpy_to_ort_value</span> <span class="p">(</span><span class="n">numpy_to_ort_value</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntim</span><span class="o">...</span><span class="n">state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="o">--</span>   <span class="mi">13426</span>   <span class="mi">13426</span> <span class="o">--</span> <span class="mf">0.03211</span> <span class="mf">0.03211</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
<span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;astype&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>                 <span class="o">--</span>      <span class="mi">18</span>      <span class="mi">18</span> <span class="o">--</span> <span class="mf">0.00014</span> <span class="mf">0.00014</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;astype&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;astype&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>                          <span class="o">--</span>   <span class="mi">13575</span>   <span class="mi">13575</span> <span class="o">--</span> <span class="mf">0.00608</span> <span class="mf">0.00608</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>                           <span class="o">--</span>   <span class="mi">94120</span>   <span class="mi">94120</span> <span class="o">--</span> <span class="mf">0.01981</span> <span class="mf">0.01981</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>                        <span class="o">--</span>  <span class="mi">362251</span>  <span class="mi">362251</span> <span class="o">--</span> <span class="mf">0.04476</span> <span class="mf">0.04477</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="fm">__instancecheck__</span>                                        <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Python395_x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">abc</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">96</span><span class="p">:</span><span class="fm">__instancecheck__</span> <span class="p">(</span><span class="fm">__instancecheck__</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>                               <span class="o">--</span>   <span class="mi">67437</span>   <span class="mi">67437</span> <span class="o">--</span> <span class="mf">0.02341</span> <span class="mf">0.02908</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="fm">__len__</span>                                                  <span class="o">--</span>   <span class="mi">13600</span>   <span class="mi">13600</span> <span class="o">--</span> <span class="mf">0.00567</span> <span class="mf">0.00567</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">data_loader</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">89</span><span class="p">:</span><span class="fm">__len__</span> <span class="p">(</span><span class="fm">__len__</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reshape&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>                <span class="o">--</span>      <span class="mi">14</span>      <span class="mi">14</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00002</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reshape&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reshape&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span>                           <span class="o">--</span>     <span class="mi">213</span>     <span class="mi">213</span> <span class="o">--</span> <span class="mf">0.00005</span> <span class="mf">0.00005</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">getattr</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">...</span><span class="mf">.1</span><span class="n">_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="o">--</span>   <span class="mi">93826</span>   <span class="mi">93826</span> <span class="o">--</span> <span class="mf">0.19723</span> <span class="mf">0.19723</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span><span class="n">onnxruntime_pybind11_state</span><span class="o">.</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span>                                <span class="o">--</span>  <span class="mi">301501</span>  <span class="mi">301501</span> <span class="o">--</span> <span class="mf">0.04083</span> <span class="mf">0.04083</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google...._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>      <span class="mi">36</span>      <span class="mi">36</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;HasField&#39;</span> <span class="n">of</span> <span class="s1">&#39;google.protobuf.pyext._message.CMessage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="o">&gt;</span>                               <span class="o">--</span>   <span class="mi">13404</span>   <span class="mi">13404</span> <span class="o">--</span> <span class="mf">0.01681</span> <span class="mf">0.03690</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">all</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>                                                 <span class="o">--</span>   <span class="mi">53600</span>   <span class="mi">53600</span> <span class="o">--</span> <span class="mf">0.01461</span> <span class="mf">0.02009</span> <span class="o">--</span> <span class="n">onnxcustom</span><span class="o">/</span><span class="n">onnxcustom</span><span class="o">/</span><span class="n">training</span><span class="o">/</span><span class="n">ortgradient</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">572</span><span class="p">:</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>                <span class="o">--</span>   <span class="mi">53600</span>   <span class="mi">53600</span> <span class="o">--</span> <span class="mf">0.00548</span> <span class="mf">0.00548</span> <span class="o">--</span> <span class="o">~</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+++</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_iteration</span>                                           <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.41903</span> <span class="mf">3.74610</span> <span class="o">--</span>
    <span class="n">iter_ortvalue</span>                                    <span class="o">--</span>    <span class="mi">6800</span>    <span class="mi">6800</span> <span class="o">--</span> <span class="mf">0.02838</span> <span class="mf">0.14761</span> <span class="o">--</span>
        <span class="n">_next_iter</span>                                   <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00946</span> <span class="mf">0.07207</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>           <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00245</span> <span class="mf">0.00423</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;randint&#39;</span> <span class="n">o</span><span class="o">...</span><span class="n">domState</span><span class="s1">&#39; objects&gt; --    6700    6700 -- 0.05838 0.05838 --</span>
        <span class="n">numpy_to_ort_value</span>                           <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.00658</span> <span class="mf">0.03860</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>               <span class="o">--</span>    <span class="mi">6900</span>    <span class="mi">6900</span> <span class="o">--</span> <span class="mf">0.00467</span> <span class="mf">0.00855</span> <span class="o">--</span>
    <span class="n">forward</span>                                          <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.31685</span> <span class="mf">0.44643</span> <span class="o">--</span>
        <span class="n">input_to_ort</span>                                 <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.08002</span> <span class="mf">0.11492</span> <span class="o">--</span>
        <span class="n">save_for_backward</span>                            <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.01032</span> <span class="mf">0.01032</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>          <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00434</span> <span class="mf">0.00434</span> <span class="o">--</span>
    <span class="n">backward</span>                                         <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.43012</span> <span class="mf">0.48957</span> <span class="o">--</span>
        <span class="n">input_to_ort</span>                                 <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.04148</span> <span class="mf">0.05262</span> <span class="o">--</span>
        <span class="n">saved_tensors</span>                                <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00207</span> <span class="mf">0.00207</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;pop&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>             <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00476</span> <span class="mf">0.00476</span> <span class="o">--</span>
    <span class="n">loss_gradient</span>                                    <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.05841</span> <span class="mf">0.26967</span> <span class="o">--</span>
        <span class="n">clear_binding_inputs</span>                         <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00545</span> <span class="mf">0.01270</span> <span class="o">--</span>
            <span class="n">_cache_in_clear</span>                          <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00568</span> <span class="mf">0.00725</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">id</span><span class="o">&gt;</span>        <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00157</span> <span class="mf">0.00157</span> <span class="o">--</span>
        <span class="n">_bind_input_ortvalue</span>                         <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.02070</span> <span class="mf">0.07545</span> <span class="o">--</span>
        <span class="n">_call_iobinding</span>                              <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.11997</span> <span class="mf">0.11997</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>           <span class="o">--</span>   <span class="mi">13400</span>   <span class="mi">13400</span> <span class="o">--</span> <span class="mf">0.00315</span> <span class="mf">0.00315</span> <span class="o">--</span>
    <span class="n">penalty_loss</span>                                     <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00112</span> <span class="mf">0.00112</span> <span class="o">--</span>
    <span class="n">update_weights</span>                                   <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.00651</span> <span class="mf">0.00651</span> <span class="o">--</span>
    <span class="n">update_weights</span>                                   <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.40487</span> <span class="mf">1.94238</span> <span class="o">--</span>
        <span class="n">_bind_input_ortvalue</span>                         <span class="o">--</span>  <span class="mi">201000</span>  <span class="mi">201000</span> <span class="o">--</span> <span class="mf">0.19630</span> <span class="mf">0.51693</span> <span class="o">--</span>
        <span class="n">_bind_output_ortvalue</span>                        <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.07458</span> <span class="mf">0.18952</span> <span class="o">--</span>
            <span class="n">_bio_cache</span>                               <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.04417</span> <span class="mf">0.05406</span> <span class="o">--</span>
            <span class="n">_bio_ptr</span>                                 <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.05222</span> <span class="mf">0.05222</span> <span class="o">--</span>
            <span class="n">_bio_do_bind_out</span>                         <span class="o">--</span>      <span class="mi">12</span>      <span class="mi">12</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>    <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.00863</span> <span class="mf">0.00863</span> <span class="o">--</span>
        <span class="n">_call_iobinding</span>                              <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.63987</span> <span class="mf">0.63987</span> <span class="o">--</span>
        <span class="n">value</span>                                        <span class="o">--</span>   <span class="mi">40200</span>   <span class="mi">40200</span> <span class="o">--</span> <span class="mf">0.00953</span> <span class="mf">0.00953</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">onnx</span><span class="o">...</span><span class="n">ortvalue_from_numpy</span><span class="o">&gt;</span> <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.16512</span> <span class="mf">0.16512</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>           <span class="o">--</span>   <span class="mi">80400</span>   <span class="mi">80400</span> <span class="o">--</span> <span class="mf">0.01655</span> <span class="mf">0.01655</span> <span class="o">--</span>
    <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;mean&#39;</span> <span class="n">of</span> <span class="s1">&#39;numpy.ndarray&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>       <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00026</span> <span class="mf">0.00426</span> <span class="o">--</span>
        <span class="n">_mean</span>                                        <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00163</span> <span class="mf">0.00400</span> <span class="o">--</span>
            <span class="n">_count_reduce_items</span>                      <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00097</span> <span class="mf">0.00107</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="o">...</span><span class="n">lize_axis_index</span><span class="o">&gt;</span> <span class="o">--</span>     <span class="mi">200</span>     <span class="mi">200</span> <span class="o">--</span> <span class="mf">0.00010</span> <span class="mf">0.00010</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asanyarray</span><span class="o">&gt;</span>       <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00004</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;reduce&#39;</span> <span class="n">of</span><span class="o">...</span><span class="n">py</span><span class="o">.</span><span class="n">ufunc</span><span class="s1">&#39; objects&gt; --     100     100 -- 0.00109 0.00109 --</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">hasattr</span><span class="o">&gt;</span>       <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00006</span> <span class="mf">0.00006</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">isinstance</span><span class="o">&gt;</span>    <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00004</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">issubclass</span><span class="o">&gt;</span>    <span class="o">--</span>     <span class="mi">200</span>     <span class="mi">200</span> <span class="o">--</span> <span class="mf">0.00007</span> <span class="mf">0.00007</span> <span class="o">--</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="o">&gt;</span>                    <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00358</span> <span class="mf">0.00358</span> <span class="o">--</span>
    <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="o">&gt;</span>              <span class="o">--</span>    <span class="mi">6700</span>    <span class="mi">6700</span> <span class="o">--</span> <span class="mf">0.00169</span> <span class="mf">0.00169</span> <span class="o">--</span>
    <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>                   <span class="o">--</span>   <span class="mi">40300</span>   <span class="mi">40300</span> <span class="o">--</span> <span class="mf">0.01424</span> <span class="mf">0.01424</span> <span class="o">--</span>
<span class="n">_create_training_session</span>                             <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.02824</span> <span class="o">--</span>
    <span class="fm">__init__</span>                                         <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00008</span> <span class="mf">0.02820</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
        <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
        <span class="n">_init_next</span>                                   <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00010</span> <span class="mf">0.02809</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
            <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                               <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
            <span class="n">_create_onnx_graphs</span>                      <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00662</span> <span class="mf">0.02797</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00002</span> <span class="o">--</span>
                    <span class="n">_provider_name_to_device_type</span>    <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00002</span> <span class="o">--</span>
                    <span class="n">_provider_name_to_device_type</span>    <span class="o">--</span>       <span class="mi">7</span>       <span class="mi">7</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                    <span class="n">_provider_name_to_device_type</span>    <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
                <span class="n">get_inputs</span>                           <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="n">get_outputs</span>                          <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="fm">__init__</span>                             <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.02063</span> <span class="o">--</span>
                    <span class="n">get</span>                              <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00004</span> <span class="o">--</span>
                        <span class="fm">__getitem__</span>                  <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00003</span> <span class="o">--</span>
                            <span class="n">encodekey</span>                <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00002</span> <span class="o">--</span>
                                <span class="n">check_str</span>            <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                    <span class="fm">__init__</span>                         <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                    <span class="n">_create_inference_session</span>        <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.02045</span> <span class="mf">0.02055</span> <span class="o">--</span>
                        <span class="n">check_and_nor</span><span class="o">...</span><span class="n">rovider_args</span> <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00004</span> <span class="mf">0.00008</span> <span class="o">--</span>
                            <span class="n">set_provider_options</span>     <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00001</span> <span class="o">--</span>
                                <span class="o">&lt;</span><span class="n">dictcomp</span><span class="o">&gt;</span>           <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                            <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>               <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                            <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>               <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="n">load_model</span>                           <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00049</span> <span class="o">--</span>
                    <span class="n">_load_bytes</span>                      <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00002</span> <span class="mf">0.00003</span> <span class="o">--</span>
                        <span class="n">inner</span>                        <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                        <span class="n">cast</span>                         <span class="o">--</span>       <span class="mi">4</span>       <span class="mi">4</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                    <span class="n">_get_file_path</span>                   <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                    <span class="n">load_model_from_string</span>           <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00045</span> <span class="o">--</span>
                        <span class="n">_deserialize</span>                 <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00001</span> <span class="mf">0.00044</span> <span class="o">--</span>
                            <span class="n">inner</span>                    <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                            <span class="n">cast</span>                     <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                            <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;Pa...&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>       <span class="mi">2</span>       <span class="mi">2</span> <span class="o">--</span> <span class="mf">0.00042</span> <span class="mf">0.00042</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">method</span> <span class="n">builtins</span><span class="o">.</span><span class="n">len</span><span class="o">&gt;</span>       <span class="o">--</span>      <span class="mi">16</span>      <span class="mi">16</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
                <span class="o">&lt;</span><span class="n">method</span> <span class="s1">&#39;Serializ...essage&#39;</span> <span class="n">objects</span><span class="o">&gt;</span> <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00014</span> <span class="mf">0.00014</span> <span class="o">--</span>
    <span class="n">new_instance</span>                                     <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
        <span class="fm">__init__</span>                                     <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="o">--</span>
    <span class="n">device_to_providers</span>                              <span class="o">--</span>       <span class="mi">1</span>       <span class="mi">1</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span>
<span class="n">value</span>                                                <span class="o">--</span>     <span class="mi">100</span>     <span class="mi">100</span> <span class="o">--</span> <span class="mf">0.00003</span> <span class="mf">0.00003</span> <span class="o">--</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;mlp_onnx_ort&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;mlp_onnx_ort&quot;</span><span class="p">)</span>
<span class="n">train_session2</span><span class="o">.</span><span class="n">save_onnx_graph</span><span class="p">(</span><span class="s2">&quot;mlp_onnx_ort&quot;</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">{'model_onnx': 'mlp_onnx_ort\GradFBOptimizer.model_onnx.onnx',
 'learning_rate': {'<a href="#id10"><span class="problematic" id="id11">axpyw_onnx_</span></a>': 'mlp_onnx_ort\LRateSGDNesterov.learning_rate.axpyw_onnx_.onnx'},
 'learning_loss': {'<a href="#id12"><span class="problematic" id="id13">loss_grad_onnx_</span></a>': 'mlp_onnx_ort\SquareLLoss.learning_loss.loss_grad_onnx_.onnx',
  '<a href="#id14"><span class="problematic" id="id15">loss_score_onnx_</span></a>': 'mlp_onnx_ort\SquareLLoss.learning_loss.loss_score_onnx_.onnx'},
 'learning_penalty': {},
 '<a href="#id16"><span class="problematic" id="id17">zero_onnx_</span></a>': 'mlp_onnx_ort\GradFBOptimizer.zero_onnx_.onnx',
 '<a href="#id18"><span class="problematic" id="id19">train_function_</span></a>': {'_trained_onnx': 'mlp_onnx_ort\OrtGradientForwardBackwardFunction_1523278698000.train_function_._trained_onnx.onnx',
  '_optimized_pre_grad_model': 'mlp_onnx_ort\OrtGradientForwardBackwardFunction_1523278698000.train_function_._optimized_pre_grad_model.onnx'}}</pre>
<p>Weights are updated with the following ONNX graph:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">onnxview</span> train_session2.learning_rate.axpyw_onnx_
</pre></div>
</div>
<div id="M535d70bde10646b088951599157d0d15-cont"><div id="M535d70bde10646b088951599157d0d15" style="width:;height:;"></div></div>
<script>

require(['http://www.xavierdupre.fr/js/vizjs/viz.js'], function() { var svgGraph = Viz("digraph{\n  size=7;\n  orientation=portrait;\n  ranksep=0.25;\n  nodesep=0.05;\n\n  X1 [shape=box color=red label=\"X1\nfloat(('?',))\" fontsize=10];\n  X2 [shape=box color=red label=\"X2\nfloat(('?',))\" fontsize=10];\n  G [shape=box color=red label=\"G\nfloat(('?',))\" fontsize=10];\n  alpha [shape=box color=red label=\"alpha\nfloat((1,))\" fontsize=10];\n  beta [shape=box color=red label=\"beta\nfloat((1,))\" fontsize=10];\n\n  Y [shape=box color=green label=\"Y\nfloat(('?',))\" fontsize=10];\n  Z [shape=box color=green label=\"Z\nfloat(('?',))\" fontsize=10];\n\n\n  Mu_C03 [shape=box label=\"Mu_C03\" fontsize=10];\n  Mu_Mul1 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mu_Mul1)\" fontsize=10];\n  G -> Mu_Mul1;\n  beta -> Mu_Mul1;\n  Mu_Mul1 -> Mu_C03;\n\n  Mu_C0 [shape=box label=\"Mu_C0\" fontsize=10];\n  Mu_Mul [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mu_Mul)\" fontsize=10];\n  X1 -> Mu_Mul;\n  alpha -> Mu_Mul;\n  Mu_Mul -> Mu_C0;\n\n  Ad_Add [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Ad_Add)\" fontsize=10];\n  Mu_C0 -> Ad_Add;\n  Mu_C03 -> Ad_Add;\n  Ad_Add -> Z;\n\n  Mu_C02 [shape=box label=\"Mu_C02\" fontsize=10];\n  Mu_Mul2 [shape=box style=\"filled,rounded\" color=orange label=\"Mul\n(Mu_Mul2)\" fontsize=10];\n  Z -> Mu_Mul2;\n  beta -> Mu_Mul2;\n  Mu_Mul2 -> Mu_C02;\n\n  Ad_C0 [shape=box label=\"Ad_C0\" fontsize=10];\n  Ad_Add1 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Ad_Add1)\" fontsize=10];\n  Mu_C0 -> Ad_Add1;\n  Mu_C02 -> Ad_Add1;\n  Ad_Add1 -> Ad_C0;\n\n  Ad_Add2 [shape=box style=\"filled,rounded\" color=orange label=\"Add\n(Ad_Add2)\" fontsize=10];\n  Ad_C0 -> Ad_Add2;\n  X2 -> Ad_Add2;\n  Ad_Add2 -> Y;\n}");
document.getElementById('M535d70bde10646b088951599157d0d15').innerHTML = svgGraph; });

</script></section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="tree_to_onnx.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Convert a tree into ONNX</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../all_notebooks_coverage.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks Coverage</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, Xavier Dupré.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>