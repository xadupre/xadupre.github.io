<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>Technical details</title>

  <link rel="stylesheet" href="_static/sphinx-modern-theme-modified.css" type="text/css"/>
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
</head>
<body>
<div class="container">
  <div class="row" style="margin-top: 1rem;">
    <div id="sidebar" class="col-xs-12 col-sm-3">
      <a href="index.html">
        <img style="margin-bottom: 0.5rem;" class="img-fluid" src="_static/logo_main.png"/>
      </a>
      <div id="searchbox" style="display: none" role="search">
        <form class="form-inline" action="search.html" method="get">
          <div class="form-group">
            <label class="sr-only" for="searchInput">Search</label>
            <input type="text" class="form-control" name="q" id="searchInput" placeholder="Search">
          </div>
          <button type="submit" class="btn btn-secondary" style="display:none">Go</button>
          <input type="hidden" name="check_keywords" value="yes"/>
          <input type="hidden" name="area" value="default"/>
        </form>
      </div>

      <hr>

        <div id="toc">
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="implementation.html">Comparing implementations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scikit-learn/PR13290.html">PR13290 - Faster Polynomial Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="scikit-learn/PR13290_2.html">PR13290 - Faster Polynomial Features with partial_fit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="onnx.html">ONNX benchmarks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="onnx.html#one-off-predictions">One-Off predictions</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Technical details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scikit-learn">scikit-learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="#onnxruntime">onnxruntime</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
    <div class="col-xs-12 col-sm-9">
      <div class="section" id="technical-details">
<h1>Technical details<a class="headerlink" href="#technical-details" title="Permalink to this headline">¶</a></h1>
<p>Benchmarking is an exact science as the results
may change depending on the machine used to compute
the figures. There is not necessarily an exact correlation
between the processing time and the algorithm cost.
The results may also depend on the options used
to compile a library (CPU, GPU, MKL, …).
Next sections gives some details on how it was done.</p>
<div class="section" id="scikit-learn">
<h2>scikit-learn<a class="headerlink" href="#scikit-learn" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a> is usually the current latest
stable version except if the test involves a pull request
which implies <a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a> is installed from
the master branch.</p>
</div>
<div class="section" id="onnxruntime">
<h2>onnxruntime<a class="headerlink" href="#onnxruntime" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/Microsoft/onnxruntime">onnxruntime</a> is not easy to install on Linux even on CPU.
The current implementation requires that <a class="reference external" href="https://www.python.org/">Python</a> is built
with a specific flags <code class="docutils literal notranslate"><span class="pre">--enable-shared</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">configure</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">optimizations</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">ensurepip</span><span class="o">=</span><span class="n">install</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">shared</span> <span class="o">--</span><span class="n">prefix</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="nb">bin</span>
</pre></div>
</div>
<p>This is due to a feature which requests to be able to interpret
<em>Python</em> inside a package itself and more specifically: <a class="reference external" href="https://pybind11.readthedocs.io/en/stable/compiling.html#embedding-the-python-interpreter">Embedding the Python interpreter</a>.
Then the environment variable <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> must be set to
the location of the shard libraries, <code class="docutils literal notranslate"><span class="pre">/opt/bin</span></code> in the previous example.
The following issue might appear:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">load</span> <span class="n">onnxruntime</span><span class="o">.</span><span class="n">capi</span><span class="o">.</span>
<span class="n">Error</span><span class="p">:</span> <span class="s1">&#39;libnnvm_compiler.so: cannot open shared object file: No such file or directory&#39;</span>
</pre></div>
</div>
<p>To build <a class="reference external" href="https://github.com/Microsoft/onnxruntime">onnxruntime</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Microsoft</span><span class="o">/</span><span class="n">onnxruntime</span><span class="o">.</span><span class="n">git</span> <span class="o">--</span><span class="n">recursive</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="mf">3.6</span><span class="o">.</span><span class="mi">8</span>
<span class="n">python3</span><span class="o">.</span><span class="mi">6</span> <span class="o">./</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">ci_build</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">build_dir</span> <span class="o">./</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">debian36</span> <span class="o">--</span><span class="n">config</span> <span class="n">Release</span> <span class="o">--</span><span class="n">enable_pybind</span> <span class="o">--</span><span class="n">build_wheel</span> <span class="o">--</span><span class="n">use_mkldnn</span> <span class="o">--</span><span class="n">use_openmp</span> <span class="o">--</span><span class="n">build_shared_lib</span>
<span class="n">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="mf">3.7</span><span class="o">.</span><span class="mi">2</span>
<span class="n">python3</span><span class="o">.</span><span class="mi">7</span> <span class="o">./</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">ci_build</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">build_dir</span> <span class="o">./</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">debian37</span> <span class="o">--</span><span class="n">config</span> <span class="n">Release</span> <span class="o">--</span><span class="n">enable_pybind</span> <span class="o">--</span><span class="n">build_wheel</span> <span class="o">--</span><span class="n">use_mkldnn</span> <span class="o">--</span><span class="n">use_openmp</span> <span class="o">--</span><span class="n">build_shared_lib</span>
</pre></div>
</div>
<p>If the wheel then, it is possible to just copy the files
into the <em>python</em> distribution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">./</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">debian36</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">./</span><span class="n">onnxruntime</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">debian37</span><span class="o">/</span><span class="n">Release</span><span class="o">/</span><span class="n">onnxruntime</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>

    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"
        integrity="sha384-THPy051/pYDQGanwU6poAc/hOdQxjnOEXzbT+OuUAFqNqFjL+4IGLBgCJC3ZOShY"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js"
        integrity="sha384-Plbmg8JY28KFelvJVai01l8WyZzrYWG825m+cZ0eDDS1f7d/js6ikvy1+X+guPIB"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/js/bootstrap.min.js"
        integrity="sha384-ux8v3A6CPtOTqOzMKiuo3d/DomGaaClxFYdCu2HPMBEkf6x2xiDyJ7gkXU0MWwaD"
        crossorigin="anonymous"></script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/0.6.0/lunr.min.js"></script>
<script src="_static/searchtools.js"></script>
<script>$('#searchbox').show(0)</script>
</body>
</html>