<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>PR13290 - Faster Polynomial Features</title>

  <link rel="stylesheet" href="../_static/sphinx-modern-theme-modified.css" type="text/css"/>
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
</head>
<body>
<div class="container">
  <div class="row" style="margin-top: 1rem;">
    <div id="sidebar" class="col-xs-12 col-sm-3">
      <a href="../index.html">
        <img style="margin-bottom: 0.5rem;" class="img-fluid" src="../_static/logo_main.png"/>
      </a>
      <div id="searchbox" style="display: none" role="search">
        <form class="form-inline" action="../search.html" method="get">
          <div class="form-group">
            <label class="sr-only" for="searchInput">Search</label>
            <input type="text" class="form-control" name="q" id="searchInput" placeholder="Search">
          </div>
          <button type="submit" class="btn btn-secondary" style="display:none">Go</button>
          <input type="hidden" name="check_keywords" value="yes"/>
          <input type="hidden" name="area" value="default"/>
        </form>
      </div>

      <hr>

        <div id="toc">
        <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../implementation.html">Comparing implementations</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">PR13290 - Faster Polynomial Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="PR13290_2.html">PR13290 - Faster Polynomial Features with partial_fit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../onnx.html">ONNX benchmarks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../onnx.html#one-off-predictions">One-Off predictions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../technical.html">Technical details</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../technical.html#scikit-learn">scikit-learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../technical.html#onnxruntime">onnxruntime</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
    <div class="col-xs-12 col-sm-9">
      <div class="section" id="pr13290-faster-polynomial-features">
<span id="l-pr13290"></span><h1>PR13290 - Faster Polynomial Features<a class="headerlink" href="#pr13290-faster-polynomial-features" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<span id="index-0"></span><ul class="simple">
<li><a class="reference internal" href="#intuition" id="id1">Intuition</a></li>
<li><a class="reference internal" href="#code" id="id2">Code</a></li>
<li><a class="reference internal" href="#graphs" id="id3">Graphs</a></li>
<li><a class="reference internal" href="#raw-results" id="id4">Raw results</a></li>
<li><a class="reference internal" href="#benchmark-code" id="id5">Benchmark code</a></li>
<li><a class="reference internal" href="#alternatives" id="id6">Alternatives</a><ul>
<li><a class="reference internal" href="#transpose-if-order-c-and-size-10e7" id="id7">Transpose if order==’C’ and size &lt; 10e7</a></li>
<li><a class="reference internal" href="#never-transpose" id="id8">Never transpose</a></li>
</ul>
</li>
<li><a class="reference internal" href="#number-of-output-features" id="id9">Number of output features</a></li>
</ul>
</div>
<div class="section" id="intuition">
<h2><a class="toc-backref" href="#id1">Intuition</a><a class="headerlink" href="#intuition" title="Permalink to this headline">¶</a></h2>
<p>The current implementation of <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.PolynomialFeatures.html">PolynomialFeatures</a>
(0.20.2) uses a code based on combinations as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">combinations</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="c1"># combinations(&#39;ABCD&#39;, 2) --&gt; AB AC AD BC BD CD</span>
    <span class="c1"># combinations(range(4), 3) --&gt; 012 013 023 123</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
    <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pool</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pool</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
<p>The current code for method <em>transform</em> uses independently computes
every feature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_output_features_</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combinations</span><span class="p">):</span>
    <span class="n">XP</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">comb</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>But it is possible to leverage broadcasting to reduce
the number of multiplication to do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>

<span class="n">XP</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pos</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_degree</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">XP</span><span class="p">[:,</span> <span class="n">pos</span><span class="p">:</span><span class="n">pos</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">pos</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">new_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">end</span> <span class="o">-</span> <span class="n">a</span>
            <span class="n">multiply</span><span class="p">(</span><span class="n">XP</span><span class="p">[:,</span> <span class="n">a</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">XP</span><span class="p">[:,</span> <span class="n">pos</span><span class="p">:</span><span class="n">new_pos</span><span class="p">])</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">new_pos</span>

        <span class="n">new_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">new_index</span>
</pre></div>
</div>
</div>
<div class="section" id="code">
<h2><a class="toc-backref" href="#id2">Code</a><a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/scikit-learn/scikit-learn/pull/13290">PR13290</a>:
implements faster polynomial features for dense matrices.</p>
</div>
<div class="section" id="graphs">
<h2><a class="toc-backref" href="#id3">Graphs</a><a class="headerlink" href="#graphs" title="Permalink to this headline">¶</a></h2>
<p>(<a class="reference external" href="../scikit-learn/PR13290-1.py">Source code</a>)</p>
<div class="figure">
<img alt="../_images/PR13290-1.png" src="../_images/PR13290-1.png" />
</div>
<p>(<a class="reference external" href="../scikit-learn/PR13290-2.py">Source code</a>)</p>
<div class="figure">
<img alt="../_images/PR13290-2.png" src="../_images/PR13290-2.png" />
</div>
<p>And when <code class="docutils literal notranslate"><span class="pre">degree</span> <span class="pre">==</span> <span class="pre">2</span></code> which is the most common case.
Each color is a different number of features or a different
number of observations.</p>
<p>(<a class="reference external" href="../scikit-learn/PR13290-3.py">Source code</a>)</p>
<div class="figure">
<img alt="../_images/PR13290-3.png" src="../_images/PR13290-3.png" />
</div>
<p>The new implementation is always better.</p>
</div>
<div class="section" id="raw-results">
<h2><a class="toc-backref" href="#id4">Raw results</a><a class="headerlink" href="#raw-results" title="Permalink to this headline">¶</a></h2>
<p><a class="reference download internal" download="" href="../_downloads/fb034573696b91af5b9cc2d094b2ebd4/bench_polynomial_features.csv"><code class="xref download docutils literal notranslate"><span class="pre">bench_polynomial_features.csv</span></code></a></p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyquickhelper.pandashelper</span> <span class="k">import</span> <span class="n">df2rst</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">__WD__</span><span class="p">,</span> <span class="s2">&quot;../../scikit-learn/results/bench_polynomial_features.csv&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;speedup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_0_20_2&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_current&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df2rst</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">number_format</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="19%" />
<col width="9%" />
<col width="7%" />
<col width="7%" />
<col width="11%" />
<col width="14%" />
<col width="15%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">degree</th>
<th class="head">interaction_only</th>
<th class="head">n</th>
<th class="head">nfeat</th>
<th class="head">order</th>
<th class="head">out_feat</th>
<th class="head">time_0_20_2</th>
<th class="head">time_current</th>
<th class="head">speedup</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>10</td>
<td>C</td>
<td>65</td>
<td>0.0007012</td>
<td>0.0001041</td>
<td>6.739</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>10</td>
<td>C</td>
<td>55</td>
<td>0.0005889</td>
<td>0.0001005</td>
<td>5.86</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>10</td>
<td>C</td>
<td>285</td>
<td>0.003043</td>
<td>0.0001523</td>
<td>19.97</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>10</td>
<td>C</td>
<td>175</td>
<td>0.001857</td>
<td>0.0001404</td>
<td>13.23</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1</td>
<td>10</td>
<td>C</td>
<td>1000</td>
<td>0.01086</td>
<td>0.0001999</td>
<td>54.33</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1</td>
<td>10</td>
<td>C</td>
<td>385</td>
<td>0.004192</td>
<td>0.0001755</td>
<td>23.89</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>10</td>
<td>F</td>
<td>65</td>
<td>0.0006966</td>
<td>0.0001027</td>
<td>6.784</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>10</td>
<td>F</td>
<td>55</td>
<td>0.0005901</td>
<td>0.0001007</td>
<td>5.862</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>10</td>
<td>F</td>
<td>285</td>
<td>0.003019</td>
<td>0.0001501</td>
<td>20.12</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>10</td>
<td>F</td>
<td>175</td>
<td>0.001871</td>
<td>0.0001394</td>
<td>13.42</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1</td>
<td>10</td>
<td>F</td>
<td>1000</td>
<td>0.01095</td>
<td>0.0001981</td>
<td>55.28</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1</td>
<td>10</td>
<td>F</td>
<td>385</td>
<td>0.004178</td>
<td>0.0001743</td>
<td>23.97</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>20</td>
<td>C</td>
<td>230</td>
<td>0.002536</td>
<td>0.0001532</td>
<td>16.55</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>20</td>
<td>C</td>
<td>210</td>
<td>0.002236</td>
<td>0.0001496</td>
<td>14.94</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>20</td>
<td>C</td>
<td>1770</td>
<td>0.01912</td>
<td>0.0002461</td>
<td>77.67</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>20</td>
<td>C</td>
<td>1350</td>
<td>0.01461</td>
<td>0.0002388</td>
<td>61.15</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1</td>
<td>20</td>
<td>C</td>
<td>10625</td>
<td>0.1163</td>
<td>0.0003869</td>
<td>300.6</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1</td>
<td>20</td>
<td>C</td>
<td>6195</td>
<td>0.06776</td>
<td>0.0003343</td>
<td>202.7</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>20</td>
<td>F</td>
<td>230</td>
<td>0.002484</td>
<td>0.00015</td>
<td>16.56</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>20</td>
<td>F</td>
<td>210</td>
<td>0.002228</td>
<td>0.0001493</td>
<td>14.92</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>20</td>
<td>F</td>
<td>1770</td>
<td>0.01923</td>
<td>0.0002452</td>
<td>78.45</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>20</td>
<td>F</td>
<td>1350</td>
<td>0.01471</td>
<td>0.0002377</td>
<td>61.89</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1</td>
<td>20</td>
<td>F</td>
<td>10625</td>
<td>0.1164</td>
<td>0.0003818</td>
<td>304.9</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1</td>
<td>20</td>
<td>F</td>
<td>6195</td>
<td>0.06843</td>
<td>0.0003357</td>
<td>203.8</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>40</td>
<td>C</td>
<td>860</td>
<td>0.009277</td>
<td>0.0002557</td>
<td>36.28</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>40</td>
<td>C</td>
<td>820</td>
<td>0.008946</td>
<td>0.0002482</td>
<td>36.04</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>40</td>
<td>C</td>
<td>12340</td>
<td>0.134</td>
<td>0.0004575</td>
<td>292.9</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>40</td>
<td>C</td>
<td>10700</td>
<td>0.1161</td>
<td>0.0004573</td>
<td>253.9</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>40</td>
<td>F</td>
<td>860</td>
<td>0.00933</td>
<td>0.0002481</td>
<td>37.61</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>40</td>
<td>F</td>
<td>820</td>
<td>0.008828</td>
<td>0.0002494</td>
<td>35.4</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>40</td>
<td>F</td>
<td>12340</td>
<td>0.134</td>
<td>0.0004602</td>
<td>291.1</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>40</td>
<td>F</td>
<td>10700</td>
<td>0.1171</td>
<td>0.0004645</td>
<td>252.1</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>60</td>
<td>C</td>
<td>1890</td>
<td>0.02047</td>
<td>0.0003508</td>
<td>58.35</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>60</td>
<td>C</td>
<td>1830</td>
<td>0.0196</td>
<td>0.0003485</td>
<td>56.24</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>60</td>
<td>C</td>
<td>39710</td>
<td>0.433</td>
<td>0.0007546</td>
<td>573.8</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>60</td>
<td>C</td>
<td>36050</td>
<td>0.3941</td>
<td>0.0007044</td>
<td>559.6</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1</td>
<td>60</td>
<td>F</td>
<td>1890</td>
<td>0.02061</td>
<td>0.0003501</td>
<td>58.89</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1</td>
<td>60</td>
<td>F</td>
<td>1830</td>
<td>0.01983</td>
<td>0.000357</td>
<td>55.56</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1</td>
<td>60</td>
<td>F</td>
<td>39710</td>
<td>0.4341</td>
<td>0.0007157</td>
<td>606.6</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1</td>
<td>60</td>
<td>F</td>
<td>36050</td>
<td>0.3973</td>
<td>0.0007063</td>
<td>562.6</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>10</td>
<td>C</td>
<td>65</td>
<td>0.0007819</td>
<td>0.0001267</td>
<td>6.17</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>10</td>
<td>C</td>
<td>55</td>
<td>0.0006578</td>
<td>0.0001204</td>
<td>5.461</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>10</td>
<td>C</td>
<td>285</td>
<td>0.003415</td>
<td>0.0001955</td>
<td>17.47</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>10</td>
<td>C</td>
<td>175</td>
<td>0.002102</td>
<td>0.0001765</td>
<td>11.91</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>10</td>
<td>10</td>
<td>C</td>
<td>1000</td>
<td>0.01212</td>
<td>0.000281</td>
<td>43.13</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>10</td>
<td>10</td>
<td>C</td>
<td>385</td>
<td>0.004607</td>
<td>0.0002286</td>
<td>20.15</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>10</td>
<td>F</td>
<td>65</td>
<td>0.000773</td>
<td>0.0001093</td>
<td>7.07</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>10</td>
<td>F</td>
<td>55</td>
<td>0.0006463</td>
<td>0.000105</td>
<td>6.154</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>10</td>
<td>F</td>
<td>285</td>
<td>0.003366</td>
<td>0.0001625</td>
<td>20.72</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>10</td>
<td>F</td>
<td>175</td>
<td>0.002089</td>
<td>0.0001481</td>
<td>14.1</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>10</td>
<td>10</td>
<td>F</td>
<td>1000</td>
<td>0.01208</td>
<td>0.000225</td>
<td>53.66</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>10</td>
<td>10</td>
<td>F</td>
<td>385</td>
<td>0.004612</td>
<td>0.0001892</td>
<td>24.38</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>20</td>
<td>C</td>
<td>230</td>
<td>0.002709</td>
<td>0.0001918</td>
<td>14.12</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>20</td>
<td>C</td>
<td>210</td>
<td>0.002484</td>
<td>0.0001889</td>
<td>13.15</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>20</td>
<td>C</td>
<td>1770</td>
<td>0.02123</td>
<td>0.0003616</td>
<td>58.73</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>20</td>
<td>C</td>
<td>1350</td>
<td>0.01607</td>
<td>0.0003394</td>
<td>47.34</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>10</td>
<td>20</td>
<td>C</td>
<td>10625</td>
<td>0.1288</td>
<td>0.0007574</td>
<td>170.1</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>10</td>
<td>20</td>
<td>C</td>
<td>6195</td>
<td>0.07507</td>
<td>0.0006131</td>
<td>122.4</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>20</td>
<td>F</td>
<td>230</td>
<td>0.002718</td>
<td>0.0001609</td>
<td>16.89</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>20</td>
<td>F</td>
<td>210</td>
<td>0.002478</td>
<td>0.0001594</td>
<td>15.55</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>20</td>
<td>F</td>
<td>1770</td>
<td>0.02125</td>
<td>0.0002895</td>
<td>73.38</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>20</td>
<td>F</td>
<td>1350</td>
<td>0.0162</td>
<td>0.000274</td>
<td>59.15</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>10</td>
<td>20</td>
<td>F</td>
<td>10625</td>
<td>0.1277</td>
<td>0.000549</td>
<td>232.6</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>10</td>
<td>20</td>
<td>F</td>
<td>6195</td>
<td>0.0752</td>
<td>0.0004769</td>
<td>157.7</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>40</td>
<td>C</td>
<td>860</td>
<td>0.01015</td>
<td>0.000333</td>
<td>30.48</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>40</td>
<td>C</td>
<td>820</td>
<td>0.009671</td>
<td>0.0003341</td>
<td>28.95</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>40</td>
<td>C</td>
<td>12340</td>
<td>0.1478</td>
<td>0.0008955</td>
<td>165.1</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>40</td>
<td>C</td>
<td>10700</td>
<td>0.1285</td>
<td>0.0008335</td>
<td>154.2</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>40</td>
<td>F</td>
<td>860</td>
<td>0.01012</td>
<td>0.0002753</td>
<td>36.78</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>40</td>
<td>F</td>
<td>820</td>
<td>0.009767</td>
<td>0.0002754</td>
<td>35.46</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>40</td>
<td>F</td>
<td>12340</td>
<td>0.1473</td>
<td>0.0007126</td>
<td>206.7</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>40</td>
<td>F</td>
<td>10700</td>
<td>0.1282</td>
<td>0.0006595</td>
<td>194.4</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>60</td>
<td>C</td>
<td>1890</td>
<td>0.02235</td>
<td>0.0004914</td>
<td>45.48</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>60</td>
<td>C</td>
<td>1830</td>
<td>0.02181</td>
<td>0.0004963</td>
<td>43.94</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>60</td>
<td>C</td>
<td>39710</td>
<td>0.4824</td>
<td>0.002482</td>
<td>194.3</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>60</td>
<td>C</td>
<td>36050</td>
<td>0.4351</td>
<td>0.001694</td>
<td>256.8</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10</td>
<td>60</td>
<td>F</td>
<td>1890</td>
<td>0.02239</td>
<td>0.0003944</td>
<td>56.79</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10</td>
<td>60</td>
<td>F</td>
<td>1830</td>
<td>0.02163</td>
<td>0.0003957</td>
<td>54.65</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10</td>
<td>60</td>
<td>F</td>
<td>39710</td>
<td>0.4763</td>
<td>0.00162</td>
<td>294.1</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10</td>
<td>60</td>
<td>F</td>
<td>36050</td>
<td>0.4316</td>
<td>0.001336</td>
<td>323</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>10</td>
<td>C</td>
<td>65</td>
<td>0.0008296</td>
<td>0.0001576</td>
<td>5.264</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>10</td>
<td>C</td>
<td>55</td>
<td>0.0007</td>
<td>0.0001484</td>
<td>4.718</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100</td>
<td>10</td>
<td>C</td>
<td>285</td>
<td>0.003707</td>
<td>0.0002904</td>
<td>12.77</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100</td>
<td>10</td>
<td>C</td>
<td>175</td>
<td>0.002271</td>
<td>0.0002422</td>
<td>9.376</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>100</td>
<td>10</td>
<td>C</td>
<td>1000</td>
<td>0.01337</td>
<td>0.0005293</td>
<td>25.26</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>100</td>
<td>10</td>
<td>C</td>
<td>385</td>
<td>0.005079</td>
<td>0.0003534</td>
<td>14.37</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>10</td>
<td>F</td>
<td>65</td>
<td>0.000798</td>
<td>0.0001177</td>
<td>6.779</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>10</td>
<td>F</td>
<td>55</td>
<td>0.0006699</td>
<td>0.0001131</td>
<td>5.922</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100</td>
<td>10</td>
<td>F</td>
<td>285</td>
<td>0.003572</td>
<td>0.0001987</td>
<td>17.98</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100</td>
<td>10</td>
<td>F</td>
<td>175</td>
<td>0.002179</td>
<td>0.0001705</td>
<td>12.78</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>100</td>
<td>10</td>
<td>F</td>
<td>1000</td>
<td>0.0129</td>
<td>0.0003275</td>
<td>39.39</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>100</td>
<td>10</td>
<td>F</td>
<td>385</td>
<td>0.004821</td>
<td>0.0002342</td>
<td>20.59</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>20</td>
<td>C</td>
<td>230</td>
<td>0.002907</td>
<td>0.0002774</td>
<td>10.48</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>20</td>
<td>C</td>
<td>210</td>
<td>0.002706</td>
<td>0.0002697</td>
<td>10.03</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100</td>
<td>20</td>
<td>C</td>
<td>1770</td>
<td>0.02415</td>
<td>0.0007945</td>
<td>30.39</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100</td>
<td>20</td>
<td>C</td>
<td>1350</td>
<td>0.01813</td>
<td>0.0006914</td>
<td>26.22</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>100</td>
<td>20</td>
<td>C</td>
<td>10625</td>
<td>0.1521</td>
<td>0.003815</td>
<td>39.87</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>100</td>
<td>20</td>
<td>C</td>
<td>6195</td>
<td>0.085</td>
<td>0.001883</td>
<td>45.15</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>20</td>
<td>F</td>
<td>230</td>
<td>0.002789</td>
<td>0.0002023</td>
<td>13.79</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>20</td>
<td>F</td>
<td>210</td>
<td>0.002556</td>
<td>0.0001846</td>
<td>13.85</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100</td>
<td>20</td>
<td>F</td>
<td>1770</td>
<td>0.02203</td>
<td>0.0004801</td>
<td>45.89</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100</td>
<td>20</td>
<td>F</td>
<td>1350</td>
<td>0.01676</td>
<td>0.0004156</td>
<td>40.32</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>100</td>
<td>20</td>
<td>F</td>
<td>10625</td>
<td>0.1383</td>
<td>0.001949</td>
<td>70.93</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>100</td>
<td>20</td>
<td>F</td>
<td>6195</td>
<td>0.07894</td>
<td>0.001231</td>
<td>64.14</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>40</td>
<td>C</td>
<td>860</td>
<td>0.01129</td>
<td>0.0005974</td>
<td>18.89</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>40</td>
<td>C</td>
<td>820</td>
<td>0.01083</td>
<td>0.0005919</td>
<td>18.29</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100</td>
<td>40</td>
<td>C</td>
<td>12340</td>
<td>0.174</td>
<td>0.003936</td>
<td>44.22</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100</td>
<td>40</td>
<td>C</td>
<td>10700</td>
<td>0.1473</td>
<td>0.003214</td>
<td>45.82</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>40</td>
<td>F</td>
<td>860</td>
<td>0.0105</td>
<td>0.0003614</td>
<td>29.06</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>40</td>
<td>F</td>
<td>820</td>
<td>0.01</td>
<td>0.0003591</td>
<td>27.85</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100</td>
<td>40</td>
<td>F</td>
<td>12340</td>
<td>0.1552</td>
<td>0.002376</td>
<td>65.33</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100</td>
<td>40</td>
<td>F</td>
<td>10700</td>
<td>0.1359</td>
<td>0.001902</td>
<td>71.45</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>60</td>
<td>C</td>
<td>1890</td>
<td>0.02482</td>
<td>0.001022</td>
<td>24.28</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>60</td>
<td>C</td>
<td>1830</td>
<td>0.02418</td>
<td>0.001009</td>
<td>23.95</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100</td>
<td>60</td>
<td>F</td>
<td>1890</td>
<td>0.0232</td>
<td>0.0006073</td>
<td>38.21</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100</td>
<td>60</td>
<td>F</td>
<td>1830</td>
<td>0.02246</td>
<td>0.0005926</td>
<td>37.9</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>10</td>
<td>C</td>
<td>65</td>
<td>0.001398</td>
<td>0.0004639</td>
<td>3.013</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>10</td>
<td>C</td>
<td>55</td>
<td>0.00118</td>
<td>0.0004169</td>
<td>2.83</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1000</td>
<td>10</td>
<td>C</td>
<td>285</td>
<td>0.007529</td>
<td>0.00117</td>
<td>6.432</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1000</td>
<td>10</td>
<td>C</td>
<td>175</td>
<td>0.004174</td>
<td>0.0008793</td>
<td>4.748</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1000</td>
<td>10</td>
<td>C</td>
<td>1000</td>
<td>0.03284</td>
<td>0.003688</td>
<td>8.903</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1000</td>
<td>10</td>
<td>C</td>
<td>385</td>
<td>0.01127</td>
<td>0.001573</td>
<td>7.166</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>10</td>
<td>F</td>
<td>65</td>
<td>0.0009943</td>
<td>0.0001877</td>
<td>5.296</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>10</td>
<td>F</td>
<td>55</td>
<td>0.0008455</td>
<td>0.0001722</td>
<td>4.91</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1000</td>
<td>10</td>
<td>F</td>
<td>285</td>
<td>0.004644</td>
<td>0.0004681</td>
<td>9.921</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1000</td>
<td>10</td>
<td>F</td>
<td>175</td>
<td>0.002835</td>
<td>0.0003395</td>
<td>8.35</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1000</td>
<td>10</td>
<td>F</td>
<td>1000</td>
<td>0.01741</td>
<td>0.001503</td>
<td>11.59</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1000</td>
<td>10</td>
<td>F</td>
<td>385</td>
<td>0.006582</td>
<td>0.0006279</td>
<td>10.48</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>20</td>
<td>C</td>
<td>230</td>
<td>0.005635</td>
<td>0.001065</td>
<td>5.293</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>20</td>
<td>C</td>
<td>210</td>
<td>0.005056</td>
<td>0.001009</td>
<td>5.013</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1000</td>
<td>20</td>
<td>C</td>
<td>1770</td>
<td>0.05886</td>
<td>0.005778</td>
<td>10.19</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1000</td>
<td>20</td>
<td>C</td>
<td>1350</td>
<td>0.04458</td>
<td>0.004366</td>
<td>10.21</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1000</td>
<td>20</td>
<td>C</td>
<td>10625</td>
<td>0.539</td>
<td>0.1456</td>
<td>3.703</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1000</td>
<td>20</td>
<td>C</td>
<td>6195</td>
<td>0.2584</td>
<td>0.03266</td>
<td>7.912</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>20</td>
<td>F</td>
<td>230</td>
<td>0.003605</td>
<td>0.0004438</td>
<td>8.123</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>20</td>
<td>F</td>
<td>210</td>
<td>0.003225</td>
<td>0.0003981</td>
<td>8.101</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1000</td>
<td>20</td>
<td>F</td>
<td>1770</td>
<td>0.0298</td>
<td>0.002662</td>
<td>11.19</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1000</td>
<td>20</td>
<td>F</td>
<td>1350</td>
<td>0.02246</td>
<td>0.001989</td>
<td>11.29</td>
</tr>
<tr class="row-even"><td>4</td>
<td>False</td>
<td>1000</td>
<td>20</td>
<td>F</td>
<td>10625</td>
<td>0.2344</td>
<td>0.032</td>
<td>7.326</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>True</td>
<td>1000</td>
<td>20</td>
<td>F</td>
<td>6195</td>
<td>0.1392</td>
<td>0.01993</td>
<td>6.984</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>40</td>
<td>C</td>
<td>860</td>
<td>0.02653</td>
<td>0.00338</td>
<td>7.849</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>40</td>
<td>C</td>
<td>820</td>
<td>0.02517</td>
<td>0.003145</td>
<td>8.003</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1000</td>
<td>40</td>
<td>C</td>
<td>12340</td>
<td>0.5103</td>
<td>0.0592</td>
<td>8.62</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1000</td>
<td>40</td>
<td>C</td>
<td>10700</td>
<td>0.4357</td>
<td>0.05293</td>
<td>8.233</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>40</td>
<td>F</td>
<td>860</td>
<td>0.01353</td>
<td>0.001431</td>
<td>9.455</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>40</td>
<td>F</td>
<td>820</td>
<td>0.01271</td>
<td>0.001304</td>
<td>9.746</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>1000</td>
<td>40</td>
<td>F</td>
<td>12340</td>
<td>0.2611</td>
<td>0.03768</td>
<td>6.931</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>1000</td>
<td>40</td>
<td>F</td>
<td>10700</td>
<td>0.2288</td>
<td>0.03337</td>
<td>6.857</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>60</td>
<td>C</td>
<td>1890</td>
<td>0.06103</td>
<td>0.006978</td>
<td>8.746</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>60</td>
<td>C</td>
<td>1830</td>
<td>0.05777</td>
<td>0.006349</td>
<td>9.099</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>1000</td>
<td>60</td>
<td>F</td>
<td>1890</td>
<td>0.03049</td>
<td>0.002828</td>
<td>10.78</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>1000</td>
<td>60</td>
<td>F</td>
<td>1830</td>
<td>0.02882</td>
<td>0.002879</td>
<td>10.01</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>10</td>
<td>C</td>
<td>65</td>
<td>0.00619</td>
<td>0.004732</td>
<td>1.308</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>10</td>
<td>C</td>
<td>55</td>
<td>0.00521</td>
<td>0.003208</td>
<td>1.624</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10000</td>
<td>10</td>
<td>C</td>
<td>285</td>
<td>0.03784</td>
<td>0.0178</td>
<td>2.126</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10000</td>
<td>10</td>
<td>C</td>
<td>175</td>
<td>0.01996</td>
<td>0.01122</td>
<td>1.779</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>10</td>
<td>F</td>
<td>65</td>
<td>0.002776</td>
<td>0.0008052</td>
<td>3.448</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>10</td>
<td>F</td>
<td>55</td>
<td>0.002354</td>
<td>0.0006884</td>
<td>3.419</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10000</td>
<td>10</td>
<td>F</td>
<td>285</td>
<td>0.01434</td>
<td>0.003655</td>
<td>3.923</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10000</td>
<td>10</td>
<td>F</td>
<td>175</td>
<td>0.008721</td>
<td>0.002185</td>
<td>3.992</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>20</td>
<td>C</td>
<td>230</td>
<td>0.02457</td>
<td>0.01388</td>
<td>1.77</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>20</td>
<td>C</td>
<td>210</td>
<td>0.02166</td>
<td>0.01278</td>
<td>1.695</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10000</td>
<td>20</td>
<td>C</td>
<td>1770</td>
<td>0.5034</td>
<td>0.2072</td>
<td>2.429</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10000</td>
<td>20</td>
<td>C</td>
<td>1350</td>
<td>0.2725</td>
<td>0.1079</td>
<td>2.526</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>20</td>
<td>F</td>
<td>230</td>
<td>0.01001</td>
<td>0.002778</td>
<td>3.604</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>20</td>
<td>F</td>
<td>210</td>
<td>0.008921</td>
<td>0.002488</td>
<td>3.585</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10000</td>
<td>20</td>
<td>F</td>
<td>1770</td>
<td>0.1334</td>
<td>0.04963</td>
<td>2.689</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10000</td>
<td>20</td>
<td>F</td>
<td>1350</td>
<td>0.103</td>
<td>0.03926</td>
<td>2.623</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>40</td>
<td>C</td>
<td>860</td>
<td>0.1518</td>
<td>0.07155</td>
<td>2.121</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>40</td>
<td>C</td>
<td>820</td>
<td>0.144</td>
<td>0.06856</td>
<td>2.1</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10000</td>
<td>40</td>
<td>C</td>
<td>12340</td>
<td>3.63</td>
<td>1.43</td>
<td>2.539</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10000</td>
<td>40</td>
<td>C</td>
<td>10700</td>
<td>2.71</td>
<td>0.5692</td>
<td>4.761</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>40</td>
<td>F</td>
<td>860</td>
<td>0.06095</td>
<td>0.02708</td>
<td>2.25</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>40</td>
<td>F</td>
<td>820</td>
<td>0.05662</td>
<td>0.02376</td>
<td>2.383</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>10000</td>
<td>40</td>
<td>F</td>
<td>12340</td>
<td>0.9268</td>
<td>0.3321</td>
<td>2.791</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>10000</td>
<td>40</td>
<td>F</td>
<td>10700</td>
<td>0.8235</td>
<td>0.3032</td>
<td>2.716</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>60</td>
<td>C</td>
<td>1890</td>
<td>0.3639</td>
<td>0.1596</td>
<td>2.28</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>60</td>
<td>C</td>
<td>1830</td>
<td>0.3449</td>
<td>0.1462</td>
<td>2.36</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>10000</td>
<td>60</td>
<td>F</td>
<td>1890</td>
<td>0.1308</td>
<td>0.05353</td>
<td>2.444</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>10000</td>
<td>60</td>
<td>F</td>
<td>1830</td>
<td>0.1268</td>
<td>0.05183</td>
<td>2.447</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>10</td>
<td>C</td>
<td>65</td>
<td>0.123</td>
<td>0.07495</td>
<td>1.642</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>10</td>
<td>C</td>
<td>55</td>
<td>0.1031</td>
<td>0.0643</td>
<td>1.603</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100000</td>
<td>10</td>
<td>C</td>
<td>285</td>
<td>0.733</td>
<td>0.2586</td>
<td>2.834</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100000</td>
<td>10</td>
<td>C</td>
<td>175</td>
<td>0.4261</td>
<td>0.1727</td>
<td>2.468</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>10</td>
<td>F</td>
<td>65</td>
<td>0.03554</td>
<td>0.02029</td>
<td>1.752</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>10</td>
<td>F</td>
<td>55</td>
<td>0.03013</td>
<td>0.0172</td>
<td>1.752</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100000</td>
<td>10</td>
<td>F</td>
<td>285</td>
<td>0.1837</td>
<td>0.08313</td>
<td>2.209</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100000</td>
<td>10</td>
<td>F</td>
<td>175</td>
<td>0.1141</td>
<td>0.05276</td>
<td>2.163</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>20</td>
<td>C</td>
<td>230</td>
<td>0.5694</td>
<td>0.221</td>
<td>2.577</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>20</td>
<td>C</td>
<td>210</td>
<td>0.5096</td>
<td>0.2049</td>
<td>2.488</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100000</td>
<td>20</td>
<td>C</td>
<td>1770</td>
<td>7.795</td>
<td>2.027</td>
<td>3.845</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100000</td>
<td>20</td>
<td>C</td>
<td>1350</td>
<td>6.868</td>
<td>1.136</td>
<td>6.043</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>20</td>
<td>F</td>
<td>230</td>
<td>0.1307</td>
<td>0.07256</td>
<td>1.801</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>20</td>
<td>F</td>
<td>210</td>
<td>0.1153</td>
<td>0.0621</td>
<td>1.856</td>
</tr>
<tr class="row-even"><td>3</td>
<td>False</td>
<td>100000</td>
<td>20</td>
<td>F</td>
<td>1770</td>
<td>1.151</td>
<td>0.4576</td>
<td>2.516</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>True</td>
<td>100000</td>
<td>20</td>
<td>F</td>
<td>1350</td>
<td>1.356</td>
<td>0.3993</td>
<td>3.398</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>40</td>
<td>C</td>
<td>860</td>
<td>3.94</td>
<td>0.7977</td>
<td>4.939</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>40</td>
<td>C</td>
<td>820</td>
<td>3.163</td>
<td>0.7609</td>
<td>4.157</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>40</td>
<td>F</td>
<td>860</td>
<td>0.475</td>
<td>0.2499</td>
<td>1.9</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>40</td>
<td>F</td>
<td>820</td>
<td>0.457</td>
<td>0.2381</td>
<td>1.919</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>60</td>
<td>C</td>
<td>1890</td>
<td>8.46</td>
<td>3.196</td>
<td>2.647</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>60</td>
<td>C</td>
<td>1830</td>
<td>7.702</td>
<td>1.607</td>
<td>4.794</td>
</tr>
<tr class="row-even"><td>2</td>
<td>False</td>
<td>100000</td>
<td>60</td>
<td>F</td>
<td>1890</td>
<td>1.43</td>
<td>0.7338</td>
<td>1.949</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>True</td>
<td>100000</td>
<td>60</td>
<td>F</td>
<td>1830</td>
<td>1.408</td>
<td>0.5349</td>
<td>2.632</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="benchmark-code">
<h2><a class="toc-backref" href="#id5">Benchmark code</a><a class="headerlink" href="#benchmark-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># coding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Benchmark of polynomial features for dense matrices</span>
<span class="sd">implemented in 0.20.2 against implementation from PR #13290.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Authors: Xavier Dupré (benchmark)</span>
<span class="c1"># License: MIT</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations_with_replacement</span> <span class="k">as</span> <span class="n">combinations_w_r</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">rand</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_almost_equal</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>


<span class="c1">##############################</span>
<span class="c1"># Implementations to benchmark.</span>
<span class="c1">##############################</span>

<span class="k">def</span> <span class="nf">_combinations</span><span class="p">(</span><span class="n">n_features</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">include_bias</span><span class="p">):</span>
    <span class="n">comb</span> <span class="o">=</span> <span class="p">(</span><span class="n">combinations</span> <span class="k">if</span> <span class="n">interaction_only</span> <span class="k">else</span> <span class="n">combinations_w_r</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">include_bias</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_features</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fct_polynomial_features_0_20_2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="s2">&quot;PolynomialFeature 0.20.2 for dense matrices (no bias).&quot;</span>
    <span class="n">comb</span> <span class="o">=</span> <span class="n">_combinations</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span>
                         <span class="n">include_bias</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_feat</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">comb</span><span class="o">=</span><span class="n">comb</span><span class="p">):</span>
        <span class="n">XP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">comb</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comb</span><span class="p">):</span>
            <span class="n">XP</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">comb</span><span class="p">]</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">XP</span>

    <span class="k">return</span> <span class="n">compute_feat</span>


<span class="k">def</span> <span class="nf">fct_polynomial_features</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="s2">&quot;Current implementation of PolynomialFeatures.&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                               <span class="n">interaction_only</span><span class="o">=</span><span class="n">interaction_only</span><span class="p">,</span>
                               <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_feat</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">compute_feat</span>


<span class="c1">##############################</span>
<span class="c1"># Benchmarks</span>
<span class="c1">##############################</span>

<span class="k">def</span> <span class="nf">allow_configuration</span><span class="p">(</span><span class="n">n_obs</span><span class="p">,</span> <span class="n">n_feature</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_feature</span> <span class="o">&gt;=</span> <span class="mi">60</span> <span class="ow">and</span> <span class="n">degree</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">n_obs</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">n_feature</span> <span class="o">&gt;=</span> <span class="mi">60</span> <span class="ow">and</span> <span class="n">degree</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">n_obs</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">n_feature</span> <span class="o">&gt;=</span> <span class="mi">40</span> <span class="ow">and</span> <span class="n">degree</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">n_obs</span> <span class="o">&gt;=</span> <span class="mi">10000</span> <span class="ow">and</span> <span class="n">degree</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">n_obs</span> <span class="o">&gt;=</span> <span class="mi">100000</span> <span class="ow">and</span> <span class="n">degree</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">n_feature</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">bench</span><span class="p">(</span><span class="n">n_obs</span><span class="p">,</span> <span class="n">n_features</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">interactions_only</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span>
          <span class="n">repeat</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_obs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">nfeat</span> <span class="ow">in</span> <span class="n">n_features</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">nfeat</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
                <span class="n">X</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nfeat</span><span class="p">)[:,</span> <span class="p">:]</span>
                <span class="k">for</span> <span class="n">degree</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">interaction_only</span> <span class="ow">in</span> <span class="n">interactions_only</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_configuration</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nfeat</span><span class="p">,</span>
                                                   <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
                            <span class="k">continue</span>

                        <span class="n">obs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">nfeat</span><span class="o">=</span><span class="n">nfeat</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
                                   <span class="n">interaction_only</span><span class="o">=</span><span class="n">interaction_only</span><span class="p">,</span>
                                   <span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">)</span>
                        <span class="n">fct1</span> <span class="o">=</span> <span class="n">fct_polynomial_features_0_20_2</span><span class="p">(</span>
                            <span class="n">X</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
                        <span class="n">fct2</span> <span class="o">=</span> <span class="n">fct_polynomial_features</span><span class="p">(</span>
                            <span class="n">X</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

                        <span class="c1"># creates different inputs to avoid caching in any ways</span>
                        <span class="n">Xs</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat</span><span class="p">):</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">nfeat</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
                            <span class="n">x</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nfeat</span><span class="p">)[:,</span> <span class="p">:]</span>
                            <span class="n">Xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                        <span class="c1"># measures the baseline</span>
                        <span class="n">st</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">Xs</span><span class="p">:</span>
                            <span class="n">p1</span> <span class="o">=</span> <span class="n">fct1</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                            <span class="n">r</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">break</span>  <span class="c1"># stops if longer than a second</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                        <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;time_0_20_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span>

                        <span class="c1"># measures the new implementation</span>
                        <span class="n">st</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                        <span class="n">r2</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">X</span> <span class="ow">in</span> <span class="n">Xs</span><span class="p">:</span>
                            <span class="n">p2</span> <span class="o">=</span> <span class="n">fct2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                            <span class="n">r2</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">:</span>
                                <span class="k">break</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                        <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;time_current&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">st</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span>
                        <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;out_feat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;bench&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

                        <span class="c1"># checks that both produce the same outputs</span>
                        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">10000</span><span class="p">:</span>
                            <span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="c1">##############################</span>
<span class="c1"># Plots.</span>
<span class="c1">##############################</span>

<span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">degree</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">di</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">degree</span><span class="p">))):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">order</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">interaction_only</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">interaction_only</span><span class="p">)):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">di</span><span class="p">,</span> <span class="n">pos</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">di</span> <span class="o">==</span> <span class="n">ax</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;N observations&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Time (s) degree={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">degree</span><span class="p">),</span>
                                 <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">nfeat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;brgyc&#39;</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">nfeat</span><span class="p">))):</span>
                    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="n">degree</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">nfeat</span> <span class="o">==</span> <span class="n">nfeat</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">interaction_only</span> <span class="o">==</span> <span class="n">interaction_only</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="n">order</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="n">subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;nf={} l=0.20.2&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfeat</span><span class="p">)</span>
                    <span class="n">subset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;time_0_20_2&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                <span class="n">logx</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;nf={} l=now&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfeat</span><span class="p">)</span>
                    <span class="n">subset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;time_current&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                                <span class="n">logx</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

                <span class="n">a</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">di</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;order={} interaction_only={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">order</span><span class="p">,</span> <span class="n">interaction_only</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Benchmark for PolynomialFeatures&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run_bench</span><span class="p">(</span><span class="n">repeat</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">n_obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]</span>
    <span class="n">n_features</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">]</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">interactions_only</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
    <span class="n">orders</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">bench</span><span class="p">(</span><span class="n">n_obs</span><span class="p">,</span> <span class="n">n_features</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">interactions_only</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span>
                    <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total time = </span><span class="si">%0.3f</span><span class="s2"> sec</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

    <span class="c1"># plot the results</span>
    <span class="n">plot_results</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results_df</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sklearn</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;numpy:&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;scikit-learn:&quot;</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">run_bench</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;bench_polynomial_features.png&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;bench_polynomial_features.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="section" id="alternatives">
<h2><a class="toc-backref" href="#id6">Alternatives</a><a class="headerlink" href="#alternatives" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transpose-if-order-c-and-size-10e7">
<h3><a class="toc-backref" href="#id7">Transpose if order==’C’ and size &lt; 10e7</a><a class="headerlink" href="#transpose-if-order-c-and-size-10e7" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../_downloads/db13b1bdf758b46648b8570aa71de4ef/bench_polynomial_features_transpose.csv"><code class="xref download docutils literal notranslate"><span class="pre">bench_polynomial_features.csv</span></code></a></p>
<a class="reference internal image-reference" href="../_images/bench_polynomial_features_transpose.png"><img alt="../_images/bench_polynomial_features_transpose.png" src="../_images/bench_polynomial_features_transpose.png" style="width: 800px;" /></a>
</div>
<div class="section" id="never-transpose">
<h3><a class="toc-backref" href="#id8">Never transpose</a><a class="headerlink" href="#never-transpose" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../_downloads/6ef60a2f0cfe649902130c7d1fed24cd/bench_polynomial_features_notranspose.csv"><code class="xref download docutils literal notranslate"><span class="pre">bench_polynomial_features_notranspose.csv</span></code></a></p>
<a class="reference internal image-reference" href="../_images/bench_polynomial_features_notranspose.png"><img alt="../_images/bench_polynomial_features_notranspose.png" src="../_images/bench_polynomial_features_notranspose.png" style="width: 800px;" /></a>
</div>
</div>
<div class="section" id="number-of-output-features">
<h2><a class="toc-backref" href="#id9">Number of output features</a><a class="headerlink" href="#number-of-output-features" title="Permalink to this headline">¶</a></h2>
<p>The following code use a linear regression to find out
the relationship between the number of output features and
the number of features.</p>
<p>&lt;&lt;&lt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span>

<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">__WD__</span><span class="p">,</span> <span class="s2">&quot;../../scikit-learn/results/bench_polynomial_features.csv&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;degree interaction_only n f order of time_0_20_2 time_current&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">degrees</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">degree</span><span class="p">)))</span>
<span class="n">ionlys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">interaction_only</span><span class="p">)))</span>
<span class="n">orders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">order</span><span class="p">)))</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">degrees</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">io</span> <span class="ow">in</span> <span class="n">ionlys</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="n">d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">interaction_only</span> <span class="o">==</span> <span class="n">io</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="n">o</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span> <span class="s2">&quot;interaction_only&quot;</span><span class="p">,</span> <span class="s2">&quot;order&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[[</span><span class="s2">&quot;f&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f^2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f^3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;f^2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f^4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;f^2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;f^2&#39;</span><span class="p">]</span>

            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;of&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="c1"># number of output features</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cst&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">reg</span><span class="o">.</span><span class="n">intercept_</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">form</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="n">io</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="n">o</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">coefs</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-4</span><span class="p">:</span>
                    <span class="n">form</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>

            <span class="c1"># formula</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>&gt;&gt;&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">1.4479336930936064</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.27165029676397506</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.5031692534639053</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">1.4479336930936064</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.27165029676397506</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.5031692534639053</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.48336342856243714</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.08679950310796479</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.501012660870124</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.48336342856243714</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.08679950310796479</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.501012660870124</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">1.7705270670289486</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.32768486774558864</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">1.0038229901227265</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="mf">0.1665779186816733</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">1.7705270670289486</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.32768486774558864</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">1.0038229901227265</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="mf">0.1665779186816733</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.8038002098581859</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.1540858616451886</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.0017976683853484928</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="mf">0.16662493507914947</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.8038002098581859</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.1540858616451886</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.0017976683853484928</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="mf">0.16662493507914947</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.011471050804572044</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.0012288032071543224</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.09837088270379162</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="mf">0.656916320199341</span><span class="p">,</span> <span class="s1">&#39;f^4&#39;</span><span class="p">:</span> <span class="mf">0.033313065221902895</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">0.011471050804572044</span><span class="p">,</span> <span class="s1">&#39;bias&#39;</span><span class="p">:</span> <span class="mf">0.0012288032071543224</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="mf">0.09837088270379162</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="mf">0.656916320199341</span><span class="p">,</span> <span class="s1">&#39;f^4&#39;</span><span class="p">:</span> <span class="mf">0.033313065221902895</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0001035465640466857</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.000831923032214686</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.004248378157103456</span><span class="p">,</span> <span class="s1">&#39;f^4&#39;</span><span class="p">:</span> <span class="mf">0.03893326172983353</span><span class="p">}</span>
    <span class="p">{</span><span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;ionly&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0001035465640466857</span><span class="p">,</span> <span class="s1">&#39;f^2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.000831923032214686</span><span class="p">,</span> <span class="s1">&#39;f^3&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.004248378157103456</span><span class="p">,</span> <span class="s1">&#39;f^4&#39;</span><span class="p">:</span> <span class="mf">0.03893326172983353</span><span class="p">}</span>
</pre></div>
</div>
<p>It is not easy to guess the cost of an algorithm with
this kind of method as the different of scales between
features is quite high. It is numerically difficult
to have precise coefficients.</p>
</div>
</div>

    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"
        integrity="sha384-THPy051/pYDQGanwU6poAc/hOdQxjnOEXzbT+OuUAFqNqFjL+4IGLBgCJC3ZOShY"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js"
        integrity="sha384-Plbmg8JY28KFelvJVai01l8WyZzrYWG825m+cZ0eDDS1f7d/js6ikvy1+X+guPIB"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/js/bootstrap.min.js"
        integrity="sha384-ux8v3A6CPtOTqOzMKiuo3d/DomGaaClxFYdCu2HPMBEkf6x2xiDyJ7gkXU0MWwaD"
        crossorigin="anonymous"></script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/0.6.0/lunr.min.js"></script>
<script src="../_static/searchtools.js"></script>
<script>$('#searchbox').show(0)</script>
</body>
</html>